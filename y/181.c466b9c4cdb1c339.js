"use strict";(self.webpackChunkModeloParcial=self.webpackChunkModeloParcial||[]).push([[181],{1445:(hh,Mi,K)=>{K.d(Mi,{v:()=>p});class p{constructor(R=0,je="",Ht="",bt="",Mr=0,jn=""){this.id=R,this.nombre=je,this.apellido=Ht,this.pais=bt,this.foto=jn}}},1998:(hh,Mi,K)=>{K.d(Mi,{R:()=>ZI});var p=K(5861),$=K(5e3),R=K(7579),je=K(9646),Ht=K(8306),bt=K(8996),Mr=K(6451),jn=K(5363),tt=K(3900),nt=K(4004),xl=K(6063);class fn extends R.x{constructor(e=1/0,t=1/0,r=xl.l){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=r,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:r,_infiniteTimeWindow:i,_timestampProvider:o,_windowTime:u}=this;t||(r.push(e),!i&&r.push(o.now()+u)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:r,_buffer:i}=this,o=i.slice();for(let u=0;u<o.length&&!e.closed;u+=r?1:2)e.next(o[u]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:r,_infiniteTimeWindow:i}=this,o=(i?1:2)*e;if(e<1/0&&o<r.length&&r.splice(0,r.length-o),!i){const u=t.now();let h=0;for(let m=1;m<r.length&&r[m]<=u;m+=2)h=m;h&&r.splice(0,h+1)}}}var oo=K(3099);function Ct(n,e,t){let r,i=!1;return n&&"object"==typeof n?({bufferSize:r=1/0,windowTime:e=1/0,refCount:i=!1,scheduler:t}=n):r=null!=n?n:1/0,(0,oo.B)({connector:()=>new fn(r,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:i})}var _t=K(590),Ua=K(576);function Pr(n,e){return(0,Ua.m)(e)?(0,tt.w)(()=>n,e):(0,tt.w)(()=>n)}var ao=K(9468),Vr=K(9300),Se=K(5813),se=K(2011),fe=K(9808);K(5867);var zt=K(9681),Kn=K(4859),W=K(2090),ue=K(1877);const Hn=new Map,Fr={activated:!1,tokenObservers:[]},Ur={initialized:!1,enabled:!1};function le(n){return Hn.get(n)||Fr}function ze(n,e){Hn.set(n,e)}function Zt(){return Ur}class go{constructor(e,t,r,i,o){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=o,this.pending=null,this.nextErrorWaitInterval=i,i>o)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){var t=this;return(0,p.Z)(function*(){t.stop();try{t.pending=new W.BH,yield function mo(n){return new Promise(e=>{setTimeout(e,n)})}(t.getNextRun(e)),t.pending.resolve(),yield t.pending.promise,t.pending=new W.BH,yield t.operation(),t.pending.resolve(),yield t.pending.promise,t.process(!0).catch(()=>{})}catch(r){t.retryPolicy(r)?t.process(!1).catch(()=>{}):t.stop()}})()}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}const $e=new W.LL("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function gn(n){if(!le(n).activated)throw $e.create("use-before-activation",{appName:n.name})}function ut(n,e){return jr.apply(this,arguments)}function jr(){return(jr=(0,p.Z)(function*({url:n,body:e},t){const r={"Content-Type":"application/json"},i=t.getImmediate({optional:!0});if(i){const E=yield i.getHeartbeatsHeader();E&&(r["X-Firebase-Client"]=E)}const o={method:"POST",body:JSON.stringify(e),headers:r};let u,h;try{u=yield fetch(n,o)}catch(E){throw $e.create("fetch-network-error",{originalErrorMessage:E.message})}if(200!==u.status)throw $e.create("fetch-status-error",{httpStatus:u.status});try{h=yield u.json()}catch(E){throw $e.create("fetch-parse-error",{originalErrorMessage:E.message})}const m=h.ttl.match(/^([\d.]+)(s)$/);if(!m||!m[2]||isNaN(Number(m[1])))throw $e.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${h.ttl}`});const _=1e3*Number(m[1]),w=Date.now();return{token:h.attestationToken,expireTimeMillis:w+_,issuedAtTimeMillis:w}})).apply(this,arguments)}function Ga(n,e){const{projectId:t,appId:r,apiKey:i}=n.options;return{url:`https://content-firebaseappcheck.googleapis.com/v1beta/projects/${t}/apps/${r}:exchangeDebugToken?key=${i}`,body:{debug_token:e}}}const Zn="firebase-app-check-store";let Wr=null;function _o(){return Wr||(Wr=new Promise((n,e)=>{try{const t=indexedDB.open("firebase-app-check-database",1);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e($e.create("storage-open",{originalErrorMessage:null===(i=r.target.error)||void 0===i?void 0:i.message}))},t.onupgradeneeded=r=>{0===r.oldVersion&&r.target.result.createObjectStore(Zn,{keyPath:"compositeKey"})}}catch(t){e($e.create("storage-open",{originalErrorMessage:t.message}))}}),Wr)}function vo(){return(vo=(0,p.Z)(function*(n,e){const r=(yield _o()).transaction(Zn,"readwrite"),o=r.objectStore(Zn).put({compositeKey:n,value:e});return new Promise((u,h)=>{o.onsuccess=m=>{u()},r.onerror=m=>{var _;h($e.create("storage-set",{originalErrorMessage:null===(_=m.target.error)||void 0===_?void 0:_.message}))}})})).apply(this,arguments)}const In=new ue.Yd("@firebase/app-check");function Kr(n,e){return(0,W.hl)()?function vn(n,e){return function ct(n,e){return vo.apply(this,arguments)}(function Yt(n){return`${n.options.appId}-${n.name}`}(n),e)}(n,e).catch(t=>{In.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Ui(){return Zt().enabled}function Hr(){return Qt.apply(this,arguments)}function Qt(){return(Qt=(0,p.Z)(function*(){const n=Zt();if(n.enabled&&n.token)return n.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")})).apply(this,arguments)}const ja={error:"UNKNOWN_ERROR"};function wo(n){return W.US.encodeString(JSON.stringify(n),!1)}function Jt(n){return Jn.apply(this,arguments)}function Jn(){return(Jn=(0,p.Z)(function*(n,e=!1){const t=n.app;gn(t);const r=le(t);let o,i=r.token;if(!i){const m=yield r.cachedTokenPromise;m&&Nt(m)&&(i=m)}if(!e&&i&&Nt(i))return{token:i.token};let h,u=!1;if(Ui()){r.exchangeTokenPromise||(r.exchangeTokenPromise=ut(Ga(t,yield Hr()),n.heartbeatServiceProvider).then(_=>(r.exchangeTokenPromise=void 0,_)),u=!0);const m=yield r.exchangeTokenPromise;return yield Kr(t,m),ze(t,Object.assign(Object.assign({},r),{token:m})),{token:m.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().then(m=>(r.exchangeTokenPromise=void 0,m)),u=!0),i=yield r.exchangeTokenPromise}catch(m){"appCheck/throttled"===m.code?In.warn(m.message):In.error(m),o=m}return i?(h={token:i.token},ze(t,Object.assign(Object.assign({},r),{token:i})),yield Kr(t,i)):h=$a(o),u&&Xt(t,h),h})).apply(this,arguments)}function Xn(n,e){const t=le(n),r=t.tokenObservers.filter(i=>i.next!==e);0===r.length&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),ze(n,Object.assign(Object.assign({},t),{tokenObservers:r}))}function ge(n){const{app:e}=n,t=le(e);let r=t.tokenRefresher;r||(r=function er(n){const{app:e}=n;return new go((0,p.Z)(function*(){let r;if(r=le(e).token?yield Jt(n,!0):yield Jt(n),r.error)throw r.error}),()=>!0,()=>{const t=le(e);if(t.token){let r=t.token.issuedAtTimeMillis+.5*(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)+3e5;return r=Math.min(r,t.token.expireTimeMillis-3e5),Math.max(0,r-Date.now())}return 0},3e4,96e4)}(n),ze(e,Object.assign(Object.assign({},t),{tokenRefresher:r}))),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function Xt(n,e){const t=le(n).tokenObservers;for(const r of t)try{"EXTERNAL"===r.type&&null!=e.error?r.error(e.error):r.next(e)}catch(i){}}function Nt(n){return n.expireTimeMillis-Date.now()>0}function $a(n){return{token:wo(ja),error:n}}class zr{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=le(this.app);for(const t of e)Xn(this.app,t.next);return Promise.resolve()}}const Ao="app-check-internal";!function It(){(0,zt._registerComponent)(new Kn.wA("app-check",n=>function Eo(n,e){return new zr(n,e)}(n.getProvider("app").getImmediate(),n.getProvider("heartbeat")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Ao).initialize()})),(0,zt._registerComponent)(new Kn.wA(Ao,n=>function Lt(n){return{getToken:e=>Jt(n,e),addTokenListener:e=>function Gi(n,e,t,r){const{app:i}=n,o=le(i),u={next:t,error:r,type:e};if(ze(i,Object.assign(Object.assign({},o),{tokenObservers:[...o.tokenObservers,u]})),o.token&&Nt(o.token)){const h=o.token;Promise.resolve().then(()=>{t({token:h.token}),ge(n)}).catch(()=>{})}o.cachedTokenPromise.then(()=>ge(n))}(n,"INTERNAL",e),removeTokenListener:e=>Xn(n.app,e)}}(n.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),(0,zt.registerVersion)("@firebase/app-check","0.5.6")}();class bo{constructor(){return(0,Se.vb)("app-check")}}"undefined"!=typeof window&&window,K(127);const Xi=new $.OlP("angularfire2.auth.use-emulator"),es=new $.OlP("angularfire2.auth.settings"),on=new $.OlP("angularfire2.auth.tenant-id"),ur=new $.OlP("angularfire2.auth.langugage-code"),bn=new $.OlP("angularfire2.auth.use-device-language"),ts=new $.OlP("angularfire.auth.persistence"),Jr=(n,e,t,r,i,o,u,h)=>(0,se.cc)(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{const m=e.runOutsideAngular(()=>n.auth());if(t&&m.useEmulator(...t),r&&(m.tenantId=r),m.languageCode=i,o&&m.useDeviceLanguage(),u)for(const[_,w]of Object.entries(u))m.settings[_]=w;return h&&m.setPersistence(h),m},[t,r,i,o,u,h]);let lr=(()=>{class n{constructor(t,r,i,o,u,h,m,_,w,E,A,D){const k=new R.x,F=(0,je.of)(void 0).pipe((0,jn.Q)(u.outsideAngular),(0,tt.w)(()=>o.runOutsideAngular(()=>Promise.resolve().then(K.bind(K,820)))),(0,nt.U)(()=>(0,se.on)(t,o,r)),(0,nt.U)(Y=>Jr(Y,o,h,_,w,E,m,A)),Ct({bufferSize:1,refCount:!1}));if((0,fe.PM)(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,je.of)(null);else{F.pipe((0,_t.P)()).subscribe();const de=F.pipe((0,tt.w)(te=>te.getRedirectResult().then(ie=>ie,()=>null)),Se.iC,Ct({bufferSize:1,refCount:!1})),we=F.pipe((0,tt.w)(te=>new Ht.y(ie=>({unsubscribe:o.runOutsideAngular(()=>te.onAuthStateChanged(ce=>ie.next(ce),ce=>ie.error(ce),()=>ie.complete()))})))),ae=F.pipe((0,tt.w)(te=>new Ht.y(ie=>({unsubscribe:o.runOutsideAngular(()=>te.onIdTokenChanged(ce=>ie.next(ce),ce=>ie.error(ce),()=>ie.complete()))}))));this.authState=de.pipe(Pr(we),(0,ao.R)(u.outsideAngular),(0,jn.Q)(u.insideAngular)),this.user=de.pipe(Pr(ae),(0,ao.R)(u.outsideAngular),(0,jn.Q)(u.insideAngular)),this.idToken=this.user.pipe((0,tt.w)(te=>te?(0,bt.D)(te.getIdToken()):(0,je.of)(null))),this.idTokenResult=this.user.pipe((0,tt.w)(te=>te?(0,bt.D)(te.getIdTokenResult()):(0,je.of)(null))),this.credential=(0,Mr.T)(de,k,this.authState.pipe((0,Vr.h)(te=>!te))).pipe((0,nt.U)(te=>(null==te?void 0:te.user)?te:null),(0,ao.R)(u.outsideAngular),(0,jn.Q)(u.insideAngular))}return(0,se.pX)(this,F,o,{spy:{apply:(Y,de,we)=>{(Y.startsWith("signIn")||Y.startsWith("createUser"))&&we.then(ae=>k.next(ae))}}})}}return n.\u0275fac=function(t){return new(t||n)($.LFG(se.Dh),$.LFG(se.xv,8),$.LFG($.Lbi),$.LFG($.R0b),$.LFG(Se.HU),$.LFG(Xi,8),$.LFG(es,8),$.LFG(on,8),$.LFG(ur,8),$.LFG(bn,8),$.LFG(ts,8),$.LFG(bo,8))},n.\u0275prov=$.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();var Xr=K(4986),ei=K(8675),cr=K(4482),hr=K(5403);function dr(){return(0,cr.e)((n,e)=>{let t,r=!1;n.subscribe((0,hr.x)(e,i=>{const o=t;t=i,r&&e.next([o,i]),r=!0}))})}var Et=K(5026),Ja=K(4671);function ns(n,e){return n===e}K(820);var U,ni=K(3942),is="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},it={},ri=ri||{},Z=is||self;function an(){}function Cn(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Sn(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var si="closure_uid_"+(1e9*Math.random()>>>0),oi=0;function Ol(n,e,t){return n.call.apply(n.bind,arguments)}function Co(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function Ve(n,e,t){return(Ve=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ol:Co).apply(null,arguments)}function un(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function Ee(n,e){function t(){}t.prototype=e.prototype,n.Z=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Vb=function(r,i,o){for(var u=Array(arguments.length-2),h=2;h<arguments.length;h++)u[h-2]=arguments[h];return e.prototype[i].apply(r,u)}}function Tt(){this.s=this.s,this.o=this.o}var Ml={};Tt.prototype.s=!1,Tt.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var n=function ii(n){return Object.prototype.hasOwnProperty.call(n,si)&&n[si]||(n[si]=++oi)}(this);delete Ml[n]}},Tt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const os=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1},g=Array.prototype.forEach?function(n,e,t){Array.prototype.forEach.call(n,e,t)}:function(n,e,t){const r=n.length,i="string"==typeof n?n.split(""):n;for(let o=0;o<r;o++)o in i&&e.call(t,i[o],o,n)};function d(n){return Array.prototype.concat.apply([],arguments)}function v(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function x(n){return/^[\s\xa0]*$/.test(n)}var ye,B=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function ee(n,e){return-1!=n.indexOf(e)}function Le(n,e){return n<e?-1:n>e?1:0}e:{var Ot=Z.navigator;if(Ot){var fr=Ot.userAgent;if(fr){ye=fr;break e}}ye=""}function pr(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function ai(n){const e={};for(const t in n)e[t]=n[t];return e}var Pl="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Vl(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let o=0;o<Pl.length;o++)t=Pl[o],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function as(n){return as[" "](n),n}as[" "]=an;var ko,n,Xa=ee(ye,"Opera"),ui=ee(ye,"Trident")||ee(ye,"MSIE"),So=ee(ye,"Edge"),eu=So||ui,xo=ee(ye,"Gecko")&&!(ee(ye.toLowerCase(),"webkit")&&!ee(ye,"Edge"))&&!(ee(ye,"Trident")||ee(ye,"MSIE"))&&!ee(ye,"Edge"),gh=ee(ye.toLowerCase(),"webkit")&&!ee(ye,"Edge");function Do(){var n=Z.document;return n?n.documentMode:void 0}e:{var us="",tu=(n=ye,xo?/rv:([^\);]+)(\)|;)/.exec(n):So?/Edge\/([\d\.]+)/.exec(n):ui?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):gh?/WebKit\/(\S+)/.exec(n):Xa?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(tu&&(us=tu?tu[1]:""),ui){var ls=Do();if(null!=ls&&ls>parseFloat(us)){ko=String(ls);break e}}ko=us}var mh={};var _h=Z.document&&ui&&(Do()||parseInt(ko,10))||void 0,li=function(){if(!Z.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{Z.addEventListener("test",an,e),Z.removeEventListener("test",an,e)}catch(t){}return n}();function We(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}function cs(n,e){if(We.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(xo){e:{try{as(e.nodeName);var i=!0;break e}catch(o){}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:vh[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&cs.Z.h.call(this)}}We.prototype.h=function(){this.defaultPrevented=!0},Ee(cs,We);var vh={2:"touch",3:"pen",4:"mouse"};cs.prototype.h=function(){cs.Z.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var hs="closure_listenable_"+(1e6*Math.random()|0),Ih=0;function wh(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.ia=i,this.key=++Ih,this.ca=this.fa=!1}function nu(n){n.ca=!0,n.listener=null,n.proxy=null,n.src=null,n.ia=null}function ru(n){this.src=n,this.g={},this.h=0}function Ll(n,e){var t=e.type;if(t in n.g){var o,r=n.g[t],i=os(r,e);(o=0<=i)&&Array.prototype.splice.call(r,i,1),o&&(nu(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function Fl(n,e,t,r){for(var i=0;i<n.length;++i){var o=n[i];if(!o.ca&&o.listener==e&&o.capture==!!t&&o.ia==r)return i}return-1}ru.prototype.add=function(n,e,t,r,i){var o=n.toString();(n=this.g[o])||(n=this.g[o]=[],this.h++);var u=Fl(n,e,r,i);return-1<u?(e=n[u],t||(e.fa=!1)):((e=new wh(e,this.src,o,!!r,i)).fa=t,n.push(e)),e};var Ul="closure_lm_"+(1e6*Math.random()|0),Bl={};function Eh(n,e,t,r,i){if(r&&r.once)return Mo(n,e,t,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Eh(n,e[o],t,r,i);return null}return t=su(t),n&&n[hs]?n.N(e,t,Sn(r)?!!r.capture:!!r,i):Oo(n,e,t,!1,r,i)}function Oo(n,e,t,r,i,o){if(!e)throw Error("Invalid event type");var u=Sn(i)?!!i.capture:!!i,h=ds(n);if(h||(n[Ul]=h=new ru(n)),(t=h.add(e,t,r,u,o)).proxy)return t;if(r=function gr(){var e=Th;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)li||(i=u),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(ql(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function Mo(n,e,t,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)Mo(n,e[o],t,r,i);return null}return t=su(t),n&&n[hs]?n.O(e,t,Sn(r)?!!r.capture:!!r,i):Oo(n,e,t,!0,r,i)}function Gl(n,e,t,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)Gl(n,e[o],t,r,i);else r=Sn(r)?!!r.capture:!!r,t=su(t),n&&n[hs]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=Fl(o=n.g[e],t,r,i))&&(nu(o[t]),Array.prototype.splice.call(o,t,1),0==o.length&&(delete n.g[e],n.h--))):n&&(n=ds(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Fl(e,t,r,i)),(t=-1<n?e[n]:null)&&iu(t))}function iu(n){if("number"!=typeof n&&n&&!n.ca){var e=n.src;if(e&&e[hs])Ll(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(ql(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=ds(e))?(Ll(t,n),0==t.h&&(t.src=null,e[Ul]=null)):nu(n)}}}function ql(n){return n in Bl?Bl[n]:Bl[n]="on"+n}function Th(n,e){if(n.ca)n=!0;else{e=new cs(e,this);var t=n.listener,r=n.ia||n.src;n.fa&&iu(n),n=t.call(r,e)}return n}function ds(n){return(n=n[Ul])instanceof ru?n:null}var fs="__closure_events_fn_"+(1e9*Math.random()>>>0);function su(n){return"function"==typeof n?n:(n[fs]||(n[fs]=function(e){return n.handleEvent(e)}),n[fs])}function xe(){Tt.call(this),this.i=new ru(this),this.P=this,this.I=null}function Fe(n,e){var t,r=n.I;if(r)for(t=[];r;r=r.I)t.push(r);if(n=n.P,r=e.type||e,"string"==typeof e)e=new We(e,n);else if(e instanceof We)e.target=e.target||n;else{var i=e;Vl(e=new We(r,n),i)}if(i=!0,t)for(var o=t.length-1;0<=o;o--){var u=e.g=t[o];i=Po(u,r,!0,e)&&i}if(i=Po(u=e.g=n,r,!0,e)&&i,i=Po(u,r,!1,e)&&i,t)for(o=0;o<t.length;o++)i=Po(u=e.g=t[o],r,!1,e)&&i}function Po(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var u=e[o];if(u&&!u.ca&&u.capture==t){var h=u.listener,m=u.ia||u.src;u.fa&&Ll(n.i,u),i=!1!==h.call(m,r)&&i}}return i&&!r.defaultPrevented}Ee(xe,Tt),xe.prototype[hs]=!0,xe.prototype.removeEventListener=function(n,e,t,r){Gl(this,n,e,t,r)},xe.prototype.M=function(){if(xe.Z.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)nu(t[r]);delete n.g[e],n.h--}}this.I=null},xe.prototype.N=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},xe.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var ou=Z.JSON.stringify;function Ah(){var n=Ne;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var uu,ps=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new np,n=>n.reset());class np{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function xn(n){Z.setTimeout(()=>{throw n},0)}function au(n,e){uu||function gs(){var n=Z.Promise.resolve(void 0);uu=function(){n.then(bh)}}(),lu||(uu(),lu=!0),Ne.add(n,e)}var lu=!1,Ne=new class tp{constructor(){this.h=this.g=null}add(e,t){const r=ps.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}};function bh(){for(var n;n=Ah();){try{n.h.call(n.g)}catch(t){xn(t)}var e=ps;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}lu=!1}function ci(n,e){xe.call(this),this.h=n||1,this.g=e||Z,this.j=Ve(this.kb,this),this.l=Date.now()}function cu(n){n.da=!1,n.S&&(n.g.clearTimeout(n.S),n.S=null)}function ms(n,e,t){if("function"==typeof n)t&&(n=Ve(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=Ve(n.handleEvent,n)}return 2147483647<Number(e)?-1:Z.setTimeout(n,e||0)}function jl(n){n.g=ms(()=>{n.g=null,n.i&&(n.i=!1,jl(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}Ee(ci,xe),(U=ci.prototype).da=!1,U.S=null,U.kb=function(){if(this.da){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-n):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Fe(this,"tick"),this.da&&(cu(this),this.start()))}},U.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},U.M=function(){ci.Z.M.call(this),cu(this),delete this.g};class Ch extends Tt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:jl(this)}M(){super.M(),this.g&&(Z.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function hi(n){Tt.call(this),this.h=n,this.g={}}Ee(hi,Tt);var $l=[];function ys(n,e,t,r){Array.isArray(t)||(t&&($l[0]=t.toString()),t=$l);for(var i=0;i<t.length;i++){var o=Eh(e,t[i],r||n.handleEvent,!1,n.h||n);if(!o)break;n.g[o.key]=o}}function hu(n){pr(n.g,function(e,t){this.g.hasOwnProperty(t)&&iu(e)},n),n.g={}}function Dn(){this.g=!0}function kn(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function du(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var u=1;u<i.length;u++)i[u]=""}}}return ou(t)}catch(h){return e}}(n,t)+(r?" "+r:"")})}hi.prototype.M=function(){hi.Z.M.call(this),hu(this)},hi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Dn.prototype.Aa=function(){this.g=!1},Dn.prototype.info=function(){};var mr={},Lo=null;function _s(){return Lo=Lo||new xe}function Kl(n){We.call(this,mr.Ma,n)}function vs(n){const e=_s();Fe(e,new Kl(e,n))}function xh(n,e){We.call(this,mr.STAT_EVENT,n),this.stat=e}function Re(n){const e=_s();Fe(e,new xh(e,n))}function Hl(n,e){We.call(this,mr.Na,n),this.size=e}function Is(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return Z.setTimeout(function(){n()},e)}mr.Ma="serverreachability",Ee(Kl,We),mr.STAT_EVENT="statevent",Ee(xh,We),mr.Na="timingevent",Ee(Hl,We);var Fo={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Uo={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function fu(){}function gu(){}fu.prototype.h=null;var yu,ws={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function mu(){We.call(this,"d")}function di(){We.call(this,"c")}function Bo(){}function Es(n,e,t,r){this.l=n,this.j=e,this.m=t,this.X=r||1,this.V=new hi(this),this.P=Dh,this.W=new ci(n=eu?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Go}function Go(){this.i=null,this.g="",this.h=!1}Ee(mu,We),Ee(di,We),Ee(Bo,fu),Bo.prototype.g=function(){return new XMLHttpRequest},Bo.prototype.i=function(){return{}},yu=new Bo;var Dh=45e3,_u={},qo={};function vu(n,e,t){n.K=1,n.v=Yo(Mt(e)),n.s=t,n.U=!0,zl(n,null)}function zl(n,e){n.F=Date.now(),Ts(n),n.A=Mt(n.v);var t=n.A,r=n.X;Array.isArray(r)||(r=[String(r)]),Yl(t.h,"t",r),n.C=0,t=n.l.H,n.h=new Go,n.g=gc(n.l,t?e:null,!n.s),0<n.O&&(n.L=new Ch(Ve(n.Ia,n,n.g),n.O)),ys(n.V,n.g,"readystatechange",n.gb),e=n.H?ai(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ea(n.A,n.u,n.s,e)):(n.u="GET",n.g.ea(n.A,n.u,null,e)),vs(1),function Vo(n,e,t,r,i,o){n.info(function(){if(n.g)if(o)for(var u="",h=o.split("&"),m=0;m<h.length;m++){var _=h[m].split("=");if(1<_.length){var w=_[0];_=_[1];var E=w.split("_");u=2<=E.length&&"type"==E[1]?u+(w+"=")+_+"&":u+(w+"=redacted&")}}else u=null;else u=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+u})}(n.j,n.u,n.A,n.m,n.X,n.s)}function Iu(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Ba}function Zl(n,e,t){let i,r=!0;for(;!n.I&&n.C<t.length;){if(i=kh(n,t),i==qo){4==e&&(n.o=4,Re(14),r=!1),kn(n.j,n.m,null,"[Incomplete Response]");break}if(i==_u){n.o=4,Re(15),kn(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}kn(n.j,n.m,i,null),As(n,i)}Iu(n)&&i!=qo&&i!=_u&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,Re(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.aa&&(n.aa=!0,(e=n.l).g==n&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+t.length),Pu(e),e.L=!0,Re(11))):(kn(n.j,n.m,t,"[Invalid Chunked Response]"),_r(n),yr(n))}function kh(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?qo:(t=Number(e.substring(t,r)),isNaN(t)?_u:(r+=1)+t>e.length?qo:(e=e.substr(r,t),n.C=r+t,e))}function Ts(n){n.Y=Date.now()+n.P,jo(n,n.P)}function jo(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=Is(Ve(n.eb,n),e)}function $o(n){n.B&&(Z.clearTimeout(n.B),n.B=null)}function yr(n){0==n.l.G||n.I||ua(n.l,n)}function _r(n){$o(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,cu(n.W),hu(n.V),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function As(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||ks(t.i,n)))if(t.I=n.N,!n.J&&ks(t.i,n)&&3==t.G){try{var r=t.Ca.g.parse(e)}catch(_){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0])e:if(t.u)t.ta=i[1],0<t.ta-t.U&&37500>i[2]&&t.N&&0==t.A&&!t.v&&(t.v=Is(Ve(t.ab,t),6e3));else{if(t.g){if(!(t.g.F+3e3<n.F))break e;aa(t),pi(t)}Mu(t),Re(18)}if(1>=ec(t.i)&&t.ka){try{t.ka()}catch(_){}t.ka=void 0}}else Nn(t,11)}else if((n.J||t.g==n)&&aa(t),!x(e))for(i=t.Ca.g.parse(e),e=0;e<i.length;e++){let _=i[e];if(t.U=_[0],_=_[1],2==t.G)if("c"==_[0]){t.J=_[1],t.la=_[2];const w=_[3];null!=w&&(t.ma=w,t.h.info("VER="+t.ma));const E=_[4];null!=E&&(t.za=E,t.h.info("SVER="+t.za));const A=_[5];null!=A&&"number"==typeof A&&0<A&&(t.K=r=1.5*A,t.h.info("backChannelRequestTimeoutMs_="+r)),r=t;const D=n.g;if(D){const k=D.g?D.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(k){var o=r.i;!o.g&&(ee(k,"spdy")||ee(k,"quic")||ee(k,"h2"))&&(o.j=o.l,o.g=new Set,o.h&&(Au(o,o.h),o.h=null))}if(r.D){const F=D.g?D.g.getResponseHeader("X-HTTP-Session-Id"):null;F&&(r.sa=F,me(r.F,r.D,F))}}t.G=3,t.j&&t.j.xa(),t.$&&(t.O=Date.now()-n.F,t.h.info("Handshake RTT: "+t.O+"ms"));var u=n;if((r=t).oa=la(r,r.H?r.la:null,r.W),u.J){tc(r.i,u);var h=u,m=r.K;m&&h.setTimeout(m),h.B&&($o(h),Ts(h)),r.g=u}else dc(r);0<t.l.length&&sa(t)}else"stop"!=_[0]&&"close"!=_[0]||Nn(t,7);else 3==t.G&&("stop"==_[0]||"close"==_[0]?"stop"==_[0]?Nn(t,7):Ru(t):"noop"!=_[0]&&t.j&&t.j.wa(_),t.A=0)}vs(4)}catch(_){}}function bs(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(Cn(n)||"string"==typeof n)g(n,e,void 0);else{if(n.T&&"function"==typeof n.T)var t=n.T();else if(n.R&&"function"==typeof n.R)t=void 0;else if(Cn(n)||"string"==typeof n){t=[];for(var r=n.length,i=0;i<r;i++)t.push(i)}else for(i in t=[],r=0,n)t[r++]=i;r=function Nh(n){if(n.R&&"function"==typeof n.R)return n.R();if("string"==typeof n)return n.split("");if(Cn(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length;for(var o=0;o<i;o++)e.call(void 0,r[o],t&&t[o],n)}}function ln(n,e){this.h={},this.g=[],this.i=0;var t=arguments.length;if(1<t){if(t%2)throw Error("Uneven number of arguments");for(var r=0;r<t;r+=2)this.set(arguments[r],arguments[r+1])}else if(n)if(n instanceof ln)for(t=n.T(),r=0;r<t.length;r++)this.set(t[r],n.get(t[r]));else for(r in n)this.set(r,n[r])}function Cs(n){if(n.i!=n.g.length){for(var e=0,t=0;e<n.g.length;){var r=n.g[e];vr(n.h,r)&&(n.g[t++]=r),e++}n.g.length=t}if(n.i!=n.g.length){var i={};for(t=e=0;e<n.g.length;)vr(i,r=n.g[e])||(n.g[t++]=r,i[r]=1),e++;n.g.length=t}}function vr(n,e){return Object.prototype.hasOwnProperty.call(n,e)}(U=Es.prototype).setTimeout=function(n){this.P=n},U.gb=function(n){n=n.target;const e=this.L;e&&3==cn(n)?e.l():this.Ia(n)},U.Ia=function(n){try{if(n==this.g)e:{const w=cn(this.g);var e=this.g.Da();const E=this.g.ba();if(!(3>w)&&(3!=w||eu||this.g&&(this.h.h||this.g.ga()||ac(this.g)))){this.I||4!=w||7==e||vs(8==e||0>=E?3:2),$o(this);var t=this.g.ba();this.N=t;t:if(Iu(this)){var r=ac(this.g);n="";var i=r.length,o=4==cn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){_r(this),yr(this);var u="";break t}this.h.i=new Z.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:o&&e==i-1});r.splice(0,i),this.h.g+=n,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==t,function Sh(n,e,t,r,i,o,u){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+o+" "+u})}(this.j,this.u,this.A,this.m,this.X,w,t),this.i){if(this.$&&!this.J){t:{if(this.g){var h,m=this.g;if((h=m.g?m.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(h)){var _=h;break t}}_=null}if(!(t=_)){this.i=!1,this.o=3,Re(12),_r(this),yr(this);break e}kn(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,As(this,t)}this.U?(Zl(this,w,u),eu&&this.i&&3==w&&(ys(this.V,this.W,"tick",this.fb),this.W.start())):(kn(this.j,this.m,u,null),As(this,u)),4==w&&_r(this),this.i&&!this.I&&(4==w?ua(this.l,this):(this.i=!1,Ts(this)))}else 400==t&&0<u.indexOf("Unknown SID")?(this.o=3,Re(12)):(this.o=0,Re(13)),_r(this),yr(this)}}}catch(w){}},U.fb=function(){if(this.g){var n=cn(this.g),e=this.g.ga();this.C<e.length&&($o(this),Zl(this,n,e),this.i&&4!=n&&Ts(this))}},U.cancel=function(){this.I=!0,_r(this)},U.eb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function Wl(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(vs(3),Re(17)),_r(this),this.o=2,yr(this)):jo(this,this.Y-n)},(U=ln.prototype).R=function(){Cs(this);for(var n=[],e=0;e<this.g.length;e++)n.push(this.h[this.g[e]]);return n},U.T=function(){return Cs(this),this.g.concat()},U.get=function(n,e){return vr(this.h,n)?this.h[n]:e},U.set=function(n,e){vr(this.h,n)||(this.i++,this.g.push(n)),this.h[n]=e},U.forEach=function(n,e){for(var t=this.T(),r=0;r<t.length;r++){var i=t[r],o=this.get(i);n.call(e,o,i,this)}};var Wo=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function ht(n,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,n instanceof ht){this.g=void 0!==e?e:n.g,Ko(this,n.j),this.s=n.s,Ho(this,n.i),zo(this,n.m),this.l=n.l,e=n.h;var t=new Ds;t.i=e.i,e.g&&(t.g=new ln(e.g),t.h=e.h),Zo(this,t),this.o=n.o}else n&&(t=String(n).match(Wo))?(this.g=!!e,Ko(this,t[1]||"",!0),this.s=xs(t[2]||""),Ho(this,t[3]||"",!0),zo(this,t[4]),this.l=xs(t[5]||"",!0),Zo(this,t[6]||"",!0),this.o=xs(t[7]||"")):(this.g=!!e,this.h=new Ds(null,this.g))}function Mt(n){return new ht(n)}function Ko(n,e,t){n.j=t?xs(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Ho(n,e,t){n.i=t?xs(e,!0):e}function zo(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Zo(n,e,t){e instanceof Ds?(n.h=e,function Ql(n,e){e&&!n.j&&(Bt(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(Xo(this,r),Yl(this,i,t))},n)),n.j=e}(n.h,n.g)):(t||(e=Ir(e,Jo)),n.h=new Ds(e,n.g))}function me(n,e,t){n.h.set(e,t)}function Yo(n){return me(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function xs(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Ir(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Oh),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Oh(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}ht.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Ir(e,Qo,!0),":");var t=this.i;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Ir(e,Qo,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.i&&"/"!=t.charAt(0)&&n.push("/"),n.push(Ir(t,"/"==t.charAt(0)?Mh:Eu,!0))),(t=this.h.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Ir(t,Ph)),n.join("")};var Qo=/[#\/\?@]/g,Eu=/[#\?:]/g,Mh=/[#\?]/g,Jo=/[#\?@]/g,Ph=/#/g;function Ds(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Bt(n){n.g||(n.g=new ln,n.h=0,n.i&&function Ss(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var o=n[t].substring(0,r);i=n[t].substring(r+1)}else o=n[t];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Xo(n,e){Bt(n),e=wr(n,e),vr(n.g.h,e)&&(n.i=null,n.h-=n.g.get(e).length,vr((n=n.g).h,e)&&(delete n.h[e],n.i--,n.g.length>2*n.i&&Cs(n)))}function ea(n,e){return Bt(n),e=wr(n,e),vr(n.g.h,e)}function Yl(n,e,t){Xo(n,e),0<t.length&&(n.i=null,n.g.set(wr(n,e),v(t)),n.h+=t.length)}function wr(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Jl(n){this.l=n||Tu,n=Z.PerformanceNavigationTiming?0<(n=Z.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(Z.g&&Z.g.Ea&&Z.g.Ea()&&Z.g.Ea().Zb),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(U=Ds.prototype).add=function(n,e){Bt(this),this.i=null,n=wr(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},U.forEach=function(n,e){Bt(this),this.g.forEach(function(t,r){g(t,function(i){n.call(e,i,r,this)},this)},this)},U.T=function(){Bt(this);for(var n=this.g.R(),e=this.g.T(),t=[],r=0;r<e.length;r++)for(var i=n[r],o=0;o<i.length;o++)t.push(e[r]);return t},U.R=function(n){Bt(this);var e=[];if("string"==typeof n)ea(this,n)&&(e=d(e,this.g.get(wr(this,n))));else{n=this.g.R();for(var t=0;t<n.length;t++)e=d(e,n[t])}return e},U.set=function(n,e){return Bt(this),this.i=null,ea(this,n=wr(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},U.get=function(n,e){return n&&0<(n=this.R(n)).length?String(n[0]):e},U.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var n=[],e=this.g.T(),t=0;t<e.length;t++){var r=e[t],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var u=i;""!==r[o]&&(u+="="+encodeURIComponent(String(r[o]))),n.push(u)}}return this.i=n.join("&")};var Tu=10;function Xl(n){return!!n.h||!!n.g&&n.g.size>=n.j}function ec(n){return n.h?1:n.g?n.g.size:0}function ks(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Au(n,e){n.g?n.g.add(e):n.h=e}function tc(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function ta(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return v(n.i)}function bu(){}function Cu(){this.g=new bu}function na(n,e,t){const r=t||"";try{bs(n,function(i,o){let u=i;Sn(i)&&(u=ou(i)),e.push(r+o+"="+encodeURIComponent(u))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Ns(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}function Er(n){this.l=n.$b||null,this.j=n.ib||!1}function ra(n,e){xe.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=ia,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Jl.prototype.cancel=function(){if(this.i=ta(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},bu.prototype.stringify=function(n){return Z.JSON.stringify(n,void 0)},bu.prototype.parse=function(n){return Z.JSON.parse(n,void 0)},Ee(Er,fu),Er.prototype.g=function(){return new ra(this.l,this.j)},Er.prototype.i=function(n){return function(){return n}}({}),Ee(ra,xe);var ia=0;function xu(n){n.j.read().then(n.Sa.bind(n)).catch(n.ha.bind(n))}function fi(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Rs(n)}function Rs(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(U=ra.prototype).open=function(n,e){if(this.readyState!=ia)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Rs(this)},U.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||Z).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},U.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,fi(this)),this.readyState=ia},U.Va=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Rs(this)),this.g&&(this.readyState=3,Rs(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==Z.ReadableStream&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;xu(this)}else n.text().then(this.Ua.bind(this),this.ha.bind(this))},U.Sa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?fi(this):Rs(this),3==this.readyState&&xu(this)}},U.Ua=function(n){this.g&&(this.response=this.responseText=n,fi(this))},U.Ta=function(n){this.g&&(this.response=n,fi(this))},U.ha=function(){this.g&&fi(this)},U.setRequestHeader=function(n,e){this.v.append(n,e)},U.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},U.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(ra.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var nc=Z.JSON.parse;function Te(n){xe.call(this),this.headers=new ln,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=rc,this.K=this.L=!1}Ee(Te,xe);var rc="",Lh=/^https?$/i,Fh=["POST","PUT"];function Uh(n){return"content-type"==n.toLowerCase()}function ic(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,ku(n),Tr(n)}function ku(n){n.D||(n.D=!0,Fe(n,"complete"),Fe(n,"error"))}function sc(n){if(n.h&&void 0!==ri&&(!n.C[1]||4!=cn(n)||2!=n.ba()))if(n.v&&4==cn(n))ms(n.Fa,0,n);else if(Fe(n,"readystatechange"),4==cn(n)){n.h=!1;try{const h=n.ba();e:switch(h){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===h){var i=String(n.H).match(Wo)[1]||null;if(!i&&Z.self&&Z.self.location){var o=Z.self.location.protocol;i=o.substr(0,o.length-1)}r=!Lh.test(i?i.toLowerCase():"")}t=r}if(t)Fe(n,"complete"),Fe(n,"success");else{n.m=6;try{var u=2<cn(n)?n.g.statusText:""}catch(m){u=""}n.j=u+" ["+n.ba()+"]",ku(n)}}finally{Tr(n)}}}function Tr(n,e){if(n.g){oc(n);const t=n.g,r=n.C[0]?an:null;n.g=null,n.C=null,e||Fe(n,"ready");try{t.onreadystatechange=r}catch(i){}}}function oc(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(Z.clearTimeout(n.A),n.A=null)}function cn(n){return n.g?n.g.readyState:0}function ac(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case rc:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Nu(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=function Bh(n){let e="";return pr(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):me(n,e,t))}function Os(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function uc(n){this.za=0,this.l=[],this.h=new Dn,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Os("failFast",!1,n),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Os("baseRetryDelayMs",5e3,n),this.$a=Os("retryDelaySeedMs",1e4,n),this.Ya=Os("forwardChannelMaxRetries",2,n),this.ra=Os("forwardChannelRequestTimeoutMs",2e4,n),this.qa=n&&n.xmlHttpFactory||void 0,this.Ba=n&&n.Yb||!1,this.K=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.J="",this.i=new Jl(n&&n.concurrentRequestLimit),this.Ca=new Cu,this.ja=n&&n.fastHandshake||!1,this.Ra=n&&n.Wb||!1,n&&n.Aa&&this.h.Aa(),n&&n.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&n&&n.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!n||!1!==n.Xb}function Ru(n){if(lc(n),3==n.G){var e=n.V++,t=Mt(n.F);me(t,"SID",n.J),me(t,"RID",e),me(t,"TYPE","terminate"),gi(n,t),(e=new Es(n,n.h,e,void 0)).K=2,e.v=Yo(Mt(t)),t=!1,Z.navigator&&Z.navigator.sendBeacon&&(t=Z.navigator.sendBeacon(e.v.toString(),"")),!t&&Z.Image&&((new Image).src=e.v,t=!0),t||(e.g=gc(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Ts(e)}pc(n)}function pi(n){n.g&&(Pu(n),n.g.cancel(),n.g=null)}function lc(n){pi(n),n.u&&(Z.clearTimeout(n.u),n.u=null),aa(n),n.i.cancel(),n.m&&("number"==typeof n.m&&Z.clearTimeout(n.m),n.m=null)}function Ou(n,e){n.l.push(new class{constructor(n,e){this.h=n,this.g=e}}(n.Za++,e)),3==n.G&&sa(n)}function sa(n){Xl(n.i)||n.m||(n.m=!0,au(n.Ha,n),n.C=0)}function cc(n,e){var t;t=e?e.m:n.V++;const r=Mt(n.F);me(r,"SID",n.J),me(r,"RID",t),me(r,"AID",n.U),gi(n,r),n.o&&n.s&&Nu(r,n.o,n.s),t=new Es(n,n.h,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.l=e.D.concat(n.l)),e=hc(n,t,1e3),t.setTimeout(Math.round(.5*n.ra)+Math.round(.5*n.ra*Math.random())),Au(n.i,t),vu(t,r,e)}function gi(n,e){n.j&&bs({},function(t,r){me(e,r,t)})}function hc(n,e,t){t=Math.min(n.l.length,t);var r=n.j?Ve(n.j.Oa,n.j,n):null;e:{var i=n.l;let o=-1;for(;;){const u=["count="+t];-1==o?0<t?(o=i[0].h,u.push("ofs="+o)):o=0:u.push("ofs="+o);let h=!0;for(let m=0;m<t;m++){let _=i[m].h;const w=i[m].g;if(_-=o,0>_)o=Math.max(0,i[m].h-100),h=!1;else try{na(w,u,"req"+_+"_")}catch(E){r&&r(w)}}if(h){r=u.join("&");break e}}}return n=n.l.splice(0,t),e.D=n,r}function dc(n){n.g||n.u||(n.Y=1,au(n.Ga,n),n.A=0)}function Mu(n){return!(n.g||n.u||3<=n.A||(n.Y++,n.u=Is(Ve(n.Ga,n),fc(n,n.A)),n.A++,0))}function Pu(n){null!=n.B&&(Z.clearTimeout(n.B),n.B=null)}function oa(n){n.g=new Es(n,n.h,"rpc",n.Y),null===n.o&&(n.g.H=n.s),n.g.O=0;var e=Mt(n.oa);me(e,"RID","rpc"),me(e,"SID",n.J),me(e,"CI",n.N?"0":"1"),me(e,"AID",n.U),gi(n,e),me(e,"TYPE","xmlhttp"),n.o&&n.s&&Nu(e,n.o,n.s),n.K&&n.g.setTimeout(n.K);var t=n.g;n=n.la,t.K=1,t.v=Yo(Mt(e)),t.s=null,t.U=!0,zl(t,n)}function aa(n){null!=n.v&&(Z.clearTimeout(n.v),n.v=null)}function ua(n,e){var t=null;if(n.g==e){aa(n),Pu(n),n.g=null;var r=2}else{if(!ks(n.i,e))return;t=e.D,tc(n.i,e),r=1}if(n.I=e.N,0!=n.G)if(e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.F;var i=n.C;Fe(r=_s(),new Hl(r,t,e,i)),sa(n)}else dc(n);else if(3==(i=e.o)||0==i&&0<n.I||!(1==r&&function Gh(n,e){return!(ec(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.l=e.D.concat(n.l),0):1==n.G||2==n.G||n.C>=(n.Xa?0:n.Ya)||(n.m=Is(Ve(n.Ha,n,e),fc(n,n.C)),n.C++,0)))}(n,e)||2==r&&Mu(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:Nn(n,5);break;case 4:Nn(n,10);break;case 3:Nn(n,6);break;default:Nn(n,2)}}function fc(n,e){let t=n.Pa+Math.floor(Math.random()*n.$a);return n.j||(t*=2),t*e}function Nn(n,e){if(n.h.info("Error code "+e),2==e){var t=null;n.j&&(t=null);var r=Ve(n.jb,n);t||(t=new ht("//www.google.com/images/cleardot.gif"),Z.location&&"http"==Z.location.protocol||Ko(t,"https"),Yo(t)),function Su(n,e){const t=new Dn;if(Z.Image){const r=new Image;r.onload=un(Ns,t,r,"TestLoadImage: loaded",!0,e),r.onerror=un(Ns,t,r,"TestLoadImage: error",!1,e),r.onabort=un(Ns,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=un(Ns,t,r,"TestLoadImage: timeout",!1,e),Z.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else Re(2);n.G=0,n.j&&n.j.va(e),pc(n),lc(n)}function pc(n){n.G=0,n.I=-1,n.j&&((0!=ta(n.i).length||0!=n.l.length)&&(n.i.i.length=0,v(n.l),n.l.length=0),n.j.ua())}function la(n,e,t){let r=function Rh(n){return n instanceof ht?Mt(n):new ht(n,void 0)}(t);if(""!=r.i)e&&Ho(r,e+"."+r.i),zo(r,r.m);else{const i=Z.location;r=function wu(n,e,t,r){var i=new ht(null,void 0);return n&&Ko(i,n),e&&Ho(i,e),t&&zo(i,t),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,t)}return n.aa&&pr(n.aa,function(i,o){me(r,o,i)}),t=n.sa,(e=n.D)&&t&&me(r,e,t),me(r,"VER",n.ma),gi(n,r),r}function gc(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Te(t&&n.Ba&&!n.qa?new Er({ib:!0}):n.qa)).L=n.H,e}function Vu(){}function Ms(){if(ui&&!(10<=Number(_h)))throw Error("Environmental error: no available transport.")}function dt(n,e){xe.call(this),this.g=new uc(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.P=n,(n=e&&e.httpHeadersOverwriteParam)&&!x(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!x(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Ps(this)}function mc(n){mu.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function yc(){di.call(this),this.status=1}function Ps(n){this.g=n}(U=Te.prototype).ea=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():yu.g(),this.C=function pu(n){return n.h||(n.h=n.i())}(this.u?this.u:yu),this.g.onreadystatechange=Ve(this.Fa,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(o){return void ic(this,o)}n=t||"";const i=new ln(this.headers);r&&bs(r,function(o,u){i.set(u,o)}),r=function f(n){e:{var e=Uh;const t=n.length,r="string"==typeof n?n.split(""):n;for(let i=0;i<t;i++)if(i in r&&e.call(void 0,r[i],i,n)){e=i;break e}e=-1}return 0>e?null:"string"==typeof n?n.charAt(e):n[e]}(i.T()),t=Z.FormData&&n instanceof Z.FormData,!(0<=os(Fh,e))||r||t||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(o,u){this.g.setRequestHeader(u,o)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{oc(this),0<this.B&&((this.K=function Du(n){return ui&&function yh(){return function ph(n){var e=mh;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}(function(){let n=0;const e=B(String(ko)).split("."),t=B("9").split("."),r=Math.max(e.length,t.length);for(let u=0;0==n&&u<r;u++){var i=e[u]||"",o=t[u]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],0==i[0].length&&0==o[0].length)break;n=Le(0==i[1].length?0:parseInt(i[1],10),0==o[1].length?0:parseInt(o[1],10))||Le(0==i[2].length,0==o[2].length)||Le(i[2],o[2]),i=i[3],o=o[3]}while(0==n)}return 0<=n})}()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ve(this.pa,this)):this.A=ms(this.pa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(o){ic(this,o)}},U.pa=function(){void 0!==ri&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Fe(this,"timeout"),this.abort(8))},U.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Fe(this,"complete"),Fe(this,"abort"),Tr(this))},U.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Tr(this,!0)),Te.Z.M.call(this)},U.Fa=function(){this.s||(this.F||this.v||this.l?sc(this):this.cb())},U.cb=function(){sc(this)},U.ba=function(){try{return 2<cn(this)?this.g.status:-1}catch(n){return-1}},U.ga=function(){try{return this.g?this.g.responseText:""}catch(n){return""}},U.Qa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),nc(e)}},U.Da=function(){return this.m},U.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(U=uc.prototype).ma=8,U.G=1,U.hb=function(n){try{this.h.info("Origin Trials invoked: "+n)}catch(e){}},U.Ha=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.V=Math.floor(1e5*Math.random()),n=this.V++;const i=new Es(this,this.h,n,void 0);let o=this.s;if(this.P&&(o?(o=ai(o),Vl(o,this.P)):o=this.P),null===this.o&&(i.H=o),this.ja)e:{for(var e=0,t=0;t<this.l.length;t++){var r=this.l[t];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.l.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=hc(this,i,e),me(t=Mt(this.F),"RID",n),me(t,"CVER",22),this.D&&me(t,"X-HTTP-Session-Id",this.D),gi(this,t),this.o&&o&&Nu(t,this.o,o),Au(this.i,i),this.Ra&&me(t,"TYPE","init"),this.ja?(me(t,"$req",e),me(t,"SID","null"),i.$=!0,vu(i,t,null)):vu(i,t,e),this.G=2}}else 3==this.G&&(n?cc(this,n):0==this.l.length||Xl(this.i)||cc(this))},U.Ga=function(){if(this.u=null,oa(this),this.$&&!(this.L||null==this.g||0>=this.O)){var n=2*this.O;this.h.info("BP detection timer enabled: "+n),this.B=Is(Ve(this.bb,this),n)}},U.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Re(10),pi(this),oa(this))},U.ab=function(){null!=this.v&&(this.v=null,pi(this),Mu(this),Re(19))},U.jb=function(n){n?(this.h.info("Successfully pinged google.com"),Re(2)):(this.h.info("Failed to ping google.com"),Re(1))},(U=Vu.prototype).xa=function(){},U.wa=function(){},U.va=function(){},U.ua=function(){},U.Oa=function(){},Ms.prototype.g=function(n,e){return new dt(n,e)},Ee(dt,xe),dt.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;n.Wa&&(n.h.info("Origin Trials enabled."),au(Ve(n.hb,n,e))),Re(0),n.W=e,n.aa=t||{},n.N=n.X,n.F=la(n,null,n.W),sa(n)},dt.prototype.close=function(){Ru(this.g)},dt.prototype.u=function(n){if("string"==typeof n){var e={};e.__data__=n,Ou(this.g,e)}else this.v?((e={}).__data__=ou(n),Ou(this.g,e)):Ou(this.g,n)},dt.prototype.M=function(){this.g.j=null,delete this.j,Ru(this.g),delete this.g,dt.Z.M.call(this)},Ee(mc,mu),Ee(yc,di),Ee(Ps,Vu),Ps.prototype.xa=function(){Fe(this.g,"a")},Ps.prototype.wa=function(n){Fe(this.g,new mc(n))},Ps.prototype.va=function(n){Fe(this.g,new yc(n))},Ps.prototype.ua=function(){Fe(this.g,"b")},Ms.prototype.createWebChannel=Ms.prototype.g,dt.prototype.send=dt.prototype.u,dt.prototype.open=dt.prototype.m,dt.prototype.close=dt.prototype.close,Fo.NO_ERROR=0,Fo.TIMEOUT=8,Fo.HTTP_ERROR=6,Uo.COMPLETE="complete",gu.EventType=ws,ws.OPEN="a",ws.CLOSE="b",ws.ERROR="c",ws.MESSAGE="d",xe.prototype.listen=xe.prototype.N,Te.prototype.listenOnce=Te.prototype.O,Te.prototype.getLastError=Te.prototype.La,Te.prototype.getLastErrorCode=Te.prototype.Da,Te.prototype.getStatus=Te.prototype.ba,Te.prototype.getResponseJson=Te.prototype.Qa,Te.prototype.getResponseText=Te.prototype.ga,Te.prototype.send=Te.prototype.ea;var Ar=it.createWebChannelTransport=function(){return new Ms},qh=it.getStatEventTarget=function(){return _s()},Lu=it.ErrorCode=Fo,Fu=it.EventType=Uo,jh=it.Event=mr,ca=it.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},$h=it.FetchXmlHttpFactory=Er,ha=it.WebChannel=gu,Uu=it.XhrIo=Te;const _c="@firebase/firestore";class Ke{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ke.UNAUTHENTICATED=new Ke(null),Ke.GOOGLE_CREDENTIALS=new Ke("google-credentials-uid"),Ke.FIRST_PARTY=new Ke("first-party-uid"),Ke.MOCK_USER=new Ke("mock-user");let Rn="9.6.11";const On=new ue.Yd("@firebase/firestore");function Bu(){return On.logLevel}function M(n,...e){if(On.logLevel<=ue.in.DEBUG){const t=e.map(Vs);On.debug(`Firestore (${Rn}): ${n}`,...t)}}function Oe(n,...e){if(On.logLevel<=ue.in.ERROR){const t=e.map(Vs);On.error(`Firestore (${Rn}): ${n}`,...t)}}function mi(n,...e){if(On.logLevel<=ue.in.WARN){const t=e.map(Vs);On.warn(`Firestore (${Rn}): ${n}`,...t)}}function Vs(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch(t){return n}}function q(n="Unexpected state"){const e=`FIRESTORE (${Rn}) INTERNAL ASSERTION FAILED: `+n;throw Oe(e),new Error(e)}function Q(n,e){n||q()}function L(n,e){return n}const b={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class N extends W.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class De{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class vc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Kh{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ke.UNAUTHENTICATED))}shutdown(){}}class Hh{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Ic{constructor(e){this.t=e,this.currentUser=Ke.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const o=_=>this.i!==i?(i=this.i,t(_)):Promise.resolve();let u=new De;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new De,e.enqueueRetryable(()=>o(this.currentUser))};const h=()=>{const _=u;e.enqueueRetryable((0,p.Z)(function*(){yield _.promise,yield o(r.currentUser)}))},m=_=>{M("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=_,this.auth.addAuthTokenListener(this.o),h()};this.t.onInit(_=>m(_)),setTimeout(()=>{if(!this.auth){const _=this.t.getImmediate({optional:!0});_?m(_):(M("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new De)}},0),h()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(M("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Q("string"==typeof r.accessToken),new vc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Q(null===e||"string"==typeof e),new Ke(e)}}class zh{constructor(e,t,r){this.type="FirstParty",this.user=Ke.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const i=e.auth.getAuthHeaderValueForFirstParty([]);i&&this.headers.set("Authorization",i),r&&this.headers.set("X-Goog-Iam-Authorization-Token",r)}}class Zh{constructor(e,t,r){this.h=e,this.l=t,this.m=r}getToken(){return Promise.resolve(new zh(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(Ke.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class wc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Yh{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(e,t){const r=o=>{null!=o.error&&M("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const u=o.token!==this.p;return this.p=o.token,M("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};const i=o=>{M("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.appCheck.addTokenListener(this.o)};this.g.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){const o=this.g.getImmediate({optional:!0});o?i(o):M("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Q("string"==typeof t.token),this.p=t.token,new wc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class ft{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.I(r),this.T=r=>t.writeSequenceNumber(r))}I(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}function Ec(n){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}ft.A=-1;class Tc{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=Ec(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<t&&(r+=e.charAt(i[o]%e.length))}return r}}function X(n,e){return n<e?-1:n>e?1:0}function yi(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function Ac(n){return n+"\0"}class Ae{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new N(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new N(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new N(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new N(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ae.fromMillis(Date.now())}static fromDate(e){return Ae.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Ae(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?X(this.nanoseconds,e.nanoseconds):X(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class z{constructor(e){this.timestamp=e}static fromTimestamp(e){return new z(e)}static min(){return new z(new Ae(0,0))}static max(){return new z(new Ae(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function da(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Mn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function bc(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class br{constructor(e,t,r){void 0===t?t=0:t>e.length&&q(),void 0===r?r=e.length-t:r>e.length-t&&q(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===br.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof br?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const o=e.get(i),u=t.get(i);if(o<u)return-1;if(o>u)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ne extends br{construct(e,t,r){return new ne(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new N(b.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new ne(t)}static emptyPath(){return new ne([])}}const pt=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class be extends br{construct(e,t,r){return new be(e,t,r)}static isValidIdentifier(e){return pt.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),be.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new be(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const o=()=>{if(0===r.length)throw new N(b.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let u=!1;for(;i<e.length;){const h=e[i];if("\\"===h){if(i+1===e.length)throw new N(b.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const m=e[i+1];if("\\"!==m&&"."!==m&&"`"!==m)throw new N(b.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=m,i+=2}else"`"===h?(u=!u,i++):"."!==h||u?(r+=h,i++):(o(),i++)}if(o(),u)throw new N(b.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new be(t)}static emptyPath(){return new be([])}}class Cr{constructor(e){this.fields=e,e.sort(be.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return yi(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class ke{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new ke(t)}static fromUint8Array(e){const t=function(r){let i="";for(let o=0;o<r.length;++o)i+=String.fromCharCode(r[o]);return i}(e);return new ke(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return X(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ke.EMPTY_BYTE_STRING=new ke("");const ju=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pn(n){if(Q(!!n),"string"==typeof n){let e=0;const t=ju.exec(n);if(Q(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:_e(n.seconds),nanos:_e(n.nanos)}}function _e(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Sr(n){return"string"==typeof n?ke.fromBase64String(n):ke.fromUint8Array(n)}function Gt(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function $u(n){const e=n.mapValue.fields.__previous_value__;return Gt(e)?$u(e):e}function Ls(n){const e=Pn(n.mapValue.fields.__local_write_time__.timestampValue);return new Ae(e.seconds,e.nanos)}class Jh{constructor(e,t,r,i,o,u,h,m){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=u,this.autoDetectLongPolling=h,this.useFetchStreams=m}}class hn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new hn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof hn&&e.projectId===this.projectId&&e.database===this.database}}function Vn(n){return null==n}function Ue(n){return 0===n&&1/n==-1/0}function fa(n){return"number"==typeof n&&Number.isInteger(n)&&!Ue(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}class P{constructor(e){this.path=e}static fromPath(e){return new P(ne.fromString(e))}static fromName(e){return new P(ne.fromString(e).popFirst(5))}static empty(){return new P(ne.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ne.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ne.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new P(new ne(e.slice()))}}const Cc={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},qt={nullValue:"NULL_VALUE"};function Pt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Gt(n)?4:I(n)?9:10:q()}function Vt(n,e){if(n===e)return!0;const t=Pt(n);if(t!==Pt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ls(n).isEqual(Ls(e));case 3:return function(r,i){if("string"==typeof r.timestampValue&&"string"==typeof i.timestampValue&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const o=Pn(r.timestampValue),u=Pn(i.timestampValue);return o.seconds===u.seconds&&o.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return i=e,Sr(n.bytesValue).isEqual(Sr(i.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,i){return _e(r.geoPointValue.latitude)===_e(i.geoPointValue.latitude)&&_e(r.geoPointValue.longitude)===_e(i.geoPointValue.longitude)}(n,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return _e(r.integerValue)===_e(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const o=_e(r.doubleValue),u=_e(i.doubleValue);return o===u?Ue(o)===Ue(u):isNaN(o)&&isNaN(u)}return!1}(n,e);case 9:return yi(n.arrayValue.values||[],e.arrayValue.values||[],Vt);case 10:return function(r,i){const o=r.mapValue.fields||{},u=i.mapValue.fields||{};if(da(o)!==da(u))return!1;for(const h in o)if(o.hasOwnProperty(h)&&(void 0===u[h]||!Vt(o[h],u[h])))return!1;return!0}(n,e);default:return q()}var i}function _i(n,e){return void 0!==(n.values||[]).find(t=>Vt(t,e))}function Ln(n,e){if(n===e)return 0;const t=Pt(n),r=Pt(e);if(t!==r)return X(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return X(n.booleanValue,e.booleanValue);case 2:return function(i,o){const u=_e(i.integerValue||i.doubleValue),h=_e(o.integerValue||o.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1}(n,e);case 3:return pa(n.timestampValue,e.timestampValue);case 4:return pa(Ls(n),Ls(e));case 5:return X(n.stringValue,e.stringValue);case 6:return function(i,o){const u=Sr(i),h=Sr(o);return u.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const u=i.split("/"),h=o.split("/");for(let m=0;m<u.length&&m<h.length;m++){const _=X(u[m],h[m]);if(0!==_)return _}return X(u.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const u=X(_e(i.latitude),_e(o.latitude));return 0!==u?u:X(_e(i.longitude),_e(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(i,o){const u=i.values||[],h=o.values||[];for(let m=0;m<u.length&&m<h.length;++m){const _=Ln(u[m],h[m]);if(_)return _}return X(u.length,h.length)}(n.arrayValue,e.arrayValue);case 10:return function(i,o){const u=i.fields||{},h=Object.keys(u),m=o.fields||{},_=Object.keys(m);h.sort(),_.sort();for(let w=0;w<h.length&&w<_.length;++w){const E=X(h[w],_[w]);if(0!==E)return E;const A=Ln(u[h[w]],m[_[w]]);if(0!==A)return A}return X(h.length,_.length)}(n.mapValue,e.mapValue);default:throw q()}}function pa(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return X(n,e);const t=Pn(n),r=Pn(e),i=X(t.seconds,r.seconds);return 0!==i?i:X(t.nanos,r.nanos)}function vi(n){return Wu(n)}function Wu(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const i=Pn(r);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Sr(n.bytesValue).toBase64():"referenceValue"in n?P.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let i="[",o=!0;for(const u of r.values||[])o?o=!1:i+=",",i+=Wu(u);return i+"]"}(n.arrayValue):"mapValue"in n?function(r){const i=Object.keys(r.fields||{}).sort();let o="{",u=!0;for(const h of i)u?u=!1:o+=",",o+=`${h}:${Wu(r.fields[h])}`;return o+"}"}(n.mapValue):q();var e}function xr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ku(n){return!!n&&"integerValue"in n}function l(n){return!!n&&"arrayValue"in n}function s(n){return!!n&&"nullValue"in n}function a(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function c(n){return!!n&&"mapValue"in n}function y(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Mn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=y(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=y(n.arrayValue.values[t]);return e}return Object.assign({},n)}function I(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function T(n){return"nullValue"in n?qt:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?xr(hn.empty(),P.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:q()}function C(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?xr(hn.empty(),P.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Cc:q()}function V(n,e){return void 0===n?e:void 0===e||Ln(n,e)>0?n:e}function j(n,e){return void 0===n?e:void 0===e||Ln(n,e)<0?n:e}class G{constructor(e){this.value=e}static empty(){return new G({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!c(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=y(t)}setAll(e){let t=be.emptyPath(),r={},i=[];e.forEach((u,h)=>{if(!t.isImmediateParentOf(h)){const m=this.getFieldsMap(t);this.applyChanges(m,r,i),r={},i=[],t=h.popLast()}u?r[h.lastSegment()]=y(u):i.push(h.lastSegment())});const o=this.getFieldsMap(t);this.applyChanges(o,r,i)}delete(e){const t=this.field(e.popLast());c(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Vt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];c(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Mn(t,(i,o)=>e[i]=o);for(const i of r)delete e[i]}clone(){return new G(y(this.value))}}function H(n){const e=[];return Mn(n.fields,(t,r)=>{const i=new be([t]);if(c(r)){const o=H(r.mapValue).fields;if(0===o.length)e.push(i);else for(const u of o)e.push(i.child(u))}else e.push(i)}),new Cr(e)}class J{constructor(e,t,r,i,o,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.data=o,this.documentState=u}static newInvalidDocument(e){return new J(e,0,z.min(),z.min(),G.empty(),0)}static newFoundDocument(e,t,r){return new J(e,1,t,z.min(),r,0)}static newNoDocument(e,t){return new J(e,2,t,z.min(),G.empty(),0)}static newUnknownDocument(e,t){return new J(e,3,t,z.min(),G.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=G.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=G.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof J&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new J(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class st{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function Ii(n){return n.fields.find(e=>2===e.kind)}function Fn(n){return n.fields.filter(e=>2!==e.kind)}st.UNKNOWN_ID=-1;class wi{constructor(e,t){this.fieldPath=e,this.kind=t}}class Ei{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Ei(0,jt.min())}}function Hu(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=z.fromTimestamp(1e9===r?new Ae(t+1,0):new Ae(t,r));return new jt(i,P.empty(),e)}function zu(n){return new jt(n.readTime,n.key,-1)}class jt{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new jt(z.min(),P.empty(),-1)}static max(){return new jt(z.max(),P.empty(),-1)}}function Sc(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=P.comparator(n.documentKey,e.documentKey),0!==t?t:X(n.largestBatchId,e.largestBatchId))}class Zu{constructor(e,t=null,r=[],i=[],o=null,u=null,h=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=u,this.endAt=h,this.P=null}}function Yu(n,e=null,t=[],r=[],i=null,o=null,u=null){return new Zu(n,e,t,r,i,o,u)}function Dr(n){const e=L(n);if(null===e.P){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>{return(i=r).field.canonicalString()+i.op.toString()+vi(i.value);var i}).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(i=r).field.canonicalString()+i.dir;var i}).join(","),Vn(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>vi(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>vi(r)).join(",")),e.P=t}return e.P}function Fs(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!sy(n.orderBy[i],e.orderBy[i]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if((t=n.filters[i]).op!==(r=e.filters[i]).op||!t.field.isEqual(r.field)||!Vt(t.value,r.value))return!1;var t,r;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!ap(n.startAt,e.startAt)&&ap(n.endAt,e.endAt)}function xc(n){return P.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function Dc(n,e){return n.filters.filter(t=>t instanceof Xe&&t.field.isEqual(e))}function rp(n,e,t){let r,i=!0;for(const o of Dc(n,e)){let u,h=!0;switch(o.op){case"<":case"<=":u=T(o.value);break;case"==":case"in":case">=":u=o.value;break;case">":u=o.value,h=!1;break;case"!=":case"not-in":u=qt}V(r,u)===u&&(r=u,i=h)}if(null!==t)for(let o=0;o<n.orderBy.length;++o)if(n.orderBy[o].field.isEqual(e)){const u=t.position[o];V(r,u)===u&&(r=u,i=t.inclusive);break}return{value:r,inclusive:i}}function ip(n,e,t){let r,i=!0;for(const o of Dc(n,e)){let u,h=!0;switch(o.op){case">=":case">":u=C(o.value),h=!1;break;case"==":case"in":case"<=":u=o.value;break;case"<":u=o.value,h=!1;break;case"!=":case"not-in":u=Cc}j(r,u)===u&&(r=u,i=h)}if(null!==t)for(let o=0;o<n.orderBy.length;++o)if(n.orderBy[o].field.isEqual(e)){const u=t.position[o];j(r,u)===u&&(r=u,i=t.inclusive);break}return{value:r,inclusive:i}}class Xe extends class{}{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.V(e,t,r):new Jm(e,t,r):"array-contains"===t?new ty(e,r):"in"===t?new ny(e,r):"not-in"===t?new ry(e,r):"array-contains-any"===t?new iy(e,r):new Xe(e,t,r)}static V(e,t,r){return"in"===t?new Xm(e,r):new ey(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.v(Ln(t,this.value)):null!==t&&Pt(this.value)===Pt(t)&&this.v(Ln(t,this.value))}v(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return q()}}S(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Jm extends Xe{constructor(e,t,r){super(e,t,r),this.key=P.fromName(r.referenceValue)}matches(e){const t=P.comparator(e.key,this.key);return this.v(t)}}class Xm extends Xe{constructor(e,t){super(e,"in",t),this.keys=sp(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class ey extends Xe{constructor(e,t){super(e,"not-in",t),this.keys=sp(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function sp(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>P.fromName(r.referenceValue))}class ty extends Xe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return l(t)&&_i(t.arrayValue,this.value)}}class ny extends Xe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&_i(this.value.arrayValue,t)}}class ry extends Xe{constructor(e,t){super(e,"not-in",t)}matches(e){if(_i(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!_i(this.value.arrayValue,t)}}class iy extends Xe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!l(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>_i(this.value.arrayValue,r))}}class Ti{constructor(e,t){this.position=e,this.inclusive=t}}class ga{constructor(e,t="asc"){this.field=e,this.dir=t}}function sy(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}function op(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const o=e[i],u=n.position[i];if(r=o.field.isKeyField()?P.comparator(P.fromName(u.referenceValue),t.key):Ln(u,t.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return r}function ap(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Vt(n.position[t],e.position[t]))return!1;return!0}class kr{constructor(e,t=null,r=[],i=[],o=null,u="F",h=null,m=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=u,this.startAt=h,this.endAt=m,this.D=null,this.C=null}}function up(n,e,t,r,i,o,u,h){return new kr(n,e,t,r,i,o,u,h)}function ma(n){return new kr(n)}function kc(n){return!Vn(n.limit)&&"F"===n.limitType}function Nc(n){return!Vn(n.limit)&&"L"===n.limitType}function Xh(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function ed(n){for(const e of n.filters)if(e.S())return e.field;return null}function td(n){return null!==n.collectionGroup}function ya(n){const e=L(n);if(null===e.D){e.D=[];const t=ed(e),r=Xh(e);if(null!==t&&null===r)t.isKeyField()||e.D.push(new ga(t)),e.D.push(new ga(be.keyField(),"asc"));else{let i=!1;for(const o of e.explicitOrderBy)e.D.push(o),o.field.isKeyField()&&(i=!0);if(!i){const o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.D.push(new ga(be.keyField(),o))}}}return e.D}function $t(n){const e=L(n);if(!e.C)if("F"===e.limitType)e.C=Yu(e.path,e.collectionGroup,ya(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const o of ya(e))t.push(new ga(o.field,"desc"===o.dir?"asc":"desc"));const r=e.endAt?new Ti(e.endAt.position,!e.endAt.inclusive):null,i=e.startAt?new Ti(e.startAt.position,!e.startAt.inclusive):null;e.C=Yu(e.path,e.collectionGroup,t,e.filters,e.limit,r,i)}return e.C}function lp(n,e,t){return new kr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ju(n,e){return Fs($t(n),$t(e))&&n.limitType===e.limitType}function cp(n){return`${Dr($t(n))}|lt:${n.limitType}`}function nd(n){return`Query(target=${function Qu(n){let e=n.path.canonicalString();return null!==n.collectionGroup&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>{return`${(r=t).field.canonicalString()} ${r.op} ${vi(r.value)}`;var r}).join(", ")}]`),Vn(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>{return`${(r=t).field.canonicalString()} (${r.dir})`;var r}).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>vi(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>vi(t)).join(",")),`Target(${e})`}($t(n))}; limitType=${n.limitType})`}function rd(n,e){return e.isFoundDocument()&&function(t,r){const i=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(i):P.isDocumentKey(t.path)?t.path.isEqual(i):t.path.isImmediateParentOf(i)}(n,e)&&function(t,r){for(const i of t.explicitOrderBy)if(!i.field.isKeyField()&&null===r.data.field(i.field))return!1;return!0}(n,e)&&function(t,r){for(const i of t.filters)if(!i.matches(r))return!1;return!0}(n,e)&&(r=e,!((t=n).startAt&&!function(i,o,u){const h=op(i,o,u);return i.inclusive?h<=0:h<0}(t.startAt,ya(t),r)||t.endAt&&!function(i,o,u){const h=op(i,o,u);return i.inclusive?h>=0:h>0}(t.endAt,ya(t),r)));var t,r}function hp(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function dp(n){return(e,t)=>{let r=!1;for(const i of ya(n)){const o=oy(i,e,t);if(0!==o)return o;r=r||i.field.isKeyField()}return 0}}function oy(n,e,t){const r=n.field.isKeyField()?P.comparator(e.key,t.key):function(i,o,u){const h=o.data.field(i),m=u.data.field(i);return null!==h&&null!==m?Ln(h,m):q()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return q()}}function fp(n,e){if(n.N){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ue(e)?"-0":e}}function pp(n){return{integerValue:""+n}}function gp(n,e){return fa(e)?pp(e):fp(n,e)}class Rc{constructor(){this._=void 0}}function ay(n,e,t){return n instanceof _a?function(r,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof Us?yp(n,e):n instanceof Bs?_p(n,e):function(r,i){const o=mp(r,i),u=vp(o)+vp(r.k);return Ku(o)&&Ku(r.k)?pp(u):fp(r.M,u)}(n,e)}function uy(n,e,t){return n instanceof Us?yp(n,e):n instanceof Bs?_p(n,e):t}function mp(n,e){return n instanceof va?Ku(t=e)||(r=t)&&"doubleValue"in r?e:{integerValue:0}:null;var r,t}class _a extends Rc{}class Us extends Rc{constructor(e){super(),this.elements=e}}function yp(n,e){const t=Ip(e);for(const r of n.elements)t.some(i=>Vt(i,r))||t.push(r);return{arrayValue:{values:t}}}class Bs extends Rc{constructor(e){super(),this.elements=e}}function _p(n,e){let t=Ip(e);for(const r of n.elements)t=t.filter(i=>!Vt(i,r));return{arrayValue:{values:t}}}class va extends Rc{constructor(e,t){super(),this.M=e,this.k=t}}function vp(n){return _e(n.integerValue||n.doubleValue)}function Ip(n){return l(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Xu{constructor(e,t){this.field=e,this.transform=t}}class cy{constructor(e,t){this.version=e,this.transformResults=t}}class Be{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Be}static exists(e){return new Be(void 0,e)}static updateTime(e){return new Be(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Oc(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class Mc{}function hy(n,e,t){n instanceof el?function(r,i,o){const u=r.value.clone(),h=Ap(r.fieldTransforms,i,o.transformResults);u.setAll(h),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):n instanceof Gs?function(r,i,o){if(!Oc(r.precondition,i))return void i.convertToUnknownDocument(o.version);const u=Ap(r.fieldTransforms,i,o.transformResults),h=i.data;h.setAll(Tp(r)),h.setAll(u),i.convertToFoundDocument(o.version,h).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function id(n,e,t){var i;n instanceof el?function(r,i,o){if(!Oc(r.precondition,i))return;const u=r.value.clone(),h=bp(r.fieldTransforms,o,i);u.setAll(h),i.convertToFoundDocument(Ep(i),u).setHasLocalMutations()}(n,e,t):n instanceof Gs?function(r,i,o){if(!Oc(r.precondition,i))return;const u=bp(r.fieldTransforms,o,i),h=i.data;h.setAll(Tp(r)),h.setAll(u),i.convertToFoundDocument(Ep(i),h).setHasLocalMutations()}(n,e,t):Oc(n.precondition,i=e)&&i.convertToNoDocument(z.min())}function dy(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),o=mp(r.transform,i||null);null!=o&&(null==t&&(t=G.empty()),t.set(r.field,o))}return t||null}function wp(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(r=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===r||t&&r&&yi(t,r,(i,o)=>function ly(n,e){return n.field.isEqual(e.field)&&(r=e.transform,(t=n.transform)instanceof Us&&r instanceof Us||t instanceof Bs&&r instanceof Bs?yi(t.elements,r.elements,Vt):t instanceof va&&r instanceof va?Vt(t.k,r.k):t instanceof _a&&r instanceof _a);var t,r}(i,o))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,r}function Ep(n){return n.isFoundDocument()?n.version:z.min()}class el extends Mc{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}}class Gs extends Mc{constructor(e,t,r,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}}function Tp(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Ap(n,e,t){const r=new Map;Q(n.length===t.length);for(let i=0;i<t.length;i++){const o=n[i],u=o.transform,h=e.data.field(o.field);r.set(o.field,uy(u,h,t[i]))}return r}function bp(n,e,t){const r=new Map;for(const i of n){const o=i.transform,u=t.data.field(i.field);r.set(i.field,ay(o,u,e))}return r}class tl extends Mc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class sd extends Mc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class fy{constructor(e){this.count=e}}var Ge,oe;function Cp(n){switch(n){default:return q();case b.CANCELLED:case b.UNKNOWN:case b.DEADLINE_EXCEEDED:case b.RESOURCE_EXHAUSTED:case b.INTERNAL:case b.UNAVAILABLE:case b.UNAUTHENTICATED:return!1;case b.INVALID_ARGUMENT:case b.NOT_FOUND:case b.ALREADY_EXISTS:case b.PERMISSION_DENIED:case b.FAILED_PRECONDITION:case b.ABORTED:case b.OUT_OF_RANGE:case b.UNIMPLEMENTED:case b.DATA_LOSS:return!0}}function Sp(n){if(void 0===n)return Oe("GRPC error has no .code"),b.UNKNOWN;switch(n){case Ge.OK:return b.OK;case Ge.CANCELLED:return b.CANCELLED;case Ge.UNKNOWN:return b.UNKNOWN;case Ge.DEADLINE_EXCEEDED:return b.DEADLINE_EXCEEDED;case Ge.RESOURCE_EXHAUSTED:return b.RESOURCE_EXHAUSTED;case Ge.INTERNAL:return b.INTERNAL;case Ge.UNAVAILABLE:return b.UNAVAILABLE;case Ge.UNAUTHENTICATED:return b.UNAUTHENTICATED;case Ge.INVALID_ARGUMENT:return b.INVALID_ARGUMENT;case Ge.NOT_FOUND:return b.NOT_FOUND;case Ge.ALREADY_EXISTS:return b.ALREADY_EXISTS;case Ge.PERMISSION_DENIED:return b.PERMISSION_DENIED;case Ge.FAILED_PRECONDITION:return b.FAILED_PRECONDITION;case Ge.ABORTED:return b.ABORTED;case Ge.OUT_OF_RANGE:return b.OUT_OF_RANGE;case Ge.UNIMPLEMENTED:return b.UNIMPLEMENTED;case Ge.DATA_LOSS:return b.DATA_LOSS;default:return q()}}(oe=Ge||(Ge={}))[oe.OK=0]="OK",oe[oe.CANCELLED=1]="CANCELLED",oe[oe.UNKNOWN=2]="UNKNOWN",oe[oe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",oe[oe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",oe[oe.NOT_FOUND=5]="NOT_FOUND",oe[oe.ALREADY_EXISTS=6]="ALREADY_EXISTS",oe[oe.PERMISSION_DENIED=7]="PERMISSION_DENIED",oe[oe.UNAUTHENTICATED=16]="UNAUTHENTICATED",oe[oe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",oe[oe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",oe[oe.ABORTED=10]="ABORTED",oe[oe.OUT_OF_RANGE=11]="OUT_OF_RANGE",oe[oe.UNIMPLEMENTED=12]="UNIMPLEMENTED",oe[oe.INTERNAL=13]="INTERNAL",oe[oe.UNAVAILABLE=14]="UNAVAILABLE",oe[oe.DATA_LOSS=15]="DATA_LOSS";class Ai{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,o]of r)if(this.equalsFn(i,e))return o}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Mn(this.inner,(t,r)=>{for(const[i,o]of r)e(i,o)})}isEmpty(){return bc(this.inner)}size(){return this.innerSize}}class Pe{constructor(e,t){this.comparator=e,this.root=t||et.EMPTY}insert(e,t){return new Pe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,et.BLACK,null,null))}remove(e){return new Pe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,et.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Pc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Pc(this.root,e,this.comparator,!1)}getReverseIterator(){return new Pc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Pc(this.root,e,this.comparator,!0)}}class Pc{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(0===o){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class et{constructor(e,t,r,i,o){this.key=e,this.value=t,this.color=null!=r?r:et.RED,this.left=null!=i?i:et.EMPTY,this.right=null!=o?o:et.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,o){return new et(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===o?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return et.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return et.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,et.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,et.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw q();const e=this.left.check();if(e!==this.right.check())throw q();return e+(this.isRed()?0:1)}}et.EMPTY=null,et.RED=!0,et.BLACK=!1,et.EMPTY=new class{constructor(){this.size=0}get key(){throw q()}get value(){throw q()}get color(){throw q()}get left(){throw q()}get right(){throw q()}copy(n,e,t,r,i){return this}insert(n,e,t){return new et(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ve{constructor(e){this.comparator=e,this.data=new Pe(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new xp(this.data.getIterator())}getIteratorFrom(e){return new xp(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof ve)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ve(this.comparator);return t.data=e,t}}class xp{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ia(n){return n.hasNext()?n.getNext():void 0}const py=new Pe(P.comparator);function Wt(){return py}const gy=new Pe(P.comparator);function od(){return gy}function nl(){return new Ai(n=>n.toString(),(n,e)=>n.isEqual(e))}const my=new Pe(P.comparator),yy=new ve(P.comparator);function he(...n){let e=yy;for(const t of n)e=e.add(t);return e}const _y=new ve(X);function Vc(){return _y}class rl{constructor(e,t,r,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t){const r=new Map;return r.set(e,il.createSynthesizedTargetChangeForCurrentChange(e,t)),new rl(z.min(),r,Vc(),Wt(),he())}}class il{constructor(e,t,r,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t){return new il(ke.EMPTY_BYTE_STRING,t,he(),he(),he())}}class Lc{constructor(e,t,r,i){this.O=e,this.removedTargetIds=t,this.key=r,this.F=i}}class Dp{constructor(e,t){this.targetId=e,this.$=t}}class kp{constructor(e,t,r=ke.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Np{constructor(){this.B=0,this.L=Op(),this.U=ke.EMPTY_BYTE_STRING,this.q=!1,this.K=!0}get current(){return this.q}get resumeToken(){return this.U}get G(){return 0!==this.B}get j(){return this.K}W(e){e.approximateByteSize()>0&&(this.K=!0,this.U=e)}H(){let e=he(),t=he(),r=he();return this.L.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:q()}}),new il(this.U,this.q,e,t,r)}J(){this.K=!1,this.L=Op()}Y(e,t){this.K=!0,this.L=this.L.insert(e,t)}X(e){this.K=!0,this.L=this.L.remove(e)}Z(){this.B+=1}tt(){this.B-=1}et(){this.K=!0,this.q=!0}}class vy{constructor(e){this.nt=e,this.st=new Map,this.it=Wt(),this.rt=Rp(),this.ot=new ve(X)}ut(e){for(const t of e.O)e.F&&e.F.isFoundDocument()?this.at(t,e.F):this.ct(t,e.key,e.F);for(const t of e.removedTargetIds)this.ct(t,e.key,e.F)}ht(e){this.forEachTarget(e,t=>{const r=this.lt(t);switch(e.state){case 0:this.ft(t)&&r.W(e.resumeToken);break;case 1:r.tt(),r.G||r.J(),r.W(e.resumeToken);break;case 2:r.tt(),r.G||this.removeTarget(t);break;case 3:this.ft(t)&&(r.et(),r.W(e.resumeToken));break;case 4:this.ft(t)&&(this.dt(t),r.W(e.resumeToken));break;default:q()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.st.forEach((r,i)=>{this.ft(i)&&t(i)})}_t(e){const t=e.targetId,r=e.$.count,i=this.wt(t);if(i){const o=i.target;if(xc(o))if(0===r){const u=new P(o.path);this.ct(t,u,J.newNoDocument(u,z.min()))}else Q(1===r);else this.gt(t)!==r&&(this.dt(t),this.ot=this.ot.add(t))}}yt(e){const t=new Map;this.st.forEach((o,u)=>{const h=this.wt(u);if(h){if(o.current&&xc(h.target)){const m=new P(h.target.path);null!==this.it.get(m)||this.It(u,m)||this.ct(u,m,J.newNoDocument(m,e))}o.j&&(t.set(u,o.H()),o.J())}});let r=he();this.rt.forEach((o,u)=>{let h=!0;u.forEachWhile(m=>{const _=this.wt(m);return!_||2===_.purpose||(h=!1,!1)}),h&&(r=r.add(o))}),this.it.forEach((o,u)=>u.setReadTime(e));const i=new rl(e,t,this.ot,this.it,r);return this.it=Wt(),this.rt=Rp(),this.ot=new ve(X),i}at(e,t){if(!this.ft(e))return;const r=this.It(e,t.key)?2:0;this.lt(e).Y(t.key,r),this.it=this.it.insert(t.key,t),this.rt=this.rt.insert(t.key,this.Tt(t.key).add(e))}ct(e,t,r){if(!this.ft(e))return;const i=this.lt(e);this.It(e,t)?i.Y(t,1):i.X(t),this.rt=this.rt.insert(t,this.Tt(t).delete(e)),r&&(this.it=this.it.insert(t,r))}removeTarget(e){this.st.delete(e)}gt(e){const t=this.lt(e).H();return this.nt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Z(e){this.lt(e).Z()}lt(e){let t=this.st.get(e);return t||(t=new Np,this.st.set(e,t)),t}Tt(e){let t=this.rt.get(e);return t||(t=new ve(X),this.rt=this.rt.insert(e,t)),t}ft(e){const t=null!==this.wt(e);return t||M("WatchChangeAggregator","Detected inactive target",e),t}wt(e){const t=this.st.get(e);return t&&t.G?null:this.nt.Et(e)}dt(e){this.st.set(e,new Np),this.nt.getRemoteKeysForTarget(e).forEach(t=>{this.ct(e,t,null)})}It(e,t){return this.nt.getRemoteKeysForTarget(e).has(t)}}function Rp(){return new Pe(P.comparator)}function Op(){return new Pe(P.comparator)}const Iy={asc:"ASCENDING",desc:"DESCENDING"},wy={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Ey{constructor(e,t){this.databaseId=e,this.N=t}}function sl(n,e){return n.N?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Mp(n,e){return n.N?e.toBase64():e.toUint8Array()}function Ty(n,e){return sl(n,e.toTimestamp())}function Ze(n){return Q(!!n),z.fromTimestamp(function(e){const t=Pn(e);return new Ae(t.seconds,t.nanos)}(n))}function ad(n,e){return(t=n,new ne(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function Pp(n){const e=ne.fromString(n);return Q($p(e)),e}function ol(n,e){return ad(n.databaseId,e.path)}function Un(n,e){const t=Pp(e);if(t.get(1)!==n.databaseId.projectId)throw new N(b.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new N(b.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new P(Lp(t))}function ud(n,e){return ad(n.databaseId,e)}function Vp(n){const e=Pp(n);return 4===e.length?ne.emptyPath():Lp(e)}function al(n){return new ne(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Lp(n){return Q(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Fp(n,e,t){return{name:ol(n,e),fields:t.value.mapValue.fields}}function Up(n,e,t){const r=Un(n,e.name),i=Ze(e.updateTime),o=new G({mapValue:{fields:e.fields}}),u=J.newFoundDocument(r,i,o);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function ul(n,e){let t;if(e instanceof el)t={update:Fp(n,e.key,e.value)};else if(e instanceof tl)t={delete:ol(n,e.key)};else if(e instanceof Gs)t={update:Fp(n,e.key,e.data),updateMask:Ry(e.fieldMask)};else{if(!(e instanceof sd))return q();t={verify:ol(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const u=o.transform;if(u instanceof _a)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Us)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Bs)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof va)return{fieldPath:o.field.canonicalString(),increment:u.k};throw q()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:Ty(n,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:q()),t;var i}function ld(n,e){const t=e.currentDocument?void 0!==(i=e.currentDocument).updateTime?Be.updateTime(Ze(i.updateTime)):void 0!==i.exists?Be.exists(i.exists):Be.none():Be.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,u){let h=null;"setToServerValue"in u?(Q("REQUEST_TIME"===u.setToServerValue),h=new _a):"appendMissingElements"in u?h=new Us(u.appendMissingElements.values||[]):"removeAllFromArray"in u?h=new Bs(u.removeAllFromArray.values||[]):"increment"in u?h=new va(o,u.increment):q();const m=be.fromServerFormat(u.fieldPath);return new Xu(m,h)}(n,i)):[];var i;if(e.update){const i=Un(n,e.update.name),o=new G({mapValue:{fields:e.update.fields}});if(e.updateMask){const u=new Cr((e.updateMask.fieldPaths||[]).map(_=>be.fromServerFormat(_)));return new Gs(i,o,u,t,r)}return new el(i,o,t,r)}if(e.delete){const i=Un(n,e.delete);return new tl(i,t)}if(e.verify){const i=Un(n,e.verify);return new sd(i,t)}return q()}function Bp(n,e){return{documents:[ud(n,e.path)]}}function Gp(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=ud(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=ud(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(m){if(0===m.length)return;const _=m.map(w=>function(E){if("=="===E.op){if(a(E.value))return{unaryFilter:{field:wa(E.field),op:"IS_NAN"}};if(s(E.value))return{unaryFilter:{field:wa(E.field),op:"IS_NULL"}}}else if("!="===E.op){if(a(E.value))return{unaryFilter:{field:wa(E.field),op:"IS_NOT_NAN"}};if(s(E.value))return{unaryFilter:{field:wa(E.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:wa(E.field),op:Dy(E.op),value:E.value}}}(w));return 1===_.length?_[0]:{compositeFilter:{op:"AND",filters:_}}}(e.filters);i&&(t.structuredQuery.where=i);const o=function(m){if(0!==m.length)return m.map(_=>{return{field:wa((w=_).field),direction:xy(w.dir)};var w})}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const u=(_=e.limit,n.N||Vn(_)?_:{value:_});var _,h,m;return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(h=e.startAt).inclusive,values:h.position}),e.endAt&&(t.structuredQuery.endAt={before:!(m=e.endAt).inclusive,values:m.position}),t}function qp(n){let e=Vp(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){Q(1===r);const w=t.from[0];w.allDescendants?i=w.collectionId:e=e.child(w.collectionId)}let o=[];t.where&&(o=jp(t.where));let u=[];t.orderBy&&(u=t.orderBy.map(w=>{return new ga(Ea((E=w).field),function(A){switch(A){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(E.direction));var E}));let h=null;t.limit&&(h=function(w){let E;return E="object"==typeof w?w.value:w,Vn(E)?null:E}(t.limit));let m=null;var w;t.startAt&&(m=new Ti((w=t.startAt).values||[],!!w.before));let _=null;return t.endAt&&(_=function(w){return new Ti(w.values||[],!w.before)}(t.endAt)),up(e,i,u,o,h,"F",m,_)}function jp(n){return n?void 0!==n.unaryFilter?[Ny(n)]:void 0!==n.fieldFilter?[ky(n)]:void 0!==n.compositeFilter?n.compositeFilter.filters.map(e=>jp(e)).reduce((e,t)=>e.concat(t)):q():[]}function xy(n){return Iy[n]}function Dy(n){return wy[n]}function wa(n){return{fieldPath:n.canonicalString()}}function Ea(n){return be.fromServerFormat(n.fieldPath)}function ky(n){return Xe.create(Ea(n.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return q()}}(n.fieldFilter.op),n.fieldFilter.value)}function Ny(n){switch(n.unaryFilter.op){case"IS_NAN":const e=Ea(n.unaryFilter.field);return Xe.create(e,"==",{doubleValue:NaN});case"IS_NULL":const t=Ea(n.unaryFilter.field);return Xe.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Ea(n.unaryFilter.field);return Xe.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Ea(n.unaryFilter.field);return Xe.create(i,"!=",{nullValue:"NULL_VALUE"});default:return q()}}function Ry(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function $p(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function gt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Wp(e)),e=Oy(n.get(t),e);return Wp(e)}function Oy(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const o=n.charAt(i);switch(o){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=o}}return t}function Wp(n){return n+"\x01\x01"}function Bn(n){const e=n.length;if(Q(e>=2),2===e)return Q("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),ne.emptyPath();const t=e-2,r=[];let i="";for(let o=0;o<e;){const u=n.indexOf("\x01",o);switch((u<0||u>t)&&q(),n.charAt(u+1)){case"\x01":const h=n.substring(o,u);let m;0===i.length?m=h:(i+=h,m=i,i=""),r.push(m);break;case"\x10":i+=n.substring(o,u),i+="\0";break;case"\x11":i+=n.substring(o,u+1);break;default:q()}o=u+2}return new ne(r)}const Kp=["userId","batchId"];function Fc(n,e){return[n,gt(e)]}function Hp(n,e,t){return[n,gt(e),t]}const My={},Py=["prefixPath","collectionGroup","readTime","documentId"],Vy=["prefixPath","collectionGroup","documentId"],Ly=["collectionGroup","readTime","prefixPath","documentId"],Fy=["canonicalId","targetId"],Uy=["targetId","path"],By=["path","targetId"],Gy=["collectionId","parent"],qy=["indexId","uid"],jy=["uid","sequenceNumber"],$y=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Wy=["indexId","uid","orderedDocumentKey"],Ky=["userId","collectionPath","documentId"],Hy=["userId","collectionPath","largestBatchId"],zy=["userId","collectionGroup","largestBatchId"],zp=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Zy=[...zp,"documentOverlays"],Zp=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Yy=[...Zp,"indexConfiguration","indexState","indexEntries"],Yp="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Qp{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class S{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&q(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new S((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof S?t:S.resolve(t)}catch(t){return S.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):S.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):S.reject(t)}static resolve(e){return new S((t,r)=>{t(e)})}static reject(e){return new S((t,r)=>{r(e)})}static waitFor(e){return new S((t,r)=>{let i=0,o=0,u=!1;e.forEach(h=>{++i,h.next(()=>{++o,u&&o===i&&t()},m=>r(m))}),u=!0,o===i&&t()})}static or(e){let t=S.resolve(!1);for(const r of e)t=t.next(i=>i?S.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,o)=>{r.push(t.call(this,i,o))}),this.waitFor(r)}}class Uc{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.At=new De,this.transaction.oncomplete=()=>{this.At.resolve()},this.transaction.onabort=()=>{t.error?this.At.reject(new ll(e,t.error)):this.At.resolve()},this.transaction.onerror=r=>{const i=cd(r.target.error);this.At.reject(new ll(e,i))}}static open(e,t,r,i){try{return new Uc(t,e.transaction(i,r))}catch(o){throw new ll(t,o)}}get Rt(){return this.At.promise}abort(e){e&&this.At.reject(e),this.aborted||(M("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}Pt(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Jy(t)}}class dn{constructor(e,t,r){this.name=e,this.version=t,this.bt=r,12.2===dn.Vt((0,W.z$)())&&Oe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return M("SimpleDb","Removing database:",e),js(window.indexedDB.deleteDatabase(e)).toPromise()}static vt(){if(!(0,W.hl)())return!1;if(dn.St())return!0;const e=(0,W.z$)(),t=dn.Vt(e),r=0<t&&t<10,i=dn.Dt(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)}static St(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.Ct)}static xt(e,t){return e.store(t)}static Vt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static Dt(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}Nt(e){var t=this;return(0,p.Z)(function*(){return t.db||(M("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const o=indexedDB.open(t.name,t.version);o.onsuccess=u=>{r(u.target.result)},o.onblocked=()=>{i(new ll(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},o.onerror=u=>{const h=u.target.error;i("VersionError"===h.name?new N(b.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===h.name?new N(b.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+h):new ll(e,h))},o.onupgradeneeded=u=>{M("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',u.oldVersion),t.bt.kt(u.target.result,o.transaction,u.oldVersion,t.version).next(()=>{M("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.Mt&&(t.db.onversionchange=r=>t.Mt(r)),t.db})()}Ot(e){this.Mt=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var o=this;return(0,p.Z)(function*(){const u="readonly"===t;let h=0;for(;;){++h;try{o.db=yield o.Nt(e);const m=Uc.open(o.db,e,u?"readonly":"readwrite",r),_=i(m).next(w=>(m.Pt(),w)).catch(w=>(m.abort(w),S.reject(w))).toPromise();return _.catch(()=>{}),yield m.Rt,_}catch(m){const _="FirebaseError"!==m.name&&h<3;if(M("SimpleDb","Transaction failed with error:",m.message,"Retrying:",_),o.close(),!_)return Promise.reject(m)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Qy{constructor(e){this.Ft=e,this.$t=!1,this.Bt=null}get isDone(){return this.$t}get Lt(){return this.Bt}set cursor(e){this.Ft=e}done(){this.$t=!0}Ut(e){this.Bt=e}delete(){return js(this.Ft.delete())}}class ll extends N{constructor(e,t){super(b.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function qs(n){return"IndexedDbTransactionError"===n.name}class Jy{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(M("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(M("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),js(r)}add(e){return M("SimpleDb","ADD",this.store.name,e,e),js(this.store.add(e))}get(e){return js(this.store.get(e)).next(t=>(void 0===t&&(t=null),M("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return M("SimpleDb","DELETE",this.store.name,e),js(this.store.delete(e))}count(){return M("SimpleDb","COUNT",this.store.name),js(this.store.count())}qt(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const i=this.cursor(r),o=[];return this.Kt(i,(u,h)=>{o.push(h)}).next(()=>o)}{const i=this.store.getAll(r.range);return new S((o,u)=>{i.onerror=h=>{u(h.target.error)},i.onsuccess=h=>{o(h.target.result)}})}}Gt(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new S((i,o)=>{r.onerror=u=>{o(u.target.error)},r.onsuccess=u=>{i(u.target.result)}})}Qt(e,t){M("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.jt=!1;const i=this.cursor(r);return this.Kt(i,(o,u,h)=>h.delete())}Wt(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.Kt(i,t)}zt(e){const t=this.cursor({});return new S((r,i)=>{t.onerror=o=>{const u=cd(o.target.error);i(u)},t.onsuccess=o=>{const u=o.target.result;u?e(u.primaryKey,u.value).next(h=>{h?u.continue():r()}):r()}})}Kt(e,t){const r=[];return new S((i,o)=>{e.onerror=u=>{o(u.target.error)},e.onsuccess=u=>{const h=u.target.result;if(!h)return void i();const m=new Qy(h),_=t(h.primaryKey,h.value,m);if(_ instanceof S){const w=_.catch(E=>(m.done(),S.reject(E)));r.push(w)}m.isDone?i():null===m.Lt?h.continue():h.continue(m.Lt)}}).next(()=>S.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.jt?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function js(n){return new S((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=cd(r.target.error);t(i)}})}let Jp=!1;function cd(n){const e=dn.Vt((0,W.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new N("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Jp||(Jp=!0,setTimeout(()=>{throw r},0)),r}}return n}class Xp extends Qp{constructor(e,t){super(),this.Ht=e,this.currentSequenceNumber=t}}function Ye(n,e){const t=L(n);return dn.xt(t.Ht,e)}class hd{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&hy(o,e,r[i])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&id(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&id(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(t=>{const r=e.get(t.key),i=r;this.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(z.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),he())}isEqual(e){return this.batchId===e.batchId&&yi(this.mutations,e.mutations,(t,r)=>wp(t,r))&&yi(this.baseMutations,e.baseMutations,(t,r)=>wp(t,r))}}class dd{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Q(e.mutations.length===r.length);let i=my;const o=e.mutations;for(let u=0;u<o.length;u++)i=i.insert(o[u].key,r[u].version);return new dd(e,t,r,i)}}class fd{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class bi{constructor(e,t,r,i,o=z.min(),u=z.min(),h=ke.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=h}withSequenceNumber(e){return new bi(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new bi(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new bi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class eg{constructor(e){this.Jt=e}}function tg(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Bc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:ol(i=n.Jt,(o=e).key),fields:o.data.value.mapValue.fields,updateTime:sl(i,o.version.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:$s(e.version)};else{if(!e.isUnknownDocument())return q();r.unknownDocument={path:t.path.toArray(),version:$s(e.version)}}var i,o;return r}function Bc(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function $s(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ws(n){const e=new Ae(n.seconds,n.nanoseconds);return z.fromTimestamp(e)}function Ta(n,e){const t=(e.baseMutations||[]).map(o=>ld(n.Jt,o));for(let o=0;o<e.mutations.length-1;++o){const u=e.mutations[o];o+1<e.mutations.length&&void 0!==e.mutations[o+1].transform&&(u.updateTransforms=e.mutations[o+1].transform.fieldTransforms,e.mutations.splice(o+1,1),++o)}const r=e.mutations.map(o=>ld(n.Jt,o)),i=Ae.fromMillis(e.localWriteTimeMs);return new hd(e.batchId,i,t,r)}function cl(n){const e=Ws(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?Ws(n.lastLimboFreeSnapshotVersion):z.min();let r;var i;return void 0!==n.query.documents?(Q(1===(i=n.query).documents.length),r=$t(ma(Vp(i.documents[0])))):r=$t(qp(n.query)),new bi(r,n.targetId,0,n.lastListenSequenceNumber,e,t,ke.fromBase64String(n.resumeToken))}function ng(n,e){const t=$s(e.snapshotVersion),r=$s(e.lastLimboFreeSnapshotVersion);let i;i=xc(e.target)?Bp(n.Jt,e.target):Gp(n.Jt,e.target);const o=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Dr(e.target),readTime:t,resumeToken:o,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function pd(n){const e=qp({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?lp(e,e.limit,"L"):e}function gd(n,e){return new fd(e.largestBatchId,ld(n.Jt,e.overlayMutation))}function rg(n,e){const t=e.path.lastSegment();return[n,gt(e.path.popLast()),t]}class e_{getBundleMetadata(e,t){return ig(e).get(t).next(r=>{if(r)return{id:(i=r).bundleId,createTime:Ws(i.createTime),version:i.version};var i})}saveBundleMetadata(e,t){return ig(e).put({bundleId:(r=t).id,createTime:$s(Ze(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return sg(e).get(t).next(r=>{if(r)return{name:(i=r).name,query:pd(i.bundledQuery),readTime:Ws(i.readTime)};var i})}saveNamedQuery(e,t){return sg(e).put({name:(r=t).name,readTime:$s(Ze(r.readTime)),bundledQuery:r.bundledQuery});var r}}function ig(n){return Ye(n,"bundles")}function sg(n){return Ye(n,"namedQueries")}class md{constructor(e,t){this.M=e,this.userId=t}static Yt(e,t){return new md(e,t.uid||"")}getOverlay(e,t){return hl(e).get(rg(this.userId,t)).next(r=>r?gd(this.M,r):null)}saveOverlays(e,t,r){const i=[];return r.forEach((o,u)=>{const h=new fd(t,u);i.push(this.Xt(e,h))}),S.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(u=>i.add(gt(u.getCollectionPath())));const o=[];return i.forEach(u=>{const h=IDBKeyRange.bound([this.userId,u,r],[this.userId,u,r+1],!1,!0);o.push(hl(e).Qt("collectionPathOverlayIndex",h))}),S.waitFor(o)}getOverlaysForCollection(e,t,r){const i=nl(),o=gt(t),u=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,Number.POSITIVE_INFINITY],!0);return hl(e).qt("collectionPathOverlayIndex",u).next(h=>{for(const m of h){const _=gd(this.M,m);i.set(_.getKey(),_)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const o=nl();let u;const h=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return hl(e).Wt({index:"collectionGroupOverlayIndex",range:h},(m,_,w)=>{const E=gd(this.M,_);o.size()<i||E.largestBatchId===u?(o.set(E.getKey(),E),u=E.largestBatchId):w.done()}).next(()=>o)}Xt(e,t){return hl(e).put(function(r,i,o){const[u,h,m]=rg(i,o.mutation.key);return{userId:i,collectionPath:h,documentId:m,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:ul(r.Jt,o.mutation)}}(this.M,this.userId,t))}}function hl(n){return Ye(n,"documentOverlays")}class Ks{constructor(){}Zt(e,t){this.te(e,t),t.ee()}te(e,t){if("nullValue"in e)this.ne(t,5);else if("booleanValue"in e)this.ne(t,10),t.se(e.booleanValue?1:0);else if("integerValue"in e)this.ne(t,15),t.se(_e(e.integerValue));else if("doubleValue"in e){const r=_e(e.doubleValue);isNaN(r)?this.ne(t,13):(this.ne(t,15),Ue(r)?t.se(0):t.se(r))}else if("timestampValue"in e){const r=e.timestampValue;this.ne(t,20),"string"==typeof r?t.ie(r):(t.ie(`${r.seconds||""}`),t.se(r.nanos||0))}else if("stringValue"in e)this.re(e.stringValue,t),this.oe(t);else if("bytesValue"in e)this.ne(t,30),t.ue(Sr(e.bytesValue)),this.oe(t);else if("referenceValue"in e)this.ae(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.ne(t,45),t.se(r.latitude||0),t.se(r.longitude||0)}else"mapValue"in e?I(e)?this.ne(t,Number.MAX_SAFE_INTEGER):(this.ce(e.mapValue,t),this.oe(t)):"arrayValue"in e?(this.he(e.arrayValue,t),this.oe(t)):q()}re(e,t){this.ne(t,25),this.le(e,t)}le(e,t){t.ie(e)}ce(e,t){const r=e.fields||{};this.ne(t,55);for(const i of Object.keys(r))this.re(i,t),this.te(r[i],t)}he(e,t){const r=e.values||[];this.ne(t,50);for(const i of r)this.te(i,t)}ae(e,t){this.ne(t,37),P.fromName(e).path.forEach(r=>{this.ne(t,60),this.le(r,t)})}ne(e,t){e.se(t)}oe(e){e.se(2)}}function t_(n){if(0===n)return 8;let e=0;return n>>4==0&&(e+=4,n<<=4),n>>6==0&&(e+=2,n<<=2),n>>7==0&&(e+=1),e}function og(n){const e=64-function(t){let r=0;for(let i=0;i<8;++i){const o=t_(255&t[i]);if(r+=o,8!==o)break}return r}(n);return Math.ceil(e/8)}Ks.fe=new Ks;class n_{constructor(){this.buffer=new Uint8Array(1024),this.position=0}de(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this._e(r.value),r=t.next();this.we()}me(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.ge(r.value),r=t.next();this.ye()}pe(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this._e(r);else if(r<2048)this._e(960|r>>>6),this._e(128|63&r);else if(t<"\ud800"||"\udbff"<t)this._e(480|r>>>12),this._e(128|63&r>>>6),this._e(128|63&r);else{const i=t.codePointAt(0);this._e(240|i>>>18),this._e(128|63&i>>>12),this._e(128|63&i>>>6),this._e(128|63&i)}}this.we()}Ie(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.ge(r);else if(r<2048)this.ge(960|r>>>6),this.ge(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.ge(480|r>>>12),this.ge(128|63&r>>>6),this.ge(128|63&r);else{const i=t.codePointAt(0);this.ge(240|i>>>18),this.ge(128|63&i>>>12),this.ge(128|63&i>>>6),this.ge(128|63&i)}}this.ye()}Te(e){const t=this.Ee(e),r=og(t);this.Ae(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Re(e){const t=this.Ee(e),r=og(t);this.Ae(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Pe(){this.be(255),this.be(255)}Ve(){this.ve(255),this.ve(255)}reset(){this.position=0}seed(e){this.Ae(e.length),this.buffer.set(e,this.position),this.position+=e.length}Se(){return this.buffer.slice(0,this.position)}Ee(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}_e(e){const t=255&e;0===t?(this.be(0),this.be(255)):255===t?(this.be(255),this.be(0)):this.be(t)}ge(e){const t=255&e;0===t?(this.ve(0),this.ve(255)):255===t?(this.ve(255),this.ve(0)):this.ve(e)}we(){this.be(0),this.be(1)}ye(){this.ve(0),this.ve(1)}be(e){this.Ae(1),this.buffer[this.position++]=e}ve(e){this.Ae(1),this.buffer[this.position++]=~e}Ae(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class r_{constructor(e){this.De=e}ue(e){this.De.de(e)}ie(e){this.De.pe(e)}se(e){this.De.Te(e)}ee(){this.De.Pe()}}class i_{constructor(e){this.De=e}ue(e){this.De.me(e)}ie(e){this.De.Ie(e)}se(e){this.De.Re(e)}ee(){this.De.Ve()}}class dl{constructor(){this.De=new n_,this.Ce=new r_(this.De),this.xe=new i_(this.De)}seed(e){this.De.seed(e)}Ne(e){return 0===e?this.Ce:this.xe}Se(){return this.De.Se()}reset(){this.De.reset()}}class Ci{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}ke(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Ci(this.indexId,this.documentKey,this.arrayValue,r)}}function Hs(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=ag(n.arrayValue,e.arrayValue),0!==t?t:(t=ag(n.directionalValue,e.directionalValue),0!==t?t:P.comparator(n.documentKey,e.documentKey)))}function ag(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class s_{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Me=e.orderBy,this.Oe=[];for(const t of e.filters){const r=t;r.S()?this.Fe=r:this.Oe.push(r)}}$e(e){const t=Ii(e);if(void 0!==t&&!this.Be(t))return!1;const r=Fn(e);let i=0,o=0;for(;i<r.length&&this.Be(r[i]);++i);if(i===r.length)return!0;if(void 0!==this.Fe){const u=r[i];if(!this.Le(this.Fe,u)||!this.Ue(this.Me[o++],u))return!1;++i}for(;i<r.length;++i){const u=r[i];if(o>=this.Me.length||!this.Ue(this.Me[o++],u))return!1}return!0}Be(e){for(const t of this.Oe)if(this.Le(t,e))return!0;return!1}Le(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}Ue(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}class o_{constructor(){this.qe=new yd}addToCollectionParentIndex(e,t){return this.qe.add(t),S.resolve()}getCollectionParents(e,t){return S.resolve(this.qe.getEntries(t))}addFieldIndex(e,t){return S.resolve()}deleteFieldIndex(e,t){return S.resolve()}getDocumentsMatchingTarget(e,t){return S.resolve(null)}getFieldIndex(e,t){return S.resolve(null)}getFieldIndexes(e,t){return S.resolve([])}getNextCollectionGroupToUpdate(e){return S.resolve(null)}updateCollectionGroup(e,t,r){return S.resolve()}updateIndexEntries(e,t){return S.resolve()}}class yd{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ve(ne.comparator),o=!i.has(r);return this.index[t]=i.add(r),o}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ve(ne.comparator)).toArray()}}const Aa=new Uint8Array(0);class a_{constructor(e,t){this.user=e,this.databaseId=t,this.Ke=new yd,this.Ge=new Ai(r=>Dr(r),(r,i)=>Fs(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ke.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.Ke.add(t)});const o={collectionId:r,parent:gt(i)};return ug(e).put(o)}return S.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[Ac(t),""],!1,!0);return ug(e).qt(i).next(o=>{for(const u of o){if(u.collectionId!==t)break;r.push(Bn(u.parent))}return r})}addFieldIndex(e,t){const r=Gc(e),i={indexId:(o=t).indexId,collectionGroup:o.collectionGroup,fields:o.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])};var o;return delete i.indexId,r.add(i).next()}deleteFieldIndex(e,t){const r=Gc(e),i=qc(e),o=fl(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>o.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const r=fl(e);let i=!0;const o=new Map;return S.forEach(this.Qe(t),u=>this.getFieldIndex(e,u).next(h=>{i&&(i=!!h),o.set(u,h)})).next(()=>{if(i){let u=he();const h=[];return S.forEach(o,(m,_)=>{var w;M("IndexedDbIndexManager",`Using index ${w=m,`id=${w.indexId}|cg=${w.collectionGroup}|f=${w.fields.map(ae=>`${ae.fieldPath}:${ae.kind}`).join(",")}`} to execute ${Dr(t)}`);const E=function(ae,te){const ie=Ii(te);if(void 0===ie)return null;for(const ce of Dc(ae,ie.fieldPath))switch(ce.op){case"array-contains-any":return ce.value.arrayValue.values||[];case"array-contains":return[ce.value]}return null}(_,m),A=function(ae,te){const ie=new Map;for(const ce of Fn(te))for(const at of Dc(ae,ce.fieldPath))switch(at.op){case"==":case"in":ie.set(ce.fieldPath.canonicalString(),at.value);break;case"not-in":case"!=":return ie.set(ce.fieldPath.canonicalString(),at.value),Array.from(ie.values())}return null}(_,m),D=function(ae,te){const ie=[];let ce=!0;for(const at of Fn(te)){const so=0===at.kind?rp(ae,at.fieldPath,ae.startAt):ip(ae,at.fieldPath,ae.startAt);if(!so.value)return null;ie.push(so.value),ce&&(ce=so.inclusive)}return new Ti(ie,ce)}(_,m),k=function(ae,te){const ie=[];let ce=!0;for(const at of Fn(te)){const so=0===at.kind?ip(ae,at.fieldPath,ae.endAt):rp(ae,at.fieldPath,ae.endAt);if(!so.value)return null;ie.push(so.value),ce&&(ce=so.inclusive)}return new Ti(ie,ce)}(_,m),F=this.je(m,_,D),Y=this.je(m,_,k),de=this.We(m,_,A),we=this.ze(m.indexId,E,F,!!D&&D.inclusive,Y,!!k&&k.inclusive,de);return S.forEach(we,ae=>r.Gt(ae,t.limit).next(te=>{te.forEach(ie=>{const ce=P.fromSegments(ie.documentKey);u.has(ce)||(u=u.add(ce),h.push(ce))})}))}).next(()=>h)}return S.resolve(null)})}Qe(e){let t=this.Ge.get(e);return t||(t=[e],this.Ge.set(e,t),t)}ze(e,t,r,i,o,u,h){const m=(null!=t?t.length:1)*Math.max(null!=r?r.length:1,null!=o?o.length:1),_=m/(null!=t?t.length:1),w=[];for(let E=0;E<m;++E){const A=t?this.He(t[E/_]):Aa,D=r?this.Je(e,A,r[E%_],i):this.Ye(e),k=o?this.Xe(e,A,o[E%_],u):this.Ye(e+1);w.push(...this.createRange(D,k,h.map(F=>this.Je(e,A,F,!0))))}return w}Je(e,t,r,i){const o=new Ci(e,P.empty(),t,r);return i?o:o.ke()}Xe(e,t,r,i){const o=new Ci(e,P.empty(),t,r);return i?o.ke():o}Ye(e){return new Ci(e,P.empty(),Aa,Aa)}getFieldIndex(e,t){const r=new s_(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(o=>{const u=o.filter(h=>r.$e(h));return u.sort((h,m)=>m.fields.length-h.fields.length),u.length>0?u[0]:null})}Ze(e,t){const r=new dl;for(const i of Fn(e)){const o=t.data.field(i.fieldPath);if(null==o)return null;const u=r.Ne(i.kind);Ks.fe.Zt(o,u)}return r.Se()}He(e){const t=new dl;return Ks.fe.Zt(e,t.Ne(0)),t.Se()}tn(e,t){const r=new dl;return Ks.fe.Zt(xr(this.databaseId,t),r.Ne(function(i){const o=Fn(i);return 0===o.length?0:o[o.length-1].kind}(e))),r.Se()}We(e,t,r){if(null===r)return[];let i=[];i.push(new dl);let o=0;for(const u of Fn(e)){const h=r[o++];for(const m of i)if(this.en(t,u.fieldPath)&&l(h))i=this.nn(i,u,h);else{const _=m.Ne(u.kind);Ks.fe.Zt(h,_)}}return this.sn(i)}je(e,t,r){return null==r?null:this.We(e,t,r.position)}sn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Se();return t}nn(e,t,r){const i=[...e],o=[];for(const u of r.arrayValue.values||[])for(const h of i){const m=new dl;m.seed(h.Se()),Ks.fe.Zt(u,m.Ne(t.kind)),o.push(m)}return o}en(e,t){return!!e.filters.find(r=>r instanceof Xe&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=Gc(e),i=qc(e);return(t?r.qt("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.qt()).next(o=>{const u=[];return S.forEach(o,h=>i.get([h.indexId,this.uid]).next(m=>{u.push(function(_,w){const E=w?new Ei(w.sequenceNumber,new jt(Ws(w.readTime),new P(Bn(w.documentKey)),w.largestBatchId)):Ei.empty(),A=_.fields.map(([D,k])=>new wi(be.fromServerFormat(D),k));return new st(_.indexId,_.collectionGroup,A,E)}(h,m))})).next(()=>u)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const o=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==o?o:X(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=Gc(e),o=qc(e);return this.rn(e).next(u=>i.qt("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(h=>S.forEach(h,m=>{return o.put({indexId:m.indexId,uid:this.user.uid||"",sequenceNumber:u,readTime:$s((A=r).readTime),documentKey:gt(A.documentKey.path),largestBatchId:A.largestBatchId});var A})))}updateIndexEntries(e,t){const r=new Map;return S.forEach(t,(i,o)=>{const u=r.get(i.collectionGroup);return(u?S.resolve(u):this.getFieldIndexes(e,i.collectionGroup)).next(h=>(r.set(i.collectionGroup,h),S.forEach(h,m=>this.on(e,i,m).next(_=>{const w=this.un(o,m);return _.isEqual(w)?S.resolve():this.an(e,o,m,_,w)}))))})}cn(e,t,r,i){return fl(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.tn(r,t.key),documentKey:t.key.path.toArray()})}hn(e,t,r,i){return fl(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.tn(r,t.key),t.key.path.toArray()])}on(e,t,r){const i=fl(e);let o=new ve(Hs);return i.Wt({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.tn(r,t)])},(u,h)=>{o=o.add(new Ci(r.indexId,t,h.arrayValue,h.directionalValue))}).next(()=>o)}un(e,t){let r=new ve(Hs);const i=this.Ze(t,e);if(null==i)return r;const o=Ii(t);if(null!=o){const u=e.data.field(o.fieldPath);if(l(u))for(const h of u.arrayValue.values||[])r=r.add(new Ci(t.indexId,e.key,this.He(h),i))}else r=r.add(new Ci(t.indexId,e.key,Aa,i));return r}an(e,t,r,i,o){M("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const u=[];return function(h,m,_,w,E){const A=h.getIterator(),D=m.getIterator();let k=Ia(A),F=Ia(D);for(;k||F;){let Y=!1,de=!1;if(k&&F){const we=_(k,F);we<0?de=!0:we>0&&(Y=!0)}else null!=k?de=!0:Y=!0;Y?(w(F),F=Ia(D)):de?(E(k),k=Ia(A)):(k=Ia(A),F=Ia(D))}}(i,o,Hs,h=>{u.push(this.cn(e,t,r,h))},h=>{u.push(this.hn(e,t,r,h))}),S.waitFor(u)}rn(e){let t=1;return qc(e).Wt({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,o)=>{o.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((u,h)=>Hs(u,h)).filter((u,h,m)=>!h||0!==Hs(u,m[h-1]));const i=[];i.push(e);for(const u of r){const h=Hs(u,e),m=Hs(u,t);if(0===h)i[0]=e.ke();else if(h>0&&m<0)i.push(u),i.push(u.ke());else if(m>0)break}i.push(t);const o=[];for(let u=0;u<i.length;u+=2)o.push(IDBKeyRange.bound([i[u].indexId,this.uid,i[u].arrayValue,i[u].directionalValue,Aa,[]],[i[u+1].indexId,this.uid,i[u+1].arrayValue,i[u+1].directionalValue,Aa,[]]));return o}}function ug(n){return Ye(n,"collectionParents")}function fl(n){return Ye(n,"indexEntries")}function Gc(n){return Ye(n,"indexConfiguration")}function qc(n){return Ye(n,"indexState")}const lg={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class At{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new At(e,At.DEFAULT_COLLECTION_PERCENTILE,At.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function cg(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),o=[],u=IDBKeyRange.only(t.batchId);let h=0;const m=r.Wt({range:u},(w,E,A)=>(h++,A.delete()));o.push(m.next(()=>{Q(1===h)}));const _=[];for(const w of t.mutations){const E=Hp(e,w.key.path,t.batchId);o.push(i.delete(E)),_.push(w.key)}return S.waitFor(o).next(()=>_)}function jc(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw q();e=n.noDocument}return JSON.stringify(e).length}At.DEFAULT_COLLECTION_PERCENTILE=10,At.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,At.DEFAULT=new At(41943040,At.DEFAULT_COLLECTION_PERCENTILE,At.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),At.DISABLED=new At(-1,0,0);class _d{constructor(e,t,r,i){this.userId=e,this.M=t,this.indexManager=r,this.referenceDelegate=i,this.ln={}}static Yt(e,t,r,i){Q(""!==e.uid);const o=e.isAuthenticated()?e.uid:"";return new _d(o,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Si(e).Wt({index:"userMutationsIndex",range:r},(i,o,u)=>{t=!1,u.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const o=ba(e),u=Si(e);return u.add({}).next(h=>{Q("number"==typeof h);const m=new hd(h,t,r,i),_=function(A,D,k){const F=k.baseMutations.map(de=>ul(A.Jt,de)),Y=k.mutations.map(de=>ul(A.Jt,de));return{userId:D,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:F,mutations:Y}}(this.M,this.userId,m),w=[];let E=new ve((A,D)=>X(A.canonicalString(),D.canonicalString()));for(const A of i){const D=Hp(this.userId,A.key.path,h);E=E.add(A.key.path.popLast()),w.push(u.put(_)),w.push(o.put(D,My))}return E.forEach(A=>{w.push(this.indexManager.addToCollectionParentIndex(e,A))}),e.addOnCommittedListener(()=>{this.ln[h]=m.keys()}),S.waitFor(w).next(()=>m)})}lookupMutationBatch(e,t){return Si(e).get(t).next(r=>r?(Q(r.userId===this.userId),Ta(this.M,r)):null)}fn(e,t){return this.ln[t]?S.resolve(this.ln[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.ln[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let o=null;return Si(e).Wt({index:"userMutationsIndex",range:i},(u,h,m)=>{h.userId===this.userId&&(Q(h.batchId>=r),o=Ta(this.M,h)),m.done()}).next(()=>o)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Si(e).Wt({index:"userMutationsIndex",range:t,reverse:!0},(i,o,u)=>{r=o.batchId,u.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Si(e).qt("userMutationsIndex",t).next(r=>r.map(i=>Ta(this.M,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Fc(this.userId,t.path),i=IDBKeyRange.lowerBound(r),o=[];return ba(e).Wt({range:i},(u,h,m)=>{const[_,w,E]=u,A=Bn(w);if(_===this.userId&&t.path.isEqual(A))return Si(e).get(E).next(D=>{if(!D)throw q();Q(D.userId===this.userId),o.push(Ta(this.M,D))});m.done()}).next(()=>o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ve(X);const i=[];return t.forEach(o=>{const u=Fc(this.userId,o.path),h=IDBKeyRange.lowerBound(u),m=ba(e).Wt({range:h},(_,w,E)=>{const[A,D,k]=_,F=Bn(D);A===this.userId&&o.path.isEqual(F)?r=r.add(k):E.done()});i.push(m)}),S.waitFor(i).next(()=>this.dn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,o=Fc(this.userId,r),u=IDBKeyRange.lowerBound(o);let h=new ve(X);return ba(e).Wt({range:u},(m,_,w)=>{const[E,A,D]=m,k=Bn(A);E===this.userId&&r.isPrefixOf(k)?k.length===i&&(h=h.add(D)):w.done()}).next(()=>this.dn(e,h))}dn(e,t){const r=[],i=[];return t.forEach(o=>{i.push(Si(e).get(o).next(u=>{if(null===u)throw q();Q(u.userId===this.userId),r.push(Ta(this.M,u))}))}),S.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return cg(e.Ht,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this._n(t.batchId)}),S.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}_n(e){delete this.ln[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return S.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return ba(e).Wt({range:r},(o,u,h)=>{if(o[0]===this.userId){const m=Bn(o[1]);i.push(m)}else h.done()}).next(()=>{Q(0===i.length)})})}containsKey(e,t){return hg(e,this.userId,t)}wn(e){return dg(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function hg(n,e,t){const r=Fc(e,t.path),i=r[1],o=IDBKeyRange.lowerBound(r);let u=!1;return ba(n).Wt({range:o,jt:!0},(h,m,_)=>{const[w,E,A]=h;w===e&&E===i&&(u=!0),_.done()}).next(()=>u)}function Si(n){return Ye(n,"mutations")}function ba(n){return Ye(n,"documentMutations")}function dg(n){return Ye(n,"mutationQueues")}class zs{constructor(e){this.mn=e}next(){return this.mn+=2,this.mn}static gn(){return new zs(0)}static yn(){return new zs(-1)}}class u_{constructor(e,t){this.referenceDelegate=e,this.M=t}allocateTargetId(e){return this.pn(e).next(t=>{const r=new zs(t.highestTargetId);return t.highestTargetId=r.next(),this.In(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.pn(e).next(t=>z.fromTimestamp(new Ae(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.pn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.pn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.In(e,i)))}addTargetData(e,t){return this.Tn(e,t).next(()=>this.pn(e).next(r=>(r.targetCount+=1,this.En(t,r),this.In(e,r))))}updateTargetData(e,t){return this.Tn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ca(e).delete(t.targetId)).next(()=>this.pn(e)).next(r=>(Q(r.targetCount>0),r.targetCount-=1,this.In(e,r)))}removeTargets(e,t,r){let i=0;const o=[];return Ca(e).Wt((u,h)=>{const m=cl(h);m.sequenceNumber<=t&&null===r.get(m.targetId)&&(i++,o.push(this.removeTargetData(e,m)))}).next(()=>S.waitFor(o)).next(()=>i)}forEachTarget(e,t){return Ca(e).Wt((r,i)=>{const o=cl(i);t(o)})}pn(e){return fg(e).get("targetGlobalKey").next(t=>(Q(null!==t),t))}In(e,t){return fg(e).put("targetGlobalKey",t)}Tn(e,t){return Ca(e).put(ng(this.M,t))}En(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.pn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Dr(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let o=null;return Ca(e).Wt({range:i,index:"queryTargetsIndex"},(u,h,m)=>{const _=cl(h);Fs(t,_.target)&&(o=_,m.done())}).next(()=>o)}addMatchingKeys(e,t,r){const i=[],o=xi(e);return t.forEach(u=>{const h=gt(u.path);i.push(o.put({targetId:r,path:h})),i.push(this.referenceDelegate.addReference(e,r,u))}),S.waitFor(i)}removeMatchingKeys(e,t,r){const i=xi(e);return S.forEach(t,o=>{const u=gt(o.path);return S.waitFor([i.delete([r,u]),this.referenceDelegate.removeReference(e,r,o)])})}removeMatchingKeysForTargetId(e,t){const r=xi(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=xi(e);let o=he();return i.Wt({range:r,jt:!0},(u,h,m)=>{const _=Bn(u[1]),w=new P(_);o=o.add(w)}).next(()=>o)}containsKey(e,t){const r=gt(t.path),i=IDBKeyRange.bound([r],[Ac(r)],!1,!0);let o=0;return xi(e).Wt({index:"documentTargetsIndex",jt:!0,range:i},([u,h],m,_)=>{0!==u&&(o++,_.done())}).next(()=>o>0)}Et(e,t){return Ca(e).get(t).next(r=>r?cl(r):null)}}function Ca(n){return Ye(n,"targets")}function fg(n){return Ye(n,"targetGlobal")}function xi(n){return Ye(n,"targetDocuments")}function Zs(n){return vd.apply(this,arguments)}function vd(){return vd=(0,p.Z)(function*(n){if(n.code!==b.FAILED_PRECONDITION||n.message!==Yp)throw n;M("LocalStore","Unexpectedly lost primary lease")}),vd.apply(this,arguments)}function pg([n,e],[t,r]){const i=X(n,t);return 0===i?X(e,r):i}class l_{constructor(e){this.An=e,this.buffer=new ve(pg),this.Rn=0}Pn(){return++this.Rn}bn(e){const t=[e,this.Pn()];if(this.buffer.size<this.An)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();pg(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class c_{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.Vn=!1,this.vn=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Sn(e)}stop(){this.vn&&(this.vn.cancel(),this.vn=null)}get started(){return null!==this.vn}Sn(e){var t=this;const r=this.Vn?3e5:6e4;M("LruGarbageCollector",`Garbage collection scheduled in ${r}ms`),this.vn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",r,(0,p.Z)(function*(){t.vn=null,t.Vn=!0;try{yield e.collectGarbage(t.garbageCollector)}catch(i){qs(i)?M("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",i):yield Zs(i)}yield t.Sn(e)}))}}class h_{constructor(e,t){this.Dn=e,this.params=t}calculateTargetCount(e,t){return this.Dn.Cn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return S.resolve(ft.A);const r=new l_(t);return this.Dn.forEachTarget(e,i=>r.bn(i.sequenceNumber)).next(()=>this.Dn.xn(e,i=>r.bn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Dn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Dn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(lg)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),lg):this.Nn(e,t))}getCacheSize(e){return this.Dn.getCacheSize(e)}Nn(e,t){let r,i,o,u,h,m,_;const w=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(E=>(E>this.params.maximumSequenceNumbersToCollect?(M("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${E}`),i=this.params.maximumSequenceNumbersToCollect):i=E,u=Date.now(),this.nthSequenceNumber(e,i))).next(E=>(r=E,h=Date.now(),this.removeTargets(e,r,t))).next(E=>(o=E,m=Date.now(),this.removeOrphanedDocuments(e,r))).next(E=>(_=Date.now(),Bu()<=ue.in.DEBUG&&M("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${u-w}ms\n\tDetermined least recently used ${i} in `+(h-u)+`ms\n\tRemoved ${o} targets in `+(m-h)+`ms\n\tRemoved ${E} documents in `+(_-m)+`ms\nTotal Duration: ${_-w}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:E})))}}class d_{constructor(e,t){this.db=e,this.garbageCollector=new h_(this,t)}Cn(e){const t=this.kn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}kn(e){let t=0;return this.xn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}xn(e,t){return this.Mn(e,(r,i)=>t(i))}addReference(e,t,r){return $c(e,r)}removeReference(e,t,r){return $c(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return $c(e,t)}On(e,t){return function(r,i){let o=!1;return dg(r).zt(u=>hg(r,u,i).next(h=>(h&&(o=!0),S.resolve(!h)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let o=0;return this.Mn(e,(u,h)=>{if(h<=t){const m=this.On(e,u).next(_=>{if(!_)return o++,r.getEntry(e,u).next(()=>(r.removeEntry(u,z.min()),xi(e).delete([0,gt(u.path)])))});i.push(m)}}).next(()=>S.waitFor(i)).next(()=>r.apply(e)).next(()=>o)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return $c(e,t)}Mn(e,t){const r=xi(e);let i,o=ft.A;return r.Wt({index:"documentTargetsIndex"},([u,h],{path:m,sequenceNumber:_})=>{0===u?(o!==ft.A&&t(new P(Bn(i)),o),o=_,i=m):o=ft.A}).next(()=>{o!==ft.A&&t(new P(Bn(i)),o)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function $c(n,e){return xi(n).put((r=n.currentSequenceNumber,{targetId:0,path:gt(e.path),sequenceNumber:r}));var r}class gg{constructor(){this.changes=new Ai(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,J.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?S.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class f_{constructor(e){this.M=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Ys(e).put(r)}removeEntry(e,t,r){return Ys(e).delete(function(i,o){const u=i.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Bc(o),u[u.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Fn(e,r)))}getEntry(e,t){let r=J.newInvalidDocument(t);return Ys(e).Wt({index:"documentKeyIndex",range:IDBKeyRange.only(pl(t))},(i,o)=>{r=this.$n(t,o)}).next(()=>r)}Bn(e,t){let r={size:0,document:J.newInvalidDocument(t)};return Ys(e).Wt({index:"documentKeyIndex",range:IDBKeyRange.only(pl(t))},(i,o)=>{r={document:this.$n(t,o),size:jc(o)}}).next(()=>r)}getEntries(e,t){let r=Wt();return this.Ln(e,t,(i,o)=>{const u=this.$n(i,o);r=r.insert(i,u)}).next(()=>r)}Un(e,t){let r=Wt(),i=new Pe(P.comparator);return this.Ln(e,t,(o,u)=>{const h=this.$n(o,u);r=r.insert(o,h),i=i.insert(o,jc(u))}).next(()=>({documents:r,qn:i}))}Ln(e,t,r){if(t.isEmpty())return S.resolve();let i=new ve(_g);t.forEach(m=>i=i.add(m));const o=IDBKeyRange.bound(pl(i.first()),pl(i.last())),u=i.getIterator();let h=u.getNext();return Ys(e).Wt({index:"documentKeyIndex",range:o},(m,_,w)=>{const E=P.fromSegments([..._.prefixPath,_.collectionGroup,_.documentId]);for(;h&&_g(h,E)<0;)r(h,null),h=u.getNext();h&&h.isEqual(E)&&(r(h,_),h=u.hasNext()?u.getNext():null),h?w.Ut(pl(h)):w.done()}).next(()=>{for(;h;)r(h,null),h=u.hasNext()?u.getNext():null})}getAllFromCollection(e,t,r){const i=[t.popLast().toArray(),t.lastSegment(),Bc(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ys(e).qt(IDBKeyRange.bound(i,o,!0)).next(u=>{let h=Wt();for(const m of u){const _=this.$n(P.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);h=h.insert(_.key,_)}return h})}getAllFromCollectionGroup(e,t,r,i){let o=Wt();const u=yg(t,r),h=yg(t,jt.max());return Ys(e).Wt({index:"collectionGroupIndex",range:IDBKeyRange.bound(u,h,!0)},(m,_,w)=>{const E=this.$n(P.fromSegments(_.prefixPath.concat(_.collectionGroup,_.documentId)),_);o=o.insert(E.key,E),o.size===i&&w.done()}).next(()=>o)}newChangeBuffer(e){return new p_(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return mg(e).get("remoteDocumentGlobalKey").next(t=>(Q(!!t),t))}Fn(e,t){return mg(e).put("remoteDocumentGlobalKey",t)}$n(e,t){if(t){const r=function Xy(n,e){let t;if(e.document)t=Up(n.Jt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=P.fromSegments(e.noDocument.path),i=Ws(e.noDocument.readTime);t=J.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return q();{const r=P.fromSegments(e.unknownDocument.path),i=Ws(e.unknownDocument.version);t=J.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(r){const i=new Ae(r[0],r[1]);return z.fromTimestamp(i)}(e.readTime)),t}(this.M,t);if(!r.isNoDocument()||!r.version.isEqual(z.min()))return r}return J.newInvalidDocument(e)}}class p_ extends gg{constructor(e,t){super(),this.Kn=e,this.trackRemovals=t,this.Gn=new Ai(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new ve((o,u)=>X(o.canonicalString(),u.canonicalString()));return this.changes.forEach((o,u)=>{const h=this.Gn.get(o);if(t.push(this.Kn.removeEntry(e,o,h.readTime)),u.isValidDocument()){const m=tg(this.Kn.M,u);i=i.add(o.path.popLast()),r+=jc(m)-h.size,t.push(this.Kn.addEntry(e,o,m))}else if(r-=h.size,this.trackRemovals){const m=tg(this.Kn.M,u.convertToNoDocument(z.min()));t.push(this.Kn.addEntry(e,o,m))}}),i.forEach(o=>{t.push(this.Kn.indexManager.addToCollectionParentIndex(e,o))}),t.push(this.Kn.updateMetadata(e,r)),S.waitFor(t)}getFromCache(e,t){return this.Kn.Bn(e,t).next(r=>(this.Gn.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Kn.Un(e,t).next(({documents:r,qn:i})=>(i.forEach((o,u)=>{this.Gn.set(o,{size:u,readTime:r.get(o).readTime})}),r))}}function mg(n){return Ye(n,"remoteDocumentGlobal")}function Ys(n){return Ye(n,"remoteDocumentsV14")}function pl(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function yg(n,e){const t=e.documentKey.path.toArray();return[n,Bc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function _g(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let o=0;o<t.length-2&&o<r.length-2;++o)if(i=X(t[o],r[o]),i)return i;return i=X(t.length,r.length),i||(i=X(t[t.length-2],r[r.length-2]),i||X(t[t.length-1],r[r.length-1]))}class g_{constructor(e){this.M=e}kt(e,t,r,i){const o=new Uc("createOrUpgrade",t);var h;r<1&&i>=1&&(e.createObjectStore("owner"),(h=e).createObjectStore("mutationQueues",{keyPath:"userId"}),h.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Kp,{unique:!0}),h.createObjectStore("documentMutations"),vg(e),function(h){h.createObjectStore("remoteDocuments")}(e));let u=S.resolve();return r<3&&i>=3&&(0!==r&&(function(h){h.deleteObjectStore("targetDocuments"),h.deleteObjectStore("targets"),h.deleteObjectStore("targetGlobal")}(e),vg(e)),u=u.next(()=>function(h){const m=h.store("targetGlobal"),_={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:z.min().toTimestamp(),targetCount:0};return m.put("targetGlobalKey",_)}(o))),r<4&&i>=4&&(0!==r&&(u=u.next(()=>function(h,m){return m.store("mutations").qt().next(_=>{h.deleteObjectStore("mutations"),h.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Kp,{unique:!0});const w=m.store("mutations"),E=_.map(A=>w.put(A));return S.waitFor(E)})}(e,o))),u=u.next(()=>{!function(h){h.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(u=u.next(()=>this.Qn(o))),r<6&&i>=6&&(u=u.next(()=>(function(h){h.createObjectStore("remoteDocumentGlobal")}(e),this.jn(o)))),r<7&&i>=7&&(u=u.next(()=>this.Wn(o))),r<8&&i>=8&&(u=u.next(()=>this.zn(e,o))),r<9&&i>=9&&(u=u.next(()=>{!function(h){h.objectStoreNames.contains("remoteDocumentChanges")&&h.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(u=u.next(()=>this.Hn(o))),r<11&&i>=11&&(u=u.next(()=>{(function(h){h.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(h){h.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(u=u.next(()=>{!function(h){const m=h.createObjectStore("documentOverlays",{keyPath:Ky});m.createIndex("collectionPathOverlayIndex",Hy,{unique:!1}),m.createIndex("collectionGroupOverlayIndex",zy,{unique:!1})}(e)})),r<13&&i>=13&&(u=u.next(()=>function(h){const m=h.createObjectStore("remoteDocumentsV14",{keyPath:Py});m.createIndex("documentKeyIndex",Vy),m.createIndex("collectionGroupIndex",Ly)}(e)).next(()=>this.Jn(e,o)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(u=u.next(()=>{!function(h){h.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),h.createObjectStore("indexState",{keyPath:qy}).createIndex("sequenceNumberIndex",jy,{unique:!1}),h.createObjectStore("indexEntries",{keyPath:$y}).createIndex("documentKeyIndex",Wy,{unique:!1})}(e)})),u}jn(e){let t=0;return e.store("remoteDocuments").Wt((r,i)=>{t+=jc(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Qn(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.qt().next(i=>S.forEach(i,o=>{const u=IDBKeyRange.bound([o.userId,-1],[o.userId,o.lastAcknowledgedBatchId]);return r.qt("userMutationsIndex",u).next(h=>S.forEach(h,m=>{Q(m.userId===o.userId);const _=Ta(this.M,m);return cg(e,o.userId,_).next(()=>{})}))}))}Wn(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const o=[];return r.Wt((u,h)=>{const m=new ne(u),_=[0,gt(m)];o.push(t.get(_).next(w=>w?S.resolve():t.put({targetId:0,path:gt(m),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>S.waitFor(o))})}zn(e,t){e.createObjectStore("collectionParents",{keyPath:Gy});const r=t.store("collectionParents"),i=new yd,o=u=>{if(i.add(u)){const h=u.lastSegment(),m=u.popLast();return r.put({collectionId:h,parent:gt(m)})}};return t.store("remoteDocuments").Wt({jt:!0},(u,h)=>{const m=new ne(u);return o(m.popLast())}).next(()=>t.store("documentMutations").Wt({jt:!0},([u,h,m],_)=>{const w=Bn(h);return o(w.popLast())}))}Hn(e){const t=e.store("targets");return t.Wt((r,i)=>{const o=cl(i),u=ng(this.M,o);return t.put(u)})}Jn(e,t){const r=t.store("remoteDocuments"),i=[];return r.Wt((o,u)=>{const h=t.store("remoteDocumentsV14"),m=(_=u,_.document?new P(ne.fromString(_.document.name).popFirst(5)):_.noDocument?P.fromSegments(_.noDocument.path):_.unknownDocument?P.fromSegments(_.unknownDocument.path):q()).path.toArray();var _;const w={prefixPath:m.slice(0,m.length-2),collectionGroup:m[m.length-2],documentId:m[m.length-1],readTime:u.readTime||[0,0],unknownDocument:u.unknownDocument,noDocument:u.noDocument,document:u.document,hasCommittedMutations:!!u.hasCommittedMutations};i.push(h.put(w))}).next(()=>S.waitFor(i))}}function vg(n){n.createObjectStore("targetDocuments",{keyPath:Uy}).createIndex("documentTargetsIndex",By,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Fy,{unique:!0}),n.createObjectStore("targetGlobal")}const Id="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class wd{constructor(e,t,r,i,o,u,h,m,_,w,E=13){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Yn=o,this.window=u,this.document=h,this.Xn=_,this.Zn=w,this.ts=E,this.es=null,this.ns=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ss=null,this.inForeground=!1,this.rs=null,this.os=null,this.us=Number.NEGATIVE_INFINITY,this.cs=A=>Promise.resolve(),!wd.vt())throw new N(b.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new d_(this,i),this.hs=t+"main",this.M=new eg(m),this.ls=new dn(this.hs,this.ts,new g_(this.M)),this.fs=new u_(this.referenceDelegate,this.M),this.ds=new f_(this.M),this._s=new e_,this.window&&this.window.localStorage?this.ws=this.window.localStorage:(this.ws=null,!1===w&&Oe("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.gs().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new N(b.FAILED_PRECONDITION,Id);return this.ys(),this.ps(),this.Is(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.fs.getHighestSequenceNumber(e))}).then(e=>{this.es=new ft(e,this.Xn)}).then(()=>{this.ns=!0}).catch(e=>(this.ls&&this.ls.close(),Promise.reject(e)))}Ts(e){var t=this;return this.cs=function(){var r=(0,p.Z)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.ls.Ot(function(){var t=(0,p.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Yn.enqueueAndForget((0,p.Z)(function*(){t.started&&(yield t.gs())})))}gs(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Wc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Es(e).next(t=>{t||(this.isPrimary=!1,this.Yn.enqueueRetryable(()=>this.cs(!1)))})}).next(()=>this.As(e)).next(t=>this.isPrimary&&!t?this.Rs(e).next(()=>!1):!!t&&this.Ps(e).next(()=>!0))).catch(e=>{if(qs(e))return M("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return M("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Yn.enqueueRetryable(()=>this.cs(e)),this.isPrimary=e})}Es(e){return gl(e).get("owner").next(t=>S.resolve(this.bs(t)))}Vs(e){return Wc(e).delete(this.clientId)}vs(){var e=this;return(0,p.Z)(function*(){if(e.isPrimary&&!e.Ss(e.us,18e5)){e.us=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=Ye(r,"clientMetadata");return i.qt().next(o=>{const u=e.Ds(o,18e5),h=o.filter(m=>-1===u.indexOf(m));return S.forEach(h,m=>i.delete(m.clientId)).next(()=>h)})}).catch(()=>[]);if(e.ws)for(const r of t)e.ws.removeItem(e.Cs(r.clientId))}})()}Is(){this.os=this.Yn.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.gs().then(()=>this.vs()).then(()=>this.Is()))}bs(e){return!!e&&e.ownerId===this.clientId}As(e){return this.Zn?S.resolve(!0):gl(e).get("owner").next(t=>{if(null!==t&&this.Ss(t.leaseTimestampMs,5e3)&&!this.xs(t.ownerId)){if(this.bs(t)&&this.networkEnabled)return!0;if(!this.bs(t)){if(!t.allowTabSynchronization)throw new N(b.FAILED_PRECONDITION,Id);return!1}}return!(!this.networkEnabled||!this.inForeground)||Wc(e).qt().next(r=>void 0===this.Ds(r,5e3).find(i=>{if(this.clientId!==i.clientId){const u=!this.inForeground&&i.inForeground,h=this.networkEnabled===i.networkEnabled;if(!this.networkEnabled&&i.networkEnabled||u&&h)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&M("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,p.Z)(function*(){e.ns=!1,e.Ns(),e.os&&(e.os.cancel(),e.os=null),e.ks(),e.Ms(),yield e.ls.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new Xp(t,ft.A);return e.Rs(r).next(()=>e.Vs(r))}),e.ls.close(),e.Os()})()}Ds(e,t){return e.filter(r=>this.Ss(r.updateTimeMs,t)&&!this.xs(r.clientId))}Fs(){return this.runTransaction("getActiveClients","readonly",e=>Wc(e).qt().next(t=>this.Ds(t,18e5).map(r=>r.clientId)))}get started(){return this.ns}getMutationQueue(e,t){return _d.Yt(e,this.M,t,this.referenceDelegate)}getTargetCache(){return this.fs}getRemoteDocumentCache(){return this.ds}getIndexManager(e){return new a_(e,this.M.Jt.databaseId)}getDocumentOverlayCache(e){return md.Yt(this.M,e)}getBundleCache(){return this._s}runTransaction(e,t,r){M("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",o=14===(u=this.ts)?Yy:13===u?Zp:12===u?Zy:11===u?zp:void q();var u;let h;return this.ls.runTransaction(e,i,o,m=>(h=new Xp(m,this.es?this.es.next():ft.A),"readwrite-primary"===t?this.Es(h).next(_=>!!_||this.As(h)).next(_=>{if(!_)throw Oe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Yn.enqueueRetryable(()=>this.cs(!1)),new N(b.FAILED_PRECONDITION,Yp);return r(h)}).next(_=>this.Ps(h).next(()=>_)):this.$s(h).next(()=>r(h)))).then(m=>(h.raiseOnCommittedEvent(),m))}$s(e){return gl(e).get("owner").next(t=>{if(null!==t&&this.Ss(t.leaseTimestampMs,5e3)&&!this.xs(t.ownerId)&&!this.bs(t)&&!(this.Zn||this.allowTabSynchronization&&t.allowTabSynchronization))throw new N(b.FAILED_PRECONDITION,Id)})}Ps(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return gl(e).put("owner",t)}static vt(){return dn.vt()}Rs(e){const t=gl(e);return t.get("owner").next(r=>this.bs(r)?(M("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):S.resolve())}Ss(e,t){const r=Date.now();return!(e<r-t||e>r&&(Oe(`Detected an update time that is in the future: ${e} > ${r}`),1))}ys(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.rs=()=>{this.Yn.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.gs()))},this.document.addEventListener("visibilitychange",this.rs),this.inForeground="visible"===this.document.visibilityState)}ks(){this.rs&&(this.document.removeEventListener("visibilitychange",this.rs),this.rs=null)}ps(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ss=()=>{this.Ns(),(0,W.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Yn.enterRestrictedMode(!0),this.Yn.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ss))}Ms(){this.ss&&(this.window.removeEventListener("pagehide",this.ss),this.ss=null)}xs(e){var t;try{const r=null!==(null===(t=this.ws)||void 0===t?void 0:t.getItem(this.Cs(e)));return M("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Oe("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Ns(){if(this.ws)try{this.ws.setItem(this.Cs(this.clientId),String(Date.now()))}catch(e){Oe("Failed to set zombie client id.",e)}}Os(){if(this.ws)try{this.ws.removeItem(this.Cs(this.clientId))}catch(e){}}Cs(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function gl(n){return Ye(n,"owner")}function Wc(n){return Ye(n,"clientMetadata")}function Ed(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class m_{constructor(e,t,r){this.ds=e,this.Bs=t,this.indexManager=r}Ls(e,t){return this.Bs.getAllMutationBatchesAffectingDocumentKey(e,t).next(r=>this.Us(e,t,r))}Us(e,t,r){return this.ds.getEntry(e,t).next(i=>{for(const o of r)o.applyToLocalView(i);return i})}qs(e,t){e.forEach((r,i)=>{for(const o of t)o.applyToLocalView(i)})}Ks(e,t){return this.ds.getEntries(e,t).next(r=>this.Gs(e,r).next(()=>r))}Gs(e,t){return this.Bs.getAllMutationBatchesAffectingDocumentKeys(e,t).next(r=>this.qs(t,r))}Qs(e,t,r){return P.isDocumentKey((i=t).path)&&null===i.collectionGroup&&0===i.filters.length?this.js(e,t.path):td(t)?this.Ws(e,t,r):this.zs(e,t,r);var i}js(e,t){return this.Ls(e,new P(t)).next(r=>{let i=od();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}Ws(e,t,r){const i=t.collectionGroup;let o=od();return this.indexManager.getCollectionParents(e,i).next(u=>S.forEach(u,h=>{const m=(_=t,w=h.child(i),new kr(w,null,_.explicitOrderBy.slice(),_.filters.slice(),_.limit,_.limitType,_.startAt,_.endAt));var _,w;return this.zs(e,m,r).next(_=>{_.forEach((w,E)=>{o=o.insert(w,E)})})}).next(()=>o))}zs(e,t,r){let i;return this.ds.getAllFromCollection(e,t.path,r).next(o=>(i=o,this.Bs.getAllMutationBatchesAffectingQuery(e,t))).next(o=>{for(const u of o)for(const h of u.mutations){const m=h.key;let _=i.get(m);null==_&&(_=J.newInvalidDocument(m),i=i.insert(m,_)),id(h,_,u.localWriteTime),_.isFoundDocument()||(i=i.remove(m))}}).next(()=>(i.forEach((o,u)=>{rd(t,u)||(i=i.remove(o))}),i))}}class Td{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Hs=r,this.Js=i}static Ys(e,t){let r=he(),i=he();for(const o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new Td(e,t.fromCache,r,i)}}class Ig{Xs(e){this.Zs=e}Qs(e,t,r,i){return 0===(o=t).filters.length&&null===o.limit&&null==o.startAt&&null==o.endAt&&(0===o.explicitOrderBy.length||1===o.explicitOrderBy.length&&o.explicitOrderBy[0].field.isKeyField())||r.isEqual(z.min())?this.ti(e,t):this.Zs.Ks(e,i).next(o=>{const u=this.ei(t,o);return(kc(t)||Nc(t))&&this.ni(t.limitType,u,i,r)?this.ti(e,t):(Bu()<=ue.in.DEBUG&&M("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),nd(t)),this.Zs.Qs(e,t,Hu(r,-1)).next(h=>(u.forEach(m=>{h=h.insert(m.key,m)}),h)))});var o}ei(e,t){let r=new ve(dp(e));return t.forEach((i,o)=>{rd(e,o)&&(r=r.add(o))}),r}ni(e,t,r,i){if(r.size!==t.size)return!0;const o="F"===e?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}ti(e,t){return Bu()<=ue.in.DEBUG&&M("QueryEngine","Using full collection scan to execute query:",nd(t)),this.Zs.Qs(e,t,jt.min())}}class y_{constructor(e,t,r,i){this.persistence=e,this.si=t,this.M=i,this.ii=new Pe(X),this.ri=new Ai(o=>Dr(o),Fs),this.oi=new Map,this.ui=e.getRemoteDocumentCache(),this.fs=e.getTargetCache(),this._s=e.getBundleCache(),this.ai(r)}ai(e){this.indexManager=this.persistence.getIndexManager(e),this.Bs=this.persistence.getMutationQueue(e,this.indexManager),this.ci=new m_(this.ui,this.Bs,this.indexManager),this.ui.setIndexManager(this.indexManager),this.si.Xs(this.ci)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ii))}}function wg(n,e,t,r){return new y_(n,e,t,r)}function Eg(n,e){return Ad.apply(this,arguments)}function Ad(){return Ad=(0,p.Z)(function*(n,e){const t=L(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.Bs.getAllMutationBatches(r).next(o=>(i=o,t.ai(e),t.Bs.getAllMutationBatches(r))).next(o=>{const u=[],h=[];let m=he();for(const _ of i){u.push(_.batchId);for(const w of _.mutations)m=m.add(w.key)}for(const _ of o){h.push(_.batchId);for(const w of _.mutations)m=m.add(w.key)}return t.ci.Ks(r,m).next(_=>({hi:_,removedBatchIds:u,addedBatchIds:h}))})})}),Ad.apply(this,arguments)}function __(n,e){const t=L(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),o=t.ui.newChangeBuffer({trackRemovals:!0});return function(u,h,m,_){const w=m.batch,E=w.keys();let A=S.resolve();return E.forEach(D=>{A=A.next(()=>_.getEntry(h,D)).next(k=>{const F=m.docVersions.get(D);Q(null!==F),k.version.compareTo(F)<0&&(w.applyToRemoteDocument(k,m),k.isValidDocument()&&(k.setReadTime(m.commitVersion),_.addEntry(k)))})}),A.next(()=>u.Bs.removeMutationBatch(h,w))}(t,r,e,o).next(()=>o.apply(r)).next(()=>t.Bs.performConsistencyCheck(r)).next(()=>t.ci.Ks(r,i))})}function Tg(n){const e=L(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.fs.getLastRemoteSnapshotVersion(t))}function v_(n,e){const t=L(n),r=e.snapshotVersion;let i=t.ii;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const u=t.ui.newChangeBuffer({trackRemovals:!0});i=t.ii;const h=[];e.targetChanges.forEach((_,w)=>{const E=i.get(w);if(!E)return;h.push(t.fs.removeMatchingKeys(o,_.removedDocuments,w).next(()=>t.fs.addMatchingKeys(o,_.addedDocuments,w)));let A=E.withSequenceNumber(o.currentSequenceNumber);var D,k,F;e.targetMismatches.has(w)?A=A.withResumeToken(ke.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):_.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(_.resumeToken,r)),i=i.insert(w,A),k=A,F=_,(0===(D=E).resumeToken.approximateByteSize()||k.snapshotVersion.toMicroseconds()-D.snapshotVersion.toMicroseconds()>=3e8||F.addedDocuments.size+F.modifiedDocuments.size+F.removedDocuments.size>0)&&h.push(t.fs.updateTargetData(o,A))});let m=Wt();if(e.documentUpdates.forEach(_=>{e.resolvedLimboDocuments.has(_)&&h.push(t.persistence.referenceDelegate.updateLimboDocument(o,_))}),h.push(Ag(o,u,e.documentUpdates).next(_=>{m=_})),!r.isEqual(z.min())){const _=t.fs.getLastRemoteSnapshotVersion(o).next(w=>t.fs.setTargetsMetadata(o,o.currentSequenceNumber,r));h.push(_)}return S.waitFor(h).next(()=>u.apply(o)).next(()=>t.ci.Gs(o,m)).next(()=>m)}).then(o=>(t.ii=i,o))}function Ag(n,e,t){let r=he();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Wt();return t.forEach((u,h)=>{const m=i.get(u);h.isNoDocument()&&h.version.isEqual(z.min())?(e.removeEntry(u,h.readTime),o=o.insert(u,h)):!m.isValidDocument()||h.version.compareTo(m.version)>0||0===h.version.compareTo(m.version)&&m.hasPendingWrites?(e.addEntry(h),o=o.insert(u,h)):M("LocalStore","Ignoring outdated watch update for ",u,". Current version:",m.version," Watch version:",h.version)}),o})}function I_(n,e){const t=L(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.Bs.getNextMutationBatchAfterBatchId(r,e)))}function Sa(n,e){const t=L(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.fs.getTargetData(r,e).next(o=>o?(i=o,S.resolve(i)):t.fs.allocateTargetId(r).next(u=>(i=new bi(e,u,0,r.currentSequenceNumber),t.fs.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.ii.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ii=t.ii.insert(r.targetId,r),t.ri.set(e,r.targetId)),r})}function xa(n,e,t){return bd.apply(this,arguments)}function bd(){return bd=(0,p.Z)(function*(n,e,t){const r=L(n),i=r.ii.get(e),o=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",o,u=>r.persistence.referenceDelegate.removeTarget(u,i)))}catch(u){if(!qs(u))throw u;M("LocalStore",`Failed to update sequence numbers for target ${e}: ${u}`)}r.ii=r.ii.remove(e),r.ri.delete(i.target)}),bd.apply(this,arguments)}function Kc(n,e,t){const r=L(n);let i=z.min(),o=he();return r.persistence.runTransaction("Execute query","readonly",u=>function(h,m,_){const w=L(h),E=w.ri.get(_);return void 0!==E?S.resolve(w.ii.get(E)):w.fs.getTargetData(m,_)}(r,u,$t(e)).next(h=>{if(h)return i=h.lastLimboFreeSnapshotVersion,r.fs.getMatchingKeysForTargetId(u,h.targetId).next(m=>{o=m})}).next(()=>r.si.Qs(u,e,t?i:z.min(),t?o:he())).next(h=>(Sg(r,hp(e),h),{documents:h,li:o})))}function bg(n,e){const t=L(n),r=L(t.fs),i=t.ii.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",o=>r.Et(o,e).next(u=>u?u.target:null))}function Cg(n,e){const t=L(n),r=t.oi.get(e)||z.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.ui.getAllFromCollectionGroup(i,e,Hu(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Sg(t,e,i),i))}function Sg(n,e,t){let r=z.min();t.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.oi.set(e,r)}function Cd(){return Cd=(0,p.Z)(function*(n,e,t,r){const i=L(n);let o=he(),u=Wt();for(const _ of t){const w=e.fi(_.metadata.name);_.document&&(o=o.add(w));const E=e.di(_);E.setReadTime(e._i(_.metadata.readTime)),u=u.insert(w,E)}const h=i.ui.newChangeBuffer({trackRemovals:!0}),m=yield Sa(i,(_=r,$t(ma(ne.fromString(`__bundle__/docs/${_}`)))));var _;return i.persistence.runTransaction("Apply bundle documents","readwrite",_=>Ag(_,h,u).next(w=>(h.apply(_),w)).next(w=>i.fs.removeMatchingKeysForTargetId(_,m.targetId).next(()=>i.fs.addMatchingKeys(_,o,m.targetId)).next(()=>i.ci.Gs(_,w)).next(()=>w)))}),Cd.apply(this,arguments)}function E_(n,e){return Sd.apply(this,arguments)}function Sd(){return Sd=(0,p.Z)(function*(n,e,t=he()){const r=yield Sa(n,$t(pd(e.bundledQuery))),i=L(n);return i.persistence.runTransaction("Save named query","readwrite",o=>{const u=Ze(e.readTime);if(r.snapshotVersion.compareTo(u)>=0)return i._s.saveNamedQuery(o,e);const h=r.withResumeToken(ke.EMPTY_BYTE_STRING,u);return i.ii=i.ii.insert(h.targetId,h),i.fs.updateTargetData(o,h).next(()=>i.fs.removeMatchingKeysForTargetId(o,r.targetId)).next(()=>i.fs.addMatchingKeys(o,t,r.targetId)).next(()=>i._s.saveNamedQuery(o,e))})}),Sd.apply(this,arguments)}class T_{constructor(e){this.M=e,this.wi=new Map,this.mi=new Map}getBundleMetadata(e,t){return S.resolve(this.wi.get(t))}saveBundleMetadata(e,t){var r;return this.wi.set(t.id,{id:(r=t).id,version:r.version,createTime:Ze(r.createTime)}),S.resolve()}getNamedQuery(e,t){return S.resolve(this.mi.get(t))}saveNamedQuery(e,t){return this.mi.set(t.name,{name:(r=t).name,query:pd(r.bundledQuery),readTime:Ze(r.readTime)}),S.resolve();var r}}class A_{constructor(){this.overlays=new Pe(P.comparator),this.gi=new Map}getOverlay(e,t){return S.resolve(this.overlays.get(t))}saveOverlays(e,t,r){return r.forEach((i,o)=>{this.Xt(e,t,o)}),S.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.gi.get(r);return void 0!==i&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.gi.delete(r)),S.resolve()}getOverlaysForCollection(e,t,r){const i=nl(),o=t.length+1,u=new P(t.child("")),h=this.overlays.getIteratorFrom(u);for(;h.hasNext();){const m=h.getNext().value,_=m.getKey();if(!t.isPrefixOf(_.path))break;_.path.length===o&&m.largestBatchId>r&&i.set(m.getKey(),m)}return S.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let o=new Pe((_,w)=>_-w);const u=this.overlays.getIterator();for(;u.hasNext();){const _=u.getNext().value;if(_.getKey().getCollectionGroup()===t&&_.largestBatchId>r){let w=o.get(_.largestBatchId);null===w&&(w=nl(),o=o.insert(_.largestBatchId,w)),w.set(_.getKey(),_)}}const h=nl(),m=o.getIterator();for(;m.hasNext()&&(m.getNext().value.forEach((_,w)=>h.set(_,w)),!(h.size()>=i)););return S.resolve(h)}Xt(e,t,r){if(null===r)return;const i=this.overlays.get(r.key);if(null!==i){const u=this.gi.get(i.largestBatchId).delete(r.key);this.gi.set(i.largestBatchId,u)}this.overlays=this.overlays.insert(r.key,new fd(t,r));let o=this.gi.get(t);void 0===o&&(o=he(),this.gi.set(t,o)),this.gi.set(t,o.add(r.key))}}class xd{constructor(){this.yi=new ve(Qe.pi),this.Ii=new ve(Qe.Ti)}isEmpty(){return this.yi.isEmpty()}addReference(e,t){const r=new Qe(e,t);this.yi=this.yi.add(r),this.Ii=this.Ii.add(r)}Ei(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Ai(new Qe(e,t))}Ri(e,t){e.forEach(r=>this.removeReference(r,t))}Pi(e){const t=new P(new ne([])),r=new Qe(t,e),i=new Qe(t,e+1),o=[];return this.Ii.forEachInRange([r,i],u=>{this.Ai(u),o.push(u.key)}),o}bi(){this.yi.forEach(e=>this.Ai(e))}Ai(e){this.yi=this.yi.delete(e),this.Ii=this.Ii.delete(e)}Vi(e){const t=new P(new ne([])),r=new Qe(t,e),i=new Qe(t,e+1);let o=he();return this.Ii.forEachInRange([r,i],u=>{o=o.add(u.key)}),o}containsKey(e){const t=new Qe(e,0),r=this.yi.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class Qe{constructor(e,t){this.key=e,this.vi=t}static pi(e,t){return P.comparator(e.key,t.key)||X(e.vi,t.vi)}static Ti(e,t){return X(e.vi,t.vi)||P.comparator(e.key,t.key)}}class b_{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.Bs=[],this.Si=1,this.Di=new ve(Qe.pi)}checkEmpty(e){return S.resolve(0===this.Bs.length)}addMutationBatch(e,t,r,i){const o=this.Si;this.Si++;const u=new hd(o,t,r,i);this.Bs.push(u);for(const h of i)this.Di=this.Di.add(new Qe(h.key,o)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return S.resolve(u)}lookupMutationBatch(e,t){return S.resolve(this.Ci(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.xi(t+1),o=i<0?0:i;return S.resolve(this.Bs.length>o?this.Bs[o]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(0===this.Bs.length?-1:this.Si-1)}getAllMutationBatches(e){return S.resolve(this.Bs.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Qe(t,0),i=new Qe(t,Number.POSITIVE_INFINITY),o=[];return this.Di.forEachInRange([r,i],u=>{const h=this.Ci(u.vi);o.push(h)}),S.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ve(X);return t.forEach(i=>{const o=new Qe(i,0),u=new Qe(i,Number.POSITIVE_INFINITY);this.Di.forEachInRange([o,u],h=>{r=r.add(h.vi)})}),S.resolve(this.Ni(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let o=r;P.isDocumentKey(o)||(o=o.child(""));const u=new Qe(new P(o),0);let h=new ve(X);return this.Di.forEachWhile(m=>{const _=m.key.path;return!!r.isPrefixOf(_)&&(_.length===i&&(h=h.add(m.vi)),!0)},u),S.resolve(this.Ni(h))}Ni(e){const t=[];return e.forEach(r=>{const i=this.Ci(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){Q(0===this.ki(t.batchId,"removed")),this.Bs.shift();let r=this.Di;return S.forEach(t.mutations,i=>{const o=new Qe(i.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Di=r})}_n(e){}containsKey(e,t){const r=new Qe(t,0),i=this.Di.firstAfterOrEqual(r);return S.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return S.resolve()}ki(e,t){return this.xi(e)}xi(e){return 0===this.Bs.length?0:e-this.Bs[0].batchId}Ci(e){const t=this.xi(e);return t<0||t>=this.Bs.length?null:this.Bs[t]}}class C_{constructor(e){this.Mi=e,this.docs=new Pe(P.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),o=i?i.size:0,u=this.Mi(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:u}),this.size+=u-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return S.resolve(r?r.document.mutableCopy():J.newInvalidDocument(t))}getEntries(e,t){let r=Wt();return t.forEach(i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():J.newInvalidDocument(i))}),S.resolve(r)}getAllFromCollection(e,t,r){let i=Wt();const o=new P(t.child("")),u=this.docs.getIteratorFrom(o);for(;u.hasNext();){const{key:h,value:{document:m}}=u.getNext();if(!t.isPrefixOf(h.path))break;h.path.length>t.length+1||Sc(zu(m),r)<=0||(i=i.insert(m.key,m.mutableCopy()))}return S.resolve(i)}getAllFromCollectionGroup(e,t,r,i){q()}Oi(e,t){return S.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new S_(this)}getSize(e){return S.resolve(this.size)}}class S_ extends gg{constructor(e){super(),this.Kn=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Kn.addEntry(e,i)):this.Kn.removeEntry(r)}),S.waitFor(t)}getFromCache(e,t){return this.Kn.getEntry(e,t)}getAllFromCache(e,t){return this.Kn.getEntries(e,t)}}class x_{constructor(e){this.persistence=e,this.Fi=new Ai(t=>Dr(t),Fs),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.$i=0,this.Bi=new xd,this.targetCount=0,this.Li=zs.gn()}forEachTarget(e,t){return this.Fi.forEach((r,i)=>t(i)),S.resolve()}getLastRemoteSnapshotVersion(e){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return S.resolve(this.$i)}allocateTargetId(e){return this.highestTargetId=this.Li.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.$i&&(this.$i=t),S.resolve()}Tn(e){this.Fi.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Li=new zs(t),this.highestTargetId=t),e.sequenceNumber>this.$i&&(this.$i=e.sequenceNumber)}addTargetData(e,t){return this.Tn(t),this.targetCount+=1,S.resolve()}updateTargetData(e,t){return this.Tn(t),S.resolve()}removeTargetData(e,t){return this.Fi.delete(t.target),this.Bi.Pi(t.targetId),this.targetCount-=1,S.resolve()}removeTargets(e,t,r){let i=0;const o=[];return this.Fi.forEach((u,h)=>{h.sequenceNumber<=t&&null===r.get(h.targetId)&&(this.Fi.delete(u),o.push(this.removeMatchingKeysForTargetId(e,h.targetId)),i++)}),S.waitFor(o).next(()=>i)}getTargetCount(e){return S.resolve(this.targetCount)}getTargetData(e,t){const r=this.Fi.get(t)||null;return S.resolve(r)}addMatchingKeys(e,t,r){return this.Bi.Ei(t,r),S.resolve()}removeMatchingKeys(e,t,r){this.Bi.Ri(t,r);const i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(u=>{o.push(i.markPotentiallyOrphaned(e,u))}),S.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.Bi.Pi(t),S.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Bi.Vi(t);return S.resolve(r)}containsKey(e,t){return S.resolve(this.Bi.containsKey(t))}}class D_{constructor(e,t){this.Ui={},this.overlays={},this.es=new ft(0),this.ns=!1,this.ns=!0,this.referenceDelegate=e(this),this.fs=new x_(this),this.indexManager=new o_,this.ds=new C_(r=>this.referenceDelegate.qi(r)),this.M=new eg(t),this._s=new T_(this.M)}start(){return Promise.resolve()}shutdown(){return this.ns=!1,Promise.resolve()}get started(){return this.ns}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new A_,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Ui[e.toKey()];return r||(r=new b_(t,this.referenceDelegate),this.Ui[e.toKey()]=r),r}getTargetCache(){return this.fs}getRemoteDocumentCache(){return this.ds}getBundleCache(){return this._s}runTransaction(e,t,r){M("MemoryPersistence","Starting transaction:",e);const i=new k_(this.es.next());return this.referenceDelegate.Ki(),r(i).next(o=>this.referenceDelegate.Gi(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Qi(e,t){return S.or(Object.values(this.Ui).map(r=>()=>r.containsKey(e,t)))}}class k_ extends Qp{constructor(e){super(),this.currentSequenceNumber=e}}class Dd{constructor(e){this.persistence=e,this.ji=new xd,this.Wi=null}static zi(e){return new Dd(e)}get Hi(){if(this.Wi)return this.Wi;throw q()}addReference(e,t,r){return this.ji.addReference(r,t),this.Hi.delete(r.toString()),S.resolve()}removeReference(e,t,r){return this.ji.removeReference(r,t),this.Hi.add(r.toString()),S.resolve()}markPotentiallyOrphaned(e,t){return this.Hi.add(t.toString()),S.resolve()}removeTarget(e,t){this.ji.Pi(t.targetId).forEach(i=>this.Hi.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.Hi.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}Ki(){this.Wi=new Set}Gi(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.Hi,r=>{const i=P.fromPath(r);return this.Ji(e,i).next(o=>{o||t.removeEntry(i,z.min())})}).next(()=>(this.Wi=null,t.apply(e)))}updateLimboDocument(e,t){return this.Ji(e,t).next(r=>{r?this.Hi.delete(t.toString()):this.Hi.add(t.toString())})}qi(e){return 0}Ji(e,t){return S.or([()=>S.resolve(this.ji.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Qi(e,t)])}}function xg(n,e){return`firestore_clients_${n}_${e}`}function Dg(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function kd(n,e){return`firestore_targets_${n}_${e}`}class Hc{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Yi(e,t,r){const i=JSON.parse(r);let o,u="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return u&&i.error&&(u="string"==typeof i.error.message&&"string"==typeof i.error.code,u&&(o=new N(i.error.code,i.error.message))),u?new Hc(e,t,i.state,o):(Oe("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Xi(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ml{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Yi(e,t){const r=JSON.parse(t);let i,o="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return o&&r.error&&(o="string"==typeof r.error.message&&"string"==typeof r.error.code,o&&(i=new N(r.error.code,r.error.message))),o?new ml(e,r.state,i):(Oe("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Xi(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class zc{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Yi(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Vc();for(let u=0;i&&u<r.activeTargetIds.length;++u)i=fa(r.activeTargetIds[u]),o=o.add(r.activeTargetIds[u]);return i?new zc(e,o):(Oe("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Nd{constructor(e,t){this.clientId=e,this.onlineState=t}static Yi(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Nd(t.clientId,t.onlineState):(Oe("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Rd{constructor(){this.activeTargetIds=Vc()}Zi(e){this.activeTargetIds=this.activeTargetIds.add(e)}tr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Xi(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Od{constructor(e,t,r,i,o){this.window=e,this.Yn=t,this.persistenceKey=r,this.er=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.nr=this.sr.bind(this),this.ir=new Pe(X),this.started=!1,this.rr=[];const u=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=o,this.ur=xg(this.persistenceKey,this.er),this.ar=`firestore_sequence_number_${this.persistenceKey}`,this.ir=this.ir.insert(this.er,new Rd),this.cr=new RegExp(`^firestore_clients_${u}_([^_]*)$`),this.hr=new RegExp(`^firestore_mutations_${u}_(\\d+)(?:_(.*))?$`),this.lr=new RegExp(`^firestore_targets_${u}_(\\d+)$`),this.dr=`firestore_online_state_${this.persistenceKey}`,this._r=function(h){return`firestore_bundle_loaded_v2_${h}`}(this.persistenceKey),this.window.addEventListener("storage",this.nr)}static vt(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,p.Z)(function*(){const t=yield e.syncEngine.Fs();for(const i of t){if(i===e.er)continue;const o=e.getItem(xg(e.persistenceKey,i));if(o){const u=zc.Yi(i,o);u&&(e.ir=e.ir.insert(u.clientId,u))}}e.wr();const r=e.storage.getItem(e.dr);if(r){const i=e.mr(r);i&&e.gr(i)}for(const i of e.rr)e.sr(i);e.rr=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.ar,JSON.stringify(e))}getAllActiveQueryTargets(){return this.yr(this.ir)}isActiveQueryTarget(e){let t=!1;return this.ir.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.pr(e,"pending")}updateMutationState(e,t,r){this.pr(e,t,r),this.Ir(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(kd(this.persistenceKey,e));if(r){const i=ml.Yi(e,r);i&&(t=i.state)}}return this.Tr.Zi(e),this.wr(),t}removeLocalQueryTarget(e){this.Tr.tr(e),this.wr()}isLocalQueryTarget(e){return this.Tr.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(kd(this.persistenceKey,e))}updateQueryState(e,t,r){this.Er(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Ir(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Ar(e)}notifyBundleLoaded(e){this.Rr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.nr),this.removeItem(this.ur),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return M("SharedClientState","READ",e,t),t}setItem(e,t){M("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){M("SharedClientState","REMOVE",e),this.storage.removeItem(e)}sr(e){var t=this;const r=e;if(r.storageArea===this.storage){if(M("SharedClientState","EVENT",r.key,r.newValue),r.key===this.ur)return void Oe("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Yn.enqueueRetryable((0,p.Z)(function*(){if(t.started){if(null!==r.key)if(t.cr.test(r.key)){if(null==r.newValue){const i=t.Pr(r.key);return t.br(i,null)}{const i=t.Vr(r.key,r.newValue);if(i)return t.br(i.clientId,i)}}else if(t.hr.test(r.key)){if(null!==r.newValue){const i=t.vr(r.key,r.newValue);if(i)return t.Sr(i)}}else if(t.lr.test(r.key)){if(null!==r.newValue){const i=t.Dr(r.key,r.newValue);if(i)return t.Cr(i)}}else if(r.key===t.dr){if(null!==r.newValue){const i=t.mr(r.newValue);if(i)return t.gr(i)}}else if(r.key===t.ar){const i=function(o){let u=ft.A;if(null!=o)try{const h=JSON.parse(o);Q("number"==typeof h),u=h}catch(h){Oe("SharedClientState","Failed to read sequence number from WebStorage",h)}return u}(r.newValue);i!==ft.A&&t.sequenceNumberHandler(i)}else if(r.key===t._r){const i=t.Nr(r.newValue);yield Promise.all(i.map(o=>t.syncEngine.kr(o)))}}else t.rr.push(r)}))}}get Tr(){return this.ir.get(this.er)}wr(){this.setItem(this.ur,this.Tr.Xi())}pr(e,t,r){const i=new Hc(this.currentUser,e,t,r),o=Dg(this.persistenceKey,this.currentUser,e);this.setItem(o,i.Xi())}Ir(e){const t=Dg(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Ar(e){this.storage.setItem(this.dr,JSON.stringify({clientId:this.er,onlineState:e}))}Er(e,t,r){const i=kd(this.persistenceKey,e),o=new ml(e,t,r);this.setItem(i,o.Xi())}Rr(e){const t=JSON.stringify(Array.from(e));this.setItem(this._r,t)}Pr(e){const t=this.cr.exec(e);return t?t[1]:null}Vr(e,t){const r=this.Pr(e);return zc.Yi(r,t)}vr(e,t){const r=this.hr.exec(e),i=Number(r[1]);return Hc.Yi(new Ke(void 0!==r[2]?r[2]:null),i,t)}Dr(e,t){const r=this.lr.exec(e),i=Number(r[1]);return ml.Yi(i,t)}mr(e){return Nd.Yi(e)}Nr(e){return JSON.parse(e)}Sr(e){var t=this;return(0,p.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Mr(e.batchId,e.state,e.error);M("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Cr(e){return this.syncEngine.Or(e.targetId,e.state,e.error)}br(e,t){const r=t?this.ir.insert(e,t):this.ir.remove(e),i=this.yr(this.ir),o=this.yr(r),u=[],h=[];return o.forEach(m=>{i.has(m)||u.push(m)}),i.forEach(m=>{o.has(m)||h.push(m)}),this.syncEngine.Fr(u,h).then(()=>{this.ir=r})}gr(e){this.ir.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}yr(e){let t=Vc();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class kg{constructor(){this.$r=new Rd,this.Br={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.$r.Zi(e),this.Br[e]||"not-current"}updateQueryState(e,t,r){this.Br[e]=t}removeLocalQueryTarget(e){this.$r.tr(e)}isLocalQueryTarget(e){return this.$r.activeTargetIds.has(e)}clearQueryState(e){delete this.Br[e]}getAllActiveQueryTargets(){return this.$r.activeTargetIds}isActiveQueryTarget(e){return this.$r.activeTargetIds.has(e)}start(){return this.$r=new Rd,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class N_{Lr(e){}shutdown(){}}class Ng{constructor(){this.Ur=()=>this.qr(),this.Kr=()=>this.Gr(),this.Qr=[],this.jr()}Lr(e){this.Qr.push(e)}shutdown(){window.removeEventListener("online",this.Ur),window.removeEventListener("offline",this.Kr)}jr(){window.addEventListener("online",this.Ur),window.addEventListener("offline",this.Kr)}qr(){M("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Qr)e(0)}Gr(){M("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Qr)e(1)}static vt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const R_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class O_{constructor(e){this.Wr=e.Wr,this.zr=e.zr}Hr(e){this.Jr=e}Yr(e){this.Xr=e}onMessage(e){this.Zr=e}close(){this.zr()}send(e){this.Wr(e)}eo(){this.Jr()}no(e){this.Xr(e)}so(e){this.Zr(e)}}class M_ extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.io=(e.ssl?"https":"http")+"://"+e.host,this.ro="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}oo(e,t,r,i,o){const u=this.uo(e,t);M("RestConnection","Sending: ",u,r);const h={};return this.ao(h,i,o),this.co(e,u,h,r).then(m=>(M("RestConnection","Received: ",m),m),m=>{throw mi("RestConnection",`${e} failed with error: `,m,"url: ",u,"request:",r),m})}ho(e,t,r,i,o){return this.oo(e,t,r,i,o)}ao(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+Rn,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,o)=>e[o]=i),r&&r.headers.forEach((i,o)=>e[o]=i)}uo(e,t){return`${this.io}/v1/${t}:${R_[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}co(e,t,r,i){return new Promise((o,u)=>{const h=new Uu;h.listenOnce(Fu.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Lu.NO_ERROR:const _=h.getResponseJson();M("Connection","XHR received:",JSON.stringify(_)),o(_);break;case Lu.TIMEOUT:M("Connection",'RPC "'+e+'" timed out'),u(new N(b.DEADLINE_EXCEEDED,"Request time out"));break;case Lu.HTTP_ERROR:const w=h.getStatus();if(M("Connection",'RPC "'+e+'" failed with status:',w,"response text:",h.getResponseText()),w>0){const E=h.getResponseJson().error;if(E&&E.status&&E.message){const A=function(D){const k=D.toLowerCase().replace(/_/g,"-");return Object.values(b).indexOf(k)>=0?k:b.UNKNOWN}(E.status);u(new N(A,E.message))}else u(new N(b.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new N(b.UNAVAILABLE,"Connection failed."));break;default:q()}}finally{M("Connection",'RPC "'+e+'" completed.')}});const m=JSON.stringify(i);h.send(t,"POST",m,r,15)})}lo(e,t,r){const i=[this.io,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Ar(),u=qh(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(h.xmlHttpFactory=new $h({})),this.ao(h.initMessageHeaders,t,r),(0,W.uI)()||(0,W.b$)()||(0,W.d)()||(0,W.w1)()||(0,W.Mn)()||(0,W.ru)()||(h.httpHeadersOverwriteParam="$httpHeaders");const m=i.join("");M("Connection","Creating WebChannel: "+m,h);const _=o.createWebChannel(m,h);let w=!1,E=!1;const A=new O_({Wr:k=>{E?M("Connection","Not sending because WebChannel is closed:",k):(w||(M("Connection","Opening WebChannel transport."),_.open(),w=!0),M("Connection","WebChannel sending:",k),_.send(k))},zr:()=>_.close()}),D=(k,F,Y)=>{k.listen(F,de=>{try{Y(de)}catch(we){setTimeout(()=>{throw we},0)}})};return D(_,ha.EventType.OPEN,()=>{E||M("Connection","WebChannel transport opened.")}),D(_,ha.EventType.CLOSE,()=>{E||(E=!0,M("Connection","WebChannel transport closed"),A.no())}),D(_,ha.EventType.ERROR,k=>{E||(E=!0,mi("Connection","WebChannel transport errored:",k),A.no(new N(b.UNAVAILABLE,"The operation could not be completed")))}),D(_,ha.EventType.MESSAGE,k=>{var F;if(!E){const Y=k.data[0];Q(!!Y);const de=Y,we=de.error||(null===(F=de[0])||void 0===F?void 0:F.error);if(we){M("Connection","WebChannel received error:",we);const ae=we.status;let te=function(ce){const at=Ge[ce];if(void 0!==at)return Sp(at)}(ae),ie=we.message;void 0===te&&(te=b.INTERNAL,ie="Unknown error status: "+ae+" with message "+we.message),E=!0,A.no(new N(te,ie)),_.close()}else M("Connection","WebChannel received:",Y),A.so(Y)}}),D(u,jh.STAT_EVENT,k=>{k.stat===ca.PROXY?M("Connection","Detected buffering proxy"):k.stat===ca.NOPROXY&&M("Connection","Detected no buffering proxy")}),setTimeout(()=>{A.eo()},0),A}}function Rg(){return"undefined"!=typeof window?window:null}function Zc(){return"undefined"!=typeof document?document:null}function yl(n){return new Ey(n,!0)}class Md{constructor(e,t,r=1e3,i=1.5,o=6e4){this.Yn=e,this.timerId=t,this.fo=r,this._o=i,this.wo=o,this.mo=0,this.yo=null,this.po=Date.now(),this.reset()}reset(){this.mo=0}Io(){this.mo=this.wo}To(e){this.cancel();const t=Math.floor(this.mo+this.Eo()),r=Math.max(0,Date.now()-this.po),i=Math.max(0,t-r);i>0&&M("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.mo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.yo=this.Yn.enqueueAfterDelay(this.timerId,i,()=>(this.po=Date.now(),e())),this.mo*=this._o,this.mo<this.fo&&(this.mo=this.fo),this.mo>this.wo&&(this.mo=this.wo)}Ao(){null!==this.yo&&(this.yo.skipDelay(),this.yo=null)}cancel(){null!==this.yo&&(this.yo.cancel(),this.yo=null)}Eo(){return(Math.random()-.5)*this.mo}}class Og{constructor(e,t,r,i,o,u,h,m){this.Yn=e,this.Ro=r,this.Po=i,this.bo=o,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=h,this.listener=m,this.state=0,this.Vo=0,this.vo=null,this.So=null,this.stream=null,this.Do=new Md(e,t)}Co(){return 1===this.state||5===this.state||this.xo()}xo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.No()}stop(){var e=this;return(0,p.Z)(function*(){e.Co()&&(yield e.close(0))})()}ko(){this.state=0,this.Do.reset()}Mo(){this.xo()&&null===this.vo&&(this.vo=this.Yn.enqueueAfterDelay(this.Ro,6e4,()=>this.Oo()))}Fo(e){this.$o(),this.stream.send(e)}Oo(){var e=this;return(0,p.Z)(function*(){if(e.xo())return e.close(0)})()}$o(){this.vo&&(this.vo.cancel(),this.vo=null)}Bo(){this.So&&(this.So.cancel(),this.So=null)}close(e,t){var r=this;return(0,p.Z)(function*(){r.$o(),r.Bo(),r.Do.cancel(),r.Vo++,4!==e?r.Do.reset():t&&t.code===b.RESOURCE_EXHAUSTED?(Oe(t.toString()),Oe("Using maximum backoff delay to prevent overloading the backend."),r.Do.Io()):t&&t.code===b.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Lo(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Yr(t)})()}Lo(){}auth(){this.state=1;const e=this.Uo(this.Vo),t=this.Vo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Vo===t&&this.qo(r,i)},r=>{e(()=>{const i=new N(b.UNKNOWN,"Fetching auth token failed: "+r.message);return this.Ko(i)})})}qo(e,t){const r=this.Uo(this.Vo);this.stream=this.Go(e,t),this.stream.Hr(()=>{r(()=>(this.state=2,this.So=this.Yn.enqueueAfterDelay(this.Po,1e4,()=>(this.xo()&&(this.state=3),Promise.resolve())),this.listener.Hr()))}),this.stream.Yr(i=>{r(()=>this.Ko(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}No(){var e=this;this.state=5,this.Do.To((0,p.Z)(function*(){e.state=0,e.start()}))}Ko(e){return M("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Uo(e){return t=>{this.Yn.enqueueAndForget(()=>this.Vo===e?t():(M("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class P_ extends Og{constructor(e,t,r,i,o,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,u),this.M=o}Go(e,t){return this.bo.lo("Listen",e,t)}onMessage(e){this.Do.reset();const t=function by(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(m=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===m?1:"REMOVE"===m?2:"CURRENT"===m?3:"RESET"===m?4:q(),i=e.targetChange.targetIds||[],o=function(m,_){return m.N?(Q(void 0===_||"string"==typeof _),ke.fromBase64String(_||"")):(Q(void 0===_||_ instanceof Uint8Array),ke.fromUint8Array(_||new Uint8Array))}(n,e.targetChange.resumeToken),u=e.targetChange.cause,h=u&&function(m){const _=void 0===m.code?b.UNKNOWN:Sp(m.code);return new N(_,m.message||"")}(u);t=new kp(r,i,o,h||null)}else if("documentChange"in e){const r=e.documentChange,i=Un(n,r.document.name),o=Ze(r.document.updateTime),u=new G({mapValue:{fields:r.document.fields}}),h=J.newFoundDocument(i,o,u);t=new Lc(r.targetIds||[],r.removedTargetIds||[],h.key,h)}else if("documentDelete"in e){const r=e.documentDelete,i=Un(n,r.document),o=r.readTime?Ze(r.readTime):z.min(),u=J.newNoDocument(i,o);t=new Lc([],r.removedTargetIds||[],u.key,u)}else if("documentRemove"in e){const r=e.documentRemove,i=Un(n,r.document);t=new Lc([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return q();{const r=e.filter,o=new fy(r.count||0);t=new Dp(r.targetId,o)}}var m;return t}(this.M,e),r=function(i){if(!("targetChange"in i))return z.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?z.min():o.readTime?Ze(o.readTime):z.min()}(e);return this.listener.Qo(t,r)}jo(e){const t={};t.database=al(this.M),t.addTarget=function(i,o){let u;const h=o.target;return u=xc(h)?{documents:Bp(i,h)}:{query:Gp(i,h)},u.targetId=o.targetId,o.resumeToken.approximateByteSize()>0?u.resumeToken=Mp(i,o.resumeToken):o.snapshotVersion.compareTo(z.min())>0&&(u.readTime=sl(i,o.snapshotVersion.toTimestamp())),u}(this.M,e);const r=function Sy(n,e){const t=function(r,i){switch(i){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return q()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.Fo(t)}Wo(e){const t={};t.database=al(this.M),t.removeTarget=e,this.Fo(t)}}class V_ extends Og{constructor(e,t,r,i,o,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,u),this.M=o,this.zo=!1}get Ho(){return this.zo}start(){this.zo=!1,this.lastStreamToken=void 0,super.start()}Lo(){this.zo&&this.Jo([])}Go(e,t){return this.bo.lo("Write",e,t)}onMessage(e){if(Q(!!e.streamToken),this.lastStreamToken=e.streamToken,this.zo){this.Do.reset();const t=function Cy(n,e){return n&&n.length>0?(Q(void 0!==e),n.map(t=>function(r,i){let o=Ze(r.updateTime?r.updateTime:i);return o.isEqual(z.min())&&(o=Ze(i)),new cy(o,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=Ze(e.commitTime);return this.listener.Yo(r,t)}return Q(!e.writeResults||0===e.writeResults.length),this.zo=!0,this.listener.Xo()}Zo(){const e={};e.database=al(this.M),this.Fo(e)}Jo(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>ul(this.M,r))};this.Fo(t)}}class L_ extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.bo=r,this.M=i,this.tu=!1}eu(){if(this.tu)throw new N(b.FAILED_PRECONDITION,"The client has already been terminated.")}oo(e,t,r){return this.eu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.bo.oo(e,t,r,i,o)).catch(i=>{throw"FirebaseError"===i.name?(i.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new N(b.UNKNOWN,i.toString())})}ho(e,t,r){return this.eu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.bo.ho(e,t,r,i,o)).catch(i=>{throw"FirebaseError"===i.name?(i.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new N(b.UNKNOWN,i.toString())})}terminate(){this.tu=!0}}class F_{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.nu=0,this.su=null,this.iu=!0}ru(){0===this.nu&&(this.ou("Unknown"),this.su=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.su=null,this.uu("Backend didn't respond within 10 seconds."),this.ou("Offline"),Promise.resolve())))}au(e){"Online"===this.state?this.ou("Unknown"):(this.nu++,this.nu>=1&&(this.cu(),this.uu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ou("Offline")))}set(e){this.cu(),this.nu=0,"Online"===e&&(this.iu=!1),this.ou(e)}ou(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}uu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.iu?(Oe(t),this.iu=!1):M("OnlineStateTracker",t)}cu(){null!==this.su&&(this.su.cancel(),this.su=null)}}class U_{constructor(e,t,r,i,o){var u=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.hu=[],this.lu=new Map,this.fu=new Set,this.du=[],this._u=o,this._u.Lr(h=>{r.enqueueAndForget((0,p.Z)(function*(){var m;Di(u)&&(M("RemoteStore","Restarting streams for network reachability change."),yield(m=(0,p.Z)(function*(_){const w=L(_);w.fu.add(4),yield Da(w),w.wu.set("Unknown"),w.fu.delete(4),yield _l(w)}),function(_){return m.apply(this,arguments)})(u))}))}),this.wu=new F_(r,i)}}function _l(n){return Pd.apply(this,arguments)}function Pd(){return Pd=(0,p.Z)(function*(n){if(Di(n))for(const e of n.du)yield e(!0)}),Pd.apply(this,arguments)}function Da(n){return Vd.apply(this,arguments)}function Vd(){return Vd=(0,p.Z)(function*(n){for(const e of n.du)yield e(!1)}),Vd.apply(this,arguments)}function Yc(n,e){const t=L(n);t.lu.has(e.targetId)||(t.lu.set(e.targetId,e),Ud(t)?Fd(t):Na(t).xo()&&Ld(t,e))}function vl(n,e){const t=L(n),r=Na(t);t.lu.delete(e),r.xo()&&Mg(t,e),0===t.lu.size&&(r.xo()?r.Mo():Di(t)&&t.wu.set("Unknown"))}function Ld(n,e){n.mu.Z(e.targetId),Na(n).jo(e)}function Mg(n,e){n.mu.Z(e),Na(n).Wo(e)}function Fd(n){n.mu=new vy({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.lu.get(e)||null}),Na(n).start(),n.wu.ru()}function Ud(n){return Di(n)&&!Na(n).Co()&&n.lu.size>0}function Di(n){return 0===L(n).fu.size}function Pg(n){n.mu=void 0}function B_(n){return Bd.apply(this,arguments)}function Bd(){return Bd=(0,p.Z)(function*(n){n.lu.forEach((e,t)=>{Ld(n,e)})}),Bd.apply(this,arguments)}function G_(n,e){return Gd.apply(this,arguments)}function Gd(){return Gd=(0,p.Z)(function*(n,e){Pg(n),Ud(n)?(n.wu.au(e),Fd(n)):n.wu.set("Unknown")}),Gd.apply(this,arguments)}function q_(n,e,t){return qd.apply(this,arguments)}function qd(){return qd=(0,p.Z)(function*(n,e,t){if(n.wu.set("Online"),e instanceof kp&&2===e.state&&e.cause)try{yield(r=(0,p.Z)(function*(i,o){const u=o.cause;for(const h of o.targetIds)i.lu.has(h)&&(yield i.remoteSyncer.rejectListen(h,u),i.lu.delete(h),i.mu.removeTarget(h))}),function(i,o){return r.apply(this,arguments)})(n,e)}catch(r){M("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Qc(n,r)}else if(e instanceof Lc?n.mu.ut(e):e instanceof Dp?n.mu._t(e):n.mu.ht(e),!t.isEqual(z.min()))try{const r=yield Tg(n.localStore);t.compareTo(r)>=0&&(yield function(i,o){const u=i.mu.yt(o);return u.targetChanges.forEach((h,m)=>{if(h.resumeToken.approximateByteSize()>0){const _=i.lu.get(m);_&&i.lu.set(m,_.withResumeToken(h.resumeToken,o))}}),u.targetMismatches.forEach(h=>{const m=i.lu.get(h);if(!m)return;i.lu.set(h,m.withResumeToken(ke.EMPTY_BYTE_STRING,m.snapshotVersion)),Mg(i,h);const _=new bi(m.target,h,1,m.sequenceNumber);Ld(i,_)}),i.remoteSyncer.applyRemoteEvent(u)}(n,t))}catch(r){M("RemoteStore","Failed to raise snapshot:",r),yield Qc(n,r)}var r}),qd.apply(this,arguments)}function Qc(n,e,t){return jd.apply(this,arguments)}function jd(){return jd=(0,p.Z)(function*(n,e,t){if(!qs(e))throw e;n.fu.add(1),yield Da(n),n.wu.set("Offline"),t||(t=()=>Tg(n.localStore)),n.asyncQueue.enqueueRetryable((0,p.Z)(function*(){M("RemoteStore","Retrying IndexedDB access"),yield t(),n.fu.delete(1),yield _l(n)}))}),jd.apply(this,arguments)}function Vg(n,e){return e().catch(t=>Qc(n,t,e))}function ka(n){return $d.apply(this,arguments)}function $d(){return $d=(0,p.Z)(function*(n){const e=L(n),t=ki(e);let r=e.hu.length>0?e.hu[e.hu.length-1].batchId:-1;for(;j_(e);)try{const i=yield I_(e.localStore,r);if(null===i){0===e.hu.length&&t.Mo();break}r=i.batchId,$_(e,i)}catch(i){yield Qc(e,i)}Lg(e)&&Fg(e)}),$d.apply(this,arguments)}function j_(n){return Di(n)&&n.hu.length<10}function $_(n,e){n.hu.push(e);const t=ki(n);t.xo()&&t.Ho&&t.Jo(e.mutations)}function Lg(n){return Di(n)&&!ki(n).Co()&&n.hu.length>0}function Fg(n){ki(n).start()}function W_(n){return Wd.apply(this,arguments)}function Wd(){return Wd=(0,p.Z)(function*(n){ki(n).Zo()}),Wd.apply(this,arguments)}function K_(n){return Kd.apply(this,arguments)}function Kd(){return Kd=(0,p.Z)(function*(n){const e=ki(n);for(const t of n.hu)e.Jo(t.mutations)}),Kd.apply(this,arguments)}function H_(n,e,t){return Hd.apply(this,arguments)}function Hd(){return Hd=(0,p.Z)(function*(n,e,t){const r=n.hu.shift(),i=dd.from(r,e,t);yield Vg(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield ka(n)}),Hd.apply(this,arguments)}function z_(n,e){return zd.apply(this,arguments)}function zd(){return zd=(0,p.Z)(function*(n,e){var t;e&&ki(n).Ho&&(yield(t=(0,p.Z)(function*(r,i){if(Cp(o=i.code)&&o!==b.ABORTED){const u=r.hu.shift();ki(r).ko(),yield Vg(r,()=>r.remoteSyncer.rejectFailedWrite(u.batchId,i)),yield ka(r)}var o}),function(r,i){return t.apply(this,arguments)})(n,e)),Lg(n)&&Fg(n)}),zd.apply(this,arguments)}function Ug(n,e){return Zd.apply(this,arguments)}function Zd(){return Zd=(0,p.Z)(function*(n,e){const t=L(n);t.asyncQueue.verifyOperationInProgress(),M("RemoteStore","RemoteStore received new credentials");const r=Di(t);t.fu.add(3),yield Da(t),r&&t.wu.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.fu.delete(3),yield _l(t)}),Zd.apply(this,arguments)}function Yd(n,e){return Qd.apply(this,arguments)}function Qd(){return Qd=(0,p.Z)(function*(n,e){const t=L(n);e?(t.fu.delete(2),yield _l(t)):e||(t.fu.add(2),yield Da(t),t.wu.set("Unknown"))}),Qd.apply(this,arguments)}function Na(n){return n.gu||(n.gu=function(e,t,r){const i=L(e);return i.eu(),new P_(t,i.bo,i.authCredentials,i.appCheckCredentials,i.M,r)}(n.datastore,n.asyncQueue,{Hr:B_.bind(null,n),Yr:G_.bind(null,n),Qo:q_.bind(null,n)}),n.du.push(function(){var e=(0,p.Z)(function*(t){t?(n.gu.ko(),Ud(n)?Fd(n):n.wu.set("Unknown")):(yield n.gu.stop(),Pg(n))});return function(t){return e.apply(this,arguments)}}())),n.gu}function ki(n){return n.yu||(n.yu=function(e,t,r){const i=L(e);return i.eu(),new V_(t,i.bo,i.authCredentials,i.appCheckCredentials,i.M,r)}(n.datastore,n.asyncQueue,{Hr:W_.bind(null,n),Yr:z_.bind(null,n),Xo:K_.bind(null,n),Yo:H_.bind(null,n)}),n.du.push(function(){var e=(0,p.Z)(function*(t){t?(n.yu.ko(),yield ka(n)):(yield n.yu.stop(),n.hu.length>0&&(M("RemoteStore",`Stopping write stream with ${n.hu.length} pending writes`),n.hu=[]))});return function(t){return e.apply(this,arguments)}}())),n.yu}class Jd{constructor(e,t,r,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new De,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}static createAndSchedule(e,t,r,i,o){const u=Date.now()+r,h=new Jd(e,t,u,i,o);return h.start(r),h}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new N(b.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ra(n,e){if(Oe("AsyncQueue",`${e}: ${n}`),qs(n))return new N(b.UNAVAILABLE,`${e}: ${n}`);throw n}class Oa{constructor(e){this.comparator=e?(t,r)=>e(t,r)||P.comparator(t.key,r.key):(t,r)=>P.comparator(t.key,r.key),this.keyedMap=od(),this.sortedSet=new Pe(this.comparator)}static emptySet(e){return new Oa(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Oa)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new Oa;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Bg{constructor(){this.pu=new Pe(P.comparator)}track(e){const t=e.doc.key,r=this.pu.get(t);r?0!==e.type&&3===r.type?this.pu=this.pu.insert(t,e):3===e.type&&1!==r.type?this.pu=this.pu.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.pu=this.pu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.pu=this.pu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.pu=this.pu.remove(t):1===e.type&&2===r.type?this.pu=this.pu.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.pu=this.pu.insert(t,{type:2,doc:e.doc}):q():this.pu=this.pu.insert(t,e)}Iu(){const e=[];return this.pu.inorderTraversal((t,r)=>{e.push(r)}),e}}class Ma{constructor(e,t,r,i,o,u,h,m){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=u,this.syncStateChanged=h,this.excludesMetadataChanges=m}static fromInitialDocuments(e,t,r,i){const o=[];return t.forEach(u=>{o.push({type:0,doc:u})}),new Ma(e,t,Oa.emptySet(t),o,r,i,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ju(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class Z_{constructor(){this.Tu=void 0,this.listeners=[]}}class Y_{constructor(){this.queries=new Ai(e=>cp(e),Ju),this.onlineState="Unknown",this.Eu=new Set}}function Xd(n,e){return ef.apply(this,arguments)}function ef(){return ef=(0,p.Z)(function*(n,e){const t=L(n),r=e.query;let i=!1,o=t.queries.get(r);if(o||(i=!0,o=new Z_),i)try{o.Tu=yield t.onListen(r)}catch(u){const h=Ra(u,`Initialization of query '${nd(e.query)}' failed`);return void e.onError(h)}t.queries.set(r,o),o.listeners.push(e),e.Au(t.onlineState),o.Tu&&e.Ru(o.Tu)&&rf(t)}),ef.apply(this,arguments)}function tf(n,e){return nf.apply(this,arguments)}function nf(){return nf=(0,p.Z)(function*(n,e){const t=L(n),r=e.query;let i=!1;const o=t.queries.get(r);if(o){const u=o.listeners.indexOf(e);u>=0&&(o.listeners.splice(u,1),i=0===o.listeners.length)}if(i)return t.queries.delete(r),t.onUnlisten(r)}),nf.apply(this,arguments)}function Q_(n,e){const t=L(n);let r=!1;for(const i of e){const u=t.queries.get(i.query);if(u){for(const h of u.listeners)h.Ru(i)&&(r=!0);u.Tu=i}}r&&rf(t)}function J_(n,e,t){const r=L(n),i=r.queries.get(e);if(i)for(const o of i.listeners)o.onError(t);r.queries.delete(e)}function rf(n){n.Eu.forEach(e=>{e.next()})}class sf{constructor(e,t,r){this.query=e,this.Pu=t,this.bu=!1,this.Vu=null,this.onlineState="Unknown",this.options=r||{}}Ru(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new Ma(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.bu?this.vu(e)&&(this.Pu.next(e),t=!0):this.Su(e,this.onlineState)&&(this.Du(e),t=!0),this.Vu=e,t}onError(e){this.Pu.error(e)}Au(e){this.onlineState=e;let t=!1;return this.Vu&&!this.bu&&this.Su(this.Vu,e)&&(this.Du(this.Vu),t=!0),t}Su(e,t){return!e.fromCache||!(this.options.Cu&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}vu(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Vu&&this.Vu.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}Du(e){e=Ma.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.bu=!0,this.Pu.next(e)}}class X_{constructor(e,t){this.payload=e,this.byteLength=t}xu(){return"metadata"in this.payload}}class Gg{constructor(e){this.M=e}fi(e){return Un(this.M,e)}di(e){return e.metadata.exists?Up(this.M,e.document,!1):J.newNoDocument(this.fi(e.metadata.name),this._i(e.metadata.readTime))}_i(e){return Ze(e)}}class ev{constructor(e,t,r){this.Nu=e,this.localStore=t,this.M=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=qg(e)}ku(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;const r=ne.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Mu(e){const t=new Map,r=new Gg(this.M);for(const i of e)if(i.metadata.queries){const o=r.fi(i.metadata.name);for(const u of i.metadata.queries){const h=(t.get(u)||he()).add(o);t.set(u,h)}}return t}complete(){var e=this;return(0,p.Z)(function*(){const t=yield function w_(n,e,t,r){return Cd.apply(this,arguments)}(e.localStore,new Gg(e.M),e.documents,e.Nu.id),r=e.Mu(e.documents);for(const i of e.queries)yield E_(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,Ou:e.collectionGroups,Fu:t}})()}}function qg(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class jg{constructor(e){this.key=e}}class $g{constructor(e){this.key=e}}class Wg{constructor(e,t){this.query=e,this.$u=t,this.Bu=null,this.current=!1,this.Lu=he(),this.mutatedKeys=he(),this.Uu=dp(e),this.qu=new Oa(this.Uu)}get Ku(){return this.$u}Gu(e,t){const r=t?t.Qu:new Bg,i=t?t.qu:this.qu;let o=t?t.mutatedKeys:this.mutatedKeys,u=i,h=!1;const m=kc(this.query)&&i.size===this.query.limit?i.last():null,_=Nc(this.query)&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((w,E)=>{const A=i.get(w),D=rd(this.query,E)?E:null,k=!!A&&this.mutatedKeys.has(A.key),F=!!D&&(D.hasLocalMutations||this.mutatedKeys.has(D.key)&&D.hasCommittedMutations);let Y=!1;A&&D?A.data.isEqual(D.data)?k!==F&&(r.track({type:3,doc:D}),Y=!0):this.ju(A,D)||(r.track({type:2,doc:D}),Y=!0,(m&&this.Uu(D,m)>0||_&&this.Uu(D,_)<0)&&(h=!0)):!A&&D?(r.track({type:0,doc:D}),Y=!0):A&&!D&&(r.track({type:1,doc:A}),Y=!0,(m||_)&&(h=!0)),Y&&(D?(u=u.add(D),o=F?o.add(w):o.delete(w)):(u=u.delete(w),o=o.delete(w)))}),kc(this.query)||Nc(this.query))for(;u.size>this.query.limit;){const w=kc(this.query)?u.last():u.first();u=u.delete(w.key),o=o.delete(w.key),r.track({type:1,doc:w})}return{qu:u,Qu:r,ni:h,mutatedKeys:o}}ju(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const i=this.qu;this.qu=e.qu,this.mutatedKeys=e.mutatedKeys;const o=e.Qu.Iu();o.sort((_,w)=>function(E,A){const D=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return q()}};return D(E)-D(A)}(_.type,w.type)||this.Uu(_.doc,w.doc)),this.Wu(r);const u=t?this.zu():[],h=0===this.Lu.size&&this.current?1:0,m=h!==this.Bu;return this.Bu=h,0!==o.length||m?{snapshot:new Ma(this.query,e.qu,i,o,e.mutatedKeys,0===h,m,!1),Hu:u}:{Hu:u}}Au(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({qu:this.qu,Qu:new Bg,mutatedKeys:this.mutatedKeys,ni:!1},!1)):{Hu:[]}}Ju(e){return!this.$u.has(e)&&!!this.qu.has(e)&&!this.qu.get(e).hasLocalMutations}Wu(e){e&&(e.addedDocuments.forEach(t=>this.$u=this.$u.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.$u=this.$u.delete(t)),this.current=e.current)}zu(){if(!this.current)return[];const e=this.Lu;this.Lu=he(),this.qu.forEach(r=>{this.Ju(r.key)&&(this.Lu=this.Lu.add(r.key))});const t=[];return e.forEach(r=>{this.Lu.has(r)||t.push(new $g(r))}),this.Lu.forEach(r=>{e.has(r)||t.push(new jg(r))}),t}Yu(e){this.$u=e.li,this.Lu=he();const t=this.Gu(e.documents);return this.applyChanges(t,!0)}Xu(){return Ma.fromInitialDocuments(this.query,this.qu,this.mutatedKeys,0===this.Bu)}}class tv{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class nv{constructor(e){this.key=e,this.Zu=!1}}class rv{constructor(e,t,r,i,o,u){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=u,this.ta={},this.ea=new Ai(h=>cp(h),Ju),this.na=new Map,this.sa=new Set,this.ia=new Pe(P.comparator),this.ra=new Map,this.oa=new xd,this.ua={},this.aa=new Map,this.ca=zs.yn(),this.onlineState="Unknown",this.ha=void 0}get isPrimaryClient(){return!0===this.ha}}function iv(n,e){return of.apply(this,arguments)}function of(){return of=(0,p.Z)(function*(n,e){const t=Df(n);let r,i;const o=t.ea.get(e);if(o)r=o.targetId,t.sharedClientState.addLocalQueryTarget(r),i=o.view.Xu();else{const u=yield Sa(t.localStore,$t(e));t.isPrimaryClient&&Yc(t.remoteStore,u);const h=t.sharedClientState.addLocalQueryTarget(u.targetId);r=u.targetId,i=yield af(t,e,r,"current"===h)}return i}),of.apply(this,arguments)}function af(n,e,t,r){return uf.apply(this,arguments)}function uf(){return uf=(0,p.Z)(function*(n,e,t,r){n.la=(w,E,A)=>{return(D=(0,p.Z)(function*(k,F,Y,de){let we=F.view.Gu(Y);we.ni&&(we=yield Kc(k.localStore,F.query,!1).then(({documents:ie})=>F.view.Gu(ie,we)));const ae=de&&de.targetChanges.get(F.targetId),te=F.view.applyChanges(we,k.isPrimaryClient,ae);return _f(k,F.targetId,te.Hu),te.snapshot}),function(k,F,Y,de){return D.apply(this,arguments)})(n,w,E,A);var D};const i=yield Kc(n.localStore,e,!0),o=new Wg(e,i.li),u=o.Gu(i.documents),h=il.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState),m=o.applyChanges(u,n.isPrimaryClient,h);_f(n,t,m.Hu);const _=new tv(e,t,o);return n.ea.set(e,_),n.na.has(t)?n.na.get(t).push(e):n.na.set(t,[e]),m.snapshot}),uf.apply(this,arguments)}function sv(n,e){return lf.apply(this,arguments)}function lf(){return lf=(0,p.Z)(function*(n,e){const t=L(n),r=t.ea.get(e),i=t.na.get(r.targetId);if(i.length>1)return t.na.set(r.targetId,i.filter(o=>!Ju(o,e))),void t.ea.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield xa(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),vl(t.remoteStore,r.targetId),Pa(t,r.targetId)}).catch(Zs))):(Pa(t,r.targetId),yield xa(t.localStore,r.targetId,!0))}),lf.apply(this,arguments)}function cf(){return cf=(0,p.Z)(function*(n,e,t){const r=kf(n);try{const i=yield function(o,u){const h=L(o),m=Ae.now(),_=u.reduce((E,A)=>E.add(A.key),he());let w;return h.persistence.runTransaction("Locally write mutations","readwrite",E=>h.ci.Ks(E,_).next(A=>{w=A;const D=[];for(const k of u){const F=dy(k,w.get(k.key));null!=F&&D.push(new Gs(k.key,F,H(F.value.mapValue),Be.exists(!0)))}return h.Bs.addMutationBatch(E,m,D,u)})).then(E=>(E.applyToLocalDocumentSet(w),{batchId:E.batchId,changes:w}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,u,h){let m=o.ua[o.currentUser.toKey()];m||(m=new Pe(X)),m=m.insert(u,h),o.ua[o.currentUser.toKey()]=m}(r,i.batchId,t),yield Nr(r,i.changes),yield ka(r.remoteStore)}catch(i){const o=Ra(i,"Failed to persist write");t.reject(o)}}),cf.apply(this,arguments)}function Kg(n,e){return hf.apply(this,arguments)}function hf(){return hf=(0,p.Z)(function*(n,e){const t=L(n);try{const r=yield v_(t.localStore,e);e.targetChanges.forEach((i,o)=>{const u=t.ra.get(o);u&&(Q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?u.Zu=!0:i.modifiedDocuments.size>0?Q(u.Zu):i.removedDocuments.size>0&&(Q(u.Zu),u.Zu=!1))}),yield Nr(t,r,e)}catch(r){yield Zs(r)}}),hf.apply(this,arguments)}function Hg(n,e,t){const r=L(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.ea.forEach((o,u)=>{const h=u.view.Au(e);h.snapshot&&i.push(h.snapshot)}),function(o,u){const h=L(o);h.onlineState=u;let m=!1;h.queries.forEach((_,w)=>{for(const E of w.listeners)E.Au(u)&&(m=!0)}),m&&rf(h)}(r.eventManager,e),i.length&&r.ta.Qo(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function av(n,e,t){return df.apply(this,arguments)}function df(){return df=(0,p.Z)(function*(n,e,t){const r=L(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.ra.get(e),o=i&&i.key;if(o){let u=new Pe(P.comparator);u=u.insert(o,J.newNoDocument(o,z.min()));const h=he().add(o),m=new rl(z.min(),new Map,new ve(X),u,h);yield Kg(r,m),r.ia=r.ia.remove(o),r.ra.delete(e),vf(r)}else yield xa(r.localStore,e,!1).then(()=>Pa(r,e,t)).catch(Zs)}),df.apply(this,arguments)}function uv(n,e){return ff.apply(this,arguments)}function ff(){return ff=(0,p.Z)(function*(n,e){const t=L(n),r=e.batch.batchId;try{const i=yield __(t.localStore,e);yf(t,r,null),mf(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Nr(t,i)}catch(i){yield Zs(i)}}),ff.apply(this,arguments)}function lv(n,e,t){return pf.apply(this,arguments)}function pf(){return pf=(0,p.Z)(function*(n,e,t){const r=L(n);try{const i=yield function(o,u){const h=L(o);return h.persistence.runTransaction("Reject batch","readwrite-primary",m=>{let _;return h.Bs.lookupMutationBatch(m,u).next(w=>(Q(null!==w),_=w.keys(),h.Bs.removeMutationBatch(m,w))).next(()=>h.Bs.performConsistencyCheck(m)).next(()=>h.ci.Ks(m,_))})}(r.localStore,e);yf(r,e,t),mf(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Nr(r,i)}catch(i){yield Zs(i)}}),pf.apply(this,arguments)}function gf(){return gf=(0,p.Z)(function*(n,e){const t=L(n);Di(t.remoteStore)||M("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(o){const u=L(o);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",h=>u.Bs.getHighestUnacknowledgedBatchId(h))}(t.localStore);if(-1===r)return void e.resolve();const i=t.aa.get(r)||[];i.push(e),t.aa.set(r,i)}catch(r){const i=Ra(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}),gf.apply(this,arguments)}function mf(n,e){(n.aa.get(e)||[]).forEach(t=>{t.resolve()}),n.aa.delete(e)}function yf(n,e,t){const r=L(n);let i=r.ua[r.currentUser.toKey()];if(i){const o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),r.ua[r.currentUser.toKey()]=i}}function Pa(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.na.get(e))n.ea.delete(r),t&&n.ta.fa(r,t);n.na.delete(e),n.isPrimaryClient&&n.oa.Pi(e).forEach(r=>{n.oa.containsKey(r)||zg(n,r)})}function zg(n,e){n.sa.delete(e.path.canonicalString());const t=n.ia.get(e);null!==t&&(vl(n.remoteStore,t),n.ia=n.ia.remove(e),n.ra.delete(t),vf(n))}function _f(n,e,t){for(const r of t)r instanceof jg?(n.oa.addReference(r.key,e),hv(n,r)):r instanceof $g?(M("SyncEngine","Document no longer in limbo: "+r.key),n.oa.removeReference(r.key,e),n.oa.containsKey(r.key)||zg(n,r.key)):q()}function hv(n,e){const t=e.key,r=t.path.canonicalString();n.ia.get(t)||n.sa.has(r)||(M("SyncEngine","New document in limbo: "+t),n.sa.add(r),vf(n))}function vf(n){for(;n.sa.size>0&&n.ia.size<n.maxConcurrentLimboResolutions;){const e=n.sa.values().next().value;n.sa.delete(e);const t=new P(ne.fromString(e)),r=n.ca.next();n.ra.set(r,new nv(t)),n.ia=n.ia.insert(t,r),Yc(n.remoteStore,new bi($t(ma(t.path)),r,2,ft.A))}}function Nr(n,e,t){return If.apply(this,arguments)}function If(){return If=(0,p.Z)(function*(n,e,t){const r=L(n),i=[],o=[],u=[];var h;r.ea.isEmpty()||(r.ea.forEach((h,m)=>{u.push(r.la(m,e,t).then(_=>{if(_){r.isPrimaryClient&&r.sharedClientState.updateQueryState(m.targetId,_.fromCache?"not-current":"current"),i.push(_);const w=Td.Ys(m.targetId,_);o.push(w)}}))}),yield Promise.all(u),r.ta.Qo(i),yield(h=(0,p.Z)(function*(m,_){const w=L(m);try{yield w.persistence.runTransaction("notifyLocalViewChanges","readwrite",E=>S.forEach(_,A=>S.forEach(A.Hs,D=>w.persistence.referenceDelegate.addReference(E,A.targetId,D)).next(()=>S.forEach(A.Js,D=>w.persistence.referenceDelegate.removeReference(E,A.targetId,D)))))}catch(E){if(!qs(E))throw E;M("LocalStore","Failed to update sequence numbers: "+E)}for(const E of _){const A=E.targetId;if(!E.fromCache){const D=w.ii.get(A),F=D.withLastLimboFreeSnapshotVersion(D.snapshotVersion);w.ii=w.ii.insert(A,F)}}}),function(m,_){return h.apply(this,arguments)})(r.localStore,o))}),If.apply(this,arguments)}function dv(n,e){return wf.apply(this,arguments)}function wf(){return wf=(0,p.Z)(function*(n,e){const t=L(n);if(!t.currentUser.isEqual(e)){M("SyncEngine","User change. New user:",e.toKey());const r=yield Eg(t.localStore,e);t.currentUser=e,(i=t).aa.forEach(u=>{u.forEach(h=>{h.reject(new N(b.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),i.aa.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Nr(t,r.hi)}var i}),wf.apply(this,arguments)}function fv(n,e){const t=L(n),r=t.ra.get(e);if(r&&r.Zu)return he().add(r.key);{let i=he();const o=t.na.get(e);if(!o)return i;for(const u of o){const h=t.ea.get(u);i=i.unionWith(h.view.Ku)}return i}}function pv(n,e){return Ef.apply(this,arguments)}function Ef(){return Ef=(0,p.Z)(function*(n,e){const t=L(n),r=yield Kc(t.localStore,e.query,!0),i=e.view.Yu(r);return t.isPrimaryClient&&_f(t,e.targetId,i.Hu),i}),Ef.apply(this,arguments)}function gv(n,e){return Tf.apply(this,arguments)}function Tf(){return Tf=(0,p.Z)(function*(n,e){const t=L(n);return Cg(t.localStore,e).then(r=>Nr(t,r))}),Tf.apply(this,arguments)}function mv(n,e,t,r){return Af.apply(this,arguments)}function Af(){return Af=(0,p.Z)(function*(n,e,t,r){const i=L(n),o=yield function(u,h){const m=L(u),_=L(m.Bs);return m.persistence.runTransaction("Lookup mutation documents","readonly",w=>_.fn(w,h).next(E=>E?m.ci.Ks(w,E):S.resolve(null)))}(i.localStore,e);var h;null!==o?("pending"===t?yield ka(i.remoteStore):"acknowledged"===t||"rejected"===t?(yf(i,e,r||null),mf(i,e),h=e,L(L(i.localStore).Bs)._n(h)):q(),yield Nr(i,o)):M("SyncEngine","Cannot apply mutation batch with id: "+e)}),Af.apply(this,arguments)}function bf(){return bf=(0,p.Z)(function*(n,e){const t=L(n);if(Df(t),kf(t),!0===e&&!0!==t.ha){const r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Zg(t,r.toArray());t.ha=!0,yield Yd(t.remoteStore,!0);for(const o of i)Yc(t.remoteStore,o)}else if(!1===e&&!1!==t.ha){const r=[];let i=Promise.resolve();t.na.forEach((o,u)=>{t.sharedClientState.isLocalQueryTarget(u)?r.push(u):i=i.then(()=>(Pa(t,u),xa(t.localStore,u,!0))),vl(t.remoteStore,u)}),yield i,yield Zg(t,r),function(o){const u=L(o);u.ra.forEach((h,m)=>{vl(u.remoteStore,m)}),u.oa.bi(),u.ra=new Map,u.ia=new Pe(P.comparator)}(t),t.ha=!1,yield Yd(t.remoteStore,!1)}}),bf.apply(this,arguments)}function Zg(n,e,t){return Cf.apply(this,arguments)}function Cf(){return Cf=(0,p.Z)(function*(n,e,t){const r=L(n),i=[],o=[];for(const u of e){let h;const m=r.na.get(u);if(m&&0!==m.length){h=yield Sa(r.localStore,$t(m[0]));for(const _ of m){const w=r.ea.get(_),E=yield pv(r,w);E.snapshot&&o.push(E.snapshot)}}else{const _=yield bg(r.localStore,u);h=yield Sa(r.localStore,_),yield af(r,Yg(_),u,!1)}i.push(h)}return r.ta.Qo(o),i}),Cf.apply(this,arguments)}function Yg(n){return up(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function _v(n){const e=L(n);return L(L(e.localStore).persistence).Fs()}function vv(n,e,t,r){return Sf.apply(this,arguments)}function Sf(){return Sf=(0,p.Z)(function*(n,e,t,r){const i=L(n);if(i.ha)return void M("SyncEngine","Ignoring unexpected query state notification.");const o=i.na.get(e);if(o&&o.length>0)switch(t){case"current":case"not-current":{const u=yield Cg(i.localStore,hp(o[0])),h=rl.createSynthesizedRemoteEventForCurrentChange(e,"current"===t);yield Nr(i,u,h);break}case"rejected":yield xa(i.localStore,e,!0),Pa(i,e,r);break;default:q()}}),Sf.apply(this,arguments)}function Iv(n,e,t){return xf.apply(this,arguments)}function xf(){return xf=(0,p.Z)(function*(n,e,t){const r=Df(n);if(r.ha){for(const i of e){if(r.na.has(i)){M("SyncEngine","Adding an already active target "+i);continue}const o=yield bg(r.localStore,i),u=yield Sa(r.localStore,o);yield af(r,Yg(o),u.targetId,!1),Yc(r.remoteStore,u)}for(const i of t)r.na.has(i)&&(yield xa(r.localStore,i,!1).then(()=>{vl(r.remoteStore,i),Pa(r,i)}).catch(Zs))}}),xf.apply(this,arguments)}function Df(n){const e=L(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Kg.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=fv.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=av.bind(null,e),e.ta.Qo=Q_.bind(null,e.eventManager),e.ta.fa=J_.bind(null,e.eventManager),e}function kf(n){const e=L(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=uv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=lv.bind(null,e),e}class Qg{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,p.Z)(function*(){t.M=yl(e.databaseInfo.databaseId),t.sharedClientState=t._a(e),t.persistence=t.wa(e),yield t.persistence.start(),t.gcScheduler=t.ma(e),t.localStore=t.ga(e)})()}ma(e){return null}ga(e){return wg(this.persistence,new Ig,e.initialUser,this.M)}wa(e){return new D_(Dd.zi,this.M)}_a(e){return new kg}terminate(){var e=this;return(0,p.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Jg extends Qg{constructor(e,t,r){super(),this.ya=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield t().call(r,e),yield r.ya.initialize(r,e),yield kf(r.ya.syncEngine),yield ka(r.ya.remoteStore),yield r.persistence.Ts(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(r.localStore),Promise.resolve()))})()}ga(e){return wg(this.persistence,new Ig,e.initialUser,this.M)}ma(e){return new c_(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue)}wa(e){const t=Ed(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?At.withCacheSize(this.cacheSizeBytes):At.DEFAULT;return new wd(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Rg(),Zc(),this.M,this.sharedClientState,!!this.forceOwnership)}_a(e){return new kg}}class Ev extends Jg{constructor(e,t){super(e,t,!1),this.ya=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield t().call(r,e);const i=r.ya.syncEngine;r.sharedClientState instanceof Od&&(r.sharedClientState.syncEngine={Mr:mv.bind(null,i),Or:vv.bind(null,i),Fr:Iv.bind(null,i),Fs:_v.bind(null,i),kr:gv.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.Ts(function(){var o=(0,p.Z)(function*(u){yield function yv(n,e){return bf.apply(this,arguments)}(r.ya.syncEngine,u),r.gcScheduler&&(u&&!r.gcScheduler.started?r.gcScheduler.start(r.localStore):u||r.gcScheduler.stop())});return function(u){return o.apply(this,arguments)}}())})()}_a(e){const t=Rg();if(!Od.vt(t))throw new N(b.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Ed(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Od(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Nf{initialize(e,t){var r=this;return(0,p.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>Hg(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=dv.bind(null,r.syncEngine),yield Yd(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Y_}createDatastore(e){const t=yl(e.databaseInfo.databaseId),r=new M_(e.databaseInfo);return new L_(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,i=e.asyncQueue,o=h=>Hg(this.syncEngine,h,0),u=Ng.vt()?new Ng:new N_,new U_(t,r,i,o,u);var t,r,i,o,u}createSyncEngine(e,t){return function(r,i,o,u,h,m,_){const w=new rv(r,i,o,u,h,m);return _&&(w.ha=!0),w}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,p.Z)(function*(t){const r=L(t);M("RemoteStore","RemoteStore shutting down."),r.fu.add(5),yield Da(r),r._u.shutdown(),r.wu.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function Xg(n,e=10240){let t=0;return{read:()=>(0,p.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,p.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class Jc{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.pa(this.observer.next,e)}error(e){this.observer.error?this.pa(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Ia(){this.muted=!0}pa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Tv{constructor(e,t){this.Ta=e,this.M=t,this.metadata=new De,this.buffer=new Uint8Array,this.Ea=new TextDecoder("utf-8"),this.Aa().then(r=>{r&&r.xu()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==r?void 0:r.payload)}`))},r=>this.metadata.reject(r))}close(){return this.Ta.cancel()}getMetadata(){var e=this;return(0,p.Z)(function*(){return e.metadata.promise})()}da(){var e=this;return(0,p.Z)(function*(){return yield e.getMetadata(),e.Aa()})()}Aa(){var e=this;return(0,p.Z)(function*(){const t=yield e.Ra();if(null===t)return null;const r=e.Ea.decode(t),i=Number(r);isNaN(i)&&e.Pa(`length string (${r}) is not valid number`);const o=yield e.ba(i);return new X_(JSON.parse(o),t.length+i)})()}Va(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}Ra(){var e=this;return(0,p.Z)(function*(){for(;e.Va()<0&&!(yield e.va()););if(0===e.buffer.length)return null;const t=e.Va();t<0&&e.Pa("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}ba(e){var t=this;return(0,p.Z)(function*(){for(;t.buffer.length<e;)(yield t.va())&&t.Pa("Reached the end of bundle when more is expected.");const r=t.Ea.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Pa(e){throw this.Ta.cancel(),new Error(`Invalid bundle format: ${e}`)}va(){var e=this;return(0,p.Z)(function*(){const t=yield e.Ta.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class Av{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,p.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new N(b.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(i=(0,p.Z)(function*(o,u){const h=L(o),m=al(h.M)+"/documents",_={documents:u.map(D=>ol(h.M,D))},w=yield h.ho("BatchGetDocuments",m,_),E=new Map;w.forEach(D=>{const k=function Ay(n,e){return"found"in e?function(t,r){Q(!!r.found);const i=Un(t,r.found.name),o=Ze(r.found.updateTime),u=new G({mapValue:{fields:r.found.fields}});return J.newFoundDocument(i,o,u)}(n,e):"missing"in e?function(t,r){Q(!!r.missing),Q(!!r.readTime);const i=Un(t,r.missing),o=Ze(r.readTime);return J.newNoDocument(i,o)}(n,e):q()}(h.M,D);E.set(k.key.toString(),k)});const A=[];return u.forEach(D=>{const k=E.get(D.toString());Q(!!k),A.push(k)}),A}),function(o,u){return i.apply(this,arguments)})(t.datastore,e);var i;return r.forEach(i=>t.recordVersion(i)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new tl(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,p.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,i)=>{const o=P.fromPath(i);e.mutations.push(new sd(o,e.precondition(o)))}),yield(r=(0,p.Z)(function*(i,o){const u=L(i),h=al(u.M)+"/documents",m={writes:o.map(_=>ul(u.M,_))};yield u.oo("Commit",h,m)}),function(i,o){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw q();t=z.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new N(b.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?Be.updateTime(t):Be.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(z.min()))throw new N(b.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Be.updateTime(t)}return Be.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class bv{constructor(e,t,r,i){this.asyncQueue=e,this.datastore=t,this.updateFunction=r,this.deferred=i,this.Sa=5,this.Do=new Md(this.asyncQueue,"transaction_retry")}run(){this.Sa-=1,this.Da()}Da(){var e=this;this.Do.To((0,p.Z)(function*(){const t=new Av(e.datastore),r=e.Ca(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(o=>{e.xa(o)}))}).catch(i=>{e.xa(i)})}))}Ca(e){try{const t=this.updateFunction(e);return!Vn(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}xa(e){this.Sa>0&&this.Na(e)?(this.Sa-=1,this.asyncQueue.enqueueAndForget(()=>(this.Da(),Promise.resolve()))):this.deferred.reject(e)}Na(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!Cp(t)}return!1}}class Cv{constructor(e,t,r,i){var o=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Ke.UNAUTHENTICATED,this.clientId=Tc.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var u=(0,p.Z)(function*(h){M("FirestoreClient","Received user=",h.uid),yield o.authCredentialListener(h),o.user=h});return function(h){return u.apply(this,arguments)}}()),this.appCheckCredentials.start(r,u=>(M("FirestoreClient","Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}getConfiguration(){var e=this;return(0,p.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new N(b.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new De;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=Ra(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function em(n,e){return Rf.apply(this,arguments)}function Rf(){return Rf=(0,p.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),M("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,p.Z)(function*(o){r.isEqual(o)||(yield Eg(e.localStore,o),r=o)});return function(o){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}),Rf.apply(this,arguments)}function tm(n,e){return Of.apply(this,arguments)}function Of(){return Of=(0,p.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield Mf(n);M("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(i=>Ug(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,o)=>Ug(e.remoteStore,o)),n.onlineComponents=e}),Of.apply(this,arguments)}function Mf(n){return Pf.apply(this,arguments)}function Pf(){return Pf=(0,p.Z)(function*(n){return n.offlineComponents||(M("FirestoreClient","Using default OfflineComponentProvider"),yield em(n,new Qg)),n.offlineComponents}),Pf.apply(this,arguments)}function Xc(n){return Vf.apply(this,arguments)}function Vf(){return Vf=(0,p.Z)(function*(n){return n.onlineComponents||(M("FirestoreClient","Using default OnlineComponentProvider"),yield tm(n,new Nf)),n.onlineComponents}),Vf.apply(this,arguments)}function nm(n){return Mf(n).then(e=>e.persistence)}function Lf(n){return Mf(n).then(e=>e.localStore)}function rm(n){return Xc(n).then(e=>e.remoteStore)}function Ff(n){return Xc(n).then(e=>e.syncEngine)}function Va(n){return Uf.apply(this,arguments)}function Uf(){return Uf=(0,p.Z)(function*(n){const e=yield Xc(n),t=e.eventManager;return t.onListen=iv.bind(null,e.syncEngine),t.onUnlisten=sv.bind(null,e.syncEngine),t}),Uf.apply(this,arguments)}function im(n,e,t={}){const r=new De;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(i,o,u,h,m){const _=new Jc({next:E=>{o.enqueueAndForget(()=>tf(i,w));const A=E.docs.has(u);!A&&E.fromCache?m.reject(new N(b.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&E.fromCache&&h&&"server"===h.source?m.reject(new N(b.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(E)},error:E=>m.reject(E)}),w=new sf(ma(u.path),_,{includeMetadataChanges:!0,Cu:!0});return Xd(i,w)}(yield Va(n),n.asyncQueue,e,t,r)})),r.promise}function sm(n,e,t={}){const r=new De;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(i,o,u,h,m){const _=new Jc({next:E=>{o.enqueueAndForget(()=>tf(i,w)),E.fromCache&&"server"===h.source?m.reject(new N(b.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(E)},error:E=>m.reject(E)}),w=new sf(u,_,{includeMetadataChanges:!0,Cu:!0});return Xd(i,w)}(yield Va(n),n.asyncQueue,e,t,r)})),r.promise}const om=new Map;function Bf(n,e,t){if(!t)throw new N(b.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function am(n,e,t,r){if(!0===e&&!0===r)throw new N(b.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function um(n){if(!P.isDocumentKey(n))throw new N(b.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function lm(n){if(P.isDocumentKey(n))throw new N(b.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function eh(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":q()}function re(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new N(b.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=eh(n);throw new N(b.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function cm(n,e){if(e<=0)throw new N(b.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class hm{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new N(b.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new N(b.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,am("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Il{constructor(e,t,r){this._authCredentials=t,this._appCheckCredentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hm({}),this._settingsFrozen=!1,e instanceof hn?this._databaseId=e:(this._app=e,this._databaseId=function(i){if(!Object.prototype.hasOwnProperty.apply(i.options,["projectId"]))throw new N(b.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new hn(i.options.projectId)}(e))}get app(){if(!this._app)throw new N(b.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new N(b.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hm(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new Kh;switch(t.type){case"gapi":const r=t.client;return Q(!("object"!=typeof r||null===r||!r.auth||!r.auth.getAuthHeaderValueForFirstParty)),new Zh(r,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new N(b.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=om.get(e);t&&(M("ComponentProvider","Removing Datastore"),om.delete(e),t.terminate())}(this),Promise.resolve()}}class Ie{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Gn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ie(this.firestore,e,this._key)}}class ot{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new ot(this.firestore,e,this._query)}}class Gn extends ot{constructor(e,t,r){super(e,t,ma(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ie(this.firestore,null,new P(e))}withConverter(e){return new Gn(this.firestore,e,this._path)}}function dm(n,e,...t){if(n=(0,W.m9)(n),Bf("collection","path",e),n instanceof Il){const r=ne.fromString(e,...t);return lm(r),new Gn(n,null,r)}{if(!(n instanceof Ie||n instanceof Gn))throw new N(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ne.fromString(e,...t));return lm(r),new Gn(n.firestore,null,r)}}function th(n,e,...t){if(n=(0,W.m9)(n),1===arguments.length&&(e=Tc.R()),Bf("doc","path",e),n instanceof Il){const r=ne.fromString(e,...t);return um(r),new Ie(n,null,new P(r))}{if(!(n instanceof Ie||n instanceof Gn))throw new N(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ne.fromString(e,...t));return um(r),new Ie(n.firestore,n instanceof Gn?n.converter:null,new P(r))}}function fm(n,e){return n=(0,W.m9)(n),e=(0,W.m9)(e),(n instanceof Ie||n instanceof Gn)&&(e instanceof Ie||e instanceof Gn)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function pm(n,e){return n=(0,W.m9)(n),e=(0,W.m9)(e),n instanceof ot&&e instanceof ot&&n.firestore===e.firestore&&Ju(n._query,e._query)&&n.converter===e.converter}class Lv{constructor(){this.ka=Promise.resolve(),this.Ma=[],this.Oa=!1,this.Fa=[],this.$a=null,this.Ba=!1,this.La=!1,this.Ua=[],this.Do=new Md(this,"async_queue_retry"),this.qa=()=>{const t=Zc();t&&M("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Do.Ao()};const e=Zc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.qa)}get isShuttingDown(){return this.Oa}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ka(),this.Ga(e)}enterRestrictedMode(e){if(!this.Oa){this.Oa=!0,this.La=e||!1;const t=Zc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.qa)}}enqueue(e){if(this.Ka(),this.Oa)return new Promise(()=>{});const t=new De;return this.Ga(()=>this.Oa&&this.La?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ma.push(e),this.Qa()))}Qa(){var e=this;return(0,p.Z)(function*(){if(0!==e.Ma.length){try{yield e.Ma[0](),e.Ma.shift(),e.Do.reset()}catch(t){if(!qs(t))throw t;M("AsyncQueue","Operation failed with retryable error: "+t)}e.Ma.length>0&&e.Do.To(()=>e.Qa())}})()}Ga(e){const t=this.ka.then(()=>(this.Ba=!0,e().catch(r=>{throw this.$a=r,this.Ba=!1,Oe("INTERNAL UNHANDLED ERROR: ",function(o){let u=o.message||"";return o.stack&&(u=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),u}(r)),r}).then(r=>(this.Ba=!1,r))));return this.ka=t,t}enqueueAfterDelay(e,t,r){this.Ka(),this.Ua.indexOf(e)>-1&&(t=0);const i=Jd.createAndSchedule(this,e,t,r,o=>this.ja(o));return this.Fa.push(i),i}Ka(){this.$a&&q()}verifyOperationInProgress(){}Wa(){var e=this;return(0,p.Z)(function*(){let t;do{t=e.ka,yield t}while(t!==e.ka)})()}za(e){for(const t of this.Fa)if(t.timerId===e)return!0;return!1}Ha(e){return this.Wa().then(()=>{this.Fa.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Fa)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Wa()})}Ja(e){this.Ua.push(e)}ja(e){const t=this.Fa.indexOf(e);this.Fa.splice(t,1)}}function Gf(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const i of["next","error","complete"])if(i in r&&"function"==typeof r[i])return!0;return!1}(n)}class Fv{constructor(){this._progressObserver={},this._taskCompletionResolver=new De,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Ce extends Il{constructor(e,t,r){super(e,t,r),this.type="firestore",this._queue=new Lv,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||gm(this),this._firestoreClient.terminate()}}function qe(n){return n._firestoreClient||gm(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function gm(n){var e;const t=n._freezeSettings(),r=(o=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new Jh(n._databaseId,o,n._persistenceKey,(h=t).host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,h.useFetchStreams));var o,h;n._firestoreClient=new Cv(n._authCredentials,n._appCheckCredentials,n._queue,r)}function mm(n,e,t){const r=new De;return n.asyncQueue.enqueue((0,p.Z)(function*(){try{yield em(n,t),yield tm(n,e),r.resolve()}catch(i){if(!("FirebaseError"===(o=i).name?o.code===b.FAILED_PRECONDITION||o.code===b.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&o instanceof DOMException)||22===o.code||20===o.code||11===o.code))throw i;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+i),r.reject(i)}var o})).then(()=>r.promise)}function ym(n){if(n._initialized||n._terminated)throw new N(b.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Rr{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new N(b.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new be(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class qn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new qn(ke.fromBase64String(e))}catch(t){throw new N(b.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new qn(ke.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Qs{constructor(e){this._methodName=e}}class nh{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new N(b.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new N(b.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return X(this._lat,e._lat)||X(this._long,e._long)}}const zv=/^__.*__$/;class Zv{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new Gs(e,this.data,this.fieldMask,t,this.fieldTransforms):new el(e,this.data,t,this.fieldTransforms)}}class _m{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Gs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function vm(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw q()}}class rh{constructor(e,t,r,i,o,u){this.settings=e,this.databaseId=t,this.M=r,this.ignoreUndefinedProperties=i,void 0===o&&this.Ya(),this.fieldTransforms=o||[],this.fieldMask=u||[]}get path(){return this.settings.path}get Xa(){return this.settings.Xa}Za(e){return new rh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.M,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}tc(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Za({path:r,ec:!1});return i.nc(e),i}sc(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Za({path:r,ec:!1});return i.Ya(),i}ic(e){return this.Za({path:void 0,ec:!0})}rc(e){return oh(e,this.settings.methodName,this.settings.oc||!1,this.path,this.settings.uc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Ya(){if(this.path)for(let e=0;e<this.path.length;e++)this.nc(this.path.get(e))}nc(e){if(0===e.length)throw this.rc("Document fields must not be empty");if(vm(this.Xa)&&zv.test(e))throw this.rc('Document fields cannot begin and end with "__"')}}class Yv{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.M=r||yl(e)}ac(e,t,r,i=!1){return new rh({Xa:e,methodName:t,uc:r,path:be.emptyPath(),ec:!1,oc:i},this.databaseId,this.M,this.ignoreUndefinedProperties)}}function Js(n){const e=n._freezeSettings(),t=yl(n._databaseId);return new Yv(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ih(n,e,t,r,i,o={}){const u=n.ac(o.merge||o.mergeFields?2:0,e,t,i);Wf("Data must be an object, but it was:",u,r);const h=Em(r,u);let m,_;if(o.merge)m=new Cr(u.fieldMask),_=u.fieldTransforms;else if(o.mergeFields){const w=[];for(const E of o.mergeFields){const A=Kf(e,E,t);if(!u.contains(A))throw new N(b.INVALID_ARGUMENT,`Field '${A}' is specified in your field mask but missing from your input data.`);Am(w,A)||w.push(A)}m=new Cr(w),_=u.fieldTransforms.filter(E=>m.covers(E.field))}else m=null,_=u.fieldTransforms;return new Zv(new G(h),m,_)}class wl extends Qs{_toFieldTransform(e){if(2!==e.Xa)throw e.rc(1===e.Xa?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof wl}}function Im(n,e,t){return new rh({Xa:3,uc:e.settings.uc,methodName:n._methodName,ec:t},e.databaseId,e.M,e.ignoreUndefinedProperties)}class qf extends Qs{_toFieldTransform(e){return new Xu(e.path,new _a)}isEqual(e){return e instanceof qf}}class Qv extends Qs{constructor(e,t){super(e),this.cc=t}_toFieldTransform(e){const t=Im(this,e,!0),r=this.cc.map(o=>Xs(o,t)),i=new Us(r);return new Xu(e.path,i)}isEqual(e){return this===e}}class Jv extends Qs{constructor(e,t){super(e),this.cc=t}_toFieldTransform(e){const t=Im(this,e,!0),r=this.cc.map(o=>Xs(o,t)),i=new Bs(r);return new Xu(e.path,i)}isEqual(e){return this===e}}class Xv extends Qs{constructor(e,t){super(e),this.hc=t}_toFieldTransform(e){const t=new va(e.M,gp(e.M,this.hc));return new Xu(e.path,t)}isEqual(e){return this===e}}function jf(n,e,t,r){const i=n.ac(1,e,t);Wf("Data must be an object, but it was:",i,r);const o=[],u=G.empty();Mn(r,(m,_)=>{const w=sh(e,m,t);_=(0,W.m9)(_);const E=i.sc(w);if(_ instanceof wl)o.push(w);else{const A=Xs(_,E);null!=A&&(o.push(w),u.set(w,A))}});const h=new Cr(o);return new _m(u,h,i.fieldTransforms)}function $f(n,e,t,r,i,o){const u=n.ac(1,e,t),h=[Kf(e,r,t)],m=[i];if(o.length%2!=0)throw new N(b.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let A=0;A<o.length;A+=2)h.push(Kf(e,o[A])),m.push(o[A+1]);const _=[],w=G.empty();for(let A=h.length-1;A>=0;--A)if(!Am(_,h[A])){const D=h[A];let k=m[A];k=(0,W.m9)(k);const F=u.sc(D);if(k instanceof wl)_.push(D);else{const Y=Xs(k,F);null!=Y&&(_.push(D),w.set(D,Y))}}const E=new Cr(_);return new _m(w,E,u.fieldTransforms)}function wm(n,e,t,r=!1){return Xs(t,n.ac(r?4:3,e))}function Xs(n,e){if(Tm(n=(0,W.m9)(n)))return Wf("Unsupported field value:",e,n),Em(n,e);if(n instanceof Qs)return function(t,r){if(!vm(r.Xa))throw r.rc(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r.rc(`${t._methodName}() is not currently supported inside arrays`);const i=t._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.ec&&4!==e.Xa)throw e.rc("Nested arrays are not supported");return function(t,r){const i=[];let o=0;for(const u of t){let h=Xs(u,r.ic(o));null==h&&(h={nullValue:"NULL_VALUE"}),i.push(h),o++}return{arrayValue:{values:i}}}(n,e)}return function(t,r){if(null===(t=(0,W.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return gp(r.M,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const i=Ae.fromDate(t);return{timestampValue:sl(r.M,i)}}if(t instanceof Ae){const i=new Ae(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:sl(r.M,i)}}if(t instanceof nh)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof qn)return{bytesValue:Mp(r.M,t._byteString)};if(t instanceof Ie){const i=r.databaseId,o=t.firestore._databaseId;if(!o.isEqual(i))throw r.rc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:ad(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r.rc(`Unsupported field value: ${eh(t)}`)}(n,e)}function Em(n,e){const t={};return bc(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Mn(n,(r,i)=>{const o=Xs(i,e.tc(r));null!=o&&(t[r]=o)}),{mapValue:{fields:t}}}function Tm(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof Ae||n instanceof nh||n instanceof qn||n instanceof Ie||n instanceof Qs)}function Wf(n,e,t){if(!Tm(t)||"object"!=typeof(r=t)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=eh(t);throw e.rc("an object"===r?n+" a custom object":n+" "+r)}var r}function Kf(n,e,t){if((e=(0,W.m9)(e))instanceof Rr)return e._internalPath;if("string"==typeof e)return sh(n,e);throw oh("Field path arguments must be of type string or ",n,!1,void 0,t)}const eI=new RegExp("[~\\*/\\[\\]]");function sh(n,e,t){if(e.search(eI)>=0)throw oh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Rr(...e.split("."))._internalPath}catch(r){throw oh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function oh(n,e,t,r,i){const o=r&&!r.isEmpty(),u=void 0!==i;let h=`Function ${e}() called with invalid data`;t&&(h+=" (via `toFirestore()`)"),h+=". ";let m="";return(o||u)&&(m+=" (found",o&&(m+=` in field ${r}`),u&&(m+=` in document ${i}`),m+=")"),new N(b.INVALID_ARGUMENT,h+n+m)}function Am(n,e){return n.some(t=>t.isEqual(e))}class El{constructor(e,t,r,i,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Ie(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new tI(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(ah("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class tI extends El{data(){return super.data()}}function ah(n,e){return"string"==typeof e?sh(n,e):e instanceof Rr?e._internalPath:e._delegate._internalPath}class eo{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Or extends El{constructor(e,t,r,i,o,u){super(e,t,r,i,u),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Tl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(ah("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Tl extends Or{data(e={}){return super.data(e)}}class Ni{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new eo(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Tl(this._firestore,this._userDataWriter,r.key,r,new eo(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new N(b.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(u=>({type:"added",doc:new Tl(r._firestore,r._userDataWriter,u.doc.key,u.doc,new eo(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:o++}))}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(u=>i||3!==u.type).map(u=>{const h=new Tl(r._firestore,r._userDataWriter,u.doc.key,u.doc,new eo(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter);let m=-1,_=-1;return 0!==u.type&&(m=o.indexOf(u.doc.key),o=o.delete(u.doc.key)),1!==u.type&&(o=o.add(u.doc),_=o.indexOf(u.doc.key)),{type:nI(u.type),doc:h,oldIndex:m,newIndex:_}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function nI(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return q()}}function bm(n,e){return n instanceof Or&&e instanceof Or?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Ni&&e instanceof Ni&&n._firestore===e._firestore&&pm(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function Cm(n){if(Nc(n)&&0===n.explicitOrderBy.length)throw new N(b.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Al{}function Ri(n,...e){for(const t of e)n=t._apply(n);return n}class rI extends Al{constructor(e,t,r){super(),this.lc=e,this.fc=t,this.dc=r,this.type="where"}_apply(e){const t=Js(e.firestore),r=function(i,o,u,h,m,_,w){let E;if(m.isKeyField()){if("array-contains"===_||"array-contains-any"===_)throw new N(b.INVALID_ARGUMENT,`Invalid Query. You can't perform '${_}' queries on documentId().`);if("in"===_||"not-in"===_){Rm(w,_);const D=[];for(const k of w)D.push(Nm(h,i,k));E={arrayValue:{values:D}}}else E=Nm(h,i,w)}else"in"!==_&&"not-in"!==_&&"array-contains-any"!==_||Rm(w,_),E=wm(u,"where",w,"in"===_||"not-in"===_);const A=Xe.create(m,_,E);return function(D,k){if(k.S()){const Y=ed(D);if(null!==Y&&!Y.isEqual(k.field))throw new N(b.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${Y.toString()}' and '${k.field.toString()}'`);const de=Xh(D);null!==de&&Om(0,k.field,de)}const F=function(Y,de){for(const we of Y.filters)if(de.indexOf(we.op)>=0)return we.op;return null}(D,function(Y){switch(Y){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(k.op));if(null!==F)throw new N(b.INVALID_ARGUMENT,F===k.op?`Invalid query. You cannot use more than one '${k.op.toString()}' filter.`:`Invalid query. You cannot use '${k.op.toString()}' filters with '${F.toString()}' filters.`)}(i,A),A}(e._query,0,t,e.firestore._databaseId,this.lc,this.fc,this.dc);return new ot(e.firestore,e.converter,function(i,o){const u=i.filters.concat([o]);return new kr(i.path,i.collectionGroup,i.explicitOrderBy.slice(),u,i.limit,i.limitType,i.startAt,i.endAt)}(e._query,r))}}class sI extends Al{constructor(e,t){super(),this.lc=e,this._c=t,this.type="orderBy"}_apply(e){const t=function(r,i,o){if(null!==r.startAt)throw new N(b.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new N(b.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const u=new ga(i,o);return function(h,m){if(null===Xh(h)){const _=ed(h);null!==_&&Om(0,_,m.field)}}(r,u),u}(e._query,this.lc,this._c);return new ot(e.firestore,e.converter,function(r,i){const o=r.explicitOrderBy.concat([i]);return new kr(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}class Sm extends Al{constructor(e,t,r){super(),this.type=e,this.wc=t,this.mc=r}_apply(e){return new ot(e.firestore,e.converter,lp(e._query,this.wc,this.mc))}}class xm extends Al{constructor(e,t,r){super(),this.type=e,this.gc=t,this.yc=r}_apply(e){const t=km(e,this.type,this.gc,this.yc);return new ot(e.firestore,e.converter,(i=t,new kr((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,i,r.endAt)));var r,i}}class Dm extends Al{constructor(e,t,r){super(),this.type=e,this.gc=t,this.yc=r}_apply(e){const t=km(e,this.type,this.gc,this.yc);return new ot(e.firestore,e.converter,(i=t,new kr((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,i)));var r,i}}function km(n,e,t,r){if(t[0]=(0,W.m9)(t[0]),t[0]instanceof El)return function(i,o,u,h,m){if(!h)throw new N(b.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const _=[];for(const w of ya(i))if(w.field.isKeyField())_.push(xr(o,h.key));else{const E=h.data.field(w.field);if(Gt(E))throw new N(b.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+w.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===E){const A=w.field.canonicalString();throw new N(b.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${A}' (used as the orderBy) does not exist.`)}_.push(E)}return new Ti(_,m)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=Js(n.firestore);return function(o,u,h,m,_,w){const E=o.explicitOrderBy;if(_.length>E.length)throw new N(b.INVALID_ARGUMENT,`Too many arguments provided to ${m}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const A=[];for(let D=0;D<_.length;D++){const k=_[D];if(E[D].field.isKeyField()){if("string"!=typeof k)throw new N(b.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${m}(), but got a ${typeof k}`);if(!td(o)&&-1!==k.indexOf("/"))throw new N(b.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${m}() must be a plain document ID, but '${k}' contains a slash.`);const F=o.path.child(ne.fromString(k));if(!P.isDocumentKey(F))throw new N(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${m}() must result in a valid document path, but '${F}' is not because it contains an odd number of segments.`);const Y=new P(F);A.push(xr(u,Y))}else{const F=wm(h,m,k);A.push(F)}}return new Ti(A,w)}(n._query,n.firestore._databaseId,i,e,t,r)}}function Nm(n,e,t){if("string"==typeof(t=(0,W.m9)(t))){if(""===t)throw new N(b.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!td(e)&&-1!==t.indexOf("/"))throw new N(b.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(ne.fromString(t));if(!P.isDocumentKey(r))throw new N(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return xr(n,new P(r))}if(t instanceof Ie)return xr(n,t._key);throw new N(b.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${eh(t)}.`)}function Rm(n,e){if(!Array.isArray(n)||0===n.length)throw new N(b.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new N(b.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Om(n,e,t){if(!t.isEqual(e))throw new N(b.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class Hf{convertValue(e,t="none"){switch(Pt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return _e(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Sr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw q()}}convertObject(e,t){const r={};return Mn(e.fields,(i,o)=>{r[i]=this.convertValue(o,t)}),r}convertGeoPoint(e){return new nh(_e(e.latitude),_e(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=$u(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Ls(e));default:return null}}convertTimestamp(e){const t=Pn(e);return new Ae(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ne.fromString(e);Q($p(r));const i=new hn(r.get(1),r.get(3)),o=new P(r.popFirst(5));return i.isEqual(t)||Oe(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}function uh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class fI extends Hf{constructor(e){super(),this.firestore=e}convertBytes(e){return new qn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ie(this.firestore,null,t)}}class Mm{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Js(e)}set(e,t,r){this._verifyNotCommitted();const i=Oi(e,this._firestore),o=uh(i.converter,t,r),u=ih(this._dataReader,"WriteBatch.set",i._key,o,null!==i.converter,r);return this._mutations.push(u.toMutation(i._key,Be.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const o=Oi(e,this._firestore);let u;return u="string"==typeof(t=(0,W.m9)(t))||t instanceof Rr?$f(this._dataReader,"WriteBatch.update",o._key,t,r,i):jf(this._dataReader,"WriteBatch.update",o._key,t),this._mutations.push(u.toMutation(o._key,Be.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Oi(e,this._firestore);return this._mutations=this._mutations.concat(new tl(t._key,Be.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new N(b.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Oi(n,e){if((n=(0,W.m9)(n)).firestore!==e)throw new N(b.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class to extends Hf{constructor(e){super(),this.firestore=e}convertBytes(e){return new qn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ie(this.firestore,null,t)}}function Pm(n,e,t){n=re(n,Ie);const r=re(n.firestore,Ce),i=uh(n.converter,e,t);return La(r,[ih(Js(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,Be.none())])}function Vm(n,e,t,...r){n=re(n,Ie);const i=re(n.firestore,Ce),o=Js(i);let u;return u="string"==typeof(e=(0,W.m9)(e))||e instanceof Rr?$f(o,"updateDoc",n._key,e,t,r):jf(o,"updateDoc",n._key,e),La(i,[u.toMutation(n._key,Be.exists(!0))])}function Lm(n,...e){var t,r,i;n=(0,W.m9)(n);let o={includeMetadataChanges:!1},u=0;"object"!=typeof e[u]||Gf(e[u])||(o=e[u],u++);const h={includeMetadataChanges:o.includeMetadataChanges};if(Gf(e[u])){const E=e[u];e[u]=null===(t=E.next)||void 0===t?void 0:t.bind(E),e[u+1]=null===(r=E.error)||void 0===r?void 0:r.bind(E),e[u+2]=null===(i=E.complete)||void 0===i?void 0:i.bind(E)}let m,_,w;if(n instanceof Ie)_=re(n.firestore,Ce),w=ma(n._key.path),m={next:E=>{e[u]&&e[u](zf(_,n,E))},error:e[u+1],complete:e[u+2]};else{const E=re(n,ot);_=re(E.firestore,Ce),w=E._query;const A=new to(_);m={next:D=>{e[u]&&e[u](new Ni(_,A,E,D))},error:e[u+1],complete:e[u+2]},Cm(n._query)}return function(E,A,D,k){const F=new Jc(k),Y=new sf(A,F,D);return E.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return Xd(yield Va(E),Y)})),()=>{F.Ia(),E.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return tf(yield Va(E),Y)}))}}(qe(_),w,h,m)}function La(n,e){return function(t,r){const i=new De;return t.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function ov(n,e,t){return cf.apply(this,arguments)}(yield Ff(t),r,i)})),i.promise}(qe(n),e)}function zf(n,e,t){const r=t.docs.get(e._key),i=new to(n);return new Or(n,i,e._key,r,new eo(t.hasPendingWrites,t.fromCache),e.converter)}class TI extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Js(e)}get(e){const t=Oi(e,this._firestore),r=new fI(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||1!==i.length)return q();const o=i[0];if(o.isFoundDocument())return new El(this._firestore,r,o.key,o,t.converter);if(o.isNoDocument())return new El(this._firestore,r,t._key,null,t.converter);throw q()})}set(e,t,r){const i=Oi(e,this._firestore),o=uh(i.converter,t,r),u=ih(this._dataReader,"Transaction.set",i._key,o,null!==i.converter,r);return this._transaction.set(i._key,u),this}update(e,t,r,...i){const o=Oi(e,this._firestore);let u;return u="string"==typeof(t=(0,W.m9)(t))||t instanceof Rr?$f(this._dataReader,"Transaction.update",o._key,t,r,i):jf(this._dataReader,"Transaction.update",o._key,t),this._transaction.update(o._key,u),this}delete(e){const t=Oi(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Oi(e,this._firestore),r=new to(this._firestore);return super.get(e).then(i=>new Or(this._firestore,r,t._key,i._document,new eo(!1,!1),t.converter))}}function Zf(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new N("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Um(){if("undefined"==typeof Uint8Array)throw new N("unimplemented","Uint8Arrays are not available in this environment.")}function Bm(){if(!function Qh(){return"undefined"!=typeof atob}())throw new N("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(n,e=!0){Rn=zt.SDK_VERSION,(0,zt._registerComponent)(new Kn.wA("firestore",(t,{options:r})=>{const i=t.getProvider("app").getImmediate(),o=new Ce(i,new Ic(t.getProvider("auth-internal")),new Yh(t.getProvider("app-check-internal")));return r=Object.assign({useFetchStreams:e},r),o._setSettings(r),o},"PUBLIC")),(0,zt.registerVersion)(_c,"3.4.8",n),(0,zt.registerVersion)(_c,"3.4.8","esm2017")}();class bl{constructor(e){this._delegate=e}static fromBase64String(e){return Bm(),new bl(qn.fromBase64String(e))}static fromUint8Array(e){return Um(),new bl(qn.fromUint8Array(e))}toBase64(){return Bm(),this._delegate.toBase64()}toUint8Array(){return Um(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Yf(n){return function RI(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class OI{enableIndexedDbPersistence(e,t){return function Bv(n,e){ym(n=re(n,Ce));const t=qe(n),r=n._freezeSettings(),i=new Nf;return mm(t,i,new Jg(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function Gv(n){ym(n=re(n,Ce));const e=qe(n),t=n._freezeSettings(),r=new Nf;return mm(e,r,new Ev(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function qv(n){if(n._initialized&&!n._terminated)throw new N(b.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new De;return n._queue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{yield(t=(0,p.Z)(function*(r){if(!dn.vt())return Promise.resolve();const i=r+"main";yield dn.delete(i)}),function(r){return t.apply(this,arguments)})(Ed(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Gm{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof hn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&mi("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function Pv(n,e,t,r={}){var i;const o=(n=re(n,Il))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==e&&mi("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},o),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let u,h;if("string"==typeof r.mockUserToken)u=r.mockUserToken,h=Ke.MOCK_USER;else{u=(0,W.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new N(b.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new Ke(m)}n._authCredentials=new Hh(new vc(u,h))}}(this._delegate,e,t,r)}enableNetwork(){return function $v(n){return function Sv(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const e=yield nm(n),t=yield rm(n);return e.setNetworkEnabled(!0),function(r){const i=L(r);return i.fu.delete(0),_l(i)}(t)}))}(qe(n=re(n,Ce)))}(this._delegate)}disableNetwork(){return function Wv(n){return function xv(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const e=yield nm(n),t=yield rm(n);return e.setNetworkEnabled(!1),(r=(0,p.Z)(function*(i){const o=L(i);o.fu.add(0),yield Da(o),o.wu.set("Offline")}),function(i){return r.apply(this,arguments)})(t);var r}))}(qe(n=re(n,Ce)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,am("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function jv(n){return function(e){const t=new De;return e.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function cv(n,e){return gf.apply(this,arguments)}(yield Ff(e),t)})),t.promise}(qe(n=re(n,Ce)))}(this._delegate)}onSnapshotsInSync(e){return function EI(n,e){return function Nv(n,e){const t=new Jc(e);return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return r=yield Va(n),i=t,L(r).Eu.add(i),void i.next();var r,i})),()=>{t.Ia(),n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return r=yield Va(n),i=t,void L(r).Eu.delete(i);var r,i}))}}(qe(n=re(n,Ce)),Gf(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new N("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Fa(this,dm(this._delegate,e))}catch(t){throw mt(t,"collection()","Firestore.collection()")}}doc(e){try{return new Kt(this,th(this._delegate,e))}catch(t){throw mt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new yt(this,function Vv(n,e){if(n=re(n,Il),Bf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new N(b.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ot(n,null,(t=e,new kr(ne.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw mt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function AI(n,e){return function Rv(n,e){const t=new De;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){const r=yield(i=n,Xc(i).then(o=>o.datastore));var i;new bv(n.asyncQueue,r,e,t).run()})),t.promise}(qe(n=re(n,Ce)),t=>e(new TI(n,t)))}(this._delegate,t=>e(new qm(this,t)))}batch(){return qe(this._delegate),new jm(new Mm(this._delegate,e=>La(this._delegate,e)))}loadBundle(e){return function Kv(n,e){const t=qe(n=re(n,Ce)),r=new Fv;return function Ov(n,e,t,r){const i=function(o,u){let h;return h="string"==typeof o?(new TextEncoder).encode(o):o,m=function(m,_){if(m instanceof Uint8Array)return Xg(m,_);if(m instanceof ArrayBuffer)return Xg(new Uint8Array(m),_);if(m instanceof ReadableStream)return m.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(h),new Tv(m,u);var m}(t,yl(e));n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){!function wv(n,e,t){const r=L(n);var i;(i=(0,p.Z)(function*(o,u,h){try{const m=yield u.getMetadata();if(yield function(A,D){const k=L(A),F=Ze(D.createTime);return k.persistence.runTransaction("hasNewerBundle","readonly",Y=>k._s.getBundleMetadata(Y,D.id)).then(Y=>!!Y&&Y.createTime.compareTo(F)>=0)}(o.localStore,m))return yield u.close(),h._completeWith({taskState:"Success",documentsLoaded:(A=m).totalDocuments,bytesLoaded:A.totalBytes,totalDocuments:A.totalDocuments,totalBytes:A.totalBytes}),Promise.resolve(new Set);h._updateProgress(qg(m));const _=new ev(m,o.localStore,u.M);let w=yield u.da();for(;w;){const A=yield _.ku(w);A&&h._updateProgress(A),w=yield u.da()}const E=yield _.complete();return yield Nr(o,E.Fu,void 0),yield function(A,D){const k=L(A);return k.persistence.runTransaction("Save bundle","readwrite",F=>k._s.saveBundleMetadata(F,D))}(o.localStore,m),h._completeWith(E.progress),Promise.resolve(E.Ou)}catch(m){return mi("SyncEngine",`Loading bundle failed with ${m}`),h._failWith(m),Promise.resolve(new Set)}var A}),function(o,u,h){return i.apply(this,arguments)})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield Ff(n),i,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function Hv(n,e){return function Mv(n,e){return n.asyncQueue.enqueue((0,p.Z)(function*(){return function(t,r){const i=L(t);return i.persistence.runTransaction("Get named query","readonly",o=>i._s.getNamedQuery(o,r))}(yield Lf(n),e)}))}(qe(n=re(n,Ce)),e).then(t=>t?new ot(n,null,t.query):null)}(this._delegate,e).then(t=>t?new yt(this,t):null)}}class lh extends Hf{constructor(e){super(),this.firestore=e}convertBytes(e){return new bl(new qn(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Kt.forKey(t,this.firestore,null)}}class qm{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new lh(e)}get(e){const t=ro(e);return this._delegate.get(t).then(r=>new Cl(this._firestore,new Or(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=ro(e);return r?(Zf("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const o=ro(e);return 2===arguments.length?this._delegate.update(o,t):this._delegate.update(o,t,r,...i),this}delete(e){const t=ro(e);return this._delegate.delete(t),this}}class jm{constructor(e){this._delegate=e}set(e,t,r){const i=ro(e);return r?(Zf("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const o=ro(e);return 2===arguments.length?this._delegate.update(o,t):this._delegate.update(o,t,r,...i),this}delete(e){const t=ro(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class no{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new Tl(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Sl(this._firestore,r),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=no.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let o=i.get(t);return o||(o=new no(e,new lh(e),t),i.set(t,o)),o}}no.INSTANCES=new WeakMap;class Kt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new lh(e)}static forPath(e,t,r){if(e.length%2!=0)throw new N("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Kt(t,new Ie(t._delegate,r,new P(e)))}static forKey(e,t,r){return new Kt(t,new Ie(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Fa(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Fa(this.firestore,dm(this._delegate,e))}catch(t){throw mt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,W.m9)(e))instanceof Ie&&fm(this._delegate,e)}set(e,t){t=Zf("DocumentReference.set",t);try{return t?Pm(this._delegate,e,t):Pm(this._delegate,e)}catch(r){throw mt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?Vm(this._delegate,e):Vm(this._delegate,e,t,...r)}catch(i){throw mt(i,"updateDoc()","DocumentReference.update()")}}delete(){return function II(n){return La(re(n.firestore,Ce),[new tl(n._key,Be.none())])}(this._delegate)}onSnapshot(...e){const t=$m(e),r=Wm(e,i=>new Cl(this.firestore,new Or(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Lm(this._delegate,t,r)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function gI(n){n=re(n,Ie);const e=re(n.firestore,Ce),t=qe(e),r=new to(e);return function Dv(n,e){const t=new De;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(i,o,u){try{const h=yield function(m,_){const w=L(m);return w.persistence.runTransaction("read document","readonly",E=>w.ci.Ls(E,_))}(i,o);h.isFoundDocument()?u.resolve(h):h.isNoDocument()?u.resolve(null):u.reject(new N(b.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(h){const m=Ra(h,`Failed to get document '${o} from cache`);u.reject(m)}}),function(i,o,u){return r.apply(this,arguments)})(yield Lf(n),e,t);var r})),t.promise}(t,n._key).then(i=>new Or(e,r,n._key,i,new eo(null!==i&&i.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function mI(n){n=re(n,Ie);const e=re(n.firestore,Ce);return im(qe(e),n._key,{source:"server"}).then(t=>zf(e,n,t))}(this._delegate):function pI(n){n=re(n,Ie);const e=re(n.firestore,Ce);return im(qe(e),n._key).then(t=>zf(e,n,t))}(this._delegate),t.then(r=>new Cl(this.firestore,new Or(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Kt(this.firestore,this._delegate.withConverter(e?no.getInstance(this.firestore,e):null))}}function mt(n,e,t){return n.message=n.message.replace(e,t),n}function $m(n){for(const e of n)if("object"==typeof e&&!Yf(e))return e;return{}}function Wm(n,e){var t,r;let i;return i=Yf(n[0])?n[0]:Yf(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:o=>{i.next&&i.next(e(o))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Cl{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Kt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return bm(this._delegate,e._delegate)}}class Sl extends Cl{data(e){const t=this._delegate.data(e);return function Gu(n,e){n||q()}(void 0!==t),t}}class yt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new lh(e)}where(e,t,r){try{return new yt(this.firestore,Ri(this._delegate,function iI(n,e,t){const r=e,i=ah("where",n);return new rI(i,r,t)}(e,t,r)))}catch(i){throw mt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new yt(this.firestore,Ri(this._delegate,function oI(n,e="asc"){const t=e,r=ah("orderBy",n);return new sI(r,t)}(e,t)))}catch(r){throw mt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new yt(this.firestore,Ri(this._delegate,function aI(n){return cm("limit",n),new Sm("limit",n,"F")}(e)))}catch(t){throw mt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new yt(this.firestore,Ri(this._delegate,function uI(n){return cm("limitToLast",n),new Sm("limitToLast",n,"L")}(e)))}catch(t){throw mt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new yt(this.firestore,Ri(this._delegate,function lI(...n){return new xm("startAt",n,!0)}(...e)))}catch(t){throw mt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new yt(this.firestore,Ri(this._delegate,function cI(...n){return new xm("startAfter",n,!1)}(...e)))}catch(t){throw mt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new yt(this.firestore,Ri(this._delegate,function hI(...n){return new Dm("endBefore",n,!1)}(...e)))}catch(t){throw mt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new yt(this.firestore,Ri(this._delegate,function dI(...n){return new Dm("endAt",n,!0)}(...e)))}catch(t){throw mt(t,"endAt()","Query.endAt()")}}isEqual(e){return pm(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function _I(n){n=re(n,ot);const e=re(n.firestore,Ce),t=qe(e),r=new to(e);return function kv(n,e){const t=new De;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(i,o,u){try{const h=yield Kc(i,o,!0),m=new Wg(o,h.li),_=m.Gu(h.documents),w=m.applyChanges(_,!1);u.resolve(w.snapshot)}catch(h){const m=Ra(h,`Failed to execute query '${o} against cache`);u.reject(m)}}),function(i,o,u){return r.apply(this,arguments)})(yield Lf(n),e,t);var r})),t.promise}(t,n._query).then(i=>new Ni(e,r,n,i))}(this._delegate):"server"===(null==e?void 0:e.source)?function vI(n){n=re(n,ot);const e=re(n.firestore,Ce),t=qe(e),r=new to(e);return sm(t,n._query,{source:"server"}).then(i=>new Ni(e,r,n,i))}(this._delegate):function yI(n){n=re(n,ot);const e=re(n.firestore,Ce),t=qe(e),r=new to(e);return Cm(n._query),sm(t,n._query).then(i=>new Ni(e,r,n,i))}(this._delegate),t.then(r=>new Qf(this.firestore,new Ni(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=$m(e),r=Wm(e,i=>new Qf(this.firestore,new Ni(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Lm(this._delegate,t,r)}withConverter(e){return new yt(this.firestore,this._delegate.withConverter(e?no.getInstance(this.firestore,e):null))}}class PI{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Sl(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Qf{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new yt(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Sl(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new PI(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Sl(this._firestore,r))})}isEqual(e){return bm(this._delegate,e._delegate)}}class Fa extends yt{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Kt(this.firestore,e):null}doc(e){try{return new Kt(this.firestore,void 0===e?th(this._delegate):th(this._delegate,e))}catch(t){throw mt(t,"doc()","CollectionReference.doc()")}}add(e){return function wI(n,e){const t=re(n.firestore,Ce),r=th(n),i=uh(n.converter,e);return La(t,[ih(Js(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,Be.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new Kt(this.firestore,t))}isEqual(e){return fm(this._delegate,e._delegate)}withConverter(e){return new Fa(this.firestore,this._delegate.withConverter(e?no.getInstance(this.firestore,e):null))}}function ro(n){return re(n,Ie)}class Jf{constructor(...e){this._delegate=new Rr(...e)}static documentId(){return new Jf(be.keyField().canonicalString())}isEqual(e){return(e=(0,W.m9)(e))instanceof Rr&&this._delegate._internalPath.isEqual(e._internalPath)}}class io{constructor(e){this._delegate=e}static serverTimestamp(){const e=function CI(){return new qf("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new io(e)}static delete(){const e=function bI(){return new wl("deleteField")}();return e._methodName="FieldValue.delete",new io(e)}static arrayUnion(...e){const t=function SI(...n){return new Qv("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new io(t)}static arrayRemove(...e){const t=function xI(...n){return new Jv("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new io(t)}static increment(e){const t=function DI(n){return new Xv("increment",n)}(e);return t._methodName="FieldValue.increment",new io(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const VI={Firestore:Gm,GeoPoint:nh,Timestamp:Ae,Blob:bl,Transaction:qm,WriteBatch:jm,DocumentReference:Kt,DocumentSnapshot:Cl,Query:yt,QueryDocumentSnapshot:Sl,QuerySnapshot:Qf,CollectionReference:Fa,FieldPath:Jf,FieldValue:io,setLogLevel:function MI(n){!function Wh(n){On.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};function Km(n,e){return function UI(n,e=Xr.z){return new Ht.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=r&&r()}})}(n,e)}function Xf(n,e){return Km(n,e).pipe((0,nt.U)(t=>({payload:t,type:"query"})))}function ch(n,e){return Xf(n,e).pipe((0,ei.O)(void 0),dr(),(0,nt.U)(([t,r])=>{const i=r.payload.docChanges(),o=i.map(u=>({type:u.type,payload:u}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((u,h)=>{const m=i.find(w=>w.doc.ref.isEqual(u.ref)),_=null==t?void 0:t.payload.docs.find(w=>w.ref.isEqual(u.ref));m&&JSON.stringify(m.doc.metadata)===JSON.stringify(u.metadata)||!m&&_&&JSON.stringify(_.metadata)===JSON.stringify(u.metadata)||o.push({type:"modified",payload:{oldIndex:h,newIndex:h,type:"modified",doc:u}})}),o}))}function Hm(n,e,t){return ch(n,t).pipe((0,Et.R)((r,i)=>function GI(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function qI(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return ep(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return ep(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return ep(n,e.oldIndex,1)}return n}(n,r))}),n}(r,i.map(o=>o.payload),e),[]),function ti(n,e=Ja.y){return n=null!=n?n:ns,(0,cr.e)((t,r)=>{let i,o=!0;t.subscribe((0,hr.x)(r,u=>{const h=e(u);(o||!n(i,h))&&(o=!1,i=h,r.next(u))}))})}(),(0,nt.U)(r=>r.map(i=>({type:i.type,payload:i}))))}function ep(n,e,t,...r){const i=n.slice();return i.splice(e,t,...r),i}function zm(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}!function FI(n){(function LI(n,e){n.INTERNAL.registerComponent(new Kn.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},VI)))})(n,(e,t)=>new Gm(e,t,new OI)),n.registerVersion("@firebase/firestore-compat","0.1.17")}(ni.Z);class Zm{constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=ch(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,nt.U)(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,ei.O)(void 0),dr(),(0,Vr.h)(([r,i])=>i.length>0||!r),(0,nt.U)(([r,i])=>i),Se.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Et.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=zm(e);return Hm(this.query,t,this.afs.schedulers.outsideAngular).pipe(Se.iC)}valueChanges(e={}){return Xf(this.query,this.afs.schedulers.outsideAngular).pipe((0,nt.U)(t=>t.payload.docs.map(r=>e.idField?Object.assign(Object.assign({},r.data()),{[e.idField]:r.id}):r.data())),Se.iC)}get(e){return(0,bt.D)(this.query.get(e)).pipe(Se.iC)}add(e){return this.ref.add(e)}doc(e){return new Ym(this.ref.doc(e),this.afs)}}class Ym{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:i,query:o}=Qm(r,t);return new Zm(i,o,this.afs)}snapshotChanges(){return function BI(n,e){return Km(n,e).pipe((0,ei.O)(void 0),dr(),(0,nt.U)(([t,r])=>r.exists?(null==t?void 0:t.exists)?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Se.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,nt.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,bt.D)(this.ref.get(e)).pipe(Se.iC)}}class jI{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?ch(this.query,this.afs.schedulers.outsideAngular).pipe((0,nt.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,Vr.h)(t=>t.length>0),Se.iC):ch(this.query,this.afs.schedulers.outsideAngular).pipe(Se.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Et.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=zm(e);return Hm(this.query,t,this.afs.schedulers.outsideAngular).pipe(Se.iC)}valueChanges(e={}){return Xf(this.query,this.afs.schedulers.outsideAngular).pipe((0,nt.U)(r=>r.payload.docs.map(i=>e.idField?Object.assign({[e.idField]:i.id},i.data()):i.data())),Se.iC)}get(e){return(0,bt.D)(this.query.get(e)).pipe(Se.iC)}}const $I=new $.OlP("angularfire2.enableFirestorePersistence"),WI=new $.OlP("angularfire2.firestore.persistenceSettings"),KI=new $.OlP("angularfire2.firestore.settings"),HI=new $.OlP("angularfire2.firestore.use-emulator");function Qm(n,e=(t=>t)){return{query:e(n),ref:n}}let zI=(()=>{class n{constructor(t,r,i,o,u,h,m,_,w,E,A,D,k,F,Y,de,we){this.schedulers=m;const ae=(0,se.on)(t,h,r),te=w;E&&Jr(ae,h,A,k,F,Y,D,de),[this.firestore,this.persistenceEnabled$]=(0,se.cc)(`${ae.name}.firestore`,"AngularFirestore",ae.name,()=>{const ie=h.runOutsideAngular(()=>ae.firestore());if(o&&ie.settings(o),te&&ie.useEmulator(...te),i&&!(0,fe.PM)(u)){const ce=()=>{try{return(0,bt.D)(ie.enablePersistence(_||void 0).then(()=>!0,()=>!1))}catch(at){return"undefined"!=typeof console&&console.warn(at),(0,je.of)(!1)}};return[ie,h.runOutsideAngular(ce)]}return[ie,(0,je.of)(!1)]},[o,te,i])}collection(t,r){let i;i="string"==typeof t?this.firestore.collection(t):t;const{ref:o,query:u}=Qm(i,r),h=this.schedulers.ngZone.run(()=>o);return new Zm(h,u,this)}collectionGroup(t,r){const i=r||(u=>u),o=this.firestore.collectionGroup(t);return new jI(i(o),this)}doc(t){let r;r="string"==typeof t?this.firestore.doc(t):t;const i=this.schedulers.ngZone.run(()=>r);return new Ym(i,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)($.LFG(se.Dh),$.LFG(se.xv,8),$.LFG($I,8),$.LFG(KI,8),$.LFG($.Lbi),$.LFG($.R0b),$.LFG(Se.HU),$.LFG(WI,8),$.LFG(HI,8),$.LFG(lr,8),$.LFG(Xi,8),$.LFG(es,8),$.LFG(on,8),$.LFG(ur,8),$.LFG(bn,8),$.LFG(ts,8),$.LFG(bo,8))},n.\u0275prov=$.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})(),ZI=(()=>{class n{constructor(t,r){this.afauth=t,this.fireStore=r}login(t,r){var i=this;return(0,p.Z)(function*(){try{return yield i.afauth.signInWithEmailAndPassword(t,r)}catch(o){throw o}})()}agregarActor(t){return this.fireStore.collection("actoresCollection").add(JSON.parse(JSON.stringify(t)))}traerColeccion(t){var r=this;return(0,p.Z)(function*(){return yield r.fireStore.collection(t).snapshotChanges()})()}}return n.\u0275fac=function(t){return new(t||n)($.LFG(lr),$.LFG(zI))},n.\u0275prov=$.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()},820:(hh,Mi,K)=>{K.r(Mi);var p=K(5861),$=K(3942),R=K(2090),je=K(9681),Ht=K(655),bt=K(1877),Mr=K(4859);const _t=function oo(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},Ua=function Ct(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Pr=new R.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Vr=new bt.Yd("@firebase/auth");function Se(l,...s){Vr.logLevel<=bt.in.ERROR&&Vr.error(`Auth (${je.SDK_VERSION}): ${l}`,...s)}function se(l,...s){throw vt(l,...s)}function fe(l,...s){return vt(l,...s)}function Lr(l,s,a){const c=Object.assign(Object.assign({},Ua()),{[s]:a});return new R.LL("auth","Firebase",c).create(s,{appName:l.name})}function pe(l,s,a){if(!(s instanceof a))throw a.name!==s.constructor.name&&se(l,"argument-error"),Lr(l,"argument-error",`Type of ${s.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function vt(l,...s){if("string"!=typeof l){const a=s[0],c=[...s.slice(1)];return c[0]&&(c[0].appName=l.name),l._errorFactory.create(a,...c)}return Pr.create(l,...s)}function O(l,s,...a){if(!l)throw vt(s,...a)}function St(l){const s="INTERNAL ASSERTION FAILED: "+l;throw Se(s),new Error(s)}function He(l,s){l||St(s)}const uo=new Map;function Je(l){He(l instanceof Function,"Expected a class definition");let s=uo.get(l);return s?(He(s instanceof l,"Instance stored in cache mismatched with class"),s):(s=new l,uo.set(l,s),s)}function $n(){var l;return"undefined"!=typeof self&&(null===(l=self.location)||void 0===l?void 0:l.href)||""}function Pi(){return"http:"===ho()||"https:"===ho()}function ho(){var l;return"undefined"!=typeof self&&(null===(l=self.location)||void 0===l?void 0:l.protocol)||null}class Wn{constructor(s,a){this.shortDelay=s,this.longDelay=a,He(a>s,"Short delay should be less than long delay!"),this.isMobile=(0,R.uI)()||(0,R.b$)()}get(){return function Vi(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Pi()||(0,R.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Li(l,s){He(l.emulator,"Emulator should always be set here");const{url:a}=l.emulator;return s?`${a}${s.startsWith("/")?s.slice(1):s}`:a}class fo{static initialize(s,a,c){this.fetchImpl=s,a&&(this.headersImpl=a),c&&(this.responseImpl=c)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void St("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void St("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void St("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const zt={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Kn=new Wn(3e4,6e4);function W(l,s){return l.tenantId&&!s.tenantId?Object.assign(Object.assign({},s),{tenantId:l.tenantId}):s}function ue(l,s,a,c){return Hn.apply(this,arguments)}function Hn(){return(Hn=(0,p.Z)(function*(l,s,a,c,y={}){return Fr(l,y,(0,p.Z)(function*(){let I={},T={};c&&("GET"===s?T=c:I={body:JSON.stringify(c)});const C=(0,R.xO)(Object.assign({key:l.config.apiKey},T)).slice(1),V=yield l._getAdditionalHeaders();return V["Content-Type"]="application/json",l.languageCode&&(V["X-Firebase-Locale"]=l.languageCode),fo.fetch()(Zt(l,l.config.apiHost,a,C),Object.assign({method:s,headers:V,referrerPolicy:"no-referrer"},I))}))})).apply(this,arguments)}function Fr(l,s,a){return Ur.apply(this,arguments)}function Ur(){return(Ur=(0,p.Z)(function*(l,s,a){l._canInitEmulator=!1;const c=Object.assign(Object.assign({},zt),s);try{const y=new pn(l),I=yield Promise.race([a(),y.promise]);y.clearNetworkTimeout();const T=yield I.json();if("needConfirmation"in T)throw zn(l,"account-exists-with-different-credential",T);if(I.ok&&!("errorMessage"in T))return T;{const C=I.ok?T.errorMessage:T.error.message,[V,j]=C.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===V)throw zn(l,"credential-already-in-use",T);if("EMAIL_EXISTS"===V)throw zn(l,"email-already-in-use",T);const G=c[V]||V.toLowerCase().replace(/[_\s]+/g,"-");if(j)throw Lr(l,G,j);se(l,G)}}catch(y){if(y instanceof R.ZR)throw y;se(l,"network-request-failed")}})).apply(this,arguments)}function le(l,s,a,c){return ze.apply(this,arguments)}function ze(){return(ze=(0,p.Z)(function*(l,s,a,c,y={}){const I=yield ue(l,s,a,c,y);return"mfaPendingCredential"in I&&se(l,"multi-factor-auth-required",{_serverResponse:I}),I})).apply(this,arguments)}function Zt(l,s,a,c){const y=`${s}${a}?${c}`;return l.config.emulator?Li(l.config,y):`${l.config.apiScheme}://${y}`}class pn{constructor(s){this.auth=s,this.timer=null,this.promise=new Promise((a,c)=>{this.timer=setTimeout(()=>c(fe(this.auth,"network-request-failed")),Kn.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function zn(l,s,a){const c={appName:l.name};a.email&&(c.email=a.email),a.phoneNumber&&(c.phoneNumber=a.phoneNumber);const y=fe(l,s,c);return y.customData._tokenResponse=a,y}function Br(){return(Br=(0,p.Z)(function*(l,s){return ue(l,"POST","/v1/accounts:delete",s)})).apply(this,arguments)}function xt(l,s){return Me.apply(this,arguments)}function Me(){return(Me=(0,p.Z)(function*(l,s){return ue(l,"POST","/v1/accounts:update",s)})).apply(this,arguments)}function go(l,s){return mo.apply(this,arguments)}function mo(){return(mo=(0,p.Z)(function*(l,s){return ue(l,"POST","/v1/accounts:lookup",s)})).apply(this,arguments)}function Gr(l){if(l)try{const s=new Date(Number(l));if(!isNaN(s.getTime()))return s.toUTCString()}catch(s){}}function gn(){return(gn=(0,p.Z)(function*(l,s=!1){const a=(0,R.m9)(l),c=yield a.getIdToken(s),y=yn(c);O(y&&y.exp&&y.auth_time&&y.iat,a.auth,"internal-error");const I="object"==typeof y.firebase?y.firebase:void 0,T=null==I?void 0:I.sign_in_provider;return{claims:y,token:c,authTime:Gr(mn(y.auth_time)),issuedAtTime:Gr(mn(y.iat)),expirationTime:Gr(mn(y.exp)),signInProvider:T||null,signInSecondFactor:(null==I?void 0:I.sign_in_second_factor)||null}})).apply(this,arguments)}function mn(l){return 1e3*Number(l)}function yn(l){const[s,a,c]=l.split(".");if(void 0===s||void 0===a||void 0===c)return Se("JWT malformed, contained fewer than 3 sections"),null;try{const y=(0,R.tV)(a);return y?JSON.parse(y):(Se("Failed to decode base64 JWT payload"),null)}catch(y){return Se("Caught error parsing JWT payload as JSON",y),null}}function ut(l,s){return jr.apply(this,arguments)}function jr(){return(jr=(0,p.Z)(function*(l,s,a=!1){if(a)return s;try{return yield s}catch(c){throw c instanceof R.ZR&&Dl(c)&&l.auth.currentUser===l&&(yield l.auth.signOut()),c}})).apply(this,arguments)}function Dl({code:l}){return"auth/user-disabled"===l||"auth/user-token-expired"===l}class kl{constructor(s){this.user=s,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(s){var a;if(s){const c=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),c}{this.errorBackoff=3e4;const y=(null!==(a=this.user.stsTokenManager.expirationTime)&&void 0!==a?a:0)-Date.now()-3e5;return Math.max(0,y)}}schedule(s=!1){var a=this;if(!this.isRunning)return;const c=this.getInterval(s);this.timerId=setTimeout((0,p.Z)(function*(){yield a.iteration()}),c)}iteration(){var s=this;return(0,p.Z)(function*(){try{yield s.user.getIdToken(!0)}catch(a){return void("auth/network-request-failed"===a.code&&s.schedule(!0))}s.schedule()})()}}class Ga{constructor(s,a){this.createdAt=s,this.lastLoginAt=a,this._initializeTime()}_initializeTime(){this.lastSignInTime=Gr(this.lastLoginAt),this.creationTime=Gr(this.createdAt)}_copy(s){this.createdAt=s.createdAt,this.lastLoginAt=s.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function $r(l){return yo.apply(this,arguments)}function yo(){return(yo=(0,p.Z)(function*(l){var s;const a=l.auth,c=yield l.getIdToken(),y=yield ut(l,go(a,{idToken:c}));O(null==y?void 0:y.users.length,a,"internal-error");const I=y.users[0];l._notifyReloadListener(I);const T=(null===(s=I.providerUserInfo)||void 0===s?void 0:s.length)?_o(I.providerUserInfo):[],C=Wr(l.providerData,T),G=!!l.isAnonymous&&!(l.email&&I.passwordHash||(null==C?void 0:C.length)),H={uid:I.localId,displayName:I.displayName||null,photoURL:I.photoUrl||null,email:I.email||null,emailVerified:I.emailVerified||!1,phoneNumber:I.phoneNumber||null,tenantId:I.tenantId||null,providerData:C,metadata:new Ga(I.createdAt,I.lastLoginAt),isAnonymous:G};Object.assign(l,H)})).apply(this,arguments)}function Yn(){return(Yn=(0,p.Z)(function*(l){const s=(0,R.m9)(l);yield $r(s),yield s.auth._persistUserIfCurrent(s),s.auth._notifyListenersIfCurrent(s)})).apply(this,arguments)}function Wr(l,s){return[...l.filter(c=>!s.some(y=>y.providerId===c.providerId)),...s]}function _o(l){return l.map(s=>{var{providerId:a}=s,c=(0,Ht._T)(s,["providerId"]);return{providerId:a,uid:c.rawId||"",displayName:c.displayName||null,email:c.email||null,phoneNumber:c.phoneNumber||null,photoURL:c.photoUrl||null}})}function vn(){return(vn=(0,p.Z)(function*(l,s){const a=yield Fr(l,{},(0,p.Z)(function*(){const c=(0,R.xO)({grant_type:"refresh_token",refresh_token:s}).slice(1),{tokenApiHost:y,apiKey:I}=l.config,T=Zt(l,y,"/v1/token",`key=${I}`),C=yield l._getAdditionalHeaders();return C["Content-Type"]="application/x-www-form-urlencoded",fo.fetch()(T,{method:"POST",headers:C,body:c})}));return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}})).apply(this,arguments)}class Dt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(s){O(s.idToken,"internal-error"),O(void 0!==s.idToken,"internal-error"),O(void 0!==s.refreshToken,"internal-error");const a="expiresIn"in s&&void 0!==s.expiresIn?Number(s.expiresIn):function _n(l){const s=yn(l);return O(s,"internal-error"),O(void 0!==s.exp,"internal-error"),O(void 0!==s.iat,"internal-error"),Number(s.exp)-Number(s.iat)}(s.idToken);this.updateTokensAndExpiration(s.idToken,s.refreshToken,a)}getToken(s,a=!1){var c=this;return(0,p.Z)(function*(){return O(!c.accessToken||c.refreshToken,s,"user-token-expired"),a||!c.accessToken||c.isExpired?c.refreshToken?(yield c.refresh(s,c.refreshToken),c.accessToken):null:c.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(s,a){var c=this;return(0,p.Z)(function*(){const{accessToken:y,refreshToken:I,expiresIn:T}=yield function qa(l,s){return vn.apply(this,arguments)}(s,a);c.updateTokensAndExpiration(y,I,Number(T))})()}updateTokensAndExpiration(s,a,c){this.refreshToken=a||null,this.accessToken=s||null,this.expirationTime=Date.now()+1e3*c}static fromJSON(s,a){const{refreshToken:c,accessToken:y,expirationTime:I}=a,T=new Dt;return c&&(O("string"==typeof c,"internal-error",{appName:s}),T.refreshToken=c),y&&(O("string"==typeof y,"internal-error",{appName:s}),T.accessToken=y),I&&(O("number"==typeof I,"internal-error",{appName:s}),T.expirationTime=I),T}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(s){this.accessToken=s.accessToken,this.refreshToken=s.refreshToken,this.expirationTime=s.expirationTime}_clone(){return Object.assign(new Dt,this.toJSON())}_performRefresh(){return St("not implemented")}}function lt(l,s){O("string"==typeof l||void 0===l,"internal-error",{appName:s})}class ct{constructor(s){var{uid:a,auth:c,stsTokenManager:y}=s,I=(0,Ht._T)(s,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new kl(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=c,this.stsTokenManager=y,this.accessToken=y.accessToken,this.displayName=I.displayName||null,this.email=I.email||null,this.emailVerified=I.emailVerified||!1,this.phoneNumber=I.phoneNumber||null,this.photoURL=I.photoURL||null,this.isAnonymous=I.isAnonymous||!1,this.tenantId=I.tenantId||null,this.providerData=I.providerData?[...I.providerData]:[],this.metadata=new Ga(I.createdAt||void 0,I.lastLoginAt||void 0)}getIdToken(s){var a=this;return(0,p.Z)(function*(){const c=yield ut(a,a.stsTokenManager.getToken(a.auth,s));return O(c,a.auth,"internal-error"),a.accessToken!==c&&(a.accessToken=c,yield a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)),c})()}getIdTokenResult(s){return function qr(l){return gn.apply(this,arguments)}(this,s)}reload(){return function Zn(l){return Yn.apply(this,arguments)}(this)}_assign(s){this!==s&&(O(this.uid===s.uid,this.auth,"internal-error"),this.displayName=s.displayName,this.photoURL=s.photoURL,this.email=s.email,this.emailVerified=s.emailVerified,this.phoneNumber=s.phoneNumber,this.isAnonymous=s.isAnonymous,this.tenantId=s.tenantId,this.providerData=s.providerData.map(a=>Object.assign({},a)),this.metadata._copy(s.metadata),this.stsTokenManager._assign(s.stsTokenManager))}_clone(s){return new ct(Object.assign(Object.assign({},this),{auth:s,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(s){O(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=s,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(s){this.reloadListener?this.reloadListener(s):this.reloadUserInfo=s}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(s,a=!1){var c=this;return(0,p.Z)(function*(){let y=!1;s.idToken&&s.idToken!==c.stsTokenManager.accessToken&&(c.stsTokenManager.updateFromServerResponse(s),y=!0),a&&(yield $r(c)),yield c.auth._persistUserIfCurrent(c),y&&c.auth._notifyListenersIfCurrent(c)})()}delete(){var s=this;return(0,p.Z)(function*(){const a=yield s.getIdToken();return yield ut(s,function po(l,s){return Br.apply(this,arguments)}(s.auth,{idToken:a})),s.stsTokenManager.clearRefreshToken(),s.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(s=>Object.assign({},s)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(s,a){var c,y,I,T,C,V,j,G;const H=null!==(c=a.displayName)&&void 0!==c?c:void 0,J=null!==(y=a.email)&&void 0!==y?y:void 0,st=null!==(I=a.phoneNumber)&&void 0!==I?I:void 0,Ii=null!==(T=a.photoURL)&&void 0!==T?T:void 0,Fn=null!==(C=a.tenantId)&&void 0!==C?C:void 0,wi=null!==(V=a._redirectEventId)&&void 0!==V?V:void 0,Ei=null!==(j=a.createdAt)&&void 0!==j?j:void 0,Hu=null!==(G=a.lastLoginAt)&&void 0!==G?G:void 0,{uid:zu,emailVerified:jt,isAnonymous:Sc,providerData:Zu,stsTokenManager:Yu}=a;O(zu&&Yu,s,"internal-error");const Dr=Dt.fromJSON(this.name,Yu);O("string"==typeof zu,s,"internal-error"),lt(H,s.name),lt(J,s.name),O("boolean"==typeof jt,s,"internal-error"),O("boolean"==typeof Sc,s,"internal-error"),lt(st,s.name),lt(Ii,s.name),lt(Fn,s.name),lt(wi,s.name),lt(Ei,s.name),lt(Hu,s.name);const Qu=new ct({uid:zu,auth:s,email:J,emailVerified:jt,displayName:H,isAnonymous:Sc,photoURL:Ii,phoneNumber:st,tenantId:Fn,stsTokenManager:Dr,createdAt:Ei,lastLoginAt:Hu});return Zu&&Array.isArray(Zu)&&(Qu.providerData=Zu.map(Fs=>Object.assign({},Fs))),wi&&(Qu._redirectEventId=wi),Qu}static _fromIdTokenResponse(s,a,c=!1){return(0,p.Z)(function*(){const y=new Dt;y.updateFromServerResponse(a);const I=new ct({uid:a.localId,auth:s,stsTokenManager:y,isAnonymous:c});return yield $r(I),I})()}}const kt=(()=>{class l{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,p.Z)(function*(){return!0})()}_set(a,c){var y=this;return(0,p.Z)(function*(){y.storage[a]=c})()}_get(a){var c=this;return(0,p.Z)(function*(){const y=c.storage[a];return void 0===y?null:y})()}_remove(a){var c=this;return(0,p.Z)(function*(){delete c.storage[a]})()}_addListener(a,c){}_removeListener(a,c){}}return l.type="NONE",l})();function rt(l,s,a){return`firebase:${l}:${s}:${a}`}class Yt{constructor(s,a,c){this.persistence=s,this.auth=a,this.userKey=c;const{config:y,name:I}=this.auth;this.fullUserKey=rt(this.userKey,y.apiKey,I),this.fullPersistenceKey=rt("persistence",y.apiKey,I),this.boundEventHandler=a._onStorageEvent.bind(a),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(s){return this.persistence._set(this.fullUserKey,s.toJSON())}getCurrentUser(){var s=this;return(0,p.Z)(function*(){const a=yield s.persistence._get(s.fullUserKey);return a?ct._fromJSON(s.auth,a):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(s){var a=this;return(0,p.Z)(function*(){if(a.persistence===s)return;const c=yield a.getCurrentUser();return yield a.removeCurrentUser(),a.persistence=s,c?a.setCurrentUser(c):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(s,a,c="authUser"){return(0,p.Z)(function*(){if(!a.length)return new Yt(Je(kt),s,c);const y=(yield Promise.all(a.map(function(){var j=(0,p.Z)(function*(G){if(yield G._isAvailable())return G});return function(G){return j.apply(this,arguments)}}()))).filter(j=>j);let I=y[0]||Je(kt);const T=rt(c,s.config.apiKey,s.name);let C=null;for(const j of a)try{const G=yield j._get(T);if(G){const H=ct._fromJSON(s,G);j!==I&&(C=H),I=j;break}}catch(G){}const V=y.filter(j=>j._shouldAllowMigration);return I._shouldAllowMigration&&V.length?(I=V[0],C&&(yield I._set(T,C.toJSON())),yield Promise.all(a.map(function(){var j=(0,p.Z)(function*(G){if(G!==I)try{yield G._remove(T)}catch(H){}});return function(G){return j.apply(this,arguments)}}())),new Yt(I,s,c)):new Yt(I,s,c)})()}}function In(l){const s=l.toLowerCase();if(s.includes("opera/")||s.includes("opr/")||s.includes("opios/"))return"Opera";if(Io(s))return"IEMobile";if(s.includes("msie")||s.includes("trident/"))return"IE";if(s.includes("edge/"))return"Edge";if(Fi(s))return"Firefox";if(s.includes("silk/"))return"Silk";if(Ui(s))return"Blackberry";if(Hr(s))return"Webos";if(Qn(s))return"Safari";if((s.includes("chrome/")||Kr(s))&&!s.includes("edge/"))return"Chrome";if(wn(s))return"Android";{const c=l.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==c?void 0:c.length))return c[1]}return"Other"}function Fi(l=(0,R.z$)()){return/firefox\//i.test(l)}function Qn(l=(0,R.z$)()){const s=l.toLowerCase();return s.includes("safari/")&&!s.includes("chrome/")&&!s.includes("crios/")&&!s.includes("android")}function Kr(l=(0,R.z$)()){return/crios\//i.test(l)}function Io(l=(0,R.z$)()){return/iemobile/i.test(l)}function wn(l=(0,R.z$)()){return/android/i.test(l)}function Ui(l=(0,R.z$)()){return/blackberry/i.test(l)}function Hr(l=(0,R.z$)()){return/webos/i.test(l)}function Qt(l=(0,R.z$)()){return/iphone|ipad|ipod/i.test(l)}function Jt(l=(0,R.z$)()){return Qt(l)||wn(l)||Hr(l)||Ui(l)||/windows phone/i.test(l)||Io(l)}function Gi(l,s=[]){let a;switch(l){case"Browser":a=In((0,R.z$)());break;case"Worker":a=`${In((0,R.z$)())}-${l}`;break;default:a=l}const c=s.length?s.join(","):"FirebaseCore-web";return`${a}/JsCore/${je.SDK_VERSION}/${c}`}class Xn{constructor(s,a,c){this.app=s,this.heartbeatServiceProvider=a,this.config=c,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new er(this),this.idTokenSubscription=new er(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Pr,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=s.name,this.clientVersion=c.sdkClientVersion}_initializeWithPersistence(s,a){var c=this;return a&&(this._popupRedirectResolver=Je(a)),this._initializationPromise=this.queue((0,p.Z)(function*(){var y,I;if(!c._deleted&&(c.persistenceManager=yield Yt.create(c,s),!c._deleted)){if(null===(y=c._popupRedirectResolver)||void 0===y?void 0:y._shouldInitProactively)try{yield c._popupRedirectResolver._initialize(c)}catch(T){}yield c.initializeCurrentUser(a),c.lastNotifiedUid=(null===(I=c.currentUser)||void 0===I?void 0:I.uid)||null,!c._deleted&&(c._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var s=this;return(0,p.Z)(function*(){if(s._deleted)return;const a=yield s.assertedPersistence.getCurrentUser();if(s.currentUser||a){if(s.currentUser&&a&&s.currentUser.uid===a.uid)return s._currentUser._assign(a),void(yield s.currentUser.getIdToken());yield s._updateCurrentUser(a)}})()}initializeCurrentUser(s){var a=this;return(0,p.Z)(function*(){var c;let y=yield a.assertedPersistence.getCurrentUser();if(s&&a.config.authDomain){yield a.getOrInitRedirectPersistenceManager();const I=null===(c=a.redirectUser)||void 0===c?void 0:c._redirectEventId,T=null==y?void 0:y._redirectEventId,C=yield a.tryRedirectSignIn(s);(!I||I===T)&&(null==C?void 0:C.user)&&(y=C.user)}return y?y._redirectEventId?(O(a._popupRedirectResolver,a,"argument-error"),yield a.getOrInitRedirectPersistenceManager(),a.redirectUser&&a.redirectUser._redirectEventId===y._redirectEventId?a.directlySetCurrentUser(y):a.reloadAndSetCurrentUserOrClear(y)):a.reloadAndSetCurrentUserOrClear(y):a.directlySetCurrentUser(null)})()}tryRedirectSignIn(s){var a=this;return(0,p.Z)(function*(){let c=null;try{c=yield a._popupRedirectResolver._completeRedirectFn(a,s,!0)}catch(y){yield a._setRedirectUser(null)}return c})()}reloadAndSetCurrentUserOrClear(s){var a=this;return(0,p.Z)(function*(){try{yield $r(s)}catch(c){if("auth/network-request-failed"!==c.code)return a.directlySetCurrentUser(null)}return a.directlySetCurrentUser(s)})()}useDeviceLanguage(){this.languageCode=function Ba(){if("undefined"==typeof navigator)return null;const l=navigator;return l.languages&&l.languages[0]||l.language||null}()}_delete(){var s=this;return(0,p.Z)(function*(){s._deleted=!0})()}updateCurrentUser(s){var a=this;return(0,p.Z)(function*(){const c=s?(0,R.m9)(s):null;return c&&O(c.auth.config.apiKey===a.config.apiKey,a,"invalid-user-token"),a._updateCurrentUser(c&&c._clone(a))})()}_updateCurrentUser(s){var a=this;return(0,p.Z)(function*(){if(!a._deleted)return s&&O(a.tenantId===s.tenantId,a,"tenant-id-mismatch"),a.queue((0,p.Z)(function*(){yield a.directlySetCurrentUser(s),a.notifyAuthListeners()}))})()}signOut(){var s=this;return(0,p.Z)(function*(){return(s.redirectPersistenceManager||s._popupRedirectResolver)&&(yield s._setRedirectUser(null)),s._updateCurrentUser(null)})()}setPersistence(s){var a=this;return this.queue((0,p.Z)(function*(){yield a.assertedPersistence.setPersistence(Je(s))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(s){this._errorFactory=new R.LL("auth","Firebase",s())}onAuthStateChanged(s,a,c){return this.registerStateListener(this.authStateSubscription,s,a,c)}onIdTokenChanged(s,a,c){return this.registerStateListener(this.idTokenSubscription,s,a,c)}toJSON(){var s;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(s=this._currentUser)||void 0===s?void 0:s.toJSON()}}_setRedirectUser(s,a){var c=this;return(0,p.Z)(function*(){const y=yield c.getOrInitRedirectPersistenceManager(a);return null===s?y.removeCurrentUser():y.setCurrentUser(s)})()}getOrInitRedirectPersistenceManager(s){var a=this;return(0,p.Z)(function*(){if(!a.redirectPersistenceManager){const c=s&&Je(s)||a._popupRedirectResolver;O(c,a,"argument-error"),a.redirectPersistenceManager=yield Yt.create(a,[Je(c._redirectPersistence)],"redirectUser"),a.redirectUser=yield a.redirectPersistenceManager.getCurrentUser()}return a.redirectPersistenceManager})()}_redirectUserForId(s){var a=this;return(0,p.Z)(function*(){var c,y;return a._isInitialized&&(yield a.queue((0,p.Z)(function*(){}))),(null===(c=a._currentUser)||void 0===c?void 0:c._redirectEventId)===s?a._currentUser:(null===(y=a.redirectUser)||void 0===y?void 0:y._redirectEventId)===s?a.redirectUser:null})()}_persistUserIfCurrent(s){var a=this;return(0,p.Z)(function*(){if(s===a.currentUser)return a.queue((0,p.Z)(function*(){return a.directlySetCurrentUser(s)}))})()}_notifyListenersIfCurrent(s){s===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var s,a;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const c=null!==(a=null===(s=this.currentUser)||void 0===s?void 0:s.uid)&&void 0!==a?a:null;this.lastNotifiedUid!==c&&(this.lastNotifiedUid=c,this.authStateSubscription.next(this.currentUser))}registerStateListener(s,a,c,y){if(this._deleted)return()=>{};const I="function"==typeof a?a:a.next.bind(a),T=this._isInitialized?Promise.resolve():this._initializationPromise;return O(T,this,"internal-error"),T.then(()=>I(this.currentUser)),"function"==typeof a?s.addObserver(a,c,y):s.addObserver(a)}directlySetCurrentUser(s){var a=this;return(0,p.Z)(function*(){a.currentUser&&a.currentUser!==s&&(a._currentUser._stopProactiveRefresh(),s&&a.isProactiveRefreshEnabled&&s._startProactiveRefresh()),a.currentUser=s,s?yield a.assertedPersistence.setCurrentUser(s):yield a.assertedPersistence.removeCurrentUser()})()}queue(s){return this.operations=this.operations.then(s,s),this.operations}get assertedPersistence(){return O(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(s){!s||this.frameworks.includes(s)||(this.frameworks.push(s),this.frameworks.sort(),this.clientVersion=Gi(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var s=this;return(0,p.Z)(function*(){var a;const c={"X-Client-Version":s.clientVersion};s.app.options.appId&&(c["X-Firebase-gmpid"]=s.app.options.appId);const y=yield null===(a=s.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getHeartbeatsHeader();return y&&(c["X-Firebase-Client"]=y),c})()}}function ge(l){return(0,R.m9)(l)}class er{constructor(s){this.auth=s,this.observer=null,this.addObserver=(0,R.ne)(a=>this.observer=a)}get next(){return O(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Nt(l){const s=l.indexOf(":");return s<0?"":l.substr(0,s+1)}function zr(l){if(!l)return null;const s=Number(l);return isNaN(s)?null:s}class Lt{constructor(s,a){this.providerId=s,this.signInMethod=a}toJSON(){return St("not implemented")}_getIdTokenResponse(s){return St("not implemented")}_linkToIdToken(s,a){return St("not implemented")}_getReauthenticationResolver(s){return St("not implemented")}}function qi(l,s){return En.apply(this,arguments)}function En(){return(En=(0,p.Z)(function*(l,s){return ue(l,"POST","/v1/accounts:resetPassword",W(l,s))})).apply(this,arguments)}function ji(l,s){return tr.apply(this,arguments)}function tr(){return(tr=(0,p.Z)(function*(l,s){return ue(l,"POST","/v1/accounts:update",s)})).apply(this,arguments)}function Wa(l,s){return Zr.apply(this,arguments)}function Zr(){return(Zr=(0,p.Z)(function*(l,s){return ue(l,"POST","/v1/accounts:update",W(l,s))})).apply(this,arguments)}function rr(){return(rr=(0,p.Z)(function*(l,s){return le(l,"POST","/v1/accounts:signInWithPassword",W(l,s))})).apply(this,arguments)}function en(l,s){return Tn.apply(this,arguments)}function Tn(){return(Tn=(0,p.Z)(function*(l,s){return ue(l,"POST","/v1/accounts:sendOobCode",W(l,s))})).apply(this,arguments)}function $i(l,s){return Wi.apply(this,arguments)}function Wi(){return(Wi=(0,p.Z)(function*(l,s){return en(l,s)})).apply(this,arguments)}function Ka(l,s){return Ft.apply(this,arguments)}function Ft(){return(Ft=(0,p.Z)(function*(l,s){return en(l,s)})).apply(this,arguments)}function Yr(l,s){return ir.apply(this,arguments)}function ir(){return(ir=(0,p.Z)(function*(l,s){return en(l,s)})).apply(this,arguments)}function Ha(l,s){return Ki.apply(this,arguments)}function Ki(){return(Ki=(0,p.Z)(function*(l,s){return en(l,s)})).apply(this,arguments)}function To(){return(To=(0,p.Z)(function*(l,s){return le(l,"POST","/v1/accounts:signInWithEmailLink",W(l,s))})).apply(this,arguments)}function Hi(){return(Hi=(0,p.Z)(function*(l,s){return le(l,"POST","/v1/accounts:signInWithEmailLink",W(l,s))})).apply(this,arguments)}class tn extends Lt{constructor(s,a,c,y=null){super("password",c),this._email=s,this._password=a,this._tenantId=y}static _fromEmailAndPassword(s,a){return new tn(s,a,"password")}static _fromEmailAndCode(s,a,c=null){return new tn(s,a,"emailLink",c)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(s){const a="string"==typeof s?JSON.parse(s):s;if((null==a?void 0:a.email)&&(null==a?void 0:a.password)){if("password"===a.signInMethod)return this._fromEmailAndPassword(a.email,a.password);if("emailLink"===a.signInMethod)return this._fromEmailAndCode(a.email,a.password,a.tenantId)}return null}_getIdTokenResponse(s){var a=this;return(0,p.Z)(function*(){switch(a.signInMethod){case"password":return function nr(l,s){return rr.apply(this,arguments)}(s,{returnSecureToken:!0,email:a._email,password:a._password});case"emailLink":return function dh(l,s){return To.apply(this,arguments)}(s,{email:a._email,oobCode:a._password});default:se(s,"internal-error")}})()}_linkToIdToken(s,a){var c=this;return(0,p.Z)(function*(){switch(c.signInMethod){case"password":return ji(s,{idToken:a,returnSecureToken:!0,email:c._email,password:c._password});case"emailLink":return function Nl(l,s){return Hi.apply(this,arguments)}(s,{idToken:a,email:c._email,oobCode:c._password});default:se(s,"internal-error")}})()}_getReauthenticationResolver(s){return this._getIdTokenResponse(s)}}function Rt(l,s){return sr.apply(this,arguments)}function sr(){return(sr=(0,p.Z)(function*(l,s){return le(l,"POST","/v1/accounts:signInWithIdp",W(l,s))})).apply(this,arguments)}class It extends Lt{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(s){const a=new It(s.providerId,s.signInMethod);return s.idToken||s.accessToken?(s.idToken&&(a.idToken=s.idToken),s.accessToken&&(a.accessToken=s.accessToken),s.nonce&&!s.pendingToken&&(a.nonce=s.nonce),s.pendingToken&&(a.pendingToken=s.pendingToken)):s.oauthToken&&s.oauthTokenSecret?(a.accessToken=s.oauthToken,a.secret=s.oauthTokenSecret):se("argument-error"),a}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(s){const a="string"==typeof s?JSON.parse(s):s,{providerId:c,signInMethod:y}=a,I=(0,Ht._T)(a,["providerId","signInMethod"]);if(!c||!y)return null;const T=new It(c,y);return T.idToken=I.idToken||void 0,T.accessToken=I.accessToken||void 0,T.secret=I.secret,T.nonce=I.nonce,T.pendingToken=I.pendingToken||null,T}_getIdTokenResponse(s){return Rt(s,this.buildRequest())}_linkToIdToken(s,a){const c=this.buildRequest();return c.idToken=a,Rt(s,c)}_getReauthenticationResolver(s){const a=this.buildRequest();return a.autoCreate=!1,Rt(s,a)}buildRequest(){const s={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)s.pendingToken=this.pendingToken;else{const a={};this.idToken&&(a.id_token=this.idToken),this.accessToken&&(a.access_token=this.accessToken),this.secret&&(a.oauth_token_secret=this.secret),a.providerId=this.providerId,this.nonce&&!this.pendingToken&&(a.nonce=this.nonce),s.postBody=(0,R.xO)(a)}return s}}function zi(l,s){return or.apply(this,arguments)}function or(){return(or=(0,p.Z)(function*(l,s){return ue(l,"POST","/v1/accounts:sendVerificationCode",W(l,s))})).apply(this,arguments)}function Zi(){return(Zi=(0,p.Z)(function*(l,s){return le(l,"POST","/v1/accounts:signInWithPhoneNumber",W(l,s))})).apply(this,arguments)}function Qi(){return(Qi=(0,p.Z)(function*(l,s){const a=yield le(l,"POST","/v1/accounts:signInWithPhoneNumber",W(l,s));if(a.temporaryProof)throw zn(l,"account-exists-with-different-credential",a);return a})).apply(this,arguments)}const za={USER_NOT_FOUND:"user-not-found"};function ar(){return(ar=(0,p.Z)(function*(l,s){return le(l,"POST","/v1/accounts:signInWithPhoneNumber",W(l,Object.assign(Object.assign({},s),{operation:"REAUTH"})),za)})).apply(this,arguments)}class nn extends Lt{constructor(s){super("phone","phone"),this.params=s}static _fromVerification(s,a){return new nn({verificationId:s,verificationCode:a})}static _fromTokenResponse(s,a){return new nn({phoneNumber:s,temporaryProof:a})}_getIdTokenResponse(s){return function bo(l,s){return Zi.apply(this,arguments)}(s,this._makeVerificationRequest())}_linkToIdToken(s,a){return function Yi(l,s){return Qi.apply(this,arguments)}(s,Object.assign({idToken:a},this._makeVerificationRequest()))}_getReauthenticationResolver(s){return function Za(l,s){return ar.apply(this,arguments)}(s,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:s,phoneNumber:a,verificationId:c,verificationCode:y}=this.params;return s&&a?{temporaryProof:s,phoneNumber:a}:{sessionInfo:c,code:y}}toJSON(){const s={providerId:this.providerId};return this.params.phoneNumber&&(s.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(s.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(s.verificationCode=this.params.verificationCode),this.params.verificationId&&(s.verificationId=this.params.verificationId),s}static fromJSON(s){"string"==typeof s&&(s=JSON.parse(s));const{verificationId:a,verificationCode:c,phoneNumber:y,temporaryProof:I}=s;return c||a||y||I?new nn({verificationId:a,verificationCode:c,phoneNumber:y,temporaryProof:I}):null}}class rn{constructor(s){var a,c,y,I,T,C;const V=(0,R.zd)((0,R.pd)(s)),j=null!==(a=V.apiKey)&&void 0!==a?a:null,G=null!==(c=V.oobCode)&&void 0!==c?c:null,H=function Ya(l){switch(l){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(y=V.mode)&&void 0!==y?y:null);O(j&&G&&H,"argument-error"),this.apiKey=j,this.operation=H,this.code=G,this.continueUrl=null!==(I=V.continueUrl)&&void 0!==I?I:null,this.languageCode=null!==(T=V.languageCode)&&void 0!==T?T:null,this.tenantId=null!==(C=V.tenantId)&&void 0!==C?C:null}static parseLink(s){const a=function Rl(l){const s=(0,R.zd)((0,R.pd)(l)).link,a=s?(0,R.zd)((0,R.pd)(s)).deep_link_id:null,c=(0,R.zd)((0,R.pd)(l)).deep_link_id;return(c?(0,R.zd)((0,R.pd)(c)).link:null)||c||a||s||l}(s);try{return new rn(a)}catch(c){return null}}}let Qr=(()=>{class l{constructor(){this.providerId=l.PROVIDER_ID}static credential(a,c){return tn._fromEmailAndPassword(a,c)}static credentialWithLink(a,c){const y=rn.parseLink(c);return O(y,"argument-error"),tn._fromEmailAndCode(a,y.code,y.tenantId)}}return l.PROVIDER_ID="password",l.EMAIL_PASSWORD_SIGN_IN_METHOD="password",l.EMAIL_LINK_SIGN_IN_METHOD="emailLink",l})();class Ut{constructor(s){this.providerId=s,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(s){this.defaultLanguageCode=s}setCustomParameters(s){return this.customParameters=s,this}getCustomParameters(){return this.customParameters}}class sn extends Ut{constructor(){super(...arguments),this.scopes=[]}addScope(s){return this.scopes.includes(s)||this.scopes.push(s),this}getScopes(){return[...this.scopes]}}class An extends sn{static credentialFromJSON(s){const a="string"==typeof s?JSON.parse(s):s;return O("providerId"in a&&"signInMethod"in a,"argument-error"),It._fromParams(a)}credential(s){return this._credential(Object.assign(Object.assign({},s),{nonce:s.rawNonce}))}_credential(s){return O(s.idToken||s.accessToken,"argument-error"),It._fromParams(Object.assign(Object.assign({},s),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(s){return An.oauthCredentialFromTaggedObject(s)}static credentialFromError(s){return An.oauthCredentialFromTaggedObject(s.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:s}){if(!s)return null;const{oauthIdToken:a,oauthAccessToken:c,oauthTokenSecret:y,pendingToken:I,nonce:T,providerId:C}=s;if(!c&&!y&&!a&&!I||!C)return null;try{return new An(C)._credential({idToken:a,accessToken:c,nonce:T,pendingToken:I})}catch(V){return null}}}let Qa=(()=>{class l extends sn{constructor(){super("facebook.com")}static credential(a){return It._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return l.credential(a.oauthAccessToken)}catch(c){return null}}}return l.FACEBOOK_SIGN_IN_METHOD="facebook.com",l.PROVIDER_ID="facebook.com",l})(),Ji=(()=>{class l extends sn{constructor(){super("google.com"),this.addScope("profile")}static credential(a,c){return It._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:c})}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthIdToken:c,oauthAccessToken:y}=a;if(!c&&!y)return null;try{return l.credential(c,y)}catch(I){return null}}}return l.GOOGLE_SIGN_IN_METHOD="google.com",l.PROVIDER_ID="google.com",l})(),Xi=(()=>{class l extends sn{constructor(){super("github.com")}static credential(a){return It._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return l.credential(a.oauthAccessToken)}catch(c){return null}}}return l.GITHUB_SIGN_IN_METHOD="github.com",l.PROVIDER_ID="github.com",l})();class on extends Lt{constructor(s,a){super(s,s),this.pendingToken=a}_getIdTokenResponse(s){return Rt(s,this.buildRequest())}_linkToIdToken(s,a){const c=this.buildRequest();return c.idToken=a,Rt(s,c)}_getReauthenticationResolver(s){const a=this.buildRequest();return a.autoCreate=!1,Rt(s,a)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(s){const a="string"==typeof s?JSON.parse(s):s,{providerId:c,signInMethod:y,pendingToken:I}=a;return c&&y&&I&&c===y?new on(c,I):null}static _create(s,a){return new on(s,a)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class bn extends Ut{constructor(s){O(s.startsWith("saml."),"argument-error"),super(s)}static credentialFromResult(s){return bn.samlCredentialFromTaggedObject(s)}static credentialFromError(s){return bn.samlCredentialFromTaggedObject(s.customData||{})}static credentialFromJSON(s){const a=on.fromJSON(s);return O(a,"argument-error"),a}static samlCredentialFromTaggedObject({_tokenResponse:s}){if(!s)return null;const{pendingToken:a,providerId:c}=s;if(!a||!c)return null;try{return on._create(c,a)}catch(y){return null}}}let ts=(()=>{class l extends sn{constructor(){super("twitter.com")}static credential(a,c){return It._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:c})}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthAccessToken:c,oauthTokenSecret:y}=a;if(!c||!y)return null;try{return l.credential(c,y)}catch(I){return null}}}return l.TWITTER_SIGN_IN_METHOD="twitter.com",l.PROVIDER_ID="twitter.com",l})();function Jr(l,s){return lr.apply(this,arguments)}function lr(){return(lr=(0,p.Z)(function*(l,s){return le(l,"POST","/v1/accounts:signUp",W(l,s))})).apply(this,arguments)}class wt{constructor(s){this.user=s.user,this.providerId=s.providerId,this._tokenResponse=s._tokenResponse,this.operationType=s.operationType}static _fromIdTokenResponse(s,a,c,y=!1){return(0,p.Z)(function*(){const I=yield ct._fromIdTokenResponse(s,c,y),T=Xr(c);return new wt({user:I,providerId:T,_tokenResponse:c,operationType:a})})()}static _forOperation(s,a,c){return(0,p.Z)(function*(){yield s._updateTokensIfNecessary(c,!0);const y=Xr(c);return new wt({user:s,providerId:y,_tokenResponse:c,operationType:a})})()}}function Xr(l){return l.providerId?l.providerId:"phoneNumber"in l?"phone":null}function cr(){return(cr=(0,p.Z)(function*(l){var s;const a=ge(l);if(yield a._initializationPromise,null===(s=a.currentUser)||void 0===s?void 0:s.isAnonymous)return new wt({user:a.currentUser,providerId:null,operationType:"signIn"});const c=yield Jr(a,{returnSecureToken:!0}),y=yield wt._fromIdTokenResponse(a,"signIn",c,!0);return yield a._updateCurrentUser(y.user),y})).apply(this,arguments)}class hr extends R.ZR{constructor(s,a,c,y){var I;super(a.code,a.message),this.operationType=c,this.user=y,Object.setPrototypeOf(this,hr.prototype),this.customData={appName:s.name,tenantId:null!==(I=s.tenantId)&&void 0!==I?I:void 0,_serverResponse:a.customData._serverResponse,operationType:c}}static _fromErrorAndOperation(s,a,c,y){return new hr(s,a,c,y)}}function dr(l,s,a,c){return("reauthenticate"===s?a._getReauthenticationResolver(l):a._getIdTokenResponse(l)).catch(I=>{throw"auth/multi-factor-auth-required"===I.code?hr._fromErrorAndOperation(l,I,s,c):I})}function Et(l){return new Set(l.map(({providerId:s})=>s).filter(s=>!!s))}function ti(){return(ti=(0,p.Z)(function*(l,s){const a=(0,R.m9)(l);yield ni(!0,a,s);const{providerUserInfo:c}=yield xt(a.auth,{idToken:yield a.getIdToken(),deleteProvider:[s]}),y=Et(c||[]);return a.providerData=a.providerData.filter(I=>y.has(I.providerId)),y.has("phone")||(a.phoneNumber=null),yield a.auth._persistUserIfCurrent(a),a})).apply(this,arguments)}function ns(l,s){return rs.apply(this,arguments)}function rs(){return(rs=(0,p.Z)(function*(l,s,a=!1){const c=yield ut(l,s._linkToIdToken(l.auth,yield l.getIdToken()),a);return wt._forOperation(l,"link",c)})).apply(this,arguments)}function ni(l,s,a){return is.apply(this,arguments)}function is(){return(is=(0,p.Z)(function*(l,s,a){yield $r(s);const y=!1===l?"provider-already-linked":"no-such-provider";O(Et(s.providerData).has(a)===l,s.auth,y)})).apply(this,arguments)}function it(l,s){return U.apply(this,arguments)}function U(){return(U=(0,p.Z)(function*(l,s,a=!1){const{auth:c}=l,y="reauthenticate";try{const I=yield ut(l,dr(c,y,s,l),a);O(I.idToken,c,"internal-error");const T=yn(I.idToken);O(T,c,"internal-error");const{sub:C}=T;return O(l.uid===C,c,"user-mismatch"),wt._forOperation(l,y,I)}catch(I){throw"auth/user-not-found"===(null==I?void 0:I.code)&&se(c,"user-mismatch"),I}})).apply(this,arguments)}function ri(l,s){return Z.apply(this,arguments)}function Z(){return(Z=(0,p.Z)(function*(l,s,a=!1){const c="signIn",y=yield dr(l,c,s),I=yield wt._fromIdTokenResponse(l,c,y);return a||(yield l._updateCurrentUser(I.user)),I})).apply(this,arguments)}function an(l,s){return Cn.apply(this,arguments)}function Cn(){return(Cn=(0,p.Z)(function*(l,s){return ri(ge(l),s)})).apply(this,arguments)}function Sn(l,s){return ii.apply(this,arguments)}function ii(){return(ii=(0,p.Z)(function*(l,s){const a=(0,R.m9)(l);return yield ni(!1,a,s.providerId),ns(a,s)})).apply(this,arguments)}function si(l,s){return oi.apply(this,arguments)}function oi(){return(oi=(0,p.Z)(function*(l,s){return it((0,R.m9)(l),s)})).apply(this,arguments)}function Ol(l,s){return Co.apply(this,arguments)}function Co(){return(Co=(0,p.Z)(function*(l,s){return le(l,"POST","/v1/accounts:signInWithCustomToken",W(l,s))})).apply(this,arguments)}function un(){return(un=(0,p.Z)(function*(l,s){const a=ge(l),c=yield Ol(a,{token:s,returnSecureToken:!0}),y=yield wt._fromIdTokenResponse(a,"signIn",c);return yield a._updateCurrentUser(y.user),y})).apply(this,arguments)}class Ee{constructor(s,a){this.factorId=s,this.uid=a.mfaEnrollmentId,this.enrollmentTime=new Date(a.enrolledAt).toUTCString(),this.displayName=a.displayName}static _fromServerResponse(s,a){return"phoneInfo"in a?Tt._fromServerResponse(s,a):se(s,"internal-error")}}class Tt extends Ee{constructor(s){super("phone",s),this.phoneNumber=s.phoneInfo}static _fromServerResponse(s,a){return new Tt(a)}}function ss(l,s,a){var c;O((null===(c=a.url)||void 0===c?void 0:c.length)>0,l,"invalid-continue-uri"),O(void 0===a.dynamicLinkDomain||a.dynamicLinkDomain.length>0,l,"invalid-dynamic-link-domain"),s.continueUrl=a.url,s.dynamicLinkDomain=a.dynamicLinkDomain,s.canHandleCodeInApp=a.handleCodeInApp,a.iOS&&(O(a.iOS.bundleId.length>0,l,"missing-ios-bundle-id"),s.iOSBundleId=a.iOS.bundleId),a.android&&(O(a.android.packageName.length>0,l,"missing-android-pkg-name"),s.androidInstallApp=a.android.installApp,s.androidMinimumVersionCode=a.android.minimumVersion,s.androidPackageName=a.android.packageName)}function os(){return(os=(0,p.Z)(function*(l,s,a){const c=(0,R.m9)(l),y={requestType:"PASSWORD_RESET",email:s};a&&ss(c,y,a),yield Ka(c,y)})).apply(this,arguments)}function f(){return(f=(0,p.Z)(function*(l,s,a){yield qi((0,R.m9)(l),{oobCode:s,newPassword:a})})).apply(this,arguments)}function v(){return(v=(0,p.Z)(function*(l,s){yield Wa((0,R.m9)(l),{oobCode:s})})).apply(this,arguments)}function x(l,s){return B.apply(this,arguments)}function B(){return(B=(0,p.Z)(function*(l,s){const a=(0,R.m9)(l),c=yield qi(a,{oobCode:s}),y=c.requestType;switch(O(y,a,"internal-error"),y){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":O(c.newEmail,a,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":O(c.mfaInfo,a,"internal-error");default:O(c.email,a,"internal-error")}let I=null;return c.mfaInfo&&(I=Ee._fromServerResponse(ge(a),c.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===c.requestType?c.newEmail:c.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===c.requestType?c.email:c.newEmail)||null,multiFactorInfo:I},operation:y}})).apply(this,arguments)}function Le(){return(Le=(0,p.Z)(function*(l,s){const{data:a}=yield x((0,R.m9)(l),s);return a.email})).apply(this,arguments)}function Ot(){return(Ot=(0,p.Z)(function*(l,s,a){const c=ge(l),y=yield Jr(c,{returnSecureToken:!0,email:s,password:a}),I=yield wt._fromIdTokenResponse(c,"signIn",y);return yield c._updateCurrentUser(I.user),I})).apply(this,arguments)}function ai(){return(ai=(0,p.Z)(function*(l,s,a){const c=(0,R.m9)(l),y={requestType:"EMAIL_SIGNIN",email:s};O(a.handleCodeInApp,c,"argument-error"),a&&ss(c,y,a),yield Yr(c,y)})).apply(this,arguments)}function as(){return(as=(0,p.Z)(function*(l,s,a){const c=(0,R.m9)(l),y=Qr.credentialWithLink(s,a||$n());return O(y._tenantId===(c.tenantId||null),c,"tenant-id-mismatch"),an(c,y)})).apply(this,arguments)}function ph(l,s){return Xa.apply(this,arguments)}function Xa(){return(Xa=(0,p.Z)(function*(l,s){return ue(l,"POST","/v1/accounts:createAuthUri",W(l,s))})).apply(this,arguments)}function So(){return(So=(0,p.Z)(function*(l,s){const c={identifier:s,continueUri:Pi()?$n():"http://localhost"},{signinMethods:y}=yield ph((0,R.m9)(l),c);return y||[]})).apply(this,arguments)}function xo(){return(xo=(0,p.Z)(function*(l,s){const a=(0,R.m9)(l),y={requestType:"VERIFY_EMAIL",idToken:yield l.getIdToken()};s&&ss(a.auth,y,s);const{email:I}=yield $i(a.auth,y);I!==l.email&&(yield l.reload())})).apply(this,arguments)}function Do(){return(Do=(0,p.Z)(function*(l,s,a){const c=(0,R.m9)(l),I={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield l.getIdToken(),newEmail:s};a&&ss(c.auth,I,a);const{email:T}=yield Ha(c.auth,I);T!==l.email&&(yield l.reload())})).apply(this,arguments)}function ko(l,s){return us.apply(this,arguments)}function us(){return(us=(0,p.Z)(function*(l,s){return ue(l,"POST","/v1/accounts:update",s)})).apply(this,arguments)}function ls(){return(ls=(0,p.Z)(function*(l,{displayName:s,photoURL:a}){if(void 0===s&&void 0===a)return;const c=(0,R.m9)(l),I={idToken:yield c.getIdToken(),displayName:s,photoUrl:a,returnSecureToken:!0},T=yield ut(c,ko(c.auth,I));c.displayName=T.displayName||null,c.photoURL=T.photoUrl||null;const C=c.providerData.find(({providerId:V})=>"password"===V);C&&(C.displayName=c.displayName,C.photoURL=c.photoURL),yield c._updateTokensIfNecessary(T)})).apply(this,arguments)}function No(l,s,a){return Ro.apply(this,arguments)}function Ro(){return(Ro=(0,p.Z)(function*(l,s,a){const{auth:c}=l,I={idToken:yield l.getIdToken(),returnSecureToken:!0};s&&(I.email=s),a&&(I.password=a);const T=yield ut(l,ji(c,I));yield l._updateTokensIfNecessary(T,!0)})).apply(this,arguments)}class li{constructor(s,a,c={}){this.isNewUser=s,this.providerId=a,this.profile=c}}class We extends li{constructor(s,a,c,y){super(s,a,c),this.username=y}}class cs extends li{constructor(s,a){super(s,"facebook.com",a)}}class vh extends We{constructor(s,a){super(s,"github.com",a,"string"==typeof(null==a?void 0:a.login)?null==a?void 0:a.login:null)}}class hs extends li{constructor(s,a){super(s,"google.com",a)}}class Ih extends We{constructor(s,a,c){super(s,"twitter.com",a,c)}}function wh(l){const{user:s,_tokenResponse:a}=l;return s.isAnonymous&&!a?{providerId:null,isNewUser:!1,profile:null}:function _h(l){var s,a;if(!l)return null;const{providerId:c}=l,y=l.rawUserInfo?JSON.parse(l.rawUserInfo):{},I=l.isNewUser||"identitytoolkit#SignupNewUserResponse"===l.kind;if(!c&&(null==l?void 0:l.idToken)){const T=null===(a=null===(s=yn(l.idToken))||void 0===s?void 0:s.firebase)||void 0===a?void 0:a.sign_in_provider;if(T)return new li(I,"anonymous"!==T&&"custom"!==T?T:null)}if(!c)return null;switch(c){case"facebook.com":return new cs(I,y);case"github.com":return new vh(I,y);case"google.com":return new hs(I,y);case"twitter.com":return new Ih(I,y,l.screenName||null);case"custom":case"anonymous":return new li(I,null);default:return new li(I,c,y)}}(a)}class gr{constructor(s,a){this.type=s,this.credential=a}static _fromIdtoken(s){return new gr("enroll",s)}static _fromMfaPendingCredential(s){return new gr("signin",s)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(s){var a,c;if(null==s?void 0:s.multiFactorSession){if(null===(a=s.multiFactorSession)||void 0===a?void 0:a.pendingCredential)return gr._fromMfaPendingCredential(s.multiFactorSession.pendingCredential);if(null===(c=s.multiFactorSession)||void 0===c?void 0:c.idToken)return gr._fromIdtoken(s.multiFactorSession.idToken)}return null}}class Mo{constructor(s,a,c){this.session=s,this.hints=a,this.signInResolver=c}static _fromError(s,a){const c=ge(s),y=a.customData._serverResponse,I=(y.mfaInfo||[]).map(C=>Ee._fromServerResponse(c,C));O(y.mfaPendingCredential,c,"internal-error");const T=gr._fromMfaPendingCredential(y.mfaPendingCredential);return new Mo(T,I,function(){var C=(0,p.Z)(function*(V){const j=yield V._process(c,T);delete y.mfaInfo,delete y.mfaPendingCredential;const G=Object.assign(Object.assign({},y),{idToken:j.idToken,refreshToken:j.refreshToken});switch(a.operationType){case"signIn":const H=yield wt._fromIdTokenResponse(c,a.operationType,G);return yield c._updateCurrentUser(H.user),H;case"reauthenticate":return O(a.user,c,"internal-error"),wt._forOperation(a.user,a.operationType,G);default:se(c,"internal-error")}});return function(V){return C.apply(this,arguments)}}())}resolveSignIn(s){var a=this;return(0,p.Z)(function*(){return a.signInResolver(s)})()}}function iu(l,s){return ue(l,"POST","/v2/accounts/mfaEnrollment:start",W(l,s))}class ds{constructor(s){this.user=s,this.enrolledFactors=[],s._onReload(a=>{a.mfaInfo&&(this.enrolledFactors=a.mfaInfo.map(c=>Ee._fromServerResponse(s.auth,c)))})}static _fromUser(s){return new ds(s)}getSession(){var s=this;return(0,p.Z)(function*(){return gr._fromIdtoken(yield s.user.getIdToken())})()}enroll(s,a){var c=this;return(0,p.Z)(function*(){const y=s,I=yield c.getSession(),T=yield ut(c.user,y._process(c.user.auth,I,a));return yield c.user._updateTokensIfNecessary(T),c.user.reload()})()}unenroll(s){var a=this;return(0,p.Z)(function*(){const c="string"==typeof s?s:s.uid,y=yield a.user.getIdToken(),I=yield ut(a.user,function Th(l,s){return ue(l,"POST","/v2/accounts/mfaEnrollment:withdraw",W(l,s))}(a.user.auth,{idToken:y,mfaEnrollmentId:c}));a.enrolledFactors=a.enrolledFactors.filter(({uid:T})=>T!==c),yield a.user._updateTokensIfNecessary(I);try{yield a.user.reload()}catch(T){if("auth/user-token-expired"!==T.code)throw T}})()}}const fs=new WeakMap,xe="__sak";class Fe{constructor(s,a){this.storageRetriever=s,this.type=a}_isAvailable(){try{return this.storage?(this.storage.setItem(xe,"1"),this.storage.removeItem(xe),Promise.resolve(!0)):Promise.resolve(!1)}catch(s){return Promise.resolve(!1)}}_set(s,a){return this.storage.setItem(s,JSON.stringify(a)),Promise.resolve()}_get(s){const a=this.storage.getItem(s);return Promise.resolve(a?JSON.parse(a):null)}_remove(s){return this.storage.removeItem(s),Promise.resolve()}get storage(){return this.storageRetriever()}}const ps=(()=>{class l extends Fe{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(a,c)=>this.onStorageEvent(a,c),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function Po(){const l=(0,R.z$)();return Qn(l)||Qt(l)}()&&function Jn(){try{return!(!window||window===window.top)}catch(l){return!1}}(),this.fallbackToPolling=Jt(),this._shouldAllowMigration=!0}forAllChangedKeys(a){for(const c of Object.keys(this.listeners)){const y=this.storage.getItem(c),I=this.localCache[c];y!==I&&a(c,I,y)}}onStorageEvent(a,c=!1){if(!a.key)return void this.forAllChangedKeys((C,V,j)=>{this.notifyListeners(C,j)});const y=a.key;if(c?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const C=this.storage.getItem(y);if(a.newValue!==C)null!==a.newValue?this.storage.setItem(y,a.newValue):this.storage.removeItem(y);else if(this.localCache[y]===a.newValue&&!c)return}const I=()=>{const C=this.storage.getItem(y);!c&&this.localCache[y]===C||this.notifyListeners(y,C)},T=this.storage.getItem(y);!function wo(){return(0,R.w1)()&&10===document.documentMode}()||T===a.newValue||a.newValue===a.oldValue?I():setTimeout(I,10)}notifyListeners(a,c){this.localCache[a]=c;const y=this.listeners[a];if(y)for(const I of Array.from(y))I(c&&JSON.parse(c))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((a,c,y)=>{this.onStorageEvent(new StorageEvent("storage",{key:a,oldValue:c,newValue:y}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(a,c){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[a]||(this.listeners[a]=new Set,this.localCache[a]=this.storage.getItem(a)),this.listeners[a].add(c)}_removeListener(a,c){this.listeners[a]&&(this.listeners[a].delete(c),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(a,c){var y=()=>super._set,I=this;return(0,p.Z)(function*(){yield y().call(I,a,c),I.localCache[a]=JSON.stringify(c)})()}_get(a){var c=()=>super._get,y=this;return(0,p.Z)(function*(){const I=yield c().call(y,a);return y.localCache[a]=JSON.stringify(I),I})()}_remove(a){var c=()=>super._remove,y=this;return(0,p.Z)(function*(){yield c().call(y,a),delete y.localCache[a]})()}}return l.type="LOCAL",l})(),xn=(()=>{class l extends Fe{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(a,c){}_removeListener(a,c){}}return l.type="SESSION",l})();let uu=(()=>{class l{constructor(a){this.eventTarget=a,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(a){const c=this.receivers.find(I=>I.isListeningto(a));if(c)return c;const y=new l(a);return this.receivers.push(y),y}isListeningto(a){return this.eventTarget===a}handleEvent(a){var c=this;return(0,p.Z)(function*(){const y=a,{eventId:I,eventType:T,data:C}=y.data,V=c.handlersMap[T];if(!(null==V?void 0:V.size))return;y.ports[0].postMessage({status:"ack",eventId:I,eventType:T});const j=Array.from(V).map(function(){var H=(0,p.Z)(function*(J){return J(y.origin,C)});return function(J){return H.apply(this,arguments)}}()),G=yield function au(l){return Promise.all(l.map(function(){var s=(0,p.Z)(function*(a){try{return{fulfilled:!0,value:yield a}}catch(c){return{fulfilled:!1,reason:c}}});return function(a){return s.apply(this,arguments)}}()))}(j);y.ports[0].postMessage({status:"done",eventId:I,eventType:T,response:G})})()}_subscribe(a,c){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[a]||(this.handlersMap[a]=new Set),this.handlersMap[a].add(c)}_unsubscribe(a,c){this.handlersMap[a]&&c&&this.handlersMap[a].delete(c),(!c||0===this.handlersMap[a].size)&&delete this.handlersMap[a],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return l.receivers=[],l})();function gs(l="",s=10){let a="";for(let c=0;c<s;c++)a+=Math.floor(10*Math.random());return l+a}class lu{constructor(s){this.target=s,this.handlers=new Set}removeMessageHandler(s){s.messageChannel&&(s.messageChannel.port1.removeEventListener("message",s.onMessage),s.messageChannel.port1.close()),this.handlers.delete(s)}_send(s,a,c=50){var y=this;return(0,p.Z)(function*(){const I="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!I)throw new Error("connection_unavailable");let T,C;return new Promise((V,j)=>{const G=gs("",20);I.port1.start();const H=setTimeout(()=>{j(new Error("unsupported_event"))},c);C={messageChannel:I,onMessage(J){const st=J;if(st.data.eventId===G)switch(st.data.status){case"ack":clearTimeout(H),T=setTimeout(()=>{j(new Error("timeout"))},3e3);break;case"done":clearTimeout(T),V(st.data.response);break;default:clearTimeout(H),clearTimeout(T),j(new Error("invalid_response"))}}},y.handlers.add(C),I.port1.addEventListener("message",C.onMessage),y.target.postMessage({eventType:s,eventId:G,data:a},[I.port2])}).finally(()=>{C&&y.removeMessageHandler(C)})})()}}function Ne(){return window}function ci(){return void 0!==Ne().WorkerGlobalScope&&"function"==typeof Ne().importScripts}function ms(){return(ms=(0,p.Z)(function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch(l){return null}})).apply(this,arguments)}const hi="firebaseLocalStorageDb",ys="firebaseLocalStorage",hu="fbase_key";class Dn{constructor(s){this.request=s}toPromise(){return new Promise((s,a)=>{this.request.addEventListener("success",()=>{s(this.request.result)}),this.request.addEventListener("error",()=>{a(this.request.error)})})}}function Vo(l,s){return l.transaction([ys],s?"readwrite":"readonly").objectStore(ys)}function kn(){const l=indexedDB.open(hi,1);return new Promise((s,a)=>{l.addEventListener("error",()=>{a(l.error)}),l.addEventListener("upgradeneeded",()=>{const c=l.result;try{c.createObjectStore(ys,{keyPath:hu})}catch(y){a(y)}}),l.addEventListener("success",(0,p.Z)(function*(){const c=l.result;c.objectStoreNames.contains(ys)?s(c):(c.close(),yield function Sh(){const l=indexedDB.deleteDatabase(hi);return new Dn(l).toPromise()}(),s(yield kn()))}))})}function Wl(l,s,a){return du.apply(this,arguments)}function du(){return(du=(0,p.Z)(function*(l,s,a){const c=Vo(l,!0).put({[hu]:s,value:a});return new Dn(c).toPromise()})).apply(this,arguments)}function Lo(){return(Lo=(0,p.Z)(function*(l,s){const a=Vo(l,!1).get(s),c=yield new Dn(a).toPromise();return void 0===c?null:c.value})).apply(this,arguments)}function _s(l,s){const a=Vo(l,!0).delete(s);return new Dn(a).toPromise()}const Re=(()=>{class l{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var a=this;return(0,p.Z)(function*(){return a.db||(a.db=yield kn()),a.db})()}_withRetries(a){var c=this;return(0,p.Z)(function*(){let y=0;for(;;)try{const I=yield c._openDb();return yield a(I)}catch(I){if(y++>3)throw I;c.db&&(c.db.close(),c.db=void 0)}})()}initializeServiceWorkerMessaging(){var a=this;return(0,p.Z)(function*(){return ci()?a.initializeReceiver():a.initializeSender()})()}initializeReceiver(){var a=this;return(0,p.Z)(function*(){a.receiver=uu._getInstance(function Ch(){return ci()?self:null}()),a.receiver._subscribe("keyChanged",function(){var c=(0,p.Z)(function*(y,I){return{keyProcessed:(yield a._poll()).includes(I.key)}});return function(y,I){return c.apply(this,arguments)}}()),a.receiver._subscribe("ping",function(){var c=(0,p.Z)(function*(y,I){return["keyChanged"]});return function(y,I){return c.apply(this,arguments)}}())})()}initializeSender(){var a=this;return(0,p.Z)(function*(){var c,y;if(a.activeServiceWorker=yield function cu(){return ms.apply(this,arguments)}(),!a.activeServiceWorker)return;a.sender=new lu(a.activeServiceWorker);const I=yield a.sender._send("ping",{},800);!I||(null===(c=I[0])||void 0===c?void 0:c.fulfilled)&&(null===(y=I[0])||void 0===y?void 0:y.value.includes("keyChanged"))&&(a.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(a){var c=this;return(0,p.Z)(function*(){if(c.sender&&c.activeServiceWorker&&function jl(){var l;return(null===(l=null==navigator?void 0:navigator.serviceWorker)||void 0===l?void 0:l.controller)||null}()===c.activeServiceWorker)try{yield c.sender._send("keyChanged",{key:a},c.serviceWorkerReceiverAvailable?800:50)}catch(y){}})()}_isAvailable(){return(0,p.Z)(function*(){try{if(!indexedDB)return!1;const a=yield kn();return yield Wl(a,xe,"1"),yield _s(a,xe),!0}catch(a){}return!1})()}_withPendingWrite(a){var c=this;return(0,p.Z)(function*(){c.pendingWrites++;try{yield a()}finally{c.pendingWrites--}})()}_set(a,c){var y=this;return(0,p.Z)(function*(){return y._withPendingWrite((0,p.Z)(function*(){return yield y._withRetries(I=>Wl(I,a,c)),y.localCache[a]=c,y.notifyServiceWorker(a)}))})()}_get(a){var c=this;return(0,p.Z)(function*(){const y=yield c._withRetries(I=>function mr(l,s){return Lo.apply(this,arguments)}(I,a));return c.localCache[a]=y,y})()}_remove(a){var c=this;return(0,p.Z)(function*(){return c._withPendingWrite((0,p.Z)(function*(){return yield c._withRetries(y=>_s(y,a)),delete c.localCache[a],c.notifyServiceWorker(a)}))})()}_poll(){var a=this;return(0,p.Z)(function*(){const c=yield a._withRetries(T=>{const C=Vo(T,!1).getAll();return new Dn(C).toPromise()});if(!c)return[];if(0!==a.pendingWrites)return[];const y=[],I=new Set;for(const{fbase_key:T,value:C}of c)I.add(T),JSON.stringify(a.localCache[T])!==JSON.stringify(C)&&(a.notifyListeners(T,C),y.push(T));for(const T of Object.keys(a.localCache))a.localCache[T]&&!I.has(T)&&(a.notifyListeners(T,null),y.push(T));return y})()}notifyListeners(a,c){this.localCache[a]=c;const y=this.listeners[a];if(y)for(const I of Array.from(y))I(c)}startPolling(){var a=this;this.stopPolling(),this.pollTimer=setInterval((0,p.Z)(function*(){return a._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(a,c){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[a]||(this.listeners[a]=new Set,this._get(a)),this.listeners[a].add(c)}_removeListener(a,c){this.listeners[a]&&(this.listeners[a].delete(c),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return l.type="LOCAL",l})();function Hl(l,s){return ue(l,"POST","/v2/accounts/mfaSignIn:start",W(l,s))}function Uo(){return(Uo=(0,p.Z)(function*(l){return(yield ue(l,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function pu(l){return new Promise((s,a)=>{const c=document.createElement("script");c.setAttribute("src",l),c.onload=s,c.onerror=y=>{const I=fe("internal-error");I.customData=y,a(I)},c.type="text/javascript",c.charset="UTF-8",function fu(){var l,s;return null!==(s=null===(l=document.getElementsByTagName("head"))||void 0===l?void 0:l[0])&&void 0!==s?s:document}().appendChild(c)})}function gu(l){return`__${l}${Math.floor(1e6*Math.random())}`}const di=1e12;class yu{constructor(s){this.auth=s,this.counter=di,this._widgets=new Map}render(s,a){const c=this.counter;return this._widgets.set(c,new Bo(s,this.auth.name,a||{})),this.counter++,c}reset(s){var a;const c=s||di;null===(a=this._widgets.get(c))||void 0===a||a.delete(),this._widgets.delete(c)}getResponse(s){var a;return(null===(a=this._widgets.get(s||di))||void 0===a?void 0:a.getResponse())||""}execute(s){var a=this;return(0,p.Z)(function*(){var c;return null===(c=a._widgets.get(s||di))||void 0===c||c.execute(),""})()}}class Bo{constructor(s,a,c){this.params=c,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const y="string"==typeof s?document.getElementById(s):s;O(y,"argument-error",{appName:a}),this.container=y,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function Es(l){const s=[],a="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let c=0;c<l;c++)s.push(a.charAt(Math.floor(Math.random()*a.length)));return s.join("")}(50);const{callback:s,"expired-callback":a}=this.params;if(s)try{s(this.responseToken)}catch(c){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,a)try{a()}catch(c){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Go=gu("rcb"),Dh=new Wn(3e4,6e4);class qo{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!Ne().grecaptcha}load(s,a=""){return O(function vu(l){return l.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(l)}(a),s,"argument-error"),this.shouldResolveImmediately(a)?Promise.resolve(Ne().grecaptcha):new Promise((c,y)=>{const I=Ne().setTimeout(()=>{y(fe(s,"network-request-failed"))},Dh.get());Ne()[Go]=()=>{Ne().clearTimeout(I),delete Ne()[Go];const C=Ne().grecaptcha;if(!C)return void y(fe(s,"internal-error"));const V=C.render;C.render=(j,G)=>{const H=V(j,G);return this.counter++,H},this.hostLanguage=a,c(C)},pu(`https://www.google.com/recaptcha/api.js??${(0,R.xO)({onload:Go,render:"explicit",hl:a})}`).catch(()=>{clearTimeout(I),y(fe(s,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(s){return!!Ne().grecaptcha&&(s===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class zl{load(s){return(0,p.Z)(function*(){return new yu(s)})()}clearedOneInstance(){}}const Iu="recaptcha",Zl={theme:"light",type:"image"};class kh{constructor(s,a=Object.assign({},Zl),c){this.parameters=a,this.type=Iu,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ge(c),this.isInvisible="invisible"===this.parameters.size,O("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const y="string"==typeof s?document.getElementById(s):s;O(y,this.auth,"argument-error"),this.container=y,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new zl:new qo,this.validateStartingState()}verify(){var s=this;return(0,p.Z)(function*(){s.assertNotDestroyed();const a=yield s.render(),c=s.getAssertedRecaptcha();return c.getResponse(a)||new Promise(I=>{const T=C=>{!C||(s.tokenChangeListeners.delete(T),I(C))};s.tokenChangeListeners.add(T),s.isInvisible&&c.execute(a)})})()}render(){try{this.assertNotDestroyed()}catch(s){return Promise.reject(s)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(s=>{throw this.renderPromise=null,s})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(s=>{this.container.removeChild(s)})}validateStartingState(){O(!this.parameters.sitekey,this.auth,"argument-error"),O(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),O("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(s){return a=>{if(this.tokenChangeListeners.forEach(c=>c(a)),"function"==typeof s)s(a);else if("string"==typeof s){const c=Ne()[s];"function"==typeof c&&c(a)}}}assertNotDestroyed(){O(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var s=this;return(0,p.Z)(function*(){if(yield s.init(),!s.widgetId){let a=s.container;if(!s.isInvisible){const c=document.createElement("div");a.appendChild(c),a=c}s.widgetId=s.getAssertedRecaptcha().render(a,s.parameters)}return s.widgetId})()}init(){var s=this;return(0,p.Z)(function*(){O(Pi()&&!ci(),s.auth,"internal-error"),yield function Ts(){let l=null;return new Promise(s=>{"complete"!==document.readyState?(l=()=>s(),window.addEventListener("load",l)):s()}).catch(s=>{throw l&&window.removeEventListener("load",l),s})}(),s.recaptcha=yield s._recaptchaLoader.load(s.auth,s.auth.languageCode||void 0);const a=yield function Fo(l){return Uo.apply(this,arguments)}(s.auth);O(a,s.auth,"internal-error"),s.parameters.sitekey=a})()}getAssertedRecaptcha(){return O(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class jo{constructor(s,a){this.verificationId=s,this.onConfirmation=a}confirm(s){const a=nn._fromVerification(this.verificationId,s);return this.onConfirmation(a)}}function yr(){return(yr=(0,p.Z)(function*(l,s,a){const c=ge(l),y=yield ln(c,s,(0,R.m9)(a));return new jo(y,I=>an(c,I))})).apply(this,arguments)}function As(){return(As=(0,p.Z)(function*(l,s,a){const c=(0,R.m9)(l);yield ni(!1,c,"phone");const y=yield ln(c.auth,s,(0,R.m9)(a));return new jo(y,I=>Sn(c,I))})).apply(this,arguments)}function bs(){return(bs=(0,p.Z)(function*(l,s,a){const c=(0,R.m9)(l),y=yield ln(c.auth,s,(0,R.m9)(a));return new jo(y,I=>si(c,I))})).apply(this,arguments)}function ln(l,s,a){return Cs.apply(this,arguments)}function Cs(){return(Cs=(0,p.Z)(function*(l,s,a){var c;const y=yield a.verify();try{let I;if(O("string"==typeof y,l,"argument-error"),O(a.type===Iu,l,"argument-error"),I="string"==typeof s?{phoneNumber:s}:s,"session"in I){const T=I.session;if("phoneNumber"in I)return O("enroll"===T.type,l,"internal-error"),(yield iu(l,{idToken:T.credential,phoneEnrollmentInfo:{phoneNumber:I.phoneNumber,recaptchaToken:y}})).phoneSessionInfo.sessionInfo;{O("signin"===T.type,l,"internal-error");const C=(null===(c=I.multiFactorHint)||void 0===c?void 0:c.uid)||I.multiFactorUid;return O(C,l,"missing-multi-factor-info"),(yield Hl(l,{mfaPendingCredential:T.credential,mfaEnrollmentId:C,phoneSignInInfo:{recaptchaToken:y}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:T}=yield zi(l,{phoneNumber:I.phoneNumber,recaptchaToken:y});return T}}finally{a._reset()}})).apply(this,arguments)}function Wo(){return(Wo=(0,p.Z)(function*(l,s){yield ns((0,R.m9)(l),s)})).apply(this,arguments)}let Ss=(()=>{class l{constructor(a){this.providerId=l.PROVIDER_ID,this.auth=ge(a)}verifyPhoneNumber(a,c){return ln(this.auth,a,(0,R.m9)(c))}static credential(a,c){return nn._fromVerification(a,c)}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{phoneNumber:c,temporaryProof:y}=a;return c&&y?nn._fromTokenResponse(c,y):null}}return l.PROVIDER_ID="phone",l.PHONE_SIGN_IN_METHOD="phone",l})();function ht(l,s){return s?Je(s):(O(l._popupRedirectResolver,l,"argument-error"),l._popupRedirectResolver)}class Mt extends Lt{constructor(s){super("custom","custom"),this.params=s}_getIdTokenResponse(s){return Rt(s,this._buildIdpRequest())}_linkToIdToken(s,a){return Rt(s,this._buildIdpRequest(a))}_getReauthenticationResolver(s){return Rt(s,this._buildIdpRequest())}_buildIdpRequest(s){const a={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return s&&(a.idToken=s),a}}function Ko(l){return ri(l.auth,new Mt(l),l.bypassAuthState)}function Ho(l){const{auth:s,user:a}=l;return O(a,s,"internal-error"),it(a,new Mt(l),l.bypassAuthState)}function zo(l){return Zo.apply(this,arguments)}function Zo(){return(Zo=(0,p.Z)(function*(l){const{auth:s,user:a}=l;return O(a,s,"internal-error"),ns(a,new Mt(l),l.bypassAuthState)})).apply(this,arguments)}class me{constructor(s,a,c,y,I=!1){this.auth=s,this.resolver=c,this.user=y,this.bypassAuthState=I,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(a)?a:[a]}execute(){var s=this;return new Promise(function(){var a=(0,p.Z)(function*(c,y){s.pendingPromise={resolve:c,reject:y};try{s.eventManager=yield s.resolver._initialize(s.auth),yield s.onExecution(),s.eventManager.registerConsumer(s)}catch(I){s.reject(I)}});return function(c,y){return a.apply(this,arguments)}}())}onAuthEvent(s){var a=this;return(0,p.Z)(function*(){const{urlResponse:c,sessionId:y,postBody:I,tenantId:T,error:C,type:V}=s;if(C)return void a.reject(C);const j={auth:a.auth,requestUri:c,sessionId:y,tenantId:T||void 0,postBody:I||void 0,user:a.user,bypassAuthState:a.bypassAuthState};try{a.resolve(yield a.getIdpTask(V)(j))}catch(G){a.reject(G)}})()}onError(s){this.reject(s)}getIdpTask(s){switch(s){case"signInViaPopup":case"signInViaRedirect":return Ko;case"linkViaPopup":case"linkViaRedirect":return zo;case"reauthViaPopup":case"reauthViaRedirect":return Ho;default:se(this.auth,"internal-error")}}resolve(s){He(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(s),this.unregisterAndCleanUp()}reject(s){He(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(s),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Yo=new Wn(2e3,1e4);function wu(){return(wu=(0,p.Z)(function*(l,s,a){const c=ge(l);pe(l,s,Ut);const y=ht(c,a);return new Eu(c,"signInViaPopup",s,y).executeNotNull()})).apply(this,arguments)}function Ir(){return(Ir=(0,p.Z)(function*(l,s,a){const c=(0,R.m9)(l);pe(c.auth,s,Ut);const y=ht(c.auth,a);return new Eu(c.auth,"reauthViaPopup",s,y,c).executeNotNull()})).apply(this,arguments)}function Qo(){return(Qo=(0,p.Z)(function*(l,s,a){const c=(0,R.m9)(l);pe(c.auth,s,Ut);const y=ht(c.auth,a);return new Eu(c.auth,"linkViaPopup",s,y,c).executeNotNull()})).apply(this,arguments)}let Eu=(()=>{class l extends me{constructor(a,c,y,I,T){super(a,c,I,T),this.provider=y,this.authWindow=null,this.pollId=null,l.currentPopupAction&&l.currentPopupAction.cancel(),l.currentPopupAction=this}executeNotNull(){var a=this;return(0,p.Z)(function*(){const c=yield a.execute();return O(c,a.auth,"internal-error"),c})()}onExecution(){var a=this;return(0,p.Z)(function*(){He(1===a.filter.length,"Popup operations only handle one event");const c=gs();a.authWindow=yield a.resolver._openPopup(a.auth,a.provider,a.filter[0],c),a.authWindow.associatedEvent=c,a.resolver._originValidation(a.auth).catch(y=>{a.reject(y)}),a.resolver._isIframeWebStorageSupported(a.auth,y=>{y||a.reject(fe(a.auth,"web-storage-unsupported"))}),a.pollUserCancellation()})()}get eventId(){var a;return(null===(a=this.authWindow)||void 0===a?void 0:a.associatedEvent)||null}cancel(){this.reject(fe(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,l.currentPopupAction=null}pollUserCancellation(){const a=()=>{var c,y;this.pollId=(null===(y=null===(c=this.authWindow)||void 0===c?void 0:c.window)||void 0===y?void 0:y.closed)?window.setTimeout(()=>{this.pollId=null,this.reject(fe(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(a,Yo.get())};a()}}return l.currentPopupAction=null,l})();const Jo=new Map;class Ph extends me{constructor(s,a,c=!1){super(s,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],a,void 0,c),this.eventId=null}execute(){var s=()=>super.execute,a=this;return(0,p.Z)(function*(){let c=Jo.get(a.auth._key());if(!c){try{const I=(yield function Ds(l,s){return Bt.apply(this,arguments)}(a.resolver,a.auth))?yield s().call(a):null;c=()=>Promise.resolve(I)}catch(y){c=()=>Promise.reject(y)}Jo.set(a.auth._key(),c)}return a.bypassAuthState||Jo.set(a.auth._key(),()=>Promise.resolve(null)),c()})()}onAuthEvent(s){var a=()=>super.onAuthEvent,c=this;return(0,p.Z)(function*(){if("signInViaRedirect"===s.type)return a().call(c,s);if("unknown"!==s.type){if(s.eventId){const y=yield c.auth._redirectUserForId(s.eventId);if(y)return c.user=y,a().call(c,s);c.resolve(null)}}else c.resolve(null)})()}onExecution(){return(0,p.Z)(function*(){})()}cleanUp(){}}function Bt(){return(Bt=(0,p.Z)(function*(l,s){const a=Ql(s),c=wr(l);if(!(yield c._isAvailable()))return!1;const y="true"===(yield c._get(a));return yield c._remove(a),y})).apply(this,arguments)}function Xo(l,s){return ea.apply(this,arguments)}function ea(){return(ea=(0,p.Z)(function*(l,s){return wr(l)._set(Ql(s),"true")})).apply(this,arguments)}function wr(l){return Je(l._redirectPersistence)}function Ql(l){return rt("pendingRedirect",l.config.apiKey,l.name)}function Tu(){return(Tu=(0,p.Z)(function*(l,s,a){const c=ge(l);pe(l,s,Ut);const y=ht(c,a);return yield Xo(y,c),y._openRedirect(c,s,"signInViaRedirect")})).apply(this,arguments)}function ks(){return(ks=(0,p.Z)(function*(l,s,a){const c=(0,R.m9)(l);pe(c.auth,s,Ut);const y=ht(c.auth,a);yield Xo(y,c.auth);const I=yield Ns(c);return y._openRedirect(c.auth,s,"reauthViaRedirect",I)})).apply(this,arguments)}function ta(){return(ta=(0,p.Z)(function*(l,s,a){const c=(0,R.m9)(l);pe(c.auth,s,Ut);const y=ht(c.auth,a);yield ni(!1,c,s.providerId),yield Xo(y,c.auth);const I=yield Ns(c);return y._openRedirect(c.auth,s,"linkViaRedirect",I)})).apply(this,arguments)}function Cu(){return(Cu=(0,p.Z)(function*(l,s){return yield ge(l)._initializationPromise,na(l,s,!1)})).apply(this,arguments)}function na(l,s){return Su.apply(this,arguments)}function Su(){return(Su=(0,p.Z)(function*(l,s,a=!1){const c=ge(l),y=ht(c,s),T=yield new Ph(c,y,a).execute();return T&&!a&&(delete T.user._redirectEventId,yield c._persistUserIfCurrent(T.user),yield c._setRedirectUser(null,s)),T})).apply(this,arguments)}function Ns(l){return Er.apply(this,arguments)}function Er(){return(Er=(0,p.Z)(function*(l){const s=gs(`${l.uid}:::`);return l._redirectEventId=s,yield l.auth._setRedirectUser(l),yield l.auth._persistUserIfCurrent(l),s})).apply(this,arguments)}class ia{constructor(s){this.auth=s,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(s){this.consumers.add(s),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,s)&&(this.sendToConsumer(this.queuedRedirectEvent,s),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(s){this.consumers.delete(s)}onEvent(s){if(this.hasEventBeenHandled(s))return!1;let a=!1;return this.consumers.forEach(c=>{this.isEventForConsumer(s,c)&&(a=!0,this.sendToConsumer(s,c),this.saveEventToCache(s))}),this.hasHandledPotentialRedirect||!function Rs(l){switch(l.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return fi(l);default:return!1}}(s)||(this.hasHandledPotentialRedirect=!0,a||(this.queuedRedirectEvent=s,a=!0)),a}sendToConsumer(s,a){var c;if(s.error&&!fi(s)){const y=(null===(c=s.error.code)||void 0===c?void 0:c.split("auth/")[1])||"internal-error";a.onError(fe(this.auth,y))}else a.onAuthEvent(s)}isEventForConsumer(s,a){const c=null===a.eventId||!!s.eventId&&s.eventId===a.eventId;return a.filter.includes(s.type)&&c}hasEventBeenHandled(s){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(xu(s))}saveEventToCache(s){this.cachedEventUids.add(xu(s)),this.lastProcessedEventTime=Date.now()}}function xu(l){return[l.type,l.eventId,l.sessionId,l.tenantId].filter(s=>s).join("-")}function fi({type:l,error:s}){return"unknown"===l&&"auth/no-auth-event"===(null==s?void 0:s.code)}function nc(l){return Te.apply(this,arguments)}function Te(){return(Te=(0,p.Z)(function*(l,s={}){return ue(l,"GET","/v1/projects",s)})).apply(this,arguments)}const rc=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Lh=/^https?/;function Du(){return(Du=(0,p.Z)(function*(l){if(l.config.emulator)return;const{authorizedDomains:s}=yield nc(l);for(const a of s)try{if(Uh(a))return}catch(c){}se(l,"unauthorized-domain")})).apply(this,arguments)}function Uh(l){const s=$n(),{protocol:a,hostname:c}=new URL(s);if(l.startsWith("chrome-extension://")){const T=new URL(l);return""===T.hostname&&""===c?"chrome-extension:"===a&&l.replace("chrome-extension://","")===s.replace("chrome-extension://",""):"chrome-extension:"===a&&T.hostname===c}if(!Lh.test(a))return!1;if(rc.test(l))return c===l;const y=l.replace(/\./g,"\\.");return new RegExp("^(.+\\."+y+"|"+y+")$","i").test(c)}const ic=new Wn(3e4,6e4);function ku(){const l=Ne().___jsl;if(null==l?void 0:l.H)for(const s of Object.keys(l.H))if(l.H[s].r=l.H[s].r||[],l.H[s].L=l.H[s].L||[],l.H[s].r=[...l.H[s].L],l.CP)for(let a=0;a<l.CP.length;a++)l.CP[a]=null}let Tr=null;function oc(l){return Tr=Tr||function sc(l){return new Promise((s,a)=>{var c,y,I;function T(){ku(),gapi.load("gapi.iframes",{callback:()=>{s(gapi.iframes.getContext())},ontimeout:()=>{ku(),a(fe(l,"network-request-failed"))},timeout:ic.get()})}if(null===(y=null===(c=Ne().gapi)||void 0===c?void 0:c.iframes)||void 0===y?void 0:y.Iframe)s(gapi.iframes.getContext());else{if(!(null===(I=Ne().gapi)||void 0===I?void 0:I.load)){const C=gu("iframefcb");return Ne()[C]=()=>{gapi.load?T():a(fe(l,"network-request-failed"))},pu(`https://apis.google.com/js/api.js?onload=${C}`).catch(V=>a(V))}T()}}).catch(s=>{throw Tr=null,s})}(l),Tr}const cn=new Wn(5e3,15e3),Nu={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Os=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function uc(l){const s=l.config;O(s.authDomain,l,"auth-domain-config-required");const a=s.emulator?Li(s,"emulator/auth/iframe"):`https://${l.config.authDomain}/__/auth/iframe`,c={apiKey:s.apiKey,appName:l.name,v:je.SDK_VERSION},y=Os.get(l.config.apiHost);y&&(c.eid=y);const I=l._getFrameworks();return I.length&&(c.fw=I.join(",")),`${a}?${(0,R.xO)(c).slice(1)}`}function pi(){return pi=(0,p.Z)(function*(l){const s=yield oc(l),a=Ne().gapi;return O(a,l,"internal-error"),s.open({where:document.body,url:uc(l),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Nu,dontclear:!0},c=>new Promise(function(){var y=(0,p.Z)(function*(I,T){yield c.restyle({setHideOnLeave:!1});const C=fe(l,"network-request-failed"),V=Ne().setTimeout(()=>{T(C)},cn.get());function j(){Ne().clearTimeout(V),I(c)}c.ping(j).then(j,()=>{T(C)})});return function(I,T){return y.apply(this,arguments)}}()))}),pi.apply(this,arguments)}const lc={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class gi{constructor(s){this.window=s,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(s){}}}function oa(l,s,a,c,y,I){O(l.config.authDomain,l,"auth-domain-config-required"),O(l.config.apiKey,l,"invalid-api-key");const T={apiKey:l.config.apiKey,appName:l.name,authType:a,redirectUrl:c,v:je.SDK_VERSION,eventId:y};if(s instanceof Ut){s.setDefaultLanguage(l.languageCode),T.providerId=s.providerId||"",(0,R.xb)(s.getCustomParameters())||(T.customParameters=JSON.stringify(s.getCustomParameters()));for(const[V,j]of Object.entries(I||{}))T[V]=j}if(s instanceof sn){const V=s.getScopes().filter(j=>""!==j);V.length>0&&(T.scopes=V.join(","))}l.tenantId&&(T.tid=l.tenantId);const C=T;for(const V of Object.keys(C))void 0===C[V]&&delete C[V];return`${function aa({config:l}){return l.emulator?Li(l,"emulator/auth/handler"):`https://${l.authDomain}/__/auth/handler`}(l)}?${(0,R.xO)(C).slice(1)}`}const ua="webStorageSupport";class la extends class pc{constructor(s){this.factorId=s}_process(s,a,c){switch(a.type){case"enroll":return this._finalizeEnroll(s,a.credential,c);case"signin":return this._finalizeSignIn(s,a.credential);default:return St("unexpected MultiFactorSessionType")}}}{constructor(s){super("phone"),this.credential=s}static _fromCredential(s){return new la(s)}_finalizeEnroll(s,a,c){return function ql(l,s){return ue(l,"POST","/v2/accounts/mfaEnrollment:finalize",W(l,s))}(s,{idToken:a,displayName:c,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(s,a){return function Is(l,s){return ue(l,"POST","/v2/accounts/mfaSignIn:finalize",W(l,s))}(s,{mfaPendingCredential:a,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let gc=(()=>{class l{constructor(){}static assertion(a){return la._fromCredential(a)}}return l.FACTOR_ID="phone",l})();var Vu="@firebase/auth",Ms="0.19.12";class dt{constructor(s){this.auth=s,this.internalListeners=new Map}getUid(){var s;return this.assertAuthConfigured(),(null===(s=this.auth.currentUser)||void 0===s?void 0:s.uid)||null}getToken(s){var a=this;return(0,p.Z)(function*(){return a.assertAuthConfigured(),yield a.auth._initializationPromise,a.auth.currentUser?{accessToken:yield a.auth.currentUser.getIdToken(s)}:null})()}addAuthTokenListener(s){if(this.assertAuthConfigured(),this.internalListeners.has(s))return;const a=this.auth.onIdTokenChanged(c=>{var y;s((null===(y=c)||void 0===y?void 0:y.stsTokenManager.accessToken)||null)});this.internalListeners.set(s,a),this.updateProactiveRefresh()}removeAuthTokenListener(s){this.assertAuthConfigured();const a=this.internalListeners.get(s);!a||(this.internalListeners.delete(s),a(),this.updateProactiveRefresh())}assertAuthConfigured(){O(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Ar(){return window}function Fu(){return(Fu=(0,p.Z)(function*(l,s,a){var c;const{BuildInfo:y}=Ar();He(s.sessionId,"AuthEvent did not contain a session ID");const I=yield Ke(s.sessionId),T={};return Qt()?T.ibi=y.packageName:wn()?T.apn=y.packageName:se(l,"operation-not-supported-in-this-environment"),y.displayName&&(T.appDisplayName=y.displayName),T.sessionId=I,oa(l,a,s.type,void 0,null!==(c=s.eventId)&&void 0!==c?c:void 0,T)})).apply(this,arguments)}function ca(){return(ca=(0,p.Z)(function*(l){const{BuildInfo:s}=Ar(),a={};Qt()?a.iosBundleId=s.packageName:wn()?a.androidPackageName=s.packageName:se(l,"operation-not-supported-in-this-environment"),yield nc(l,a)})).apply(this,arguments)}function Uu(){return(Uu=(0,p.Z)(function*(l,s,a){const{cordova:c}=Ar();let y=()=>{};try{yield new Promise((I,T)=>{let C=null;function V(){var H;I();const J=null===(H=c.plugins.browsertab)||void 0===H?void 0:H.close;"function"==typeof J&&J(),"function"==typeof(null==a?void 0:a.close)&&a.close()}function j(){C||(C=window.setTimeout(()=>{T(fe(l,"redirect-cancelled-by-user"))},2e3))}function G(){"visible"===(null==document?void 0:document.visibilityState)&&j()}s.addPassiveListener(V),document.addEventListener("resume",j,!1),wn()&&document.addEventListener("visibilitychange",G,!1),y=()=>{s.removePassiveListener(V),document.removeEventListener("resume",j,!1),document.removeEventListener("visibilitychange",G,!1),C&&window.clearTimeout(C)}})}finally{y()}})).apply(this,arguments)}function Ke(l){return Rn.apply(this,arguments)}function Rn(){return(Rn=(0,p.Z)(function*(l){const s=On(l),a=yield crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(a)).map(y=>y.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}function On(l){if(He(/[0-9a-zA-Z]+/.test(l),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(l);const s=new ArrayBuffer(l.length),a=new Uint8Array(s);for(let c=0;c<l.length;c++)a[c]=l.charCodeAt(c);return a}!function yc(l){(0,je._registerComponent)(new Mr.wA("auth",(s,{options:a})=>{const c=s.getProvider("app").getImmediate(),y=s.getProvider("heartbeat"),{apiKey:I,authDomain:T}=c.options;return((C,V)=>{O(I&&!I.includes(":"),"invalid-api-key",{appName:C.name}),O(!(null==T?void 0:T.includes(":")),"argument-error",{appName:C.name});const j={apiKey:I,authDomain:T,clientPlatform:l,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Gi(l)},G=new Xn(C,V,j);return function co(l,s){const a=(null==s?void 0:s.persistence)||[],c=(Array.isArray(a)?a:[a]).map(Je);(null==s?void 0:s.errorMap)&&l._updateErrorMap(s.errorMap),l._initializeWithPersistence(c,null==s?void 0:s.popupRedirectResolver)}(G,a),G})(c,y)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((s,a,c)=>{s.getProvider("auth-internal").initialize()})),(0,je._registerComponent)(new Mr.wA("auth-internal",s=>{const a=ge(s.getProvider("auth").getImmediate());return new dt(a)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,je.registerVersion)(Vu,Ms,function mc(l){switch(l){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(l)),(0,je.registerVersion)(Vu,Ms,"esm2017")}("Browser");class Wh extends ia{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(s=>{this.resolveInialized=s})}addPassiveListener(s){this.passiveListeners.add(s)}removePassiveListener(s){this.passiveListeners.delete(s)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(s){return this.resolveInialized(),this.passiveListeners.forEach(a=>a(s)),super.onEvent(s)}initialized(){var s=this;return(0,p.Z)(function*(){yield s.initPromise})()}}function mi(l){return Vs.apply(this,arguments)}function Vs(){return(Vs=(0,p.Z)(function*(l){const s=yield Gu()._get(L(l));return s&&(yield Gu()._remove(L(l))),s})).apply(this,arguments)}function Q(){const l=[],s="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let a=0;a<20;a++){const c=Math.floor(Math.random()*s.length);l.push(s.charAt(c))}return l.join("")}function Gu(){return Je(ps)}function L(l){return rt("authEvent",l.config.apiKey,l.name)}function De(l){if(!(null==l?void 0:l.includes("?")))return{};const[s,...a]=l.split("?");return(0,R.zd)(a.join("?"))}function Ic(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:fe("no-auth-event")}}function qu(){var l;return(null===(l=null==self?void 0:self.location)||void 0===l?void 0:l.protocol)||null}function Ec(l=(0,R.z$)()){return!("file:"!==qu()&&"ionic:"!==qu()||!l.toLowerCase().match(/iphone|ipad|ipod|android/))}function Ae(){try{const l=self.localStorage,s=gs();if(l)return l.setItem(s,"1"),l.removeItem(s),!function Ac(l=(0,R.z$)()){return function X(){return(0,R.w1)()&&11===(null==document?void 0:document.documentMode)}()||function yi(l=(0,R.z$)()){return/Edge\/\d+/.test(l)}(l)}()||(0,R.hl)()}catch(l){return z()&&(0,R.hl)()}return!1}function z(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function da(){return(function ft(){return"http:"===qu()||"https:"===qu()}()||(0,R.ru)()||Ec())&&!function Tc(){return(0,R.b$)()||(0,R.UG)()}()&&Ae()&&!z()}function Mn(){return Ec()&&"undefined"!=typeof document}function br(){return(br=(0,p.Z)(function*(){return!!Mn()&&new Promise(l=>{const s=setTimeout(()=>{l(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(s),l(!0)})})})).apply(this,arguments)}const pt={LOCAL:"local",NONE:"none",SESSION:"session"},be=O,Cr="persistence";function ke(l){return ju.apply(this,arguments)}function ju(){return(ju=(0,p.Z)(function*(l){yield l._initializationPromise;const s=_e(),a=rt(Cr,l.config.apiKey,l.name);s&&s.setItem(a,l._getPersistence())})).apply(this,arguments)}function _e(){var l;try{return(null===(l=function ne(){return"undefined"!=typeof window?window:null}())||void 0===l?void 0:l.sessionStorage)||null}catch(s){return null}}const Sr=O;class Gt{constructor(){this.browserResolver=Je(class fc{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=xn,this._completeRedirectFn=na}_openPopup(s,a,c,y){var I=this;return(0,p.Z)(function*(){var T;He(null===(T=I.eventManagers[s._key()])||void 0===T?void 0:T.manager,"_initialize() not called before _openPopup()");const C=oa(s,a,c,$n(),y);return function hc(l,s,a,c=500,y=600){const I=Math.max((window.screen.availHeight-y)/2,0).toString(),T=Math.max((window.screen.availWidth-c)/2,0).toString();let C="";const V=Object.assign(Object.assign({},lc),{width:c.toString(),height:y.toString(),top:I,left:T}),j=(0,R.z$)().toLowerCase();a&&(C=Kr(j)?"_blank":a),Fi(j)&&(s=s||"http://localhost",V.scrollbars="yes");const G=Object.entries(V).reduce((J,[st,Ii])=>`${J}${st}=${Ii},`,"");if(function ja(l=(0,R.z$)()){var s;return Qt(l)&&!!(null===(s=window.navigator)||void 0===s?void 0:s.standalone)}(j)&&"_self"!==C)return function dc(l,s){const a=document.createElement("a");a.href=l,a.target=s;const c=document.createEvent("MouseEvent");c.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(c)}(s||"",C),new gi(null);const H=window.open(s||"",C,G);O(H,l,"popup-blocked");try{H.focus()}catch(J){}return new gi(H)}(s,C,gs())})()}_openRedirect(s,a,c,y){var I=this;return(0,p.Z)(function*(){return yield I._originValidation(s),function bh(l){Ne().location.href=l}(oa(s,a,c,$n(),y)),new Promise(()=>{})})()}_initialize(s){const a=s._key();if(this.eventManagers[a]){const{manager:y,promise:I}=this.eventManagers[a];return y?Promise.resolve(y):(He(I,"If manager is not set, promise should be"),I)}const c=this.initAndGetManager(s);return this.eventManagers[a]={promise:c},c.catch(()=>{delete this.eventManagers[a]}),c}initAndGetManager(s){var a=this;return(0,p.Z)(function*(){const c=yield function Ru(l){return pi.apply(this,arguments)}(s),y=new ia(s);return c.register("authEvent",I=>(O(null==I?void 0:I.authEvent,s,"invalid-auth-event"),{status:y.onEvent(I.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),a.eventManagers[s._key()]={manager:y},a.iframes[s._key()]=c,y})()}_isIframeWebStorageSupported(s,a){this.iframes[s._key()].send(ua,{type:ua},y=>{var I;const T=null===(I=null==y?void 0:y[0])||void 0===I?void 0:I[ua];void 0!==T&&a(!!T),se(s,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(s){const a=s._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function Fh(l){return Du.apply(this,arguments)}(s)),this.originValidationPromises[a]}get _shouldInitProactively(){return Jt()||Qn()||Qt()}}),this.cordovaResolver=Je(class Kh{constructor(){this._redirectPersistence=xn,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=na}_initialize(s){var a=this;return(0,p.Z)(function*(){const c=s._key();let y=a.eventManagers.get(c);return y||(y=new Wh(s),a.eventManagers.set(c,y),a.attachCallbackListeners(s,y)),y})()}_openPopup(s){se(s,"operation-not-supported-in-this-environment")}_openRedirect(s,a,c,y){var I=this;return(0,p.Z)(function*(){!function _c(l){var s,a,c,y,I,T,C,V,j,G;const H=Ar();O("function"==typeof(null===(s=null==H?void 0:H.universalLinks)||void 0===s?void 0:s.subscribe),l,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),O(void 0!==(null===(a=null==H?void 0:H.BuildInfo)||void 0===a?void 0:a.packageName),l,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),O("function"==typeof(null===(I=null===(y=null===(c=null==H?void 0:H.cordova)||void 0===c?void 0:c.plugins)||void 0===y?void 0:y.browsertab)||void 0===I?void 0:I.openUrl),l,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),O("function"==typeof(null===(V=null===(C=null===(T=null==H?void 0:H.cordova)||void 0===T?void 0:T.plugins)||void 0===C?void 0:C.browsertab)||void 0===V?void 0:V.isAvailable),l,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),O("function"==typeof(null===(G=null===(j=null==H?void 0:H.cordova)||void 0===j?void 0:j.InAppBrowser)||void 0===G?void 0:G.open),l,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(s);const T=yield I._initialize(s);yield T.initialized(),T.resetRedirect(),function Yl(){Jo.clear()}(),yield I._originValidation(s);const C=function M(l,s,a=null){return{type:s,eventId:a,urlResponse:null,sessionId:Q(),postBody:null,tenantId:l.tenantId,error:fe(l,"no-auth-event")}}(s,c,y);yield function Oe(l,s){return Gu()._set(L(l),s)}(s,C);const V=yield function Lu(l,s,a){return Fu.apply(this,arguments)}(s,C,a),j=yield function $h(l){const{cordova:s}=Ar();return new Promise(a=>{s.plugins.browsertab.isAvailable(c=>{let y=null;c?s.plugins.browsertab.openUrl(l):y=s.InAppBrowser.open(l,function Bi(l=(0,R.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(l)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(l)}()?"_blank":"_system","location=yes"),a(y)})})}(V);return function ha(l,s,a){return Uu.apply(this,arguments)}(s,T,j)})()}_isIframeWebStorageSupported(s,a){throw new Error("Method not implemented.")}_originValidation(s){const a=s._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function jh(l){return ca.apply(this,arguments)}(s)),this.originValidationPromises[a]}attachCallbackListeners(s,a){const{universalLinks:c,handleOpenURL:y,BuildInfo:I}=Ar(),T=setTimeout((0,p.Z)(function*(){yield mi(s),a.onEvent(Ic())}),500),C=function(){var G=(0,p.Z)(function*(H){clearTimeout(T);const J=yield mi(s);let st=null;J&&(null==H?void 0:H.url)&&(st=function q(l,s){var a,c;const y=function N(l){const s=De(l),a=s.link?decodeURIComponent(s.link):void 0,c=De(a).link,y=s.deep_link_id?decodeURIComponent(s.deep_link_id):void 0;return De(y).link||y||c||a||l}(s);if(y.includes("/__/auth/callback")){const I=De(y),T=I.firebaseError?function b(l){try{return JSON.parse(l)}catch(s){return null}}(decodeURIComponent(I.firebaseError)):null,C=null===(c=null===(a=null==T?void 0:T.code)||void 0===a?void 0:a.split("auth/"))||void 0===c?void 0:c[1],V=C?fe(C):null;return V?{type:l.type,eventId:l.eventId,tenantId:l.tenantId,error:V,urlResponse:null,sessionId:null,postBody:null}:{type:l.type,eventId:l.eventId,tenantId:l.tenantId,sessionId:l.sessionId,urlResponse:y,postBody:null}}return null}(J,H.url)),a.onEvent(st||Ic())});return function(J){return G.apply(this,arguments)}}();void 0!==c&&"function"==typeof c.subscribe&&c.subscribe(null,C);const V=y,j=`${I.packageName.toLowerCase()}://`;Ar().handleOpenURL=function(){var G=(0,p.Z)(function*(H){if(H.toLowerCase().startsWith(j)&&C({url:H}),"function"==typeof V)try{V(H)}catch(J){console.error(J)}});return function(H){return G.apply(this,arguments)}}()}}),this.underlyingResolver=null,this._redirectPersistence=xn,this._completeRedirectFn=na}_initialize(s){var a=this;return(0,p.Z)(function*(){return yield a.selectUnderlyingResolver(),a.assertedUnderlyingResolver._initialize(s)})()}_openPopup(s,a,c,y){var I=this;return(0,p.Z)(function*(){return yield I.selectUnderlyingResolver(),I.assertedUnderlyingResolver._openPopup(s,a,c,y)})()}_openRedirect(s,a,c,y){var I=this;return(0,p.Z)(function*(){return yield I.selectUnderlyingResolver(),I.assertedUnderlyingResolver._openRedirect(s,a,c,y)})()}_isIframeWebStorageSupported(s,a){this.assertedUnderlyingResolver._isIframeWebStorageSupported(s,a)}_originValidation(s){return this.assertedUnderlyingResolver._originValidation(s)}get _shouldInitProactively(){return Mn()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Sr(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var s=this;return(0,p.Z)(function*(){if(s.underlyingResolver)return;const a=yield function bc(){return br.apply(this,arguments)}();s.underlyingResolver=a?s.cordovaResolver:s.browserResolver})()}}function $u(l){return l.unwrap()}function Jh(l){return Vn(l)}function Vn(l){const{_tokenResponse:s}=l instanceof R.ZR?l.customData:l;if(!s)return null;if(!(l instanceof R.ZR)&&"temporaryProof"in s&&"phoneNumber"in s)return Ss.credentialFromResult(l);const a=s.providerId;if(!a||"password"===a)return null;let c;switch(a){case"google.com":c=Ji;break;case"facebook.com":c=Qa;break;case"github.com":c=Xi;break;case"twitter.com":c=ts;break;default:const{oauthIdToken:y,oauthAccessToken:I,oauthTokenSecret:T,pendingToken:C,nonce:V}=s;return I||T||y||C?C?a.startsWith("saml.")?on._create(a,C):It._fromParams({providerId:a,signInMethod:a,pendingToken:C,idToken:y,accessToken:I}):new An(a).credential({idToken:y,accessToken:I,rawNonce:V}):null}return l instanceof R.ZR?c.credentialFromError(l):c.credentialFromResult(l)}function Ue(l,s){return s.catch(a=>{throw a instanceof R.ZR&&function hn(l,s){var a;const c=null===(a=s.customData)||void 0===a?void 0:a._tokenResponse;if("auth/multi-factor-auth-required"===s.code)s.resolver=new Cc(l,function Gl(l,s){var a;const c=(0,R.m9)(l),y=s;return O(s.customData.operationType,c,"argument-error"),O(null===(a=y.customData._serverResponse)||void 0===a?void 0:a.mfaPendingCredential,c,"argument-error"),Mo._fromError(c,y)}(l,s));else if(c){const y=Vn(s),I=s;y&&(I.credential=y,I.tenantId=c.tenantId||void 0,I.email=c.email||void 0,I.phoneNumber=c.phoneNumber||void 0)}}(l,a),a}).then(a=>{const y=a.user;return{operationType:a.operationType,credential:Jh(a),additionalUserInfo:wh(a),user:qt.getOrCreate(y)}})}function fa(l,s){return P.apply(this,arguments)}function P(){return(P=(0,p.Z)(function*(l,s){const a=yield s;return{verificationId:a.verificationId,confirm:c=>Ue(l,a.confirm(c))}})).apply(this,arguments)}class Cc{constructor(s,a){this.resolver=a,this.auth=function Ls(l){return l.wrapped()}(s)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(s){return Ue($u(this.auth),this.resolver.resolveSignIn(s))}}class qt{constructor(s){this._delegate=s,this.multiFactor=function su(l){const s=(0,R.m9)(l);return fs.has(s)||fs.set(s,ds._fromUser(s)),fs.get(s)}(s)}static getOrCreate(s){return qt.USER_MAP.has(s)||qt.USER_MAP.set(s,new qt(s)),qt.USER_MAP.get(s)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(s){return this._delegate.getIdTokenResult(s)}getIdToken(s){return this._delegate.getIdToken(s)}linkAndRetrieveDataWithCredential(s){return this.linkWithCredential(s)}linkWithCredential(s){var a=this;return(0,p.Z)(function*(){return Ue(a.auth,Sn(a._delegate,s))})()}linkWithPhoneNumber(s,a){var c=this;return(0,p.Z)(function*(){return fa(c.auth,function _r(l,s,a){return As.apply(this,arguments)}(c._delegate,s,a))})()}linkWithPopup(s){var a=this;return(0,p.Z)(function*(){return Ue(a.auth,function Oh(l,s,a){return Qo.apply(this,arguments)}(a._delegate,s,Gt))})()}linkWithRedirect(s){var a=this;return(0,p.Z)(function*(){return yield ke(ge(a.auth)),function Au(l,s,a){return function tc(l,s,a){return ta.apply(this,arguments)}(l,s,a)}(a._delegate,s,Gt)})()}reauthenticateAndRetrieveDataWithCredential(s){return this.reauthenticateWithCredential(s)}reauthenticateWithCredential(s){var a=this;return(0,p.Z)(function*(){return Ue(a.auth,si(a._delegate,s))})()}reauthenticateWithPhoneNumber(s,a){return fa(this.auth,function Nh(l,s,a){return bs.apply(this,arguments)}(this._delegate,s,a))}reauthenticateWithPopup(s){return Ue(this.auth,function xs(l,s,a){return Ir.apply(this,arguments)}(this._delegate,s,Gt))}reauthenticateWithRedirect(s){var a=this;return(0,p.Z)(function*(){return yield ke(ge(a.auth)),function Xl(l,s,a){return function ec(l,s,a){return ks.apply(this,arguments)}(l,s,a)}(a._delegate,s,Gt)})()}sendEmailVerification(s){return function eu(l,s){return xo.apply(this,arguments)}(this._delegate,s)}unlink(s){var a=this;return(0,p.Z)(function*(){return yield function Ja(l,s){return ti.apply(this,arguments)}(a._delegate,s),a})()}updateEmail(s){return function mh(l,s){return No((0,R.m9)(l),s,null)}(this._delegate,s)}updatePassword(s){return function yh(l,s){return No((0,R.m9)(l),null,s)}(this._delegate,s)}updatePhoneNumber(s){return function vr(l,s){return Wo.apply(this,arguments)}(this._delegate,s)}updateProfile(s){return function tu(l,s){return ls.apply(this,arguments)}(this._delegate,s)}verifyBeforeUpdateEmail(s,a){return function gh(l,s,a){return Do.apply(this,arguments)}(this._delegate,s,a)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}qt.USER_MAP=new WeakMap;const Pt=O;let Vt=(()=>{class l{constructor(a,c){if(this.app=a,c.isInitialized())return this._delegate=c.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:y}=a.options;Pt(y,"invalid-api-key",{appName:a.name}),Pt(y,"invalid-api-key",{appName:a.name});const I="undefined"!=typeof window?Gt:void 0;this._delegate=c.initialize({options:{persistence:Ln(y,a.name),popupRedirectResolver:I}}),this._delegate._updateErrorMap(_t),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?qt.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(a){this._delegate.languageCode=a}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(a){this._delegate.tenantId=a}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(a,c){!function Xt(l,s,a){const c=ge(l);O(c._canInitEmulator,c,"emulator-config-failed"),O(/^https?:\/\//.test(s),c,"invalid-emulator-scheme");const y=!!(null==a?void 0:a.disableWarnings),I=Nt(s),{host:T,port:C}=function $a(l){const s=Nt(l),a=/(\/\/)?([^?#/]+)/.exec(l.substr(s.length));if(!a)return{host:"",port:null};const c=a[2].split("@").pop()||"",y=/^(\[[^\]]+\])(:|$)/.exec(c);if(y){const I=y[1];return{host:I,port:zr(c.substr(I.length+1))}}{const[I,T]=c.split(":");return{host:I,port:zr(T)}}}(s);c.config.emulator={url:`${I}//${T}${null===C?"":`:${C}`}/`},c.settings.appVerificationDisabledForTesting=!0,c.emulatorConfig=Object.freeze({host:T,port:C,protocol:I.replace(":",""),options:Object.freeze({disableWarnings:y})}),y||function Eo(){function l(){const s=document.createElement("p"),a=s.style;s.innerText="Running in emulator mode. Do not use with production credentials.",a.position="fixed",a.width="100%",a.backgroundColor="#ffffff",a.border=".1em solid #000000",a.color="#b50000",a.bottom="0px",a.left="0px",a.margin="0px",a.zIndex="10000",a.textAlign="center",s.classList.add("firebase-emulator-warning"),document.body.appendChild(s)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",l):l())}()}(this._delegate,a,c)}applyActionCode(a){return function d(l,s){return v.apply(this,arguments)}(this._delegate,a)}checkActionCode(a){return x(this._delegate,a)}confirmPasswordReset(a,c){return function g(l,s,a){return f.apply(this,arguments)}(this._delegate,a,c)}createUserWithEmailAndPassword(a,c){var y=this;return(0,p.Z)(function*(){return Ue(y._delegate,function ye(l,s,a){return Ot.apply(this,arguments)}(y._delegate,a,c))})()}fetchProvidersForEmail(a){return this.fetchSignInMethodsForEmail(a)}fetchSignInMethodsForEmail(a){return function ui(l,s){return So.apply(this,arguments)}(this._delegate,a)}isSignInWithEmailLink(a){return function Pl(l,s){const a=rn.parseLink(s);return"EMAIL_SIGNIN"===(null==a?void 0:a.operation)}(0,a)}getRedirectResult(){var a=this;return(0,p.Z)(function*(){Pt(da(),a._delegate,"operation-not-supported-in-this-environment");const c=yield function bu(l,s){return Cu.apply(this,arguments)}(a._delegate,Gt);return c?Ue(a._delegate,Promise.resolve(c)):{credential:null,user:null}})()}addFrameworkForLogging(a){!function zh(l,s){ge(l)._logFramework(s)}(this._delegate,a)}onAuthStateChanged(a,c,y){const{next:I,error:T,complete:C}=_i(a,c,y);return this._delegate.onAuthStateChanged(I,T,C)}onIdTokenChanged(a,c,y){const{next:I,error:T,complete:C}=_i(a,c,y);return this._delegate.onIdTokenChanged(I,T,C)}sendSignInLinkToEmail(a,c){return function pr(l,s,a){return ai.apply(this,arguments)}(this._delegate,a,c)}sendPasswordResetEmail(a,c){return function Ml(l,s,a){return os.apply(this,arguments)}(this._delegate,a,c||void 0)}setPersistence(a){var c=this;return(0,p.Z)(function*(){let y;switch(function Qh(l,s){be(Object.values(pt).includes(s),l,"invalid-persistence-type"),(0,R.b$)()?be(s!==pt.SESSION,l,"unsupported-persistence-type"):(0,R.UG)()?be(s===pt.NONE,l,"unsupported-persistence-type"):z()?be(s===pt.NONE||s===pt.LOCAL&&(0,R.hl)(),l,"unsupported-persistence-type"):be(s===pt.NONE||Ae(),l,"unsupported-persistence-type")}(c._delegate,a),a){case pt.SESSION:y=xn;break;case pt.LOCAL:y=(yield Je(Re)._isAvailable())?Re:ps;break;case pt.NONE:y=kt;break;default:return se("argument-error",{appName:c._delegate.name})}return c._delegate.setPersistence(y)})()}signInAndRetrieveDataWithCredential(a){return this.signInWithCredential(a)}signInAnonymously(){return Ue(this._delegate,function ei(l){return cr.apply(this,arguments)}(this._delegate))}signInWithCredential(a){return Ue(this._delegate,an(this._delegate,a))}signInWithCustomToken(a){return Ue(this._delegate,function Ve(l,s){return un.apply(this,arguments)}(this._delegate,a))}signInWithEmailAndPassword(a,c){return Ue(this._delegate,function fr(l,s,a){return an((0,R.m9)(l),Qr.credential(s,a))}(this._delegate,a,c))}signInWithEmailLink(a,c){return Ue(this._delegate,function Vl(l,s,a){return as.apply(this,arguments)}(this._delegate,a,c))}signInWithPhoneNumber(a,c){return fa(this._delegate,function $o(l,s,a){return yr.apply(this,arguments)}(this._delegate,a,c))}signInWithPopup(a){var c=this;return(0,p.Z)(function*(){return Pt(da(),c._delegate,"operation-not-supported-in-this-environment"),Ue(c._delegate,function Rh(l,s,a){return wu.apply(this,arguments)}(c._delegate,a,Gt))})()}signInWithRedirect(a){var c=this;return(0,p.Z)(function*(){return Pt(da(),c._delegate,"operation-not-supported-in-this-environment"),yield ke(c._delegate),function Vh(l,s,a){return function Jl(l,s,a){return Tu.apply(this,arguments)}(l,s,a)}(c._delegate,a,Gt)})()}updateCurrentUser(a){return this._delegate.updateCurrentUser(a)}verifyPasswordResetCode(a){return function ee(l,s){return Le.apply(this,arguments)}(this._delegate,a)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return l.Persistence=pt,l})();function _i(l,s,a){let c=l;"function"!=typeof l&&({next:c,error:s,complete:a}=l);const y=c;return{next:T=>y(T&&qt.getOrCreate(T)),error:s,complete:a}}function Ln(l,s){const a=function Pn(l,s){const a=_e();if(!a)return[];const c=rt(Cr,l,s);switch(a.getItem(c)){case pt.NONE:return[kt];case pt.LOCAL:return[Re,xn];case pt.SESSION:return[xn];default:return[]}}(l,s);if("undefined"!=typeof self&&!a.includes(Re)&&a.push(Re),"undefined"!=typeof window)for(const c of[ps,xn])a.includes(c)||a.push(c);return a.includes(kt)||a.push(kt),a}class pa{constructor(){this.providerId="phone",this._delegate=new Ss($u($.Z.auth()))}static credential(s,a){return Ss.credential(s,a)}verifyPhoneNumber(s,a){return this._delegate.verifyPhoneNumber(s,a)}unwrap(){return this._delegate}}pa.PHONE_SIGN_IN_METHOD=Ss.PHONE_SIGN_IN_METHOD,pa.PROVIDER_ID=Ss.PROVIDER_ID;const vi=O;class Wu{constructor(s,a,c=$.Z.app()){var y;vi(null===(y=c.options)||void 0===y?void 0:y.apiKey,"invalid-api-key",{appName:c.name}),this._delegate=new kh(s,a,c.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function Ku(l){l.INTERNAL.registerComponent(new Mr.wA("auth-compat",s=>{const a=s.getProvider("app-compat").getImmediate(),c=s.getProvider("auth");return new Vt(a,c)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:Qr,FacebookAuthProvider:Qa,GithubAuthProvider:Xi,GoogleAuthProvider:Ji,OAuthProvider:An,SAMLAuthProvider:bn,PhoneAuthProvider:pa,PhoneMultiFactorGenerator:gc,RecaptchaVerifier:Wu,TwitterAuthProvider:ts,Auth:Vt,AuthCredential:Lt,Error:R.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),l.registerVersion("@firebase/auth-compat","0.2.12")}($.Z)},2382:(hh,Mi,K)=>{K.d(Mi,{Fj:()=>se,u5:()=>Ee,JJ:()=>$e,On:()=>sr,YN:()=>bn,UX:()=>Tt,EJ:()=>ur,Kr:()=>ei});var p=K(5e3),$=K(9808),R=K(8306),je=K(4742),Ht=K(8421),bt=K(7669),Mr=K(5403),jn=K(3268),tt=K(1810),xl=K(8996),fn=K(4004);let oo=(()=>{class g{constructor(d,v){this._renderer=d,this._elementRef=v,this.onChange=x=>{},this.onTouched=()=>{}}setProperty(d,v){this._renderer.setProperty(this._elementRef.nativeElement,d,v)}registerOnTouched(d){this.onTouched=d}registerOnChange(d){this.onChange=d}setDisabledState(d){this.setProperty("disabled",d)}}return g.\u0275fac=function(d){return new(d||g)(p.Y36(p.Qsj),p.Y36(p.SBq))},g.\u0275dir=p.lG2({type:g}),g})(),Ct=(()=>{class g extends oo{}return g.\u0275fac=function(){let f;return function(v){return(f||(f=p.n5z(g)))(v||g)}}(),g.\u0275dir=p.lG2({type:g,features:[p.qOj]}),g})();const _t=new p.OlP("NgValueAccessor"),ao={provide:_t,useExisting:(0,p.Gpc)(()=>se),multi:!0},Se=new p.OlP("CompositionEventMode");let se=(()=>{class g extends oo{constructor(d,v,x){super(d,v),this._compositionMode=x,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function Vr(){const g=(0,$.q)()?(0,$.q)().getUserAgent():"";return/android (\d+)/.test(g.toLowerCase())}())}writeValue(d){this.setProperty("value",null==d?"":d)}_handleInput(d){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(d)}_compositionStart(){this._composing=!0}_compositionEnd(d){this._composing=!1,this._compositionMode&&this.onChange(d)}}return g.\u0275fac=function(d){return new(d||g)(p.Y36(p.Qsj),p.Y36(p.SBq),p.Y36(Se,8))},g.\u0275dir=p.lG2({type:g,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(d,v){1&d&&p.NdJ("input",function(B){return v._handleInput(B.target.value)})("blur",function(){return v.onTouched()})("compositionstart",function(){return v._compositionStart()})("compositionend",function(B){return v._compositionEnd(B.target.value)})},features:[p._Bn([ao]),p.qOj]}),g})();const pe=new p.OlP("NgValidators"),vt=new p.OlP("NgAsyncValidators");function Ba(g){return null!=g}function Wn(g){const f=(0,p.QGY)(g)?(0,xl.D)(g):g;return(0,p.CqO)(f),f}function Li(g){let f={};return g.forEach(d=>{f=null!=d?Object.assign(Object.assign({},f),d):f}),0===Object.keys(f).length?null:f}function fo(g,f){return f.map(d=>d(g))}function Kn(g){return g.map(f=>function zt(g){return!g.validate}(f)?f:d=>f.validate(d))}function ue(g){return null!=g?function W(g){if(!g)return null;const f=g.filter(Ba);return 0==f.length?null:function(d){return Li(fo(d,f))}}(Kn(g)):null}function Fr(g){return null!=g?function Hn(g){if(!g)return null;const f=g.filter(Ba);return 0==f.length?null:function(d){return function nt(...g){const f=(0,bt.jO)(g),{args:d,keys:v}=(0,je.D)(g),x=new R.y(B=>{const{length:ee}=d;if(!ee)return void B.complete();const Le=new Array(ee);let ye=ee,Ot=ee;for(let fr=0;fr<ee;fr++){let pr=!1;(0,Ht.Xf)(d[fr]).subscribe((0,Mr.x)(B,ai=>{pr||(pr=!0,Ot--),Le[fr]=ai},()=>ye--,void 0,()=>{(!ye||!pr)&&(Ot||B.next(v?(0,tt.n)(v,Le):Le),B.complete())}))}});return f?x.pipe((0,jn.Z)(f)):x}(fo(d,f).map(Wn)).pipe((0,fn.U)(Li))}}(Kn(g)):null}function Ur(g,f){return null===g?[f]:Array.isArray(g)?[...g,f]:[g,f]}function Zt(g){return g?Array.isArray(g)?g:[g]:[]}function pn(g,f){return Array.isArray(g)?g.includes(f):g===f}function zn(g,f){const d=Zt(f);return Zt(g).forEach(x=>{pn(d,x)||d.push(x)}),d}function po(g,f){return Zt(f).filter(d=>!pn(g,d))}class Br{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(f){this._rawValidators=f||[],this._composedValidatorFn=ue(this._rawValidators)}_setAsyncValidators(f){this._rawAsyncValidators=f||[],this._composedAsyncValidatorFn=Fr(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(f){this._onDestroyCallbacks.push(f)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(f=>f()),this._onDestroyCallbacks=[]}reset(f){this.control&&this.control.reset(f)}hasError(f,d){return!!this.control&&this.control.hasError(f,d)}getError(f,d){return this.control?this.control.getError(f,d):null}}class xt extends Br{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Me extends Br{get formDirective(){return null}get path(){return null}}let $e=(()=>{class g extends class go{constructor(f){this._cd=f}is(f){var d,v,x;return"submitted"===f?!!(null===(d=this._cd)||void 0===d?void 0:d.submitted):!!(null===(x=null===(v=this._cd)||void 0===v?void 0:v.control)||void 0===x?void 0:x[f])}}{constructor(d){super(d)}}return g.\u0275fac=function(d){return new(d||g)(p.Y36(xt,2))},g.\u0275dir=p.lG2({type:g,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(d,v){2&d&&p.ekj("ng-untouched",v.is("untouched"))("ng-touched",v.is("touched"))("ng-pristine",v.is("pristine"))("ng-dirty",v.is("dirty"))("ng-valid",v.is("valid"))("ng-invalid",v.is("invalid"))("ng-pending",v.is("pending"))},features:[p.qOj]}),g})();function Dt(g,f){(function kt(g,f){const d=function le(g){return g._rawValidators}(g);null!==f.validator?g.setValidators(Ur(d,f.validator)):"function"==typeof d&&g.setValidators([d]);const v=function ze(g){return g._rawAsyncValidators}(g);null!==f.asyncValidator?g.setAsyncValidators(Ur(v,f.asyncValidator)):"function"==typeof v&&g.setAsyncValidators([v]);const x=()=>g.updateValueAndValidity();ct(f._rawValidators,x),ct(f._rawAsyncValidators,x)})(g,f),f.valueAccessor.writeValue(g.value),function Yt(g,f){f.valueAccessor.registerOnChange(d=>{g._pendingValue=d,g._pendingChange=!0,g._pendingDirty=!0,"change"===g.updateOn&&Fi(g,f)})}(g,f),function Qn(g,f){const d=(v,x)=>{f.valueAccessor.writeValue(v),x&&f.viewToModelUpdate(v)};g.registerOnChange(d),f._registerOnDestroy(()=>{g._unregisterOnChange(d)})}(g,f),function In(g,f){f.valueAccessor.registerOnTouched(()=>{g._pendingTouched=!0,"blur"===g.updateOn&&g._pendingChange&&Fi(g,f),"submit"!==g.updateOn&&g.markAsTouched()})}(g,f),function vo(g,f){if(f.valueAccessor.setDisabledState){const d=v=>{f.valueAccessor.setDisabledState(v)};g.registerOnDisabledChange(d),f._registerOnDestroy(()=>{g._unregisterOnDisabledChange(d)})}}(g,f)}function ct(g,f){g.forEach(d=>{d.registerOnValidatorChange&&d.registerOnValidatorChange(f)})}function Fi(g,f){g._pendingDirty&&g.markAsDirty(),g.setValue(g._pendingValue,{emitModelToViewChange:!1}),f.viewToModelUpdate(g._pendingValue),g._pendingChange=!1}function Jn(g,f){const d=g.indexOf(f);d>-1&&g.splice(d,1)}const ge="VALID",er="INVALID",Xt="PENDING",Nt="DISABLED";function zr(g){return(En(g)?g.validators:g)||null}function Eo(g){return Array.isArray(g)?ue(g):g||null}function Lt(g,f){return(En(f)?f.asyncValidators:g)||null}function qi(g){return Array.isArray(g)?Fr(g):g||null}function En(g){return null!=g&&!Array.isArray(g)&&"object"==typeof g}const tr=g=>g instanceof $i;function Zr(g){return(g=>g instanceof Tn)(g)?g.value:g.getRawValue()}function nr(g,f){const d=tr(g),v=g.controls;if(!(d?Object.keys(v):v).length)throw new p.vHH(1e3,"");if(!v[f])throw new p.vHH(1001,"")}function rr(g,f){tr(g),g._forEachChild((v,x)=>{if(void 0===f[x])throw new p.vHH(1002,"")})}class en{constructor(f,d){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=f,this._rawAsyncValidators=d,this._composedValidatorFn=Eo(this._rawValidators),this._composedAsyncValidatorFn=qi(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(f){this._rawValidators=this._composedValidatorFn=f}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(f){this._rawAsyncValidators=this._composedAsyncValidatorFn=f}get parent(){return this._parent}get valid(){return this.status===ge}get invalid(){return this.status===er}get pending(){return this.status==Xt}get disabled(){return this.status===Nt}get enabled(){return this.status!==Nt}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(f){this._rawValidators=f,this._composedValidatorFn=Eo(f)}setAsyncValidators(f){this._rawAsyncValidators=f,this._composedAsyncValidatorFn=qi(f)}addValidators(f){this.setValidators(zn(f,this._rawValidators))}addAsyncValidators(f){this.setAsyncValidators(zn(f,this._rawAsyncValidators))}removeValidators(f){this.setValidators(po(f,this._rawValidators))}removeAsyncValidators(f){this.setAsyncValidators(po(f,this._rawAsyncValidators))}hasValidator(f){return pn(this._rawValidators,f)}hasAsyncValidator(f){return pn(this._rawAsyncValidators,f)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(f={}){this.touched=!0,this._parent&&!f.onlySelf&&this._parent.markAsTouched(f)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(f=>f.markAllAsTouched())}markAsUntouched(f={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(d=>{d.markAsUntouched({onlySelf:!0})}),this._parent&&!f.onlySelf&&this._parent._updateTouched(f)}markAsDirty(f={}){this.pristine=!1,this._parent&&!f.onlySelf&&this._parent.markAsDirty(f)}markAsPristine(f={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(d=>{d.markAsPristine({onlySelf:!0})}),this._parent&&!f.onlySelf&&this._parent._updatePristine(f)}markAsPending(f={}){this.status=Xt,!1!==f.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!f.onlySelf&&this._parent.markAsPending(f)}disable(f={}){const d=this._parentMarkedDirty(f.onlySelf);this.status=Nt,this.errors=null,this._forEachChild(v=>{v.disable(Object.assign(Object.assign({},f),{onlySelf:!0}))}),this._updateValue(),!1!==f.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},f),{skipPristineCheck:d})),this._onDisabledChange.forEach(v=>v(!0))}enable(f={}){const d=this._parentMarkedDirty(f.onlySelf);this.status=ge,this._forEachChild(v=>{v.enable(Object.assign(Object.assign({},f),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:f.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},f),{skipPristineCheck:d})),this._onDisabledChange.forEach(v=>v(!1))}_updateAncestors(f){this._parent&&!f.onlySelf&&(this._parent.updateValueAndValidity(f),f.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(f){this._parent=f}updateValueAndValidity(f={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ge||this.status===Xt)&&this._runAsyncValidator(f.emitEvent)),!1!==f.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!f.onlySelf&&this._parent.updateValueAndValidity(f)}_updateTreeValidity(f={emitEvent:!0}){this._forEachChild(d=>d._updateTreeValidity(f)),this.updateValueAndValidity({onlySelf:!0,emitEvent:f.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Nt:ge}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(f){if(this.asyncValidator){this.status=Xt,this._hasOwnPendingAsyncValidator=!0;const d=Wn(this.asyncValidator(this));this._asyncValidationSubscription=d.subscribe(v=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(v,{emitEvent:f})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(f,d={}){this.errors=f,this._updateControlsErrors(!1!==d.emitEvent)}get(f){return function $a(g,f,d){if(null==f||(Array.isArray(f)||(f=f.split(d)),Array.isArray(f)&&0===f.length))return null;let v=g;return f.forEach(x=>{v=tr(v)?v.controls.hasOwnProperty(x)?v.controls[x]:null:(g=>g instanceof Wi)(v)&&v.at(x)||null}),v}(this,f,".")}getError(f,d){const v=d?this.get(d):this;return v&&v.errors?v.errors[f]:null}hasError(f,d){return!!this.getError(f,d)}get root(){let f=this;for(;f._parent;)f=f._parent;return f}_updateControlsErrors(f){this.status=this._calculateStatus(),f&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(f)}_initObservables(){this.valueChanges=new p.vpe,this.statusChanges=new p.vpe}_calculateStatus(){return this._allControlsDisabled()?Nt:this.errors?er:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Xt)?Xt:this._anyControlsHaveStatus(er)?er:ge}_anyControlsHaveStatus(f){return this._anyControls(d=>d.status===f)}_anyControlsDirty(){return this._anyControls(f=>f.dirty)}_anyControlsTouched(){return this._anyControls(f=>f.touched)}_updatePristine(f={}){this.pristine=!this._anyControlsDirty(),this._parent&&!f.onlySelf&&this._parent._updatePristine(f)}_updateTouched(f={}){this.touched=this._anyControlsTouched(),this._parent&&!f.onlySelf&&this._parent._updateTouched(f)}_isBoxedValue(f){return"object"==typeof f&&null!==f&&2===Object.keys(f).length&&"value"in f&&"disabled"in f}_registerOnCollectionChange(f){this._onCollectionChange=f}_setUpdateStrategy(f){En(f)&&null!=f.updateOn&&(this._updateOn=f.updateOn)}_parentMarkedDirty(f){return!f&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class Tn extends en{constructor(f=null,d,v){super(zr(d),Lt(v,d)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(f),this._setUpdateStrategy(d),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),En(d)&&d.initialValueIsDefault&&(this.defaultValue=this._isBoxedValue(f)?f.value:f)}setValue(f,d={}){this.value=this._pendingValue=f,this._onChange.length&&!1!==d.emitModelToViewChange&&this._onChange.forEach(v=>v(this.value,!1!==d.emitViewToModelChange)),this.updateValueAndValidity(d)}patchValue(f,d={}){this.setValue(f,d)}reset(f=this.defaultValue,d={}){this._applyFormState(f),this.markAsPristine(d),this.markAsUntouched(d),this.setValue(this.value,d),this._pendingChange=!1}_updateValue(){}_anyControls(f){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(f){this._onChange.push(f)}_unregisterOnChange(f){Jn(this._onChange,f)}registerOnDisabledChange(f){this._onDisabledChange.push(f)}_unregisterOnDisabledChange(f){Jn(this._onDisabledChange,f)}_forEachChild(f){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(f){this._isBoxedValue(f)?(this.value=this._pendingValue=f.value,f.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=f}}class $i extends en{constructor(f,d,v){super(zr(d),Lt(v,d)),this.controls=f,this._initObservables(),this._setUpdateStrategy(d),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(f,d){return this.controls[f]?this.controls[f]:(this.controls[f]=d,d.setParent(this),d._registerOnCollectionChange(this._onCollectionChange),d)}addControl(f,d,v={}){this.registerControl(f,d),this.updateValueAndValidity({emitEvent:v.emitEvent}),this._onCollectionChange()}removeControl(f,d={}){this.controls[f]&&this.controls[f]._registerOnCollectionChange(()=>{}),delete this.controls[f],this.updateValueAndValidity({emitEvent:d.emitEvent}),this._onCollectionChange()}setControl(f,d,v={}){this.controls[f]&&this.controls[f]._registerOnCollectionChange(()=>{}),delete this.controls[f],d&&this.registerControl(f,d),this.updateValueAndValidity({emitEvent:v.emitEvent}),this._onCollectionChange()}contains(f){return this.controls.hasOwnProperty(f)&&this.controls[f].enabled}setValue(f,d={}){rr(this,f),Object.keys(f).forEach(v=>{nr(this,v),this.controls[v].setValue(f[v],{onlySelf:!0,emitEvent:d.emitEvent})}),this.updateValueAndValidity(d)}patchValue(f,d={}){null!=f&&(Object.keys(f).forEach(v=>{this.controls[v]&&this.controls[v].patchValue(f[v],{onlySelf:!0,emitEvent:d.emitEvent})}),this.updateValueAndValidity(d))}reset(f={},d={}){this._forEachChild((v,x)=>{v.reset(f[x],{onlySelf:!0,emitEvent:d.emitEvent})}),this._updatePristine(d),this._updateTouched(d),this.updateValueAndValidity(d)}getRawValue(){return this._reduceChildren({},(f,d,v)=>(f[v]=Zr(d),f))}_syncPendingControls(){let f=this._reduceChildren(!1,(d,v)=>!!v._syncPendingControls()||d);return f&&this.updateValueAndValidity({onlySelf:!0}),f}_forEachChild(f){Object.keys(this.controls).forEach(d=>{const v=this.controls[d];v&&f(v,d)})}_setUpControls(){this._forEachChild(f=>{f.setParent(this),f._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(f){for(const d of Object.keys(this.controls)){const v=this.controls[d];if(this.contains(d)&&f(v))return!0}return!1}_reduceValue(){return this._reduceChildren({},(f,d,v)=>((d.enabled||this.disabled)&&(f[v]=d.value),f))}_reduceChildren(f,d){let v=f;return this._forEachChild((x,B)=>{v=d(v,x,B)}),v}_allControlsDisabled(){for(const f of Object.keys(this.controls))if(this.controls[f].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}}class Wi extends en{constructor(f,d,v){super(zr(d),Lt(v,d)),this.controls=f,this._initObservables(),this._setUpdateStrategy(d),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(f){return this.controls[f]}push(f,d={}){this.controls.push(f),this._registerControl(f),this.updateValueAndValidity({emitEvent:d.emitEvent}),this._onCollectionChange()}insert(f,d,v={}){this.controls.splice(f,0,d),this._registerControl(d),this.updateValueAndValidity({emitEvent:v.emitEvent})}removeAt(f,d={}){this.controls[f]&&this.controls[f]._registerOnCollectionChange(()=>{}),this.controls.splice(f,1),this.updateValueAndValidity({emitEvent:d.emitEvent})}setControl(f,d,v={}){this.controls[f]&&this.controls[f]._registerOnCollectionChange(()=>{}),this.controls.splice(f,1),d&&(this.controls.splice(f,0,d),this._registerControl(d)),this.updateValueAndValidity({emitEvent:v.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(f,d={}){rr(this,f),f.forEach((v,x)=>{nr(this,x),this.at(x).setValue(v,{onlySelf:!0,emitEvent:d.emitEvent})}),this.updateValueAndValidity(d)}patchValue(f,d={}){null!=f&&(f.forEach((v,x)=>{this.at(x)&&this.at(x).patchValue(v,{onlySelf:!0,emitEvent:d.emitEvent})}),this.updateValueAndValidity(d))}reset(f=[],d={}){this._forEachChild((v,x)=>{v.reset(f[x],{onlySelf:!0,emitEvent:d.emitEvent})}),this._updatePristine(d),this._updateTouched(d),this.updateValueAndValidity(d)}getRawValue(){return this.controls.map(f=>Zr(f))}clear(f={}){this.controls.length<1||(this._forEachChild(d=>d._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:f.emitEvent}))}_syncPendingControls(){let f=this.controls.reduce((d,v)=>!!v._syncPendingControls()||d,!1);return f&&this.updateValueAndValidity({onlySelf:!0}),f}_forEachChild(f){this.controls.forEach((d,v)=>{f(d,v)})}_updateValue(){this.value=this.controls.filter(f=>f.enabled||this.disabled).map(f=>f.value)}_anyControls(f){return this.controls.some(d=>d.enabled&&f(d))}_setUpControls(){this._forEachChild(f=>this._registerControl(f))}_allControlsDisabled(){for(const f of this.controls)if(f.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(f){f.setParent(this),f._registerOnCollectionChange(this._onCollectionChange)}}const tn={provide:xt,useExisting:(0,p.Gpc)(()=>sr)},Rt=(()=>Promise.resolve(null))();let sr=(()=>{class g extends xt{constructor(d,v,x,B,ee){super(),this._changeDetectorRef=ee,this.control=new Tn,this._registered=!1,this.update=new p.vpe,this._parent=d,this._setValidators(v),this._setAsyncValidators(x),this.valueAccessor=function Jt(g,f){if(!f)return null;let d,v,x;return Array.isArray(f),f.forEach(B=>{B.constructor===se?d=B:function ja(g){return Object.getPrototypeOf(g.constructor)===Ct}(B)?v=B:x=B}),x||v||d||null}(0,B)}ngOnChanges(d){if(this._checkForErrors(),!this._registered||"name"in d){if(this._registered&&(this._checkName(),this.formDirective)){const v=d.name.previousValue;this.formDirective.removeControl({name:v,path:this._getPath(v)})}this._setUpControl()}"isDisabled"in d&&this._updateDisabled(d),function Bi(g,f){if(!g.hasOwnProperty("model"))return!1;const d=g.model;return!!d.isFirstChange()||!Object.is(f,d.currentValue)}(d,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(d){this.viewModel=d,this.update.emit(d)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Dt(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(d){Rt.then(()=>{var v;this.control.setValue(d,{emitViewToModelChange:!1}),null===(v=this._changeDetectorRef)||void 0===v||v.markForCheck()})}_updateDisabled(d){const v=d.isDisabled.currentValue,x=""===v||v&&"false"!==v;Rt.then(()=>{var B;x&&!this.control.disabled?this.control.disable():!x&&this.control.disabled&&this.control.enable(),null===(B=this._changeDetectorRef)||void 0===B||B.markForCheck()})}_getPath(d){return this._parent?function vn(g,f){return[...f.path,g]}(d,this._parent):[d]}}return g.\u0275fac=function(d){return new(d||g)(p.Y36(Me,9),p.Y36(pe,10),p.Y36(vt,10),p.Y36(_t,10),p.Y36(p.sBO,8))},g.\u0275dir=p.lG2({type:g,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[p._Bn([tn]),p.qOj,p.TTD]}),g})(),Zi=(()=>{class g{}return g.\u0275fac=function(d){return new(d||g)},g.\u0275mod=p.oAB({type:g}),g.\u0275inj=p.cJS({}),g})();const ar=new p.OlP("NgModelWithFormControlWarning"),Xi={provide:_t,useExisting:(0,p.Gpc)(()=>ur),multi:!0};function es(g,f){return null==g?`${f}`:(f&&"object"==typeof f&&(f="Object"),`${g}: ${f}`.slice(0,50))}let ur=(()=>{class g extends Ct{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(d){this._compareWith=d}writeValue(d){this.value=d;const x=es(this._getOptionId(d),d);this.setProperty("value",x)}registerOnChange(d){this.onChange=v=>{this.value=this._getOptionValue(v),d(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(d){for(const v of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(v),d))return v;return null}_getOptionValue(d){const v=function on(g){return g.split(":")[0]}(d);return this._optionMap.has(v)?this._optionMap.get(v):d}}return g.\u0275fac=function(){let f;return function(v){return(f||(f=p.n5z(g)))(v||g)}}(),g.\u0275dir=p.lG2({type:g,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(d,v){1&d&&p.NdJ("change",function(B){return v.onChange(B.target.value)})("blur",function(){return v.onTouched()})},inputs:{compareWith:"compareWith"},features:[p._Bn([Xi]),p.qOj]}),g})(),bn=(()=>{class g{constructor(d,v,x){this._element=d,this._renderer=v,this._select=x,this._select&&(this.id=this._select._registerOption())}set ngValue(d){null!=this._select&&(this._select._optionMap.set(this.id,d),this._setElementValue(es(this.id,d)),this._select.writeValue(this._select.value))}set value(d){this._setElementValue(d),this._select&&this._select.writeValue(this._select.value)}_setElementValue(d){this._renderer.setProperty(this._element.nativeElement,"value",d)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return g.\u0275fac=function(d){return new(d||g)(p.Y36(p.SBq),p.Y36(p.Qsj),p.Y36(ur,9))},g.\u0275dir=p.lG2({type:g,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),g})();const ts={provide:_t,useExisting:(0,p.Gpc)(()=>Xr),multi:!0};function Jr(g,f){return null==g?`${f}`:("string"==typeof f&&(f=`'${f}'`),f&&"object"==typeof f&&(f="Object"),`${g}: ${f}`.slice(0,50))}let Xr=(()=>{class g extends Ct{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(d){this._compareWith=d}writeValue(d){let v;if(this.value=d,Array.isArray(d)){const x=d.map(B=>this._getOptionId(B));v=(B,ee)=>{B._setSelected(x.indexOf(ee.toString())>-1)}}else v=(x,B)=>{x._setSelected(!1)};this._optionMap.forEach(v)}registerOnChange(d){this.onChange=v=>{const x=[],B=v.selectedOptions;if(void 0!==B){const ee=B;for(let Le=0;Le<ee.length;Le++){const Ot=this._getOptionValue(ee[Le].value);x.push(Ot)}}else{const ee=v.options;for(let Le=0;Le<ee.length;Le++){const ye=ee[Le];if(ye.selected){const Ot=this._getOptionValue(ye.value);x.push(Ot)}}}this.value=x,d(x)}}_registerOption(d){const v=(this._idCounter++).toString();return this._optionMap.set(v,d),v}_getOptionId(d){for(const v of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(v)._value,d))return v;return null}_getOptionValue(d){const v=function lr(g){return g.split(":")[0]}(d);return this._optionMap.has(v)?this._optionMap.get(v)._value:d}}return g.\u0275fac=function(){let f;return function(v){return(f||(f=p.n5z(g)))(v||g)}}(),g.\u0275dir=p.lG2({type:g,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(d,v){1&d&&p.NdJ("change",function(B){return v.onChange(B.target)})("blur",function(){return v.onTouched()})},inputs:{compareWith:"compareWith"},features:[p._Bn([ts]),p.qOj]}),g})(),ei=(()=>{class g{constructor(d,v,x){this._element=d,this._renderer=v,this._select=x,this._select&&(this.id=this._select._registerOption(this))}set ngValue(d){null!=this._select&&(this._value=d,this._setElementValue(Jr(this.id,d)),this._select.writeValue(this._select.value))}set value(d){this._select?(this._value=d,this._setElementValue(Jr(this.id,d)),this._select.writeValue(this._select.value)):this._setElementValue(d)}_setElementValue(d){this._renderer.setProperty(this._element.nativeElement,"value",d)}_setSelected(d){this._renderer.setProperty(this._element.nativeElement,"selected",d)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return g.\u0275fac=function(d){return new(d||g)(p.Y36(p.SBq),p.Y36(p.Qsj),p.Y36(Xr,9))},g.\u0275dir=p.lG2({type:g,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),g})(),un=(()=>{class g{}return g.\u0275fac=function(d){return new(d||g)},g.\u0275mod=p.oAB({type:g}),g.\u0275inj=p.cJS({imports:[[Zi]]}),g})(),Ee=(()=>{class g{}return g.\u0275fac=function(d){return new(d||g)},g.\u0275mod=p.oAB({type:g}),g.\u0275inj=p.cJS({imports:[un]}),g})(),Tt=(()=>{class g{static withConfig(d){return{ngModule:g,providers:[{provide:ar,useValue:d.warnOnNgModelWithFormControl}]}}}return g.\u0275fac=function(d){return new(d||g)},g.\u0275mod=p.oAB({type:g}),g.\u0275inj=p.cJS({imports:[un]}),g})()}}]);